<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/xxb/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"dmyang-only.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="DmYoung">
<meta property="og:url" content="https://dmyang-only.github.io/page/4/index.html">
<meta property="og:site_name" content="DmYoung">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="dmYang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://dmyang-only.github.io/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>DmYoung</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">DmYoung</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">记录美好日常</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dmyang-only.github.io/2020/11/11/10JDK8%E6%96%B0%E7%89%B9%E6%80%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dmYang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DmYoung">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/11/10JDK8%E6%96%B0%E7%89%B9%E6%80%A7/" class="post-title-link" itemprop="url">JDK8新特性</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-11 12:33:33" itemprop="dateCreated datePublished" datetime="2020-11-11T12:33:33+08:00">2020-11-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-12-17 13:10:33" itemprop="dateModified" datetime="2020-12-17T13:10:33+08:00">2020-12-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">java基础</span></a>
                </span>
            </span>

          
            <span id="/2020/11/11/10JDK8%E6%96%B0%E7%89%B9%E6%80%A7/" class="post-meta-item leancloud_visitors" data-flag-title="JDK8新特性" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>14k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>13 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="一、Lambda"><a href="#一、Lambda" class="headerlink" title="一、Lambda"></a>一、Lambda</h3><blockquote>
<p>函数式表示式，-&gt; 为Lambda运算符，读作（goes to）</p>
<p><strong>Lambda 表达式免去了使用匿名方法的麻烦，并且给予Java简单但是强大的函数化的编程能力。</strong></p>
</blockquote>
<h4 id="1、格式"><a href="#1、格式" class="headerlink" title="1、格式"></a>1、格式</h4><blockquote>
<p>（形式参数）-&gt;{代码块}</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyInterface</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">show</span><span class="params">(String s)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterfaceDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//使用实现类</span></span><br><span class="line">        MyInterface myInterface1=<span class="keyword">new</span> MyInterfaceDemo1();</span><br><span class="line">        myInterface1.show(<span class="string">&quot;show1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//使用Lambda表达式</span></span><br><span class="line">        MyInterface myInterface=s-&gt; System.out.println(<span class="string">&quot;函数式接口&quot;</span>+s);</span><br><span class="line">        myInterface.show(<span class="string">&quot;show1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyInterfaceDemo1</span> <span class="keyword">implements</span> <span class="title">MyInterface</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;函数式接口&quot;</span>+s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="2、使用特点"><a href="#2、使用特点" class="headerlink" title="2、使用特点"></a>2、使用特点</h4><ul>
<li>不需要声明参数类型，编译器可以统一识别参数值  x-&gt;2*x</li>
<li>一个参数无需定义圆括号，但多个参数需要定义圆括号 </li>
<li>主体<strong>只有一个表达式返回值则编译器会自动返回值</strong>，大括号需要指定表达式返回一个数值<ul>
<li>(String s) -&gt;System.out.print(s)</li>
</ul>
</li>
</ul>
<h4 id="3、使用"><a href="#3、使用" class="headerlink" title="3、使用"></a>3、使用</h4><ul>
<li><strong>使用Lambda必须要有接口，接口中只能有一个抽象方法</strong></li>
<li>必须要有<strong>上下文环境</strong>，调用接口抽象方法，使用Lambda表达式可以不用写 接口实现类</li>
<li>Lambda表达式中参数和接口抽象方法的形参保持一致</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Addable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Flyable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">fly</span><span class="params">(String s)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">     useAdd((<span class="keyword">int</span> x,<span class="keyword">int</span> y)-&gt;&#123;</span><br><span class="line">         <span class="keyword">return</span> x+y;</span><br><span class="line"><span class="comment">//       return x-y;</span></span><br><span class="line">     &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//省略，去掉花括号有return会报错</span></span><br><span class="line">    useAdd((x,y)-&gt;x+y);</span><br><span class="line">    <span class="comment">//Lambda</span></span><br><span class="line">    useFlyable((String s)-&gt;&#123;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">        System.out.println(<span class="string">&quot;飞机&quot;</span>+s);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//省略,只有一个参数时，括号和花括号可以被省略</span></span><br><span class="line">    useFlyable(s -&gt; System.out.println(s));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">useAdd</span><span class="params">(Addable addable)</span></span>&#123;</span><br><span class="line">     <span class="keyword">int</span> add=addable.add(<span class="number">10</span>,<span class="number">5</span>);</span><br><span class="line">     System.out.println(add);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">useFlyable</span><span class="params">(Flyable flyable)</span></span>&#123;</span><br><span class="line">        flyable.fly(<span class="string">&quot;飞飞飞&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="4、Lambda表达式和匿名内部类"><a href="#4、Lambda表达式和匿名内部类" class="headerlink" title="4、Lambda表达式和匿名内部类"></a>4、Lambda表达式和匿名内部类</h4><ul>
<li>使用限制：Lambda表达式适用于仅有一个抽象类的接口，匿名内部类可用于多个抽象类的接口</li>
<li>所需类型：Lambda表达式只能是接口，匿名内部类可以是接口、抽象类、普通类</li>
<li>实现原理：匿名内部类编译产生一个单独.class文件，而Lambda对应的<strong>字节码动态生成</strong></li>
</ul>
<h3 id="二、接口组成更新"><a href="#二、接口组成更新" class="headerlink" title="二、接口组成更新"></a>二、接口组成更新</h3><ul>
<li>常量 public final static</li>
<li>抽象方法 public abstract</li>
<li>默认方法 default  (JDK8)</li>
<li>静态方法 static  (JDK8)</li>
<li>私有方法 private （JDK9）</li>
</ul>
<h4 id="2-1-接口默认方法"><a href="#2-1-接口默认方法" class="headerlink" title="2.1 接口默认方法"></a>2.1 接口默认方法</h4><blockquote>
<p>public default void demo1(){</p>
<p>​    System.out.print(“show1”);</p>
<p>}</p>
</blockquote>
<ul>
<li>默认方法不是抽象方法，<strong>不强制被重写</strong>，<strong>但是可以被重写</strong></li>
<li>default不能被省略</li>
</ul>
<h4 id="2-2-接口静态方法"><a href="#2-2-接口静态方法" class="headerlink" title="2.2 接口静态方法"></a>2.2 接口静态方法</h4><blockquote>
<p>public static void show(){</p>
<p>​    System.out.print(“show2”);</p>
<p>}</p>
</blockquote>
<ul>
<li>接口静态方法只能通过<strong>接口名</strong>调用，不能通过实现类或者对象名调用</li>
<li>若<code>通过实现类或者对象名调用</code>，当实现类继承多个接口时，就不知道调用哪一个接口静态方法</li>
</ul>
<h4 id="2-3-接口私有方法"><a href="#2-3-接口私有方法" class="headerlink" title="2.3 接口私有方法"></a>2.3 接口私有方法</h4><p>jdk9</p>
<blockquote>
<p>格式一</p>
<p>private void show(){</p>
<p>​    System.out.print(“show2”);</p>
<p>}</p>
</blockquote>
<blockquote>
<p>格式二</p>
<p>private static void show(){</p>
<p>​    System.out.print(“show2”);</p>
<p>}</p>
</blockquote>
<ul>
<li>接口中，默认方法可以调用私有的静态方法和非静态方法</li>
<li>静态方法只能调用私有的静态方法</li>
</ul>
<h3 id="三、方法引用"><a href="#三、方法引用" class="headerlink" title="三、方法引用"></a>三、方法引用</h3><p>引用已经存在的方法</p>
<h4 id="1、方法引用符"><a href="#1、方法引用符" class="headerlink" title="1、方法引用符"></a>1、方法引用符</h4><blockquote>
<p>：：引用运算符，所在的表达式被称为方法引用</p>
</blockquote>
<ul>
<li><p>Lambda，根据”可推导就是可省略”的原则，无需指定参数类型，也无需指定的重载形式，它们被自动推导</p>
</li>
<li><p>方法引用是Lambda表达式的孪生兄弟</p>
</li>
</ul>
<h4 id="2、引用类方法"><a href="#2、引用类方法" class="headerlink" title="2、引用类方法"></a>2、引用类方法</h4><blockquote>
<p><strong>引用类的静态方法</strong></p>
<p>格式：类名：：静态方法</p>
<p>Lambda表达式被类方法替代的时候，它的形式参数<strong>全部传递</strong>给静态方法作为参数</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Lambda表达式省略</span></span><br><span class="line">useConverter(s -&gt;Integer.parseInt(s));</span><br><span class="line"><span class="comment">//引用类方法</span></span><br><span class="line">useConverter(Integer::parseInt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">useConverter</span><span class="params">(Converter converter)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> num = converter.converter(<span class="string">&quot;666&quot;</span>);</span><br><span class="line">    System.out.println(num);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="3、-引用对象的实例方法"><a href="#3、-引用对象的实例方法" class="headerlink" title="3、**引用对象的实例方法"></a>3、**引用对象的实例方法</h4><blockquote>
<p>格式：引用对象：：实例方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Printer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printUpperCase</span><span class="params">(String s)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PrintDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        usePrinter(s -&gt; System.out.println(s.toUpperCase()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//子类实现接口</span></span><br><span class="line">        PrinterDemo1 printDemo=<span class="keyword">new</span> PrinterDemo1();</span><br><span class="line">        printDemo.printUpperCase(<span class="string">&quot;hello World&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Lambda表达式</span></span><br><span class="line">        usePrinter(s-&gt;<span class="keyword">new</span> PrintString().printUpper(s));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//引用对象的实例方法</span></span><br><span class="line">        PrintString printString=<span class="keyword">new</span> PrintString();</span><br><span class="line">        usePrinter(printString::printUpper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">usePrinter</span><span class="params">(Printer printer)</span></span>&#123;</span><br><span class="line">        printer.printUpperCase(<span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PrinterDemo1</span> <span class="keyword">implements</span> <span class="title">Printer</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printUpperCase</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> PrintString().printUpper(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PrintString</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printUpper</span><span class="params">(String s)</span></span>&#123;</span><br><span class="line">        String s1=s.toUpperCase();</span><br><span class="line">        System.out.println(s1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="4、引用类的实例方法"><a href="#4、引用类的实例方法" class="headerlink" title="4、引用类的实例方法"></a>4、引用类的实例方法</h4><blockquote>
<p>引用类中的成员方法</p>
<p>格式： 类名：：成员方法</p>
</blockquote>
<ul>
<li>Lambda表达式被类的实例方法替代的时候</li>
<li><strong>第一个参数作为调用者</strong>，后面的参数全部传递给该方法作为参数</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    useMyString((s,x,y)-&gt;&#123;</span><br><span class="line">        <span class="keyword">return</span> s.substring(x,y);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    useMyString(String::substring);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">useMyString</span><span class="params">(MyString myString)</span></span>&#123;</span><br><span class="line">    String s=myString.mySubString(<span class="string">&quot;HelloWord&quot;</span>,<span class="number">2</span>,<span class="number">5</span>);</span><br><span class="line">    System.out.println(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="5、引用构造器"><a href="#5、引用构造器" class="headerlink" title="5、引用构造器"></a>5、引用构造器</h4><blockquote>
<p>引用构造方法</p>
<p>格式 ： 类名：：new</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        add((name,age)-&gt;&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Teacher(name,age);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        add(Teacher::<span class="keyword">new</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Teachere teachere)</span></span>&#123;</span><br><span class="line">        Teacher teacher = teachere.show(<span class="string">&quot;小明&quot;</span>, <span class="number">11</span>);</span><br><span class="line">        System.out.println(teacher);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Teachere</span></span>&#123;</span><br><span class="line">    <span class="function">Teacher <span class="title">show</span><span class="params">(String name,<span class="keyword">int</span> age)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Teacher</span></span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Teacher</span><span class="params">(String name, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="四、函数式接口"><a href="#四、函数式接口" class="headerlink" title="四、函数式接口"></a>四、函数式接口</h3><h4 id="1、概述"><a href="#1、概述" class="headerlink" title="1、概述"></a>1、概述</h4><blockquote>
<p>函数式接口：有且仅有一个抽象方法的接口</p>
<p><code>@FunctiongalInterface</code></p>
</blockquote>
<img src="https://csn.damyoung.cn/image-20200927123553414.png" alt="image-20200927123553414" style="zoom:80%;" />

<h4 id="2、使用方式"><a href="#2、使用方式" class="headerlink" title="2、使用方式"></a>2、使用方式</h4><h5 id="2-1-函数式接口作为方法的参数"><a href="#2-1-函数式接口作为方法的参数" class="headerlink" title="2.1 函数式接口作为方法的参数"></a>2.1 函数式接口作为方法的参数</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//匿名内部类形式</span></span><br><span class="line">    startThread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;线程启动&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Lambda表达式</span></span><br><span class="line">    startThread(()-&gt; System.out.println(Thread.currentThread().getName()+<span class="string">&quot;线程启动了&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">startThread</span><span class="params">(Runnable runnable)</span></span>&#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(runnable).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="2-2-函数式接口作为方法的返回值"><a href="#2-2-函数式接口作为方法的返回值" class="headerlink" title="2.2 函数式接口作为方法的返回值"></a>2.2 函数式接口作为方法的返回值</h5><blockquote>
<p>如果方法的返回值是一个函数式接口，可以使用Lambda表达式作为结果返回</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ArrayList&lt;String&gt; arrayList=<span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        arrayList.add(<span class="string">&quot;aaaa&quot;</span>);</span><br><span class="line">        arrayList.add(<span class="string">&quot;bbb&quot;</span>);</span><br><span class="line">        arrayList.add(<span class="string">&quot;c&quot;</span>);</span><br><span class="line">        Collections.sort(arrayList);</span><br><span class="line">        System.out.println(<span class="string">&quot;排序前&quot;</span>+arrayList);</span><br><span class="line"></span><br><span class="line">        Collections.sort(arrayList,getComparator());</span><br><span class="line">        System.out.println(<span class="string">&quot;排序后&quot;</span>+arrayList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Comparator&lt;String&gt; <span class="title">getComparator</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//        return new Comparator&lt;String&gt;() &#123;</span></span><br><span class="line"><span class="comment">//            @Override</span></span><br><span class="line"><span class="comment">//            public int compare(String s1, String s2) &#123;</span></span><br><span class="line"><span class="comment">//                return s1.length()-s2.length();</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//        &#125;;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (s1,s2)-&gt;s1.length()-s2.length();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h4 id="3、函数式接口"><a href="#3、函数式接口" class="headerlink" title="3、函数式接口"></a>3、函数式接口</h4><h5 id="3-1-Supplier"><a href="#3-1-Supplier" class="headerlink" title="3.1 Supplier"></a>3.1 Supplier</h5><ul>
<li>T get() 获得结果</li>
<li>该方法不需要参数，会按照某种实现逻辑(由Lambda表达式实现) 返回一个数据</li>
<li>Supplier&lt; T&gt; 接口被称为<strong>生产型接口</strong>，指定接口的泛型是什么类型，接口中get就会生产出什么类型供我们使用</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> maxValue=getMax(()-&gt;&#123;</span><br><span class="line">       <span class="keyword">int</span>[] arr=&#123;<span class="number">1</span>,<span class="number">4</span>,<span class="number">23</span>,<span class="number">12</span>,<span class="number">44</span>&#125;;</span><br><span class="line">       <span class="keyword">int</span> max=<span class="number">0</span>;</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;arr.length;i++)&#123;</span><br><span class="line">           <span class="keyword">if</span> (arr[i] &gt;= arr[max])&#123;</span><br><span class="line">                max=i;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> arr[max];</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    System.out.println(maxValue);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Integer <span class="title">getMax</span><span class="params">(Supplier&lt;Integer&gt; supplier)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> supplier.get();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="3-2-Consumer"><a href="#3-2-Consumer" class="headerlink" title="3.2 Consumer"></a>3.2 Consumer</h5><ul>
<li><strong>消费型接口</strong>，它消费的数据的数据类型由泛型指定</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        operatorString(<span class="string">&quot;林青霞&quot;</span>,s -&gt; System.out.println(<span class="keyword">new</span> StringBuffer(s).reverse().toString())</span><br><span class="line">        ,System.out::println);</span><br><span class="line">     operatorString(<span class="string">&quot;凌青霞&quot;</span>,<span class="number">34</span>,System.out::print,i-&gt; System.out.print(String.valueOf(i+<span class="number">200</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *定义一个方法，用不同方式消费同一个字符串数据俩次</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">operatorString</span><span class="params">(String name,Consumer&lt;String&gt; consumer,Consumer&lt;String&gt; consumer1)</span></span>&#123;</span><br><span class="line"><span class="comment">//   consumer.accept(name);</span></span><br><span class="line"><span class="comment">//   consumer1.accept(name);</span></span><br><span class="line">  consumer.andThen(consumer1).accept(name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">operatorString</span><span class="params">(String name,<span class="keyword">int</span> age,Consumer&lt;String&gt; consumer,Consumer&lt;Integer&gt; consumer1)</span></span>&#123;</span><br><span class="line">        consumer.accept(name);</span><br><span class="line">        consumer1.accept(age);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="3-3-Predicate"><a href="#3-3-Predicate" class="headerlink" title="3.3 Predicate"></a>3.3 Predicate</h5><ul>
<li>用于判断参数是否满足指定的条件</li>
<li>boolean test(T,t)：对给定参数进行判断，返回boolean值</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> b=checkString(<span class="string">&quot;hello&quot;</span>,s -&gt; s.length()&gt;<span class="number">6</span>);</span><br><span class="line">    System.out.println(b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">checkString</span><span class="params">(String str, Predicate&lt;String&gt; predicate)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> predicate.test(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>negate()</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//negate()对结果进行逻辑非操作</span></span><br><span class="line"><span class="keyword">return</span> predicate.negate().test(str);</span><br></pre></td></tr></table></figure>

<ul>
<li>短路与and，短路或or</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> hello = checkString(<span class="string">&quot;hello&quot;</span>, s -&gt; s.length() &gt; <span class="number">7</span>, s -&gt; s.length() &lt; <span class="number">6</span>);</span><br><span class="line">    System.out.println(hello);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对同一个字符串给出俩个不同的判断条件，最后把这个俩个判断结果合成</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">checkString</span><span class="params">(String str, Predicate&lt;String&gt; predicate,Predicate&lt;String&gt; predicate1)</span></span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> b1=predicate.test(str);</span><br><span class="line">    <span class="keyword">boolean</span> b2=predicate1.test(str);</span><br><span class="line"> <span class="comment">//        return b1 &amp;&amp; b2;</span></span><br><span class="line">    <span class="comment">//短路与</span></span><br><span class="line">    <span class="keyword">return</span> predicate.and(predicate1).test(str);</span><br><span class="line">    <span class="comment">//短路或</span></span><br><span class="line">    <span class="keyword">return</span> predicate.or(predicate1).test(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>应用</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> admin</span></span><br><span class="line"><span class="comment"> *      给定姓名+年龄的字符串数组</span></span><br><span class="line"><span class="comment"> *      - 查找出同时符合: 年龄&gt;35,姓名长度&gt;2的数组集合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PredicateTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String[] strArray=&#123;<span class="string">&quot;林青霞,30&quot;</span>,<span class="string">&quot;凉凉,20&quot;</span>,<span class="string">&quot;张曼玉,42&quot;</span>&#125;;</span><br><span class="line">        ArrayList&lt;String&gt; list=myFilter(strArray,s -&gt; s.split(<span class="string">&quot;,&quot;</span>)[<span class="number">0</span>].length()&gt;<span class="number">2</span>,</span><br><span class="line">                                        s -&gt; Integer.parseInt(s.split(<span class="string">&quot;,&quot;</span>)[<span class="number">1</span>])&gt;<span class="number">34</span>);</span><br><span class="line">        System.out.println(list.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ArrayList&lt;String&gt; <span class="title">myFilter</span><span class="params">(String[] strArray, Predicate&lt;String&gt;predicate</span></span></span><br><span class="line"><span class="function"><span class="params">                                         ,Predicate&lt;String&gt; predicate1)</span></span>&#123;</span><br><span class="line">        ArrayList&lt;String&gt; list=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (String str:strArray)&#123;</span><br><span class="line">            <span class="keyword">if</span> (predicate.and(predicate1).test(str))&#123;</span><br><span class="line">                list.add(str);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="3-4-function"><a href="#3-4-function" class="headerlink" title="3.4  function"></a>3.4  function</h5><blockquote>
<p>interface Function&lt; T,R&gt; </p>
<p>R apply(T,t) </p>
<p>default <V> Function&lt;T, V&gt; andThen(Function&lt;? super R, ? extends V&gt; after)  组合</p>
</blockquote>
<ul>
<li>用于对参数用于<strong>对参数进行处理</strong>，转换(处理逻辑由Lambda表达式实现)，然后<strong>返回一个新的值</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        convert(<span class="string">&quot;444&quot;</span>,s -&gt; Integer.parseInt(s));</span><br><span class="line">        convert1(<span class="number">444</span>,integer -&gt; String.valueOf(integer+<span class="number">100</span>));</span><br><span class="line"></span><br><span class="line">        convert2(<span class="string">&quot;444&quot;</span>,s -&gt; Integer.parseInt(s),integer -&gt; String.valueOf(integer+<span class="number">200</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义一个方法，将一个字符串转换为int类型</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">convert</span><span class="params">(String str, Function&lt;String,Integer&gt; fun)</span></span>&#123;</span><br><span class="line">        Integer apply = fun.apply(str);</span><br><span class="line">        System.out.println(apply);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义一个方法，将一个int类型转换为String类型</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">convert1</span><span class="params">(<span class="keyword">int</span> i,Function&lt;Integer, String&gt; fun1)</span></span>&#123;</span><br><span class="line">        String app=fun1.apply(i);</span><br><span class="line">        System.out.println(app);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//组合</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">convert2</span><span class="params">(String str,Function&lt;String, Integer&gt; fun1,Function&lt;Integer,String&gt; fun2)</span></span>&#123;</span><br><span class="line"><span class="comment">//        Integer i = fun1.apply(str);</span></span><br><span class="line"><span class="comment">//        String s = fun2.apply(i);</span></span><br><span class="line">        String s = fun1.andThen(fun2).apply(str);</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>应用</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    String str=<span class="string">&quot;林青霞,30&quot;</span>;</span><br><span class="line">    convert(str,s-&gt;s.split(<span class="string">&quot;,&quot;</span>)[<span class="number">1</span>], Integer::parseInt, integer -&gt; String.valueOf(integer+<span class="number">70</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">convert</span><span class="params">(String s, Function&lt;String,String&gt; fun1, Function&lt;String,Integer&gt; fun2,</span></span></span><br><span class="line"><span class="function"><span class="params">                           Function&lt;Integer, String&gt; fun3)</span></span>&#123;</span><br><span class="line">		String apply = fun1.andThen(fun2).andThen(fun3).apply(s);</span><br><span class="line">        System.out.println(apply);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="五、Stream流"><a href="#五、Stream流" class="headerlink" title="五、Stream流"></a>五、Stream流</h3><blockquote>
<p>使用：生成流<code>list.stream()</code>–&gt;中间操作<code>filter()-</code>-&gt;终结操作<code>foreach()</code></p>
</blockquote>
<h4 id="1、演示"><a href="#1、演示" class="headerlink" title="1、演示"></a>1、演示</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;String&gt; arrayList=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">arrayList.add(<span class="string">&quot;林青霞&quot;</span>);</span><br><span class="line">arrayList.add(<span class="string">&quot;张曼玉&quot;</span>);</span><br><span class="line">arrayList.add(<span class="string">&quot;王祖贤&quot;</span>);</span><br><span class="line">arrayList.add(<span class="string">&quot;柳岩&quot;</span>);</span><br><span class="line">arrayList.add(<span class="string">&quot;张敏&quot;</span>);</span><br><span class="line">arrayList.add(<span class="string">&quot;张无忌&quot;</span>);</span><br><span class="line"></span><br><span class="line">ArrayList&lt;String&gt; zhangList=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (String s1:arrayList) &#123;</span><br><span class="line">    <span class="keyword">if</span> (s1.startsWith(<span class="string">&quot;张&quot;</span>))&#123;</span><br><span class="line">        zhangList.add(s1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ArrayList&lt;String&gt; threeList=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (String s2:zhangList)&#123;</span><br><span class="line">    <span class="keyword">if</span> (s2.length()&gt;<span class="number">2</span>)&#123;</span><br><span class="line">        threeList.add(s2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (String s3:threeList) &#123;</span><br><span class="line">    System.out.println(s3);</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;----------------&quot;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用Stream流形式</span></span><br><span class="line">arrayList.stream().filter(s -&gt; s.startsWith(<span class="string">&quot;张&quot;</span>)).filter(s -&gt; s.length()&gt;<span class="number">2</span>).forEach(System.out::println);</span><br></pre></td></tr></table></figure>

<h4 id="2、Stream生成方式"><a href="#2、Stream生成方式" class="headerlink" title="2、Stream生成方式"></a>2、Stream生成方式</h4><h5 id="2-1-Collection体系"><a href="#2-1-Collection体系" class="headerlink" title="2.1 Collection体系"></a>2.1 Collection体系</h5><blockquote>
<p>list.stream()</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Collection体系</span></span><br><span class="line">List&lt;String&gt; list=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">Stream&lt;String&gt; listStream = list.stream();</span><br><span class="line"></span><br><span class="line">Set&lt;String&gt; set=<span class="keyword">new</span> HashSet&lt;String&gt;();</span><br><span class="line">Stream&lt;String&gt; setStream = set.stream();</span><br></pre></td></tr></table></figure>



<h5 id="2-2-Map体系"><a href="#2-2-Map体系" class="headerlink" title="2.2 Map体系"></a>2.2 Map体系</h5><blockquote>
<p>keySet()–&gt;key</p>
<p>values()–value</p>
<p>entrySet()–&gt; key-value</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Map体系</span></span><br><span class="line">Map&lt;String,Integer&gt; map=<span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">Stream&lt;String&gt; mapStream = map.keySet().stream();</span><br><span class="line">Stream&lt;Integer&gt; values = map.values().stream();</span><br><span class="line">Stream&lt;Map.Entry&lt;String, Integer&gt;&gt; mapEntryStream = map.entrySet().stream();</span><br></pre></td></tr></table></figure>



<h5 id="2-3-数组"><a href="#2-3-数组" class="headerlink" title="2.3 数组"></a>2.3 数组</h5><blockquote>
<p>Stream.of(array)</p>
<p>Arrays.stream(arr[] arr)</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//数组</span></span><br><span class="line">String[] arr=&#123;<span class="string">&quot;sss&quot;</span>,<span class="string">&quot;dsfs&quot;</span>&#125;;</span><br><span class="line">Stream&lt;String&gt; arrStream = Stream.of(arr);</span><br><span class="line">Stream&lt;String&gt; arrStream2 = Stream.of(<span class="string">&quot;sss&quot;</span>, <span class="string">&quot;dsfs&quot;</span>);</span><br><span class="line">Stream&lt;Integer&gt; integerStream = Stream.of(<span class="number">19</span>, <span class="number">23</span>);</span><br></pre></td></tr></table></figure>



<h4 id="3、Stream中间操作"><a href="#3、Stream中间操作" class="headerlink" title="3、Stream中间操作"></a>3、Stream中间操作</h4><ul>
<li>filter(Predicate predicate) 对流中的数据进行过滤</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arrayList.stream().filter(s -&gt; s.startsWith(<span class="string">&quot;张&quot;</span>)).forEach(System.out::print);</span><br></pre></td></tr></table></figure>

<ul>
<li>limit(long maxSize) 返回流中元素组成的流，<strong>截取前指定参数个数</strong>的数据</li>
<li>skip(long n)   跳过指定参数个数的数据，返回由该流<strong>剩余元素</strong>组成的流</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arrayList.stream().limit(<span class="number">3</span>).forEach(System.out::println);</span><br><span class="line">System.out.println(<span class="string">&quot;---------------&quot;</span>);</span><br><span class="line">arrayList.stream().skip(<span class="number">4</span>).forEach(System.out::println);</span><br></pre></td></tr></table></figure>

<ul>
<li>concat(Stream a,Stream b) 合并俩个流，<strong>静态方法，由接口名调用</strong></li>
<li>distinct() 返回该流不同元素组成的流</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//取出前4个元素</span></span><br><span class="line">Stream&lt;String&gt;  s1= arrayList.stream().limit(<span class="number">4</span>);</span><br><span class="line"><span class="comment">//跳过2个元素</span></span><br><span class="line">Stream&lt;String&gt; s2 = arrayList.stream().skip(<span class="number">2</span>);</span><br><span class="line"><span class="comment">//合并俩个流</span></span><br><span class="line">Stream.concat(s1, s2).forEach(System.out::println);;</span><br><span class="line">System.out.println(<span class="string">&quot;---------------&quot;</span>);</span><br><span class="line"><span class="comment">//取出流中不同元素</span></span><br><span class="line">Stream.concat(s1, s2).distinct().forEach(System.out::println);</span><br></pre></td></tr></table></figure>

<ul>
<li>sorted() 返回排序的流</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">arrayList.stream().sorted().forEach(System.out::println);</span><br><span class="line">System.out.println(<span class="string">&quot;--------------&quot;</span>);</span><br><span class="line"><span class="comment">//按照长度排序</span></span><br><span class="line">arrayList.stream().sorted((s1,s2)-&gt;s1.length()-s2.length()).forEach(System.out::println);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>map(Function mapper)   返回由给定函数应用于该流元素的结果组成的流</strong></li>
<li>IntStream <strong>mapToint</strong>(ToIntFunction mapper) 返回一个<strong>IntStream</strong>，其中包含将给定函数应用于此流的元素的<strong>结果</strong><ul>
<li>IntStream 原始的int流</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">arrayList.stream().map(Integer::parseInt).forEach(System.out::println);</span><br><span class="line">System.out.println(<span class="string">&quot;------------&quot;</span>);</span><br><span class="line"><span class="keyword">int</span> sum = arrayList.stream().mapToInt(Integer::parseInt).sum();</span><br><span class="line">System.out.println(sum);</span><br></pre></td></tr></table></figure>



<h4 id="4、Stream终结操作"><a href="#4、Stream终结操作" class="headerlink" title="4、Stream终结操作"></a>4、Stream终结操作</h4><ul>
<li><p>foreach(Consumer action)</p>
</li>
<li><p>long count()  返回流的元素数</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">long</span> c = arrayList.stream().filter(s -&gt; s.startsWith(<span class="string">&quot;张&quot;</span>)).count();</span><br><span class="line">System.out.println(c);</span><br></pre></td></tr></table></figure>



<h4 id="5、练习"><a href="#5、练习" class="headerlink" title="5、练习"></a>5、练习</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;String&gt; arrayList=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">arrayList.add(<span class="string">&quot;林青霞&quot;</span>);</span><br><span class="line">arrayList.add(<span class="string">&quot;张曼玉&quot;</span>);</span><br><span class="line">arrayList.add(<span class="string">&quot;王祖贤&quot;</span>);</span><br><span class="line">arrayList.add(<span class="string">&quot;柳岩&quot;</span>);</span><br><span class="line">arrayList.add(<span class="string">&quot;张敏&quot;</span>);</span><br><span class="line">arrayList.add(<span class="string">&quot;张无忌&quot;</span>);</span><br><span class="line"></span><br><span class="line">ArrayList&lt;String&gt; arrayList2=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">arrayList2.add(<span class="string">&quot;重监控&quot;</span>);</span><br><span class="line">arrayList2.add(<span class="string">&quot;杀杀杀&quot;</span>);</span><br><span class="line">arrayList2.add(<span class="string">&quot;搜索&quot;</span>);</span><br><span class="line">arrayList2.add(<span class="string">&quot;啊啊&quot;</span>);</span><br><span class="line">arrayList2.add(<span class="string">&quot;撒法发&quot;</span>);</span><br><span class="line">arrayList2.add(<span class="string">&quot;实施方案&quot;</span>);</span><br><span class="line"></span><br><span class="line">Stream&lt;String&gt; stream1 = arrayList.stream().filter(s -&gt; s.startsWith(<span class="string">&quot;林&quot;</span>)).skip(<span class="number">1</span>);</span><br><span class="line">Stream&lt;String&gt; stream2 = arrayList2.stream().filter(s -&gt; s.length() &gt; <span class="number">2</span>).limit(<span class="number">3</span>);</span><br><span class="line">Stream&lt;String&gt; allStream = Stream.concat(stream1, stream2);</span><br><span class="line"><span class="comment">//        allStream.map(Actor::new).forEach(System.out::println);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//返回由  给定函数应用于该流元素的结果 组成的流</span></span><br><span class="line">allStream.map(Actor::<span class="keyword">new</span>).forEach(s-&gt; System.out.println(s.getName()));</span><br></pre></td></tr></table></figure>



<h4 id="6、Stream的收集操作"><a href="#6、Stream的收集操作" class="headerlink" title="6、Stream的收集操作"></a>6、Stream的收集操作</h4><ul>
<li>R collect(Collectors collector)  收集方法的参数是一个Collector接口</li>
<li>工具类<code>Collectors</code>提供具体的收集方式<ul>
<li>toLIst()</li>
<li>toSet ()</li>
<li>toMap()</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = arrayList.stream().filter(s -&gt; s.length() &gt; <span class="number">2</span>).collect(Collectors.toList());</span><br><span class="line"><span class="keyword">for</span> (String s:list)&#123;</span><br><span class="line">    System.out.println(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dmyang-only.github.io/2020/11/11/11%E9%9B%86%E5%90%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dmYang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DmYoung">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/11/11%E9%9B%86%E5%90%88/" class="post-title-link" itemprop="url">集合</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-11 12:33:33" itemprop="dateCreated datePublished" datetime="2020-11-11T12:33:33+08:00">2020-11-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-12-17 13:10:44" itemprop="dateModified" datetime="2020-12-17T13:10:44+08:00">2020-12-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">java基础</span></a>
                </span>
            </span>

          
            <span id="/2020/11/11/11%E9%9B%86%E5%90%88/" class="post-meta-item leancloud_visitors" data-flag-title="集合" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>11k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>10 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><h4 id="1、List-Set-Map"><a href="#1、List-Set-Map" class="headerlink" title="1、List/Set/Map"></a>1、List/Set/Map</h4><ul>
<li>List是有序列表，其存放内容是可以重复的，其实现接口有：<strong>ArrayList</strong>，<strong>LinkedList</strong>，<strong>Vector</strong></li>
<li>Set是无序的集合，其内部存放的内容不可以重复，实现接口有<strong>HashSet</strong>，<strong>TreeSet</strong>，<strong>LinkedHashSet</strong></li>
<li>Map存的是键值对（key-value），key值不允许有重复，value内容可以相同，但对应不同的key，实现接口有<strong>HashMap</strong>，<strong>TreeMap</strong>,<strong>LinkedHashMap</strong></li>
</ul>
<h4 id="2、ArrayList源码"><a href="#2、ArrayList源码" class="headerlink" title="2、ArrayList源码"></a>2、ArrayList源码</h4><h5 id="2-1-构造"><a href="#2-1-构造" class="headerlink" title="2.1 构造"></a>2.1 构造</h5><blockquote>
<p>在使用默认构造方法（无参构造）时，创建的是一个空数组，</p>
<p>只有当第一次插入数据时，才会将数组容量初始化为10</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-2-扩容机制"><a href="#2-2-扩容机制" class="headerlink" title="2.2 扩容机制"></a>2.2 扩容机制</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//最大数组长度</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_ARRAY_SIZE = Integer.MAX_VALUE - <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//扩容方法</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">grow</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> oldCapacity = elementData.length;</span><br><span class="line">    	<span class="comment">//右移一位相当于除以2，即新的容量为原来容量的1.5倍</span></span><br><span class="line">        <span class="keyword">int</span> newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</span><br><span class="line">    	<span class="comment">//比较新容量跟指定容量大小</span></span><br><span class="line">        <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>)</span><br><span class="line">            newCapacity = minCapacity;</span><br><span class="line">        <span class="comment">//如果newCapacity比较大</span></span><br><span class="line">        <span class="comment">//如果小于MAX_ARRRY_SIZE，则返回newCapacity</span></span><br><span class="line">    	<span class="comment">//否则调用hugeCapacity</span></span><br><span class="line">        <span class="keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="number">0</span>)</span><br><span class="line">            newCapacity = hugeCapacity(minCapacity);</span><br><span class="line">        <span class="comment">// minCapacity is usually close to size, so this is a win:</span></span><br><span class="line">        elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">hugeCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (minCapacity &lt; <span class="number">0</span>) <span class="comment">// overflow</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> OutOfMemoryError();</span><br><span class="line">        <span class="keyword">return</span> (minCapacity &gt; MAX_ARRAY_SIZE) ?</span><br><span class="line">            Integer.MAX_VALUE :</span><br><span class="line">            MAX_ARRAY_SIZE;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-3-复制"><a href="#2-3-复制" class="headerlink" title="2.3 复制"></a>2.3 复制</h5><p><code>System.arraycopy</code> ,<code>Array.copyof</code></p>
<p><strong>区别</strong></p>
<ul>
<li><code>Array.copyof</code>本质上也是调用了<code>System.arraycopy</code>方法</li>
<li><code>arraycopy</code>需要传入目标数组，将复制后的数据放到目标数组中，而<code>copyOf</code>是在方法内部创建一个数组，将内容复制到这个数组然后返回该数组</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] copyOf(<span class="keyword">byte</span>[] original, <span class="keyword">int</span> newLength) &#123;</span><br><span class="line">    <span class="comment">//创建一个新的数组</span></span><br><span class="line">       <span class="keyword">byte</span>[] copy = <span class="keyword">new</span> <span class="keyword">byte</span>[newLength];</span><br><span class="line">       <span class="comment">//本质上调用了arraycopy</span></span><br><span class="line">       System.arraycopy(original, <span class="number">0</span>, copy, <span class="number">0</span>,</span><br><span class="line">                        Math.min(original.length, newLength));</span><br><span class="line">       <span class="keyword">return</span> copy;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>add()</p>
<ul>
<li><p>通过<code>System.arraycopy</code>方法复制自身数组</p>
</li>
<li><p>并将后面数组元素右移</p>
</li>
<li><p>实现在指定位置插入内容</p>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, E element)</span> </span>&#123;</span><br><span class="line">    	<span class="comment">//判断index是否&lt;0 or &gt;length</span></span><br><span class="line">        rangeCheckForAdd(index);</span><br><span class="line">        modCount++;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> s;</span><br><span class="line">        Object[] elementData;</span><br><span class="line">        <span class="keyword">if</span> ((s = size) == (elementData = <span class="keyword">this</span>.elementData).length)</span><br><span class="line">            elementData = grow();</span><br><span class="line">        <span class="comment">//复制自身数组，将index位置的数据后移</span></span><br><span class="line">        System.arraycopy(elementData, index,</span><br><span class="line">                         elementData, index + <span class="number">1</span>,</span><br><span class="line">                         s - index);</span><br><span class="line">        <span class="comment">//index位置放入数据</span></span><br><span class="line">        elementData[index] = element;</span><br><span class="line">        size = s + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-4-序列化"><a href="#2-4-序列化" class="headerlink" title="2.4 序列化"></a>2.4 序列化</h5><blockquote>
<p><code>ArrayList</code>基于数组实现，并且具有<strong>动态扩容</strong>的特性，因此保存元素的数组不一定都会被使用到，所以<strong>没必要全部进行序列化</strong>。</p>
</blockquote>
<h4 id="3、LinkedList源码"><a href="#3、LinkedList源码" class="headerlink" title="3、LinkedList源码"></a>3、LinkedList源码</h4><blockquote>
<p><code>LinkedList</code>是一个实现了<code>List</code>接口和<code>Deque</code>接口的双向链表。</p>
<p><code>LinkedList</code>底层的链表结构使它支持高效的插入和删除操作，另外它实现了<code>Deque</code>接口，使得<code>LinkedList</code>类也具有队列的特性;</p>
<p><code>LinkedList</code>不是线程安全的，如果想使LinkedList变成线程安全的，可以调用静态类Collections类中的synchronizedList方法：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List list=Collections.synchronizedList(<span class="keyword">new</span> LinkedList(...));</span><br></pre></td></tr></table></figure>



<h5 id="3-1-获取指定位置节点"><a href="#3-1-获取指定位置节点" class="headerlink" title="3.1 获取指定位置节点"></a>3.1 获取指定位置节点</h5><blockquote>
<p>折半查找 get(index)</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">     checkElementIndex(index);</span><br><span class="line">     <span class="keyword">return</span> node(index).item;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Node&lt;E&gt; <span class="title">node</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// assert isElementIndex(index);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (index &lt; (size &gt;&gt; <span class="number">1</span>)) &#123;<span class="comment">//折半查找</span></span><br><span class="line">        Node&lt;E&gt; x = first;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++)</span><br><span class="line">            x = x.next;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        Node&lt;E&gt; x = last;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = size - <span class="number">1</span>; i &gt; index; i--)</span><br><span class="line">            x = x.prev;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="3-2-集合插入尾部"><a href="#3-2-集合插入尾部" class="headerlink" title="3.2 集合插入尾部"></a>3.2 集合插入尾部</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addAll</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> addAll(size, c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>addAll(int Index,Collection c)</code>:将集合从指定位置开始插入具体实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addAll</span><span class="params">(<span class="keyword">int</span> index, Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1. 检查index是否在size范围内</span></span><br><span class="line">    checkPositionIndex(index);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2. 把集合的数据存到对象数组中</span></span><br><span class="line">    Object[] a = c.toArray();</span><br><span class="line">    <span class="keyword">int</span> numNew = a.length;</span><br><span class="line">    <span class="keyword">if</span> (numNew == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    Node&lt;E&gt; pred, succ;</span><br><span class="line">    <span class="comment">//3. 得到插入位置的前驱节点和后继节点</span></span><br><span class="line">    <span class="comment">//如果插入位置是尾部，前驱节点是last，后继节点是null</span></span><br><span class="line">    <span class="keyword">if</span> (index == size) &#123;</span><br><span class="line">        succ = <span class="keyword">null</span>;</span><br><span class="line">        pred = last;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//否则，调用node()方法得到后继节点，再得到前驱节点</span></span><br><span class="line">        succ = node(index);</span><br><span class="line">        pred = succ.prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4. 遍历数组将数据插入</span></span><br><span class="line">    <span class="keyword">for</span> (Object o : a) &#123;</span><br><span class="line">        <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span> E e = (E) o;</span><br><span class="line">        <span class="comment">//创建新节点，同时指定前驱节点</span></span><br><span class="line">        Node&lt;E&gt; newNode = <span class="keyword">new</span> Node&lt;&gt;(pred, e, <span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">//如果插入位置是首节点</span></span><br><span class="line">        <span class="keyword">if</span> (pred == <span class="keyword">null</span>)</span><br><span class="line">            first = newNode;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            pred.next = newNode;<span class="comment">//双向链表，前驱节点的指针指向当前节点</span></span><br><span class="line">        pred = newNode;<span class="comment">//节点后移</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果插入位置是在尾部，重置last节点</span></span><br><span class="line">    <span class="keyword">if</span> (succ == <span class="keyword">null</span>) &#123;</span><br><span class="line">        last = pred;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//否则，将插入链表与原链表的后半部分连接起来</span></span><br><span class="line">        pred.next = succ;</span><br><span class="line">        succ.prev = pred;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    size += numNew;</span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由以上可以总结出addAll方法的步骤：</p>
<ol>
<li>检查<code>index</code>范围是否在size范围内</li>
<li><code>toArray</code>方法把集合的数据存到对象数组中</li>
<li>得到插入位置的前驱和后继节点</li>
<li>遍历数据插入</li>
<li>将插入后的链表与后半部分链接</li>
</ol>
<h5 id="3-3-获取头节点数据"><a href="#3-3-获取头节点数据" class="headerlink" title="3.3 获取头节点数据"></a>3.3 获取头节点数据</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">getFirst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Node&lt;E&gt; f = first;</span><br><span class="line">    <span class="keyword">if</span> (f == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">    <span class="keyword">return</span> f.item;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">element</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> getFirst();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">peek</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Node&lt;E&gt; f = first;</span><br><span class="line">    <span class="keyword">return</span> (f == <span class="keyword">null</span>) ? <span class="keyword">null</span> : f.item;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">peekFirst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Node&lt;E&gt; f = first;</span><br><span class="line">    <span class="keyword">return</span> (f == <span class="keyword">null</span>) ? <span class="keyword">null</span> : f.item;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>区别</strong></p>
<ul>
<li><p><code>getFirst</code>和<code>element</code>方法在链表为空时会抛出异常<code>NoSuchElementException</code>，</p>
</li>
<li><p><code>peek</code>和<code>peekFirst</code>会直接返回null。</p>
</li>
</ul>
<h4 id="4、List、Set、Map是否继承自Collection接口？"><a href="#4、List、Set、Map是否继承自Collection接口？" class="headerlink" title="4、List、Set、Map是否继承自Collection接口？"></a>4、List、Set、Map是否继承自Collection接口？</h4><p>只有 List 和 Set 继承了 Collection 接口，Map 是键值对映射容器，不同于 Set 和 List 只存储元素。</p>
<h4 id="5-、Collection-和-Collections-的区别？"><a href="#5-、Collection-和-Collections-的区别？" class="headerlink" title="5 、Collection 和 Collections 的区别？"></a>5 、Collection 和 Collections 的区别？</h4><ul>
<li>Collection 是集合类的上级接口，继承与他的接口主要有Set 和List。</li>
<li>Collections 是针对集合类的一个帮助类，他提供一系列静态方法实现对各种集合的搜索、排序、线程安全化等操作。</li>
</ul>
<h4 id="6、-Iterator-和-ListIterator-区别？"><a href="#6、-Iterator-和-ListIterator-区别？" class="headerlink" title="6、 Iterator 和 ListIterator 区别？"></a>6、 Iterator 和 ListIterator 区别？</h4><ul>
<li><p><code>Iterator</code> 可用来遍历 <code>Set</code> 和 <code>List</code> 集合，但是 <code>ListIterator</code> 只能用来遍历 <code>List</code>。</p>
</li>
<li><p><code>Iterator</code> 对集合只能是后向遍历，<code>ListIterator</code> 既可以前向也可以后向。</p>
</li>
<li><p><code>ListIterator</code> 实现了 <code>Iterator</code> 接口，并包含其他的功能，比如：增加元素add，替换元素set，获取前一个和后一个元素的索引，等等。</p>
</li>
<li><p><code>Collection</code> 接口实现 <code>Iterable</code> 接口,每个集合都通过实现 <code>Iterable</code> 接口中 <code>iterator()</code> 方法返回 <code>Iterator</code> 接口的实例, 然后对集合的元素进行迭代操作。</p>
</li>
<li><p>在迭代元素的时候不能通过集合的方法删除元素, 否则会抛出 <code>ConcurrentModificationException</code> 异常. 但是可以通过 <code>Iterator</code> 接口中的 <code>remove()</code> 方法进行删除。</p>
</li>
</ul>
<h3 id="容器"><a href="#容器" class="headerlink" title="容器"></a>容器</h3><blockquote>
<p><strong>一组存放多个对象的可变字符序列</strong></p>
</blockquote>
<blockquote>
<p>JDK8:底层全部采用<strong>数组+链表+红黑树</strong>进行维护</p>
<p>​         当索引位置上的链表元素的数据个数&gt;8 且数组的长度&gt;64时，索引上的数据用红黑树存储</p>
<p> 优点：提高查找效率（类似于二分查找）</p>
</blockquote>
<h3 id="一、List"><a href="#一、List" class="headerlink" title="一、List"></a>一、List</h3><h4 id="1、Arrayslist"><a href="#1、Arrayslist" class="headerlink" title="1、Arrayslist"></a>1、Arrayslist</h4><blockquote>
<p><strong>有序可重复</strong>（下标从0开始）</p>
</blockquote>
<p>默认情况为0的空数组对象，有参构造时，创建一个大小为传递大小的对象数组</p>
<p>add()</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">List list=<span class="keyword">new</span> ArrayList();</span><br><span class="line">List list1=<span class="keyword">new</span> ArrayList();</span><br><span class="line">list.add(<span class="keyword">new</span> Student());</span><br><span class="line">list.add(<span class="string">&quot;hh&quot;</span>);</span><br><span class="line">list.add(<span class="number">123</span>);  <span class="comment">//自动装箱</span></span><br><span class="line"><span class="comment">//插入，后面元素后移</span></span><br><span class="line">list.add(<span class="number">0</span>,<span class="string">&quot;ss&quot;</span>);</span><br><span class="line">list1.add(<span class="string">&quot;故&quot;</span>);</span><br><span class="line"></span><br><span class="line">list.add(list1);        <span class="comment">//将数组2加到数组1中</span></span><br><span class="line"><span class="comment">//以ArrayList形式打印出来</span></span><br><span class="line">System.out.println(list);</span><br></pre></td></tr></table></figure>

<p>size()长度</p>
<p><code>System.out.println(list.size());</code></p>
<p>get(index) 返回Object类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String str=(String)list.get(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">int</span> i=(<span class="keyword">int</span>)list.get(<span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<p>contain();返回Boolean类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(list.contains(<span class="string">&quot;hh&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>remove()；移除</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">list.remove(<span class="string">&quot;hh&quot;</span>);</span><br><span class="line">list.remove(<span class="number">0</span>);<span class="comment">//直接用索引删除</span></span><br><span class="line">System.out.println(list.contains(<span class="string">&quot;hh&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>clear();清空</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//清空</span></span><br><span class="line">list.clear();</span><br><span class="line">System.out.println(list.size());</span><br></pre></td></tr></table></figure>

<p> set():原有元素被覆盖</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list.set(<span class="number">0</span>,<span class="string">&quot;55&quot;</span>); <span class="comment">//原有元素被覆盖</span></span><br></pre></td></tr></table></figure>

<p>逆向遍历</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ListIterator list2&#x3D;list.listIterator();</span><br><span class="line">while(list2.hasPrevious())&#123;</span><br><span class="line">    System.out.println(list2.previous());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sublist() 截取元素返回一个新的集合</p>
<h4 id="2、LinkedList"><a href="#2、LinkedList" class="headerlink" title="2、LinkedList"></a>2、LinkedList</h4><blockquote>
<p><strong>双向链表</strong>的一个数据结构</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">LinkedList list=<span class="keyword">new</span> LinkedList();</span><br><span class="line">list.add(<span class="number">0</span>,<span class="string">&quot;66&quot;</span>);</span><br><span class="line">list.add(<span class="number">1</span>,<span class="string">&quot;55&quot;</span>);</span><br><span class="line">System.out.println(list);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(Object obj:list)&#123;</span><br><span class="line">    System.out.println(obj);</span><br><span class="line">&#125;</span><br><span class="line">list.offer(<span class="string">&quot;后面添加&quot;</span>);</span><br><span class="line">list.push(<span class="string">&quot;前面添加&quot;</span>);</span><br><span class="line">Object o=list.peek(); <span class="comment">//获取集合的第一个元素</span></span><br><span class="line">Object o1=list.peekFirst();</span><br><span class="line">System.out.println(o);</span><br><span class="line">System.out.println(list);</span><br><span class="line"></span><br><span class="line">Iterator iterator=list.iterator();</span><br><span class="line"><span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">    String i= (String) iterator.next();</span><br><span class="line">    System.out.println(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//去除</span></span><br><span class="line">list.remove(<span class="string">&quot;66&quot;</span>);</span><br><span class="line">System.out.println(list);</span><br></pre></td></tr></table></figure>

<p>以队列的形式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">list.offer(<span class="string">&quot;后面添加&quot;</span>);</span><br><span class="line">list.poll();</span><br></pre></td></tr></table></figure>

<p>以栈的形式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">list.push(<span class="string">&quot;前面添加&quot;</span>);</span><br><span class="line">list.pop();</span><br><span class="line">System.out.println(list);</span><br></pre></td></tr></table></figure>



<h4 id="3、排序方法"><a href="#3、排序方法" class="headerlink" title="3、排序方法"></a>3、排序方法</h4><ul>
<li>将list放在<code>TreeSet</code>当中进行排序，根据排序顺序放置在list集合当中</li>
<li>list转化为数组，利用数组排序规则进行排序 Arrays.sort</li>
<li>使用集合工具类Collections的sort进行排序 Collections.sort        </li>
</ul>
<h3 id="二、Set"><a href="#二、Set" class="headerlink" title="二、Set"></a>二、Set</h3><blockquote>
<p><strong>无序不可重复</strong></p>
</blockquote>
<h4 id="1、HashSet"><a href="#1、HashSet" class="headerlink" title="1、HashSet"></a>1、HashSet</h4><blockquote>
<p><strong>利用Object类的<code>hashcode</code>方法来确定存储位置</strong></p>
<ul>
<li><p>若是该位置无其他元素，直接存入。</p>
</li>
<li><p>若是该位置有其他元素，调用equals()方法，比较相等则舍弃该对象；不相等则覆盖原有对象</p>
</li>
</ul>
<p>重写hash code()与equals()可解决实例对象不同（但内容相同）——&gt;重复</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Set set=<span class="keyword">new</span> HashSet();</span><br><span class="line">set.add(<span class="string">&quot;北京&quot;</span>);</span><br><span class="line">set.add(<span class="string">&quot;广州&quot;</span>);</span><br><span class="line">set.add(<span class="string">&quot;上海&quot;</span>);</span><br><span class="line">set.add(<span class="string">&quot;北京&quot;</span>);</span><br><span class="line">System.out.println(set);</span><br><span class="line"><span class="keyword">for</span>(Object obj:set)&#123;</span><br><span class="line">    System.out.println(obj);</span><br><span class="line">&#125;</span><br><span class="line">控制台：[广州, 上海, 北京]</span><br></pre></td></tr></table></figure>



<h4 id="2、LinkedSet"><a href="#2、LinkedSet" class="headerlink" title="2、LinkedSet"></a>2、LinkedSet</h4><p>其实上是<code>HashSet</code>的子类，本质也是通过<code>hashCode</code>来决定元素的位置多提供一个双向链表进行维护次序，</p>
<h4 id="3、TreeSet"><a href="#3、TreeSet" class="headerlink" title="3、TreeSet"></a>3、TreeSet</h4><blockquote>
<p>底层二叉树（红黑树）（左小右大）</p>
</blockquote>
<h5 id="排序方法"><a href="#排序方法" class="headerlink" title="排序方法"></a><strong>排序方法</strong></h5><ul>
<li><code>comparable</code>接口实际上是出自<code>java.lang</code>包,它有一个<code>compareTo(Object obj)</code>方法用来排序</li>
<li><code>comparator</code>接口实际上是出自<code>java.util</code>包,它有一个<code>compare(Object obj1, Object obj2)</code>方法用来排序</li>
</ul>
<blockquote>
<p>Comparable &amp; Comparator 都是用来实现集合中元素的比较、排序的，</p>
<p>只是 Comparable 是在<strong>集合内部</strong>定义的方法实现的排序，Comparator 是在<strong>集合外部</strong>实现的排序</p>
<p>所以，如想实现排序，就需要在集合外定义 Comparator 接口的方法或在集合内实现 Comparable 接口的方法。</p>
<p> String、Integer 自己就可以完成比较大小操作，已经实现了Comparable接口</p>
</blockquote>
<h6 id="1、自然排序"><a href="#1、自然排序" class="headerlink" title="1、自然排序"></a>1、自然排序</h6><ul>
<li>具有自然排序规则的数据(默认调用<code>comparable</code>接口</li>
<li>不具备会出现类型转换异常，需要重写<code>compareTo()</code>方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">implements</span> <span class="title">Comparable</span></span>&#123;</span><br><span class="line"> <span class="comment">//多个排序规则排序</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        Person p=(Person) o;</span><br><span class="line"><span class="comment">//      System.out.println(this.name+&quot;compare&quot;+p.name);</span></span><br><span class="line">        <span class="comment">//按照姓名长度来排序</span></span><br><span class="line">        <span class="keyword">int</span> num=<span class="keyword">this</span>.name.length()-p.name.length();</span><br><span class="line">        <span class="comment">//根据字典来排序</span></span><br><span class="line">        <span class="keyword">int</span> num1=(num==<span class="number">0</span>)?(<span class="keyword">this</span>.name.compareTo(p.name)):num;</span><br><span class="line">        <span class="comment">//长度一致，姓名一致</span></span><br><span class="line">        <span class="keyword">int</span> num2=num1==<span class="number">0</span>? <span class="keyword">this</span>.age-p.age:num1;</span><br><span class="line">        <span class="keyword">return</span> num2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">TreeSet ts1=<span class="keyword">new</span> TreeSet();</span><br><span class="line">Person p=<span class="keyword">new</span> Person(<span class="number">15</span>,<span class="string">&quot;numm&quot;</span>,<span class="string">&#x27;男&#x27;</span>);</span><br><span class="line">Person p1=<span class="keyword">new</span> Person(<span class="number">16</span>,<span class="string">&quot;aew&quot;</span>,<span class="string">&#x27;女&#x27;</span>);</span><br><span class="line">Person p2=<span class="keyword">new</span> Person(<span class="number">22</span>,<span class="string">&quot;sss&quot;</span>,<span class="string">&#x27;女&#x27;</span>);</span><br><span class="line">Person p3=<span class="keyword">new</span> Person(<span class="number">12</span>,<span class="string">&quot;aew&quot;</span>,<span class="string">&#x27;男&#x27;</span>);</span><br><span class="line">ts1.add(p); ts1.add(p1);</span><br><span class="line">ts1.add(p2); ts1.add(p3);</span><br></pre></td></tr></table></figure>



<h6 id="2、定制排序"><a href="#2、定制排序" class="headerlink" title="2、定制排序"></a>2、定制排序</h6><p>实现<code>comparator</code>接口，<strong>其在类不可以修改时使用</strong></p>
<p>重写<code>compare()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;Integer&gt; arrayList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">arrayList.add(<span class="number">1</span>);</span><br><span class="line">arrayList.add(<span class="number">2</span>);</span><br><span class="line">arrayList.add(-<span class="number">1</span>);</span><br><span class="line">arrayList.add(<span class="number">30</span>);</span><br><span class="line">arrayList.add(<span class="number">12</span>);</span><br><span class="line">System.out.println(arrayList);</span><br><span class="line"></span><br><span class="line">Collections.sort(arrayList, <span class="keyword">new</span> Comparator&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Integer o1, Integer o2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> o1-o2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">System.out.println(<span class="string">&quot;定制排序后&quot;</span>+arrayList);</span><br></pre></td></tr></table></figure>



<h3 id="三、Map"><a href="#三、Map" class="headerlink" title="三、Map"></a>三、Map</h3><blockquote>
<p> <strong>无序，一个键只能对应一个值</strong></p>
<p><strong>不可通过值来获取键</strong></p>
<ul>
<li><p>key:     <code>keySet()</code>    通过Set存储，不能重复,插入和取出的顺序不一致</p>
</li>
<li><p>value：<code>values()</code>   通过Collection存储，值能重复，取出和插入的顺序一致</p>
</li>
<li><p>  Map的Entry:无序不可重复，Entry随着key走           </p>
</li>
</ul>
</blockquote>
<h4 id="1、遍历方式"><a href="#1、遍历方式" class="headerlink" title="1、遍历方式"></a>1、遍历方式</h4><h5 id="1-1-entrySet"><a href="#1-1-entrySet" class="headerlink" title="1.1 entrySet"></a>1.1 entrySet</h5><blockquote>
<p>Set&lt;Map .Entry&lt;K,V&gt;&gt;  entrySet();</p>
<p>返回的是集合<strong>键值对的集合</strong>,使用Set进行接收，不需要进行强转</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;Map.Entry&gt; entries=map.entrySet();</span><br><span class="line"><span class="keyword">for</span>(Map.Entry entry:entries)&#123;</span><br><span class="line">    System.out.println(entry.getKey()+<span class="string">&quot;--&quot;</span>+entry.getValue());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="1-2-keySet"><a href="#1-2-keySet" class="headerlink" title="1.2 keySet"></a>1.2 keySet</h5><blockquote>
<p>获取键的set集合，values() 获取值的collection集合</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Set s=map.keySet();</span><br><span class="line">Collection s1=map.values();</span><br><span class="line">System.out.println(s1);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(Object key:map.keySet())&#123;</span><br><span class="line">    System.out.println(key+<span class="string">&quot;--&quot;</span>+map.get(key));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="2、HashMap"><a href="#2、HashMap" class="headerlink" title="2、HashMap"></a>2、HashMap</h4><p>HashMap的键不能重复，会覆盖；不可通过值来获取键</p>
<p>​        put(Object key,Object )，，putAll():</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Map map=<span class="keyword">new</span> HashMap();</span><br><span class="line">map.put(<span class="string">&quot;201&quot;</span>,<span class="string">&quot;离&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;202&quot;</span>,<span class="string">&quot;森&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;203&quot;</span>,<span class="string">&quot;青&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>contains()</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">boolean</span> b=map.containsKey(<span class="string">&quot;201&quot;</span>);</span><br><span class="line"><span class="keyword">boolean</span> b1=map.containsValue(<span class="string">&quot;离&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>get()，<strong>通过key来得到值</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">map.get(<span class="string">&quot;201&quot;</span>);</span><br><span class="line">System.out.println(map.get(<span class="string">&quot;201&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>replace(); 替代</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">map.replace(<span class="string">&quot;201&quot;</span>,<span class="string">&quot;禁&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>remove() 移除，只是在容器中移除；clear();</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">map.remove(<span class="string">&quot;201&quot;</span>);</span><br><span class="line">System.out.println(map);</span><br></pre></td></tr></table></figure>



<h4 id="3、HashTable"><a href="#3、HashTable" class="headerlink" title="3、HashTable"></a>3、HashTable</h4><h4 id="4、TreeMap"><a href="#4、TreeMap" class="headerlink" title="4、TreeMap"></a>4、TreeMap</h4><p>​    通过key来排序（类似于TreeSet，但排序方式是红黑树）</p>
<h3 id="四、Iterator"><a href="#四、Iterator" class="headerlink" title="四、Iterator"></a>四、Iterator</h3><blockquote>
<p><strong>所有集合类都实现了iterator接口</strong></p>
</blockquote>
<p>例如：（1）ArrayList实现了iterator接口，调用iterator()方法返回值实现了多态</p>
<p>​           （2）调用ArrayList内部类（该内部类实现了iterator接口，防止内存泄露使用内部类）</p>
<p> 1、iterator():将元素封装进容器</p>
<p> 2、hasNext():boolean是否还有下一个元素</p>
<p> 3、next():返回下一个元素</p>
<p> 4、remove() : 移除，但不能指定元素</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> Iterator iterator=list.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            <span class="keyword">int</span> i=(<span class="keyword">int</span>)iterator.next();</span><br><span class="line">            System.out.println(i);</span><br><span class="line"><span class="comment">//            System.out.println(iterator.next());</span></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>



<h3 id="五、for-each"><a href="#五、for-each" class="headerlink" title="五、for-each"></a>五、for-each</h3><p>增强for，必须是实现java.lang.Iterable接口，重写iterator</p>
<p>格式：for(类型 临时变量：容器变量){  循环体 }</p>
<p>​            没有增加删除方法,只能遍历</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String[] s=&#123;<span class="string">&quot;哦哦&quot;</span>,<span class="string">&quot;aa&quot;</span>,<span class="string">&quot;ss&quot;</span>&#125;;</span><br><span class="line"><span class="keyword">for</span>(String s1:s)&#123;</span><br><span class="line">    System.out.println(s1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="六、Collections"><a href="#六、Collections" class="headerlink" title="六、Collections"></a>六、Collections</h3><blockquote>
<p>Collections:是集合进行工具操作的类，例如集合排序和二分查找等</p>
<p>Collection:是单列集合的父类，有List和Set的子接口</p>
</blockquote>
<p>sort(list) 自然排序</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Collections.sort(list);</span><br></pre></td></tr></table></figure>

<p>binarySearch(list,key) 二分查找</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> s=Collections.binarySearch(list,<span class="number">125</span>);</span><br></pre></td></tr></table></figure>

<p>synchronizedXXX(XXX):对线程不安全，改为线程安全</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List li=Collections.synchronizedList(list);</span><br></pre></td></tr></table></figure>



<p>max()  :查找集合的最大值</p>
<p>reverse(list):进行反转</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Collections.reverse(list);</span><br></pre></td></tr></table></figure>

<p>shuffle(list):元素随机</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Collections.shuffle(list);</span><br></pre></td></tr></table></figure>



<img src="https://csn.damyoung.cn/image-20200731223511191.png" alt="image-20200731223511191" style="zoom:67%;" />


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dmyang-only.github.io/2020/11/11/03Servlet/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dmYang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DmYoung">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/11/03Servlet/" class="post-title-link" itemprop="url">Servlet</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-11 12:33:33" itemprop="dateCreated datePublished" datetime="2020-11-11T12:33:33+08:00">2020-11-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-12-17 13:20:05" itemprop="dateModified" datetime="2020-12-17T13:20:05+08:00">2020-12-17</time>
              </span>

          
            <span id="/2020/11/11/03Servlet/" class="post-meta-item leancloud_visitors" data-flag-title="Servlet" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>35k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>32 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>URL</strong>是统一资源定位符，对可以从互联网上得到的资源的位置和访问方法的一种简洁的表示，是互联网上标准资源的地址。</p>
<p>基本URL包含模式（或称协议）、服务器名称（或IP地址）、路径和文件名</p>
<p>如“协议：//授权/路径?查询”。</p>
<p><strong>URI：</strong>不包括http 和localhost</p>
<ul>
<li><strong>封装JavaBean对象，属性要与构造方法相同，不然会出NullPointException</strong></li>
</ul>
<h2 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h2><blockquote>
<p>为保证线程安全，不要为Servlet设置成员变量，这种没有任何成员变量的类是线程安全的</p>
<p>因为成员变量保存的数据也可以成为状态信息，没有成员变量称为【无状态】</p>
</blockquote>
<p>是运行在Web服务器的小型Java程序，即<strong>服务器端小应用程序</strong></p>
<p>通过HTTP(超文本传输协议) <strong>接收和响应Web客户端</strong>的请求</p>
<h3 id="编写Servlet程序"><a href="#编写Servlet程序" class="headerlink" title="编写Servlet程序"></a>编写Servlet程序</h3><p>1、实现Servlet接口</p>
<p><img src="https://csn.damyoung.cn/image-20200911090821515.png" alt="image-20200911090821515"></p>
<p>2、修改web.xml文件</p>
<p><img src="https://csn.damyoung.cn/image-20200911091443831.png" alt="image-20200911091443831"></p>
<p>3、部署到tomcat服务器</p>
<p>4、测试 <a target="_blank" rel="noopener" href="http://localhost:8080/demo1">http://localhost:8080/demo1</a></p>
<h3 id="1、生命周期"><a href="#1、生命周期" class="headerlink" title="1、生命周期"></a>1、生命周期</h3><p>实例化–初始化–服务–销毁</p>
<ul>
<li>init：只会调用一次，在创建servlet实例的时候才会创建</li>
<li>service：进行数据处理，只要接受一次请求，就会调用一次</li>
<li>destroy：销毁servlet对象时调用。停止服务器或重新部署web应用时</li>
</ul>
<img src="https://csn.damyoung.cn/image-20200911093556913.png" alt="image-20200911093556913" style="zoom: 80%;" />

<img src="https://csn.damyoung.cn/image-20200911093611285.png" alt="image-20200911093611285" style="zoom:80%;" />

<img src="https://csn.damyoung.cn/image-20200911093623975.png" alt="image-20200911093623975" style="zoom:67%;" />

<p><img src="https://csn.damyoung.cn/image-20200911093654231.png" alt="image-20200911093654231"></p>
<h3 id="2、Servlet创建方式"><a href="#2、Servlet创建方式" class="headerlink" title="2、Servlet创建方式"></a>2、Servlet创建方式</h3><p>1、实现javax.servlet.Servlet接口</p>
<p>2、继承javax.servlet.GenericServlet类（适配器模式）</p>
<p><img src="https://csn.damyoung.cn/image-20200911102435492.png" alt="image-20200911102435492"></p>
<p>3、继承javax.servlet.http.HttpServlet类（模板方法模式）</p>
<ul>
<li>Servlet–GenericServlet–HttpServlet</li>
</ul>
<img src="https://csn.damyoung.cn/image-20200911112518725.png" alt="image-20200911112518725" style="zoom:80%;" />

<h4 id="接收请求和响应"><a href="#接收请求和响应" class="headerlink" title="接收请求和响应"></a>接收请求和响应</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//接收数据</span></span><br><span class="line">String username=request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">String password=request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">System.out.println(request.getRemoteAddr()+username+<span class="string">&quot;..&quot;</span>+password);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//响应数据</span></span><br><span class="line"><span class="comment">//字节流</span></span><br><span class="line">PrintWriter out=response.getWriter();</span><br><span class="line">out.write(<span class="string">&quot;获取数据成功&quot;</span>);</span><br><span class="line"> <span class="comment">//字符流</span></span><br><span class="line">ServletOutputStream out=response.getOutputStream();</span><br><span class="line">out.write(<span class="string">&quot;获取数据成功&quot;</span>.getBytes());</span><br></pre></td></tr></table></figure>

<h4 id="编码"><a href="#编码" class="headerlink" title="编码"></a>编码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//服务器默认使用ISO-8859-1</span></span><br><span class="line">request.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">response.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="映射路径"><a href="#映射路径" class="headerlink" title="映射路径"></a>映射路径</h4><p>匹配顺序：精确匹配&gt;路径匹配&gt;扩展名匹配&gt;缺省匹配</p>
<p>（1）配置多个映射路径</p>
<img src="https://csn.damyoung.cn/image-20200911100234541.png" alt="image-20200911100234541" style="zoom:80%;" />

<p>（2）通配符</p>
<p><img src="https://csn.damyoung.cn/image-20200911100832172.png" alt="image-20200911100832172"></p>
<ul>
<li><p>*<strong>.</strong>    以任意路径映射到这个servlet， 如 xx.</p>
</li>
<li><p>*<em>/**</em>     任意路径映射到这个servlet，    如  /xxxx</p>
</li>
<li><p>*<em>/action/**</em>           以  /action 下的任意路径的请求都可以访问</p>
</li>
</ul>
<p>（3）优先级</p>
<p>绝对匹配&gt;/开头匹配&gt;扩展名方式匹配</p>
<h4 id="servlet自动加载"><a href="#servlet自动加载" class="headerlink" title="servlet自动加载"></a>servlet自动加载</h4><p>servlet只有在第一次被访问的时候才会加载，这肯定会造成第一个访问的人访问时间较长，因为他需要等待servlet完成加载</p>
<img src="https://csn.damyoung.cn/image-20200911110306560.png" alt="image-20200911110306560" style="zoom:80%;" />

<h3 id="3、servlet配置方式"><a href="#3、servlet配置方式" class="headerlink" title="3、servlet配置方式"></a>3、servlet配置方式</h3><h4 id="（1）在web-xml文件中配置"><a href="#（1）在web-xml文件中配置" class="headerlink" title="（1）在web.xml文件中配置"></a>（1）在web.xml文件中配置</h4><h4 id="（2）注解方式"><a href="#（2）注解方式" class="headerlink" title="（2）注解方式"></a>（2）注解方式</h4><p>@WebServlet（”/xxx”）<strong>必须加上斜杆</strong></p>
<p>value等价urlPatterns 类型 String[]   可以使用数组方式：urlPatterns={“/servlet/url1”,”/servlet/url2”}</p>
<p><img src="https://csn.damyoung.cn/image-20200911105435675.png" alt="image-20200911105435675"></p>
<p>访问/demo2的时候，服务器同样就会将处理交由Servlet1进行处理</p>
<h3 id="4、Servlet对象"><a href="#4、Servlet对象" class="headerlink" title="4、Servlet对象"></a>4、Servlet对象</h3><p>HttpServletRequest 请求对象：获取请求信息</p>
<p>HttpServletResponse 响应对象：设置响应对象</p>
<h4 id="（1）ServletConfig"><a href="#（1）ServletConfig" class="headerlink" title="**（1）ServletConfig  **"></a>**（1）ServletConfig  **</h4><h5 id="获取servlet配置对象"><a href="#获取servlet配置对象" class="headerlink" title="获取servlet配置对象"></a><strong>获取servlet配置对象</strong></h5><ul>
<li>getInitParameter() 根据参数名获取参数值</li>
<li>getInitParameterNames()  获取所有参数</li>
</ul>
<p><img src="https://csn.damyoung.cn/image-20200911115059752.png" alt="image-20200911115059752"></p>
<h5 id="得到ServletContext对象"><a href="#得到ServletContext对象" class="headerlink" title="得到ServletContext对象"></a>得到ServletContext对象</h5><h4 id="（2）ServletContext"><a href="#（2）ServletContext" class="headerlink" title="**（2）ServletContext **"></a>**（2）ServletContext **</h4><p><strong>application域对象，在一定范围内，使多个Servlet共享数据</strong></p>
<p>又叫Servlet上下文，代表当前整个应用程序，Web服务器启动时，会为每一个Web应用程序创建的一个共享的存储区域，在服务器启动时创建，关闭时销毁</p>
<h5 id="获取方式"><a href="#获取方式" class="headerlink" title="获取方式"></a>获取方式</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//第一种方法：</span></span><br><span class="line">ServletContext application = <span class="keyword">this</span>.getServletContext();</span><br><span class="line"><span class="comment">//第二种方式：</span></span><br><span class="line">ServletContext application2 = getServletConfig().getServletContext();</span><br><span class="line"><span class="comment">//第三种方法：通过session获取,常用</span></span><br><span class="line">ServletContext application3 = request.getSession().getServletContext();</span><br><span class="line"><span class="comment">//第四种方式：通过Request，最常用</span></span><br><span class="line">ServletContext application4 = request.getServletContext();</span><br></pre></td></tr></table></figure>

<h5 id="获取信息"><a href="#获取信息" class="headerlink" title="获取信息"></a>获取信息</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取路径信息(上下文路径）</span></span><br><span class="line">String path3 = application.getContextPath();<span class="comment">//项目根路径</span></span><br><span class="line"><span class="comment">//在上下文存储信息</span></span><br><span class="line">application.setAttribute(<span class="string">&quot;welcome&quot;</span>,<span class="string">&quot;在其他页面获取上下文也可以读到&quot;</span>);</span><br><span class="line"><span class="comment">//读取上下文信息</span></span><br><span class="line">Object attribute = application.getAttribute(<span class="string">&quot;welcome&quot;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//已知相对路径，求绝对路径</span></span><br><span class="line">ServletContext servletContext=<span class="keyword">this</span>.getServletContext();</span><br><span class="line">System.out.println(servletContext.getRealPath(<span class="string">&quot;web\\login.html&quot;</span>));</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.getServletContext().setAttribute(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">Object attribute = <span class="keyword">this</span>.getServletContext().getAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">resp.getWriter().write(attribute.toString());</span><br></pre></td></tr></table></figure>

<h4 id="（3）Http-Servlet-response"><a href="#（3）Http-Servlet-response" class="headerlink" title="（3）Http Servlet response"></a>（3）Http Servlet response</h4><p><strong>HttpServletResponse</strong>对象代表服务器的响应，封装了向客户端<strong>发送数据、发送响应头、发送响应状态码</strong></p>
<h5 id="跳转刷新"><a href="#跳转刷新" class="headerlink" title="跳转刷新"></a>跳转刷新</h5><p><strong>response.setHeader(“refresh”,” ?; url=   “)</strong></p>
<p><strong>url为绝对路径</strong></p>
<ul>
<li><strong>发送http头</strong>，控制浏览器定时刷新网页</li>
<li>输出一个随机数，控制浏览器每2s刷新一次</li>
<li>利用Refresh刷新到其他组件</li>
</ul>
<p><img src="https://csn.damyoung.cn/image-20200913151857738.png" alt="image-20200913151857738"></p>
<h5 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h5><p><strong>response.sendRedirect()</strong></p>
<p><strong>实现原理：</strong>302/307状态码和location即可实现重定向</p>
<p><strong>当一个web资源收到客服端请求后，通知客户端去访问另外一个web资源，称为请求重定向</strong></p>
<ul>
<li>客服端发出2次请求，服务端的俩个程序有各自的请求和响应对象，地址栏是变换的</li>
</ul>
<p><img src="https://csn.damyoung.cn/image-20200913161050799.png" alt="image-20200913161050799"></p>
<p><img src="https://csn.damyoung.cn/image-20200913161103773.png" alt="image-20200913161103773"></p>
<h4 id="（4）HttpServletRequest"><a href="#（4）HttpServletRequest" class="headerlink" title="（4）HttpServletRequest"></a>（4）HttpServletRequest</h4><p><strong>request作为web资源，只能是转发，重定向无效</strong></p>
<p><strong>域对象</strong></p>
<p>代表客户端的请求，当客户端通过Http协议访问服务器时，Http请求头中的所有信息都封装在这个对象中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(request.getMethod());</span><br><span class="line">System.out.println(request.getRequestURL());</span><br><span class="line">System.out.println(request.getRequestURI());</span><br><span class="line">System.out.println(request.getContextPath());</span><br><span class="line">System.out.println(request.getQueryString());</span><br><span class="line"><span class="comment">//返回发出请求的客户机的IP地址</span></span><br><span class="line">System.out.println(request.getRemoteAddr());</span><br><span class="line"><span class="comment">//返回发出请求的客户机的 完整主机名</span></span><br><span class="line">System.out.println(request.getRemoteHost());</span><br><span class="line"><span class="comment">//返回发出请求的客户机的 网络端口号</span></span><br><span class="line">System.out.println(request.getRemotePort());</span><br><span class="line"></span><br><span class="line"><span class="comment">//web服务器的ip地址</span></span><br><span class="line">System.out.println(request.getLocalAddr());</span><br><span class="line"><span class="comment">//web服务器的主机名</span></span><br><span class="line">System.out.println(request.getLocalName());</span><br></pre></td></tr></table></figure>

<h5 id="接收请求"><a href="#接收请求" class="headerlink" title="接收请求"></a>接收请求</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">req.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">resp.setContentType(<span class="string">&quot;text/html; charset=UTF-8&quot;</span>);</span><br><span class="line">String name=req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">String pwd=req.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">resp.getWriter().write(name);</span><br><span class="line">resp.getWriter().write(pwd);</span><br><span class="line">System.out.println(<span class="string">&quot;用户名&quot;</span>+name+<span class="string">&quot;密码&quot;</span>+pwd);</span><br></pre></td></tr></table></figure>

<h5 id="转发"><a href="#转发" class="headerlink" title="转发"></a>转发</h5><p>路径必须为相对路径，加上/  </p>
<p><strong>getRequestDispatcher(String path)</strong> 参数表示传到哪里去</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> resp.getWriter().write(<span class="string">&quot;工商局收到老汉提交的资料&lt;br/&gt;&quot;</span>);</span><br><span class="line"><span class="comment">//转发</span></span><br><span class="line">req.getRequestDispatcher(<span class="string">&quot;RequestSendDemo2&quot;</span>).forward(req, resp);</span><br><span class="line">resp.getWriter().write(<span class="string">&quot;工商局收到审批文件，工商再办证给老汉&lt;/br&gt;&quot;</span>);</span><br></pre></td></tr></table></figure>

<h6 id="forward"><a href="#forward" class="headerlink" title="forward()"></a>forward()</h6><p>会先清空用于存放响应正文数据的缓冲区，源组件生成的响应结果不会被发送到客户端，只有目标组件生成的响应结果才会发送到客户端</p>
<h6 id="include"><a href="#include" class="headerlink" title="include()"></a>include()</h6><p><img src="https://csn.damyoung.cn/image-20200914164513879.png" alt="image-20200914164513879"></p>
<h4 id="（5）转发与重定向"><a href="#（5）转发与重定向" class="headerlink" title="（5）转发与重定向"></a>（5）转发与重定向</h4><p><strong>转发</strong></p>
<ul>
<li>A要跳转到C网页，A需要先请求到B，B带领着A去请求C，相当于是A<strong>只请求了一次</strong>。</li>
<li>请求的网址不改变，请求的次数一次，可后退，刷新重新提交表单</li>
<li>服务器行为，只做一次访问请求，<strong>浏览器地址不变</strong></li>
</ul>
<p><strong>重定向</strong></p>
<ul>
<li>A要请求C，A先请求B，B把C的网址给到A，A再去请求C，则A<strong>请求了2次</strong></li>
<li>请求的网址改变，请求次数两次，不可后退，刷新不变</li>
<li>客户端行为(浏览器重新访问)、至少做两次访问请求、<strong>浏览器地址改变</strong></li>
</ul>
<h3 id="5、线程安全"><a href="#5、线程安全" class="headerlink" title="5、线程安全"></a>5、线程安全</h3><p><strong>每次请求都会创建一个线程</strong>。如果多人同时请求，就会存在多个线程操作一个Servlet对象，如果在对应的方法中操作了成员变量，就会产生线程安全问题</p>
<ul>
<li>将存在线程安全问题的代码放在同步代码块中synchronized</li>
<li>尽可能使用基本不变量，防止使用成员变量</li>
</ul>
<h3 id="6、过滤器"><a href="#6、过滤器" class="headerlink" title="6、过滤器"></a>6、过滤器</h3><blockquote>
<p>实现权限访问控制、过滤敏感词汇、压缩响应信息</p>
<p><strong>实现过滤拦截，放行后，若不是重定向，则request转发到 受拦截的URI地址上</strong></p>
</blockquote>
<h4 id="6-1-API"><a href="#6-1-API" class="headerlink" title="6.1 API"></a>6.1 API</h4><ul>
<li>destroy()  销毁</li>
<li>doFilter()  每次访问执行一次</li>
<li>init()  初始化</li>
</ul>
<h4 id="6-2-配置过滤器"><a href="#6-2-配置过滤器" class="headerlink" title="6.2 配置过滤器"></a>6.2 配置过滤器</h4><p><strong>注解：</strong>@WebFilter(“/yourFilter”)</p>
<p><strong>xml文件：</strong></p>
<p><img src="https://csn.damyoung.cn/image-20200913205457410.png" alt="image-20200913205457410"></p>
<h4 id="6-3-多个过滤器执行顺序"><a href="#6-3-多个过滤器执行顺序" class="headerlink" title="6.3 多个过滤器执行顺序"></a>6.3 多个过滤器执行顺序</h4><p>注解优先级别设定</p>
<p>在xml中，排前面的<code>filter-mapping</code>优先执行</p>
<p>在注解中按照类名的<strong>字符串排序</strong>进行作用</p>
<h4 id="6-4-登录过滤"><a href="#6-4-登录过滤" class="headerlink" title="6.4 登录过滤"></a>6.4 登录过滤</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">    HttpServletRequest req=(HttpServletRequest)servletRequest;</span><br><span class="line">    HttpServletResponse resp= (HttpServletResponse) servletResponse;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获得请求的URI</span></span><br><span class="line">    String uri = req.getRequestURI();</span><br><span class="line">    System.out.println(uri);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果请求是以下uri时,则请求直接放行,其他请求一律要进行登录验证，防止为授权访问</span></span><br><span class="line">    <span class="comment">//1、User非空说明登录验证成功,是正确的登录用户(登录验证已经在LoginServlet进行),直接放行即可</span></span><br><span class="line">    <span class="comment">//2、为空说明非法登录或是登录错误用户</span></span><br><span class="line">    <span class="keyword">if</span> (!(<span class="string">&quot;/shop/login&quot;</span>.equals(uri) || <span class="string">&quot;/shop/login.jsp&quot;</span>.equals(uri)))&#123;</span><br><span class="line">        User user = (User) req.getSession().getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (user!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">//已经登录都放行</span></span><br><span class="line">            filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//没有session，说明是非法</span></span><br><span class="line">            req.setAttribute(<span class="string">&quot;error&quot;</span>,<span class="string">&quot;请先登录!&quot;</span>);</span><br><span class="line">            req.getRequestDispatcher(<span class="string">&quot;login.jsp&quot;</span>).forward(servletRequest, servletResponse);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//资源放行，只有这句话执行才能继续访问</span></span><br><span class="line">        filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="6-4-2-登录记住账号密码-转发"><a href="#6-4-2-登录记住账号密码-转发" class="headerlink" title="6.4.2 登录记住账号密码 转发"></a>6.4.2 登录记住账号密码 转发</h5><ul>
<li>LoginServlet设置Cookie</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Cookie记住用户名</span></span><br><span class="line">Cookie cookie1 = <span class="keyword">new</span> Cookie(<span class="string">&quot;username&quot;</span>,username);</span><br><span class="line">String remember = req.getParameter(<span class="string">&quot;remember&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (remember!=<span class="keyword">null</span>)&#123;</span><br><span class="line">    cookie1.setMaxAge(<span class="number">60</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    cookie1.setMaxAge(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line">resp.addCookie(cookie1);</span><br></pre></td></tr></table></figure>

<p><strong>过滤器拦截放行，通过request转发传递Cookie</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Cookie[] cookies = request.getCookies();</span><br><span class="line"><span class="keyword">if</span> (cookies!=<span class="keyword">null</span>)&#123;</span><br><span class="line">    <span class="keyword">for</span> (Cookie cookie:cookies)&#123;</span><br><span class="line">        <span class="keyword">if</span> (cookie.getName().equals(<span class="string">&quot;username&quot;</span>)) &#123;</span><br><span class="line">            String username = cookie.getValue();</span><br><span class="line">            request.setAttribute(<span class="string">&quot;username&quot;</span>, username);</span><br><span class="line"></span><br><span class="line">            String checkState = <span class="string">&quot;checked=&#x27;checked&#x27;&quot;</span>;</span><br><span class="line">            <span class="comment">//设置request域</span></span><br><span class="line">            request.setAttribute(<span class="string">&quot;checkState&quot;</span>, checkState);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//放行 相当于转发，表示重定向，request的值都能传递过去</span></span><br><span class="line">filterChain.doFilter(servletRequest, servletResponse);</span><br></pre></td></tr></table></figure>

<h5 id="6-4-3-自动登录"><a href="#6-4-3-自动登录" class="headerlink" title="6.4.3 自动登录"></a>6.4.3 自动登录</h5><ul>
<li>loginServlet 设置Cookie</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Cookie自动登录</span></span><br><span class="line"><span class="comment">//admin&amp;123</span></span><br><span class="line">Cookie cookie2=<span class="keyword">new</span> Cookie(<span class="string">&quot;user&quot;</span>, user.getUsername()+<span class="string">&quot;&amp;&quot;</span>+user.getPassword());</span><br><span class="line">String autologin=req.getParameter(<span class="string">&quot;autologin&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (autologin!=<span class="keyword">null</span>)&#123;</span><br><span class="line">    cookie2.setMaxAge(<span class="number">60</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    cookie2.setMaxAge(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line">resp.addCookie(cookie2);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Cookie[] cookies = req.getCookies();</span><br><span class="line">        <span class="keyword">if</span> (cookies!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span> (Cookie cookie:cookies)&#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">&quot;user&quot;</span>.equals(cookie.getName())) &#123;</span><br><span class="line">                    String username=cookie.getValue().split(<span class="string">&quot;&amp;&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">                    String password = cookie.getValue().split(<span class="string">&quot;&amp;&quot;</span>)[<span class="number">1</span>];</span><br><span class="line">                    User user=<span class="keyword">new</span> LoginService().login(username,password);</span><br><span class="line">                    <span class="keyword">if</span> (user!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                        HttpSession session = req.getSession();</span><br><span class="line">                        session.setAttribute(<span class="string">&quot;user&quot;</span>,user);</span><br><span class="line">                        req.getRequestDispatcher(<span class="string">&quot;bookStoreShow1&quot;</span>).forward(servletRequest, servletResponse);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        filterChain.doFilter(servletRequest, servletResponse);</span><br></pre></td></tr></table></figure>

<h4 id="6-5-过滤器处理浏览器缓存"><a href="#6-5-过滤器处理浏览器缓存" class="headerlink" title="6.5 过滤器处理浏览器缓存"></a>6.5 过滤器处理浏览器缓存</h4><p>当向服务器请求html界面时，第一次服务器会创建一个缓存区，将资源放入缓存区，当客户端第二次进行访问时，服务器根据时间判断如果是同一个资源且没有更新，就直接返回缓存区资源并且返回<strong>304状态码</strong>，同时浏览器也会在本地缓存资源，当关闭浏览器重新打开或打开新页面时进行访问时，浏览器会从<strong>本地缓存查找</strong>，如果有就返回<code>200(from disk cache)</code>,再次刷新返回304</p>
<p><strong>避免浏览器缓存的方法</strong>：浏览器还是会缓存，只是控制每次都是第一次访问</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest req, ServletResponse resp, FilterChain chain)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;开始执行过滤&quot;</span>);</span><br><span class="line">    HttpServletRequest request = (HttpServletRequest) req;</span><br><span class="line">    HttpServletResponse response = (HttpServletResponse) resp;</span><br><span class="line">    response.setDateHeader(<span class="string">&quot;Expires&quot;</span>,-<span class="number">1</span>);</span><br><span class="line">    response.setHeader(<span class="string">&quot;Cache-Control&quot;</span>,<span class="string">&quot;no-cache&quot;</span>);</span><br><span class="line">    response.setHeader(<span class="string">&quot;Pragma&quot;</span>,<span class="string">&quot;no-cache&quot;</span>);</span><br><span class="line">    chain.doFilter(req, resp);<span class="comment">//资源放行，只有这句话执行才能继续访问</span></span><br><span class="line">    </span><br><span class="line">    System.out.println(<span class="string">&quot;过滤完成&quot;</span>);</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<h3 id="7、封装表单元素"><a href="#7、封装表单元素" class="headerlink" title="7、封装表单元素"></a>7、封装表单元素</h3><h4 id="（1）getParameter"><a href="#（1）getParameter" class="headerlink" title="（1）getParameter"></a>（1）getParameter</h4><p><img src="https://csn.damyoung.cn/image-20200914001911034.png" alt="image-20200914001911034"></p>
<h4 id="（2）getParameterMap"><a href="#（2）getParameterMap" class="headerlink" title="（2）getParameterMap"></a>（2）getParameterMap</h4><p><img src="https://csn.damyoung.cn/image-20200914001945037.png" alt="image-20200914001945037"></p>
<h4 id="（3）导入BeanUtils"><a href="#（3）导入BeanUtils" class="headerlink" title="（3）导入BeanUtils"></a>（3）导入BeanUtils</h4><p><strong>实体类变量应该与表单一致</strong></p>
<p>导入三个包（将包放在tomcat/bin目录下）</p>
<p>commons-beautils</p>
<p>commons-collections</p>
<p>commons-logging</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Emp emp=<span class="keyword">new</span> Emp();</span><br><span class="line">System.out.println(<span class="string">&quot;封装数据前&quot;</span>+emp);</span><br><span class="line">BeanUtils.populate(emp,req.getParameterMap());</span><br><span class="line">System.out.println(<span class="string">&quot;封装数据后&quot;</span>+emp);</span><br></pre></td></tr></table></figure>

<h4 id="（4）getParameter用法"><a href="#（4）getParameter用法" class="headerlink" title="（4）getParameter用法"></a>（4）getParameter用法</h4><ul>
<li>获取表单name属性</li>
<li>获取超链接属性</li>
</ul>
<blockquote>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=&quot;delBook?id=$&#123;li.id&#125;&quot; onclick=&quot;return confirm(&#x27;确认删除$&#123;li.name&#125;?&#x27;)&quot;&gt;删除&lt;/a&gt;</span><br><span class="line">req.getParameter(<span class="string">&quot;id&quot;</span>);</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="8、域对象"><a href="#8、域对象" class="headerlink" title="8、域对象"></a>8、域对象</h3><p>之所以他们是域对象，原因就是他们都内置了<strong>map集合</strong>，都有<code>setAttribute getAttribute</code>方法。 他们都有自己固定的生命周期和作用域。    </p>
<h4 id="（1）ServletContext"><a href="#（1）ServletContext" class="headerlink" title="（1）ServletContext"></a>（1）ServletContext</h4><p>Application</p>
<p>生命周期：<strong>随着服务器或Web应用</strong></p>
<p>作用范围：整个Web应用</p>
<p>作用：在不同Servlet之间转发</p>
<ul>
<li>通过重定向和转发传递数据</li>
</ul>
<h4 id="（2）Session域"><a href="#（2）Session域" class="headerlink" title="（2）Session域"></a>（2）Session域</h4><p>生命周期：调用equest.getSession() 方法时，服务器会检查是否已经有对应的session,如果没有就在内存 中创建一个session并返回。<strong>浏览器关闭也会被销毁，被浏览器独享</strong>。</p>
<p>作用范围：一次会话（可为多个Servlet共享）</p>
<h4 id="（3）request域"><a href="#（3）request域" class="headerlink" title="（3）request域"></a>（3）request域</h4><p>生命周期:<strong>请求结束</strong>，request生命结束</p>
<p>作用范围：<strong>整个请求链</strong>，只能是在<strong>一次转发有效</strong></p>
<p><img src="https://csn.damyoung.cn/image-20200914164605601.png" alt="image-20200914164605601"></p>
<p><img src="https://csn.damyoung.cn/image-20200914164615783.png" alt="image-20200914164615783"></p>
<h4 id="（4）pageContext域"><a href="#（4）pageContext域" class="headerlink" title="（4）pageContext域"></a>（4）pageContext域</h4><p>生命周期：对JSP请求时开始，<strong>当响应结束时销毁</strong></p>
<p>作用范围：整个JSP页面，是四大作用域中最小的一个，即超过这个页面就不能够使用了，</p>
<p><strong>但可以操作其他三个域对象</strong></p>
<ul>
<li>俩种方式来操作Request对象</li>
</ul>
<p><img src="https://csn.damyoung.cn/image-20200916143001663.png" alt="image-20200916143001663"></p>
<h3 id="9、文件的上传和下载"><a href="#9、文件的上传和下载" class="headerlink" title="9、文件的上传和下载"></a>9、文件的上传和下载</h3><p>导入jar包 commons-fileupload、commons-io-2.2</p>
<p><strong>上传和下载文件均需要绝对路径</strong></p>
<h4 id="9-1-上传"><a href="#9-1-上传" class="headerlink" title="9.1 上传"></a>9.1 上传</h4><p><strong>由于设置为文件可上传，故传统方式无法获得！！！！！！！！</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String username=req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">String age=req.getParameter(<span class="string">&quot;age&quot;</span>);</span><br></pre></td></tr></table></figure>

<h5 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h5><blockquote>
<ul>
<li><p>设置表单可上传&lt;  form enctype=”multipart/form-data” action=”upload” method=”post”&gt;</p>
</li>
<li><p>UploadServlet</p>
<ul>
<li><p>判断表单是否支持文件上传 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//判断表单是否支持文件上传,即enctype=&quot;multipart/form-data&quot;</span></span><br><span class="line"><span class="keyword">boolean</span> isMutipart=ServletFileUpload.isMultipartContent(req);</span><br><span class="line"><span class="keyword">if</span> (!isMutipart)&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;表单必须设置为multipart/form-data&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建ServletFileUpload对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建工厂类，用于创建ServletFileUpload对象</span></span><br><span class="line">DiskFileItemFactory factory=<span class="keyword">new</span> DiskFileItemFactory();</span><br><span class="line">ServletFileUpload servletFileUpload=<span class="keyword">new</span> ServletFileUpload(factory);</span><br></pre></td></tr></table></figure>
</li>
<li><p>遍历获得表单文件(req.getParameter() 不可行，获得不到数据)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;FileItem&gt; files=servletFileUpload.parseRequest(req);</span><br><span class="line"> <span class="keyword">for</span> (FileItem fileItem:files)&#123;</span><br><span class="line">     <span class="comment">//处理普通表单项</span></span><br><span class="line">     <span class="keyword">if</span> (fileItem.isFormField())&#123;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>普通表单</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获得字段名username</span></span><br><span class="line">String filedName=fileItem.getFieldName();</span><br><span class="line"><span class="comment">//获得字段值:张三</span></span><br><span class="line">String fieldValue=fileItem.getString(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;username&quot;</span>.equals(filedName))&#123;</span><br><span class="line">    req.setAttribute(<span class="string">&quot;username&quot;</span>,fieldValue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>文件表单</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理文件表单项</span></span><br><span class="line"><span class="comment">//获取存储上传文件目录的绝对路径(服务器中的绝对路径)</span></span><br><span class="line">String uploadPath=getServletContext().getRealPath(<span class="string">&quot;/upload&quot;</span>);</span><br><span class="line"><span class="comment">//获取上传文件的名称</span></span><br><span class="line"><span class="comment">//文件名称可能带有客户端的路径 如:f:/pictures/xx.jpg</span></span><br><span class="line">String fileName=fileItem.getName();</span><br><span class="line"><span class="comment">//文件名称不带路径xx.jpg</span></span><br><span class="line">fileName= FilenameUtils.getName(fileName);</span><br><span class="line"></span><br><span class="line"><span class="comment">//上传文件</span></span><br><span class="line">File uploadFile=<span class="keyword">new</span> File(uploadPath,fileName);</span><br><span class="line">fileItem.write(uploadFile);</span><br><span class="line">req.setAttribute(<span class="string">&quot;filename&quot;</span>,fileName);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    req.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    resp.setContentType(<span class="string">&quot;text/html; charset=UTF-8&quot;</span>);</span><br><span class="line">    PrintWriter out=resp.getWriter();</span><br><span class="line">    <span class="comment">//判断表单是否支持文件上传,即enctype=&quot;multipart/form-data&quot;</span></span><br><span class="line">    <span class="keyword">boolean</span> isMutipart=ServletFileUpload.isMultipartContent(req);</span><br><span class="line">    <span class="keyword">if</span> (!isMutipart)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;表单必须设置为multipart/form-data&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//创建工厂类，用于创建ServletFileUpload对象</span></span><br><span class="line">    DiskFileItemFactory factory=<span class="keyword">new</span> DiskFileItemFactory();</span><br><span class="line">    ServletFileUpload servletFileUpload=<span class="keyword">new</span> ServletFileUpload(factory);</span><br><span class="line">    <span class="comment">//解决上传表单中文乱码问题</span></span><br><span class="line">    servletFileUpload.setHeaderEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//限制上传文件的大小</span></span><br><span class="line">    <span class="comment">//表示单个文件最大不能超过500K</span></span><br><span class="line">    servletFileUpload.setFileSizeMax(<span class="number">500</span>*<span class="number">1024</span>);</span><br><span class="line">    <span class="comment">//表示多个上传文件合计最大不能超过1M</span></span><br><span class="line">    servletFileUpload.setSizeMax(<span class="number">1024</span>*<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        List&lt;FileItem&gt; files=servletFileUpload.parseRequest(req);</span><br><span class="line">        <span class="keyword">for</span> (FileItem fileItem:files)&#123;</span><br><span class="line">            <span class="comment">//处理普通表单项</span></span><br><span class="line">            <span class="keyword">if</span> (fileItem.isFormField())&#123;</span><br><span class="line">                <span class="comment">//因为表单设置为文件可上传, 传统方法，无法获取数据</span></span><br><span class="line">                String username=req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;11&quot;</span>+username);</span><br><span class="line">                String age=req.getParameter(<span class="string">&quot;age&quot;</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//获得字段名username</span></span><br><span class="line">                String filedName=fileItem.getFieldName();</span><br><span class="line">                <span class="comment">//获得字段值:张三</span></span><br><span class="line">                String fieldValue=fileItem.getString(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">&quot;username&quot;</span>.equals(filedName))&#123;</span><br><span class="line">                    req.setAttribute(<span class="string">&quot;username&quot;</span>,fieldValue);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">&quot;age&quot;</span>.equals(filedName))&#123;</span><br><span class="line">                    req.setAttribute(<span class="string">&quot;age&quot;</span>,fieldValue);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//处理文件表单项</span></span><br><span class="line">                <span class="comment">//获取存储上传文件目录的绝对路径(服务器中的绝对路径)</span></span><br><span class="line">                String uploadPath=getServletContext().getRealPath(<span class="string">&quot;/upload&quot;</span>);</span><br><span class="line">                System.out.println(uploadPath);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//获取上传文件的名称</span></span><br><span class="line">                <span class="comment">//文件名称可能带有客户端的路径 如:f:/pictures/xx.jpg</span></span><br><span class="line">                String fileName=fileItem.getName();</span><br><span class="line">                <span class="comment">//文件名称不带路径xx.jpg</span></span><br><span class="line">                fileName= FilenameUtils.getName(fileName);</span><br><span class="line"></span><br><span class="line">                File uploadFile=<span class="keyword">new</span> File(uploadPath,fileName);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//上传文件</span></span><br><span class="line">                fileItem.write(uploadFile);</span><br><span class="line">                req.setAttribute(<span class="string">&quot;filename&quot;</span>,fileName);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;success.jsp&quot;</span>).forward(req, resp);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (FileUploadBase.FileSizeLimitExceededException e) &#123;</span><br><span class="line">        req.setAttribute(<span class="string">&quot;errMsg&quot;</span>,<span class="string">&quot;文件过大，不能超过500K&quot;</span>);</span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;upload.jsp&quot;</span>).forward(req, resp);</span><br><span class="line">    &#125;<span class="keyword">catch</span> (FileUploadBase.SizeLimitExceededException e)&#123;</span><br><span class="line">        req.setAttribute(<span class="string">&quot;errMsg&quot;</span>,<span class="string">&quot;总文件过大，不能超过2M&quot;</span>);</span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;upload.jsp&quot;</span>).forward(req, resp);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="9-2-下载"><a href="#9-2-下载" class="headerlink" title="9.2 下载"></a>9.2 下载</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">头像:&lt;img src=<span class="string">&quot;upload/$&#123;filename&#125;&quot;</span> align=<span class="string">&quot;top&quot;</span>&gt;&lt;br/&gt;</span><br><span class="line">    &lt;a href=&quot;download?filename=$&#123;filename&#125;&quot;&gt;下载&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>创建输入流</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String fileName=req.getParameter(<span class="string">&quot;filename&quot;</span>);</span><br><span class="line"><span class="comment">//获取要下载的文件所在的目录</span></span><br><span class="line">String dir=getServletContext().getRealPath(<span class="string">&quot;/upload&quot;</span>);</span><br><span class="line"><span class="comment">//创建输入流</span></span><br><span class="line">File file=<span class="keyword">new</span> File(dir,fileName);</span><br><span class="line">FileInputStream fileInputStream=<span class="keyword">new</span> FileInputStream(file);</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置浏览器–响应头</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fileName= URLEncoder.encode(fileName,<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"><span class="comment">//设置响应头,控制浏览器下载该文件</span></span><br><span class="line">resp.setHeader(<span class="string">&quot;content-disposition&quot;</span>,<span class="string">&quot;attachment;filename&quot;</span>+fileName);</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建输出流</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建输出流</span></span><br><span class="line">ServletOutputStream os=resp.getOutputStream();</span><br><span class="line"><span class="keyword">byte</span>[] buffer=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line"><span class="keyword">int</span> len;</span><br><span class="line"><span class="keyword">while</span> ((len=fileInputStream.read(buffer))!=-<span class="number">1</span>)&#123;</span><br><span class="line">    os.write(buffer,<span class="number">0</span>,len);</span><br><span class="line">&#125;</span><br><span class="line">fileOutputStream.close();</span><br><span class="line">os.close();</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="10、会话"><a href="#10、会话" class="headerlink" title="10、会话"></a>10、会话</h3><p>被浏览器独享的域对象，常用个人用户存储传递数据</p>
<h4 id="（1）Cookie"><a href="#（1）Cookie" class="headerlink" title="（1）Cookie"></a>（1）Cookie</h4><ul>
<li>客户端技术，程序把每个用户的数据以cookie的形式写给用户各自的浏览器。</li>
<li>当用户使用浏览器去访问服务器中的Web资源时，就会带着各自的数据去</li>
</ul>
<p><strong>Cookie是实则是Map存储，获取键<code>cookie.getName()</code> 获取值<code>cookie.getValue()</code>;</strong></p>
<p><strong>创建Cookie对象</strong> <strong>键值对</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Cookie cookie = <span class="keyword">new</span> Cookie(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line">Cookie cookie1 = <span class="keyword">new</span> Cookie(<span class="string">&quot;pwd&quot;</span>, pwd);</span><br></pre></td></tr></table></figure>

<p><strong>生命周期</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cookie.setMaxAge(<span class="number">60</span>);</span><br><span class="line">cookie1.setMaxAge(<span class="number">60</span>);</span><br></pre></td></tr></table></figure>

<p><strong>添加cookie到浏览器</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">resp.addCookie(cookie);</span><br><span class="line">resp.addCookie(cookie1);</span><br></pre></td></tr></table></figure>

<p><strong>获取浏览器cookie</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Cookie[] cookies=req.getCookies();</span><br><span class="line"><span class="keyword">for</span> (Cookie cookie:cookies) &#123;</span><br><span class="line">    <span class="comment">//Cookie cookie = new Cookie(&quot;name&quot;, name);</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;name&quot;</span>.equals(cookie.getName()))&#123;</span><br><span class="line">        userName=cookie.getValue();</span><br><span class="line">        num=<span class="string">&quot;checked=&#x27;checked&#x27;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;pwd&quot;</span>.equals(cookie.getName()))&#123;</span><br><span class="line">        password=cookie.getValue();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="（2）HttpSession"><a href="#（2）HttpSession" class="headerlink" title="（2）HttpSession"></a>（2）HttpSession</h4><ul>
<li>服务器技术，为每一个用户的浏览器创建其独享的HttpSession对象</li>
<li>访问web资源时，由于session为用户浏览器独享，访问web资源时，将数据存放在各自的session中</li>
<li>访问其他Web资源时，取出在用户各自的session 为用户服务</li>
</ul>
<p><strong>Session中的数据可供当前会话中所有Servlet共享</strong>,常用于登录验证</p>
<p><img src="https://csn.damyoung.cn/image-20200915144801366.png" alt="image-20200915144801366"></p>
<p><img src="https://csn.damyoung.cn/image-20200915144814022.png" alt="image-20200915144814022"></p>
<h3 id="11、监听器"><a href="#11、监听器" class="headerlink" title="11、监听器"></a>11、监听器</h3><h2 id="Servlet技术"><a href="#Servlet技术" class="headerlink" title="Servlet技术"></a>Servlet技术</h2><h4 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 多条件查询</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Book&gt; <span class="title">searchBooks</span><span class="params">(String name,String category,String author,String minPrice,String maxPrice,</span></span></span><br><span class="line"><span class="function"><span class="params">                              String sales)</span></span>&#123;</span><br><span class="line">    StringBuilder stringBuilder=<span class="keyword">new</span> StringBuilder();</span><br><span class="line">    stringBuilder.append(<span class="string">&quot;select *from book where 1=1 &quot;</span>);</span><br><span class="line">    ArrayList list=<span class="keyword">new</span> ArrayList();</span><br><span class="line">    <span class="keyword">if</span> (!<span class="string">&quot;&quot;</span>.equals(name))&#123;</span><br><span class="line">        stringBuilder.append(<span class="string">&quot; and name like ?&quot;</span>);</span><br><span class="line">        list.add(<span class="string">&quot;%&quot;</span>+name+<span class="string">&quot;%&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="string">&quot;&quot;</span>.equals(category))&#123;</span><br><span class="line">        stringBuilder.append(<span class="string">&quot; and category = ?&quot;</span>);</span><br><span class="line">        list.add(category);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="string">&quot;&quot;</span>.equals(author))&#123;</span><br><span class="line">        stringBuilder.append(<span class="string">&quot; and author like ?&quot;</span>);</span><br><span class="line">        list.add(<span class="string">&quot;%&quot;</span>+author+<span class="string">&quot;%&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="string">&quot;&quot;</span>.equals(minPrice))&#123;</span><br><span class="line">        stringBuilder.append(<span class="string">&quot; and price &gt;=?&quot;</span>);</span><br><span class="line">        list.add(minPrice);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="string">&quot;&quot;</span>.equals(maxPrice))&#123;</span><br><span class="line">        stringBuilder.append(<span class="string">&quot; and price &lt;= ?&quot;</span>);</span><br><span class="line">        list.add(maxPrice);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="string">&quot;&quot;</span>.equals(sales))&#123;</span><br><span class="line">        stringBuilder.append(<span class="string">&quot; and sales &gt;= ?&quot;</span>);</span><br><span class="line">        list.add(sales);</span><br><span class="line">    &#125;</span><br><span class="line">    String sql = stringBuilder.toString();</span><br><span class="line">    sql=sql+ <span class="string">&quot; order by id&quot;</span>;</span><br><span class="line"></span><br><span class="line">    QueryRunner queryRunner=<span class="keyword">new</span> QueryRunner(DruidUtils.getDataSource());</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> queryRunner.query(sql,<span class="keyword">new</span> BeanListHandler&lt;&gt;(Book.class),list.toArray());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1、图片验证"><a href="#1、图片验证" class="headerlink" title="1、图片验证"></a>1、图片验证</h4><p>myweb3/login</p>
<ul>
<li>登录验证输入</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        String username=req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        String password=req.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        String code=req.getParameter(<span class="string">&quot;code&quot;</span>);</span><br><span class="line"></span><br><span class="line">        HttpSession session=req.getSession();</span><br><span class="line">        String vcode=(String)session.getAttribute(<span class="string">&quot;vcode&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (code.equals(vcode))&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;admin&quot;</span>.equals(username) &amp;&amp; <span class="string">&quot;123&quot;</span>.equals(password))&#123;</span><br><span class="line"><span class="comment">//                session.setAttribute(&quot;username&quot;,username);</span></span><br><span class="line"><span class="comment">//                resp.sendRedirect(&quot;home&quot;);</span></span><br><span class="line">                session.setAttribute(<span class="string">&quot;username&quot;</span>,username);</span><br><span class="line">                resp.sendRedirect(<span class="string">&quot;home.jsp&quot;</span>);</span><br><span class="line"></span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//                resp.setContentType(&quot;text/html; charset=UTF-8&quot;);</span></span><br><span class="line"><span class="comment">//                resp.getWriter().write(&quot;用户名或密码错误!3秒钟跳转到登录界面&quot;);</span></span><br><span class="line"><span class="comment">//                resp.setHeader(&quot;refresh&quot;,&quot;3;url=login.html&quot;);</span></span><br><span class="line">                String msg=<span class="string">&quot;账号密码输入错误&quot;</span>;</span><br><span class="line">                req.setAttribute(<span class="string">&quot;msg&quot;</span>,msg);</span><br><span class="line">                req.getRequestDispatcher(<span class="string">&quot;login.jsp&quot;</span>).forward(req, resp);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="comment">//            resp.setContentType(&quot;text/html; charset=UTF-8&quot;);</span></span><br><span class="line"><span class="comment">//            resp.getWriter().write(&quot;验证码错误！3秒跳转到登录界面&quot;);</span></span><br><span class="line"><span class="comment">//            resp.setHeader(&quot;refresh&quot;,&quot;3;url=login2.html&quot;);</span></span><br><span class="line">            String msg=<span class="string">&quot;验证码错误&quot;</span>;</span><br><span class="line">            req.setAttribute(<span class="string">&quot;msg&quot;</span>,msg);</span><br><span class="line">            req.getRequestDispatcher(<span class="string">&quot;login.jsp&quot;</span>).forward(req, resp);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>生成验证码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> login;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.Color;</span><br><span class="line"><span class="keyword">import</span> java.awt.Font;</span><br><span class="line"><span class="keyword">import</span> java.awt.Graphics;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Servlet implementation class ValidCodeServlet</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> admin</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/validCode&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValidCodeServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">       </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> HttpServlet#HttpServlet()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ValidCodeServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@see</span> HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">      <span class="comment">// 在内存中创建图象</span></span><br><span class="line">      <span class="keyword">int</span> width = <span class="number">120</span>, height = <span class="number">30</span>;</span><br><span class="line">      BufferedImage image = <span class="keyword">new</span> BufferedImage(width, height,</span><br><span class="line">            BufferedImage.TYPE_INT_RGB);</span><br><span class="line">      <span class="comment">// 获取图形上下文</span></span><br><span class="line">      Graphics g = image.getGraphics();</span><br><span class="line">      <span class="comment">// 生成随机类</span></span><br><span class="line">      Random random = <span class="keyword">new</span> Random();</span><br><span class="line">      <span class="comment">// 设定背景色</span></span><br><span class="line">      g.setColor(<span class="keyword">new</span> Color(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>));</span><br><span class="line">      g.fillRect(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">      <span class="comment">// 设定字体</span></span><br><span class="line">      g.setFont(<span class="keyword">new</span> Font(<span class="string">&quot;Times New Roman&quot;</span>, Font.PLAIN, <span class="number">23</span>));</span><br><span class="line">      <span class="comment">// 画边框</span></span><br><span class="line">      g.setColor(getRandColor(<span class="number">160</span>, <span class="number">200</span>));</span><br><span class="line">      g.drawRect(<span class="number">0</span>, <span class="number">0</span>, width - <span class="number">1</span>, height - <span class="number">1</span>);</span><br><span class="line">      <span class="comment">// 随机产生155条干扰线，使图象中的认证码不易被其它程序探测到</span></span><br><span class="line">      g.setColor(getRandColor(<span class="number">160</span>, <span class="number">200</span>));</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">         <span class="keyword">int</span> x = random.nextInt(width);</span><br><span class="line">         <span class="keyword">int</span> y = random.nextInt(height);</span><br><span class="line">         <span class="keyword">int</span> xl = random.nextInt(<span class="number">12</span>);</span><br><span class="line">         <span class="keyword">int</span> yl = random.nextInt(<span class="number">12</span>);</span><br><span class="line">         g.drawLine(x, y, x + xl, y + yl);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 取随机产生的认证码(4位数字)</span></span><br><span class="line">      StringBuilder sRand = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">         <span class="keyword">int</span> type = random.nextInt(<span class="number">3</span>);</span><br><span class="line">         <span class="comment">//产生一位随机的数字，大写或小与字母</span></span><br><span class="line">         String rand = getCaptchaPath(type);</span><br><span class="line">         sRand.append(rand);</span><br><span class="line">         <span class="comment">// 将认证码显示到图象中</span></span><br><span class="line">         g.setColor(<span class="keyword">new</span> Color(<span class="number">20</span> + random.nextInt(<span class="number">110</span>), <span class="number">20</span> + random</span><br><span class="line">               .nextInt(<span class="number">110</span>), <span class="number">20</span> + random.nextInt(<span class="number">110</span>)));</span><br><span class="line">         <span class="comment">// 调用函数出来的颜色相同，可能是因为种子太接近，所以只能直接生成</span></span><br><span class="line">         g.drawString(rand, <span class="number">26</span> * i + <span class="number">14</span>, <span class="number">23</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      HttpSession session=request.getSession();</span><br><span class="line">      <span class="comment">//将验证码存入session中</span></span><br><span class="line">      session.setAttribute(<span class="string">&quot;vcode&quot;</span>,sRand.toString());</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 图象生效</span></span><br><span class="line">      g.dispose();</span><br><span class="line">      <span class="comment">// 输出图象到页面</span></span><br><span class="line">      ImageIO.write(image, <span class="string">&quot;JPEG&quot;</span>, response.getOutputStream());</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">getCaptchaPath</span><span class="params">(<span class="keyword">int</span> type)</span> </span>&#123;</span><br><span class="line">      String result = <span class="string">&quot;&quot;</span>;</span><br><span class="line">      Random random = <span class="keyword">new</span> Random();</span><br><span class="line">      <span class="keyword">if</span> (type == <span class="number">0</span>) &#123;</span><br><span class="line">         result = String.valueOf(random.nextInt(<span class="number">10</span>));</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type == <span class="number">1</span>) &#123;</span><br><span class="line">         <span class="keyword">int</span> itmp = <span class="keyword">new</span> Random().nextInt(<span class="number">26</span>) + <span class="number">65</span>;</span><br><span class="line">         result = String.valueOf((<span class="keyword">char</span>) itmp);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="keyword">int</span> itmp = <span class="keyword">new</span> Random().nextInt(<span class="number">26</span>) + <span class="number">97</span>;</span><br><span class="line">         result = String.valueOf((<span class="keyword">char</span>) itmp);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Color <span class="title">getRandColor</span><span class="params">(<span class="keyword">int</span> fc, <span class="keyword">int</span> bc)</span> </span>&#123;<span class="comment">// 给定范围获得随机颜色</span></span><br><span class="line">      Random random = <span class="keyword">new</span> Random();</span><br><span class="line">      <span class="keyword">if</span> (fc &gt; <span class="number">255</span>) &#123;</span><br><span class="line">         fc = <span class="number">255</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (bc &gt; <span class="number">255</span>) &#123;</span><br><span class="line">         bc = <span class="number">255</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">int</span> r = fc + random.nextInt(bc - fc);</span><br><span class="line">      <span class="keyword">int</span> g = fc + random.nextInt(bc - fc);</span><br><span class="line">      <span class="keyword">int</span> b = fc + random.nextInt(bc - fc);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Color(r, g, b);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@see</span> HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">      <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">      doGet(request, response);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2、添加购物车"><a href="#2、添加购物车" class="headerlink" title="2、添加购物车"></a>2、添加购物车</h4><p>myweb3/bookshop</p>
<h4 id="3、分页查询"><a href="#3、分页查询" class="headerlink" title="3、分页查询"></a>3、分页查询</h4><ul>
<li>创建<code>PageBean</code>实体类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PageBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> pageNo;<span class="comment">// 当前第多少页</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> pageSize;<span class="comment">// 每页大小</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> totalItemCount;<span class="comment">// 总记录数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> totalPageCount;<span class="comment">//总页数</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 数据载体,即当前页要显示的数据</span></span><br><span class="line"><span class="comment">     * 封装当前页的所有Book对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Book&gt; data;</span><br></pre></td></tr></table></figure>

<ul>
<li>pagelist.jsp(数据来源，pageBean)</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;table&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;th&gt;序号&lt;ath&gt;</span><br><span class="line">        &lt;th&gt;姓名&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;价格&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;目录&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;库存&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;图片&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;类型&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;作者&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;sales&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;删除&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;修改&lt;/th&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;c:forEach items=<span class="string">&quot;$&#123;pageBean.data&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;li&quot;</span> varStatus=<span class="string">&quot;vs&quot;</span>&gt;</span><br><span class="line">        &lt;tr $&#123;vs.count%<span class="number">2</span>==<span class="number">1</span>? <span class="string">&quot;style=&#x27;background-color:yellow&#x27;&quot;</span>:<span class="string">&quot;&quot;</span>&#125;&gt;</span><br><span class="line">            &lt;td&gt;$&#123;li.id&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;detail&quot;</span>&gt;<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;detail?id=$&#123;li.id&#125;&quot;</span>&gt;</span>$&#123;li.name&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span>&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;li.price&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;li.category&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;li.pnum&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;<span class="xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;images/$&#123;li.imgurl&#125;&quot;</span>/&gt;</span></span>&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;li.description&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;li.author&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;$&#123;li.sales&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/c:forEach&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&lt;/c:<span class="keyword">if</span>&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;page&quot;</span>&gt;</span><br><span class="line">    &lt;a href=<span class="string">&quot;page?pageNo=$&#123;pageBean.pageNo==1?1:pageBean.pageNo-1&#125;&quot;</span>&gt;&amp;lt;&amp;lt;上一页&lt;/a&gt;&amp;nbsp;&amp;nbsp;</span><br><span class="line">    第$&#123;pageBean.pageNo&#125;页/共$&#123;pageBean.totalPageCount&#125;页&amp;nbsp;&amp;nbsp;总$&#123;pageBean.totalItemCount&#125;条记录&amp;nbsp;&amp;nbsp;</span><br><span class="line">    &lt;a href=<span class="string">&quot;page?pageNo=$&#123;pageBean.pageNo==pageBean.totalPageCount?pageBean.totalPageCount:pageBean.pageNo+1&#125;&quot;</span>&gt;下一页&amp;gt;&amp;gt;&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>pageServlet</code>根据pageNo,pageSize得到<code>pageBean</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//默认第一页</span></span><br><span class="line"><span class="keyword">int</span> pageNo=<span class="number">1</span>;</span><br><span class="line">String pageIndex=req.getParameter(<span class="string">&quot;pageNo&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (pageIndex !=<span class="keyword">null</span>)&#123;</span><br><span class="line">    pageNo=Integer.parseInt(pageIndex);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//设置一页显示几页</span></span><br><span class="line"><span class="keyword">int</span> pageSize=<span class="number">5</span>;</span><br><span class="line">PageService pageService=<span class="keyword">new</span> PageService();</span><br><span class="line">PageBean pageBean=pageService.getPageBean(pageNo,pageSize);</span><br><span class="line">req.setAttribute(<span class="string">&quot;pageBean&quot;</span>,pageBean);</span><br><span class="line">req.getRequestDispatcher(<span class="string">&quot;pagelist.jsp&quot;</span>).forward(req, resp);</span><br></pre></td></tr></table></figure>

<ul>
<li><code>getPageBean(pageNo,pageSize)</code> dao层方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> PageBean <span class="title">getPageBean</span><span class="params">(<span class="keyword">int</span> pageNo, <span class="keyword">int</span> pageSize)</span></span>&#123;</span><br><span class="line">    <span class="comment">//pageBean实体类</span></span><br><span class="line">    PageBean pageBean=<span class="keyword">new</span> PageBean();</span><br><span class="line">    pageBean.setPageNo(pageNo);</span><br><span class="line">    pageBean.setPageSize(pageSize);</span><br><span class="line">    <span class="comment">//获取记录总数</span></span><br><span class="line">    <span class="keyword">long</span> totalItemCount=bookDao.getTotalItemCount();</span><br><span class="line">    pageBean.setTotalItemCount((<span class="keyword">int</span>) totalItemCount);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置页数</span></span><br><span class="line">    <span class="keyword">int</span> totalPageCount=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (totalItemCount&gt;<span class="number">0</span> &amp;&amp; pageSize&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        totalPageCount=(<span class="keyword">int</span>)Math.ceil(totalItemCount*<span class="number">1.0</span>/pageSize);</span><br><span class="line">        pageBean.setTotalPageCount(totalPageCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置每页记录的集合</span></span><br><span class="line">    List&lt;Book&gt; data=bookDao.showAllBook();</span><br><span class="line">    <span class="keyword">if</span> (pageNo&lt;totalPageCount)&#123;</span><br><span class="line">        pageBean.setData(data.subList((pageNo-<span class="number">1</span>)*pageSize,pageNo*pageSize));</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (pageNo==totalPageCount)&#123;</span><br><span class="line">        <span class="comment">//最后一页</span></span><br><span class="line">        pageBean.setData(data.subList((pageNo-<span class="number">1</span>)*pageSize,data.size()));</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException(<span class="string">&quot;超出页数范围&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> pageBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="多条件查询-分页"><a href="#多条件查询-分页" class="headerlink" title="多条件查询+分页"></a>多条件查询+分页</h5><ul>
<li>前端得到多条件查询条件，查找符合条件的pageBean<ul>
<li>在分页条件要加上 <strong>查询条件</strong></li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">&quot;pageSearch&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    搜索图书:<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入图书关键字&quot;</span>/&gt;</span></span>&lt;br&gt;</span><br><span class="line">    搜索类别:<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;category&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入图书类别&quot;</span>/&gt;</span></span>&lt;br&gt;</span><br><span class="line">    作者:<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;author&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入图书作者&quot;</span>/&gt;</span></span>&lt;br&gt;</span><br><span class="line">    价格区间:<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;minPrice&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;最低价&quot;</span>/&gt;</span></span></span><br><span class="line">    到&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;maxPrice&quot;</span> placeholder=<span class="string">&quot;最高价&quot;</span>/&gt;&lt;br&gt;</span><br><span class="line">    销量大于:<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sales&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;销量&quot;</span>/&gt;</span></span>&lt;br&gt;</span><br><span class="line"></span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;搜索&quot;</span>/&gt;&amp;nbsp&lt;input type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;全部&quot;</span> onclick=<span class="string">&quot;location.href=&#x27;bookStoreShow1&#x27;&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;not empty pageBean&#125;&quot;</span>&gt;</span><br><span class="line">    &lt;table&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;th&gt;序号&lt;ath&gt;</span><br><span class="line">            &lt;th&gt;姓名&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;价格&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;目录&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;库存&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;图片&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;类型&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;作者&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;sales&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;删除&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;修改&lt;/th&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;c:forEach items=<span class="string">&quot;$&#123;pageBean.data&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;li&quot;</span> varStatus=<span class="string">&quot;vs&quot;</span>&gt;</span><br><span class="line">            &lt;tr $&#123;vs.count%<span class="number">2</span>==<span class="number">1</span>? <span class="string">&quot;style=&#x27;background-color:yellow&#x27;&quot;</span>:<span class="string">&quot;&quot;</span>&#125;&gt;</span><br><span class="line">                &lt;td&gt;$&#123;li.id&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;detail&quot;</span>&gt;<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;detail?id=$&#123;li.id&#125;&quot;</span>&gt;</span>$&#123;li.name&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span>&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;li.price&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;li.category&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;li.pnum&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;<span class="xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;images/$&#123;li.imgurl&#125;&quot;</span>/&gt;</span></span>&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;li.description&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;li.author&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;li.sales&#125;&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">        &lt;/c:forEach&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">&lt;/c:<span class="keyword">if</span>&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;page&quot;</span>&gt;</span><br><span class="line">    &lt;a href=<span class="string">&quot;pageSearch?pageNo=$&#123;pageBean.pageNo==1?1:pageBean.pageNo-1&#125; &amp;name=$&#123;name&#125; &amp;category=$&#123;category&#125;&amp;author=$&#123;author&#125;&amp;minPrice=$&#123;minPrice&#125;&amp;maxPrice=$&#123;maxPrice&#125;&amp;sales=$&#123;sales&#125;&quot;</span> &gt;&amp;lt;&amp;lt;上一页&lt;/a&gt;&amp;nbsp;&amp;nbsp;</span><br><span class="line">    第$&#123;pageBean.pageNo&#125;页/共$&#123;pageBean.totalPageCount&#125;页&amp;nbsp;&amp;nbsp;总$&#123;pageBean.totalItemCount&#125;条记录&amp;nbsp;&amp;nbsp;</span><br><span class="line">    &lt;a href=<span class="string">&quot;pageSearch?pageNo=$&#123;pageBean.pageNo==pageBean.totalPageCount?pageBean.totalPageCount:pageBean.pageNo+1&#125;&amp;name=$&#123;name&#125;&amp;category=$&#123;category&#125;&amp;author=$&#123;author&#125;&amp;minPrice=$&#123;minPrice&#125;&amp;maxPrice=$&#123;maxPrice&#125;&amp;sales=$&#123;sales&#125;&quot;</span>&gt;下一页&amp;gt;&amp;gt;&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>SearchPageServlet</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">req.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"><span class="comment">//1、第一次进入jsp查询并无pageNo属性，需要初始化</span></span><br><span class="line"><span class="comment">//2、分页时，通过获得pageNo属性，得到pageBean对象,显示数据</span></span><br><span class="line"><span class="keyword">int</span> pageNo=<span class="number">1</span>;</span><br><span class="line">String pageIndex=req.getParameter(<span class="string">&quot;pageNo&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (pageIndex!=<span class="keyword">null</span>)&#123;</span><br><span class="line">    pageNo=Integer.parseInt(pageIndex);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> pageSize=<span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">String name=req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">String category=req.getParameter(<span class="string">&quot;category&quot;</span>);</span><br><span class="line">String author=req.getParameter(<span class="string">&quot;author&quot;</span>);</span><br><span class="line">String minPrice=req.getParameter(<span class="string">&quot;minPrice&quot;</span>);</span><br><span class="line">String maxPrice=req.getParameter(<span class="string">&quot;maxPrice&quot;</span>);</span><br><span class="line">String sales=req.getParameter(<span class="string">&quot;sales&quot;</span>);</span><br><span class="line">PageService pageService=<span class="keyword">new</span> PageService();</span><br><span class="line">PageBean pageBean=pageService.getPageBean(pageNo,pageSize,name,category,author,minPrice,maxPrice,sales);</span><br><span class="line">System.out.println(pageBean);</span><br><span class="line"></span><br><span class="line"><span class="comment">//传递给jsp进行显示数据</span></span><br><span class="line">req.setAttribute(<span class="string">&quot;pageBean&quot;</span>,pageBean);</span><br><span class="line"></span><br><span class="line">req.setAttribute(<span class="string">&quot;name&quot;</span>,name);</span><br><span class="line">req.setAttribute(<span class="string">&quot;category&quot;</span>,category);</span><br><span class="line">req.setAttribute(<span class="string">&quot;author&quot;</span>,author);</span><br><span class="line">req.setAttribute(<span class="string">&quot;minPrice&quot;</span>,minPrice);</span><br><span class="line">req.setAttribute(<span class="string">&quot;maxPrice&quot;</span>,maxPrice);</span><br><span class="line">req.setAttribute(<span class="string">&quot;sales&quot;</span>,sales);</span><br><span class="line"></span><br><span class="line">req.getRequestDispatcher(<span class="string">&quot;pageSearch.jsp&quot;</span>).forward(req, resp);</span><br></pre></td></tr></table></figure>

<ul>
<li>多条件查询</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> PageBean <span class="title">getPageBean</span><span class="params">(<span class="keyword">int</span> pageNo, <span class="keyword">int</span> pageSize,String name,String category,String author,</span></span></span><br><span class="line"><span class="function"><span class="params">                            String minPrice,String maxPrice,String sales)</span></span>&#123;</span><br><span class="line">    <span class="comment">//pageBean实体类</span></span><br><span class="line">    PageBean pageBean=<span class="keyword">new</span> PageBean();</span><br><span class="line">    pageBean.setPageNo(pageNo);</span><br><span class="line">    pageBean.setPageSize(pageSize);</span><br><span class="line">    BookDao bookDao=<span class="keyword">new</span> BookDao();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取记录总数</span></span><br><span class="line">    <span class="keyword">long</span> totalItemCount=bookDao.getTotalItemCount(name,category,author,minPrice,maxPrice,sales);</span><br><span class="line">    pageBean.setTotalItemCount(totalItemCount);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置页数</span></span><br><span class="line">    <span class="keyword">int</span> totalPageCount=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (totalItemCount&gt;<span class="number">0</span> &amp;&amp; pageSize&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        totalPageCount=(<span class="keyword">int</span>)Math.ceil(totalItemCount*<span class="number">1.0</span>/pageSize);</span><br><span class="line">        pageBean.setTotalPageCount(totalPageCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    List&lt;Book&gt; data=bookDao.searchBooks(name, category, author, minPrice, maxPrice, sales);</span><br><span class="line">    <span class="comment">//设置每页记录的集合</span></span><br><span class="line">    <span class="keyword">if</span> (pageNo&lt;totalPageCount)&#123;</span><br><span class="line">        pageBean.setData(data.subList((pageNo-<span class="number">1</span>)*pageSize,pageNo*pageSize));</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (pageNo==totalPageCount)&#123;</span><br><span class="line">        <span class="comment">//最后一页</span></span><br><span class="line">        pageBean.setData(data.subList((pageNo-<span class="number">1</span>)*pageSize,data.size()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pageBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4、过滤器登录验证"><a href="#4、过滤器登录验证" class="headerlink" title="4、过滤器登录验证"></a>4、过滤器登录验证</h4><p>见过滤器</p>
<h4 id="5、多条件查询"><a href="#5、多条件查询" class="headerlink" title="5、多条件查询"></a>5、多条件查询</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    req.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    String name=req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">    String category=req.getParameter(<span class="string">&quot;category&quot;</span>);</span><br><span class="line">    String author=req.getParameter(<span class="string">&quot;author&quot;</span>);</span><br><span class="line">    String minPrice=req.getParameter(<span class="string">&quot;minPrice&quot;</span>);</span><br><span class="line">    String maxPrice=req.getParameter(<span class="string">&quot;maxPrice&quot;</span>);</span><br><span class="line">    String sales=req.getParameter(<span class="string">&quot;sales&quot;</span>);</span><br><span class="line"></span><br><span class="line">    BookService bookService=<span class="keyword">new</span> BookService();</span><br><span class="line">    List&lt;Book&gt; list=bookService.searchBooks(name,category,author,minPrice,maxPrice,sales);</span><br><span class="line"></span><br><span class="line">    req.setAttribute(<span class="string">&quot;list&quot;</span>,list);</span><br><span class="line">    req.getRequestDispatcher(<span class="string">&quot;showbook.jsp&quot;</span>).forward(req, resp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">&quot;search&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    书名:<span class="xml"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;searchName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span>&lt;input type=&quot;text&quot; name=&quot;name&quot; id=&quot;searchName&quot; autocomplete=&quot;off&quot; placeholder=&quot;请输入图书关键字&quot;&gt;&lt;br&gt;</span><br><span class="line">    &lt;div id=&quot;context1&quot; style=&quot;display: none;width: 175px;background-color: #b3a4a4;position: absolute; left: 55px;z-index: 100;border: 1px #ac3a3a solid&quot;&gt;&lt;/div&gt;</span><br><span class="line">    搜索图书:&lt;label&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; name=&quot;name&quot; placeholder=&quot;请输入图书关键字&quot;/&gt;</span><br><span class="line">&lt;/label&gt;&lt;br&gt;</span><br><span class="line">    搜索类别:&lt;label&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; name=&quot;category&quot; placeholder=&quot;请输入图书类别&quot;/&gt;</span><br><span class="line">&lt;/label&gt;&lt;br&gt;</span><br><span class="line">    作者:&lt;label&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; name=&quot;author&quot; placeholder=&quot;请输入图书作者&quot;/&gt;</span><br><span class="line">&lt;/label&gt;&lt;br&gt;</span><br><span class="line">    价格区间:&lt;label&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; name=&quot;minPrice&quot; placeholder=&quot;最低价&quot;/&gt;</span><br><span class="line">&lt;/label&gt;</span><br><span class="line">    到&lt;label&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; name=&quot;maxPrice&quot; placeholder=&quot;最高价&quot;/&gt;</span><br><span class="line">&lt;/label&gt;&lt;br&gt;</span><br><span class="line">    销量大于:&lt;label&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; name=&quot;sales&quot; placeholder=&quot;销量&quot;/&gt;</span><br><span class="line">&lt;/label&gt;&lt;br&gt;</span><br><span class="line"></span><br><span class="line">    &lt;input type=&quot;submit&quot; value=&quot;搜索&quot;/&gt;&amp;nbsp;&amp;nbsp;&lt;input type=&quot;button&quot;</span><br><span class="line">    value=&quot;全部&quot; onclick=&quot;location.href=&#x27;bookStoreShow1&#x27;&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<h4 id="6、ajax异步删除"><a href="#6、ajax异步删除" class="headerlink" title="6、ajax异步删除"></a>6、ajax异步删除</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> id=Integer.parseInt(req.getParameter(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">    BookService bookService=<span class="keyword">new</span> BookService();</span><br><span class="line">    <span class="keyword">int</span> count=bookService.deleteBook(id);</span><br><span class="line">    resp.getWriter().print(count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//实现异步删除</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">delBook</span>(<span class="params">dom,id</span>) </span>&#123;</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">       url:<span class="string">&quot;delBook2&quot;</span>,</span><br><span class="line">       type:<span class="string">&quot;get&quot;</span>,</span><br><span class="line">       data:<span class="string">&#x27;id=&#x27;</span>+id,</span><br><span class="line">       success:<span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (result&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                $(dom).parent().parent().remove();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                alert(<span class="string">&quot;删除失败&quot;</span>);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;,</span><br><span class="line">        error:<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            alert(<span class="string">&quot;执行失败&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//异步批量删除</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">delChecks</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(<span class="string">&quot;.checks&quot;</span>).each(<span class="function"><span class="keyword">function</span> (<span class="params">i,e</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ($(e).is(<span class="string">&quot;:checked&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">const</span> id = $(e).val();</span><br><span class="line">            delBook(e,id);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="7、上传和下载"><a href="#7、上传和下载" class="headerlink" title="7、上传和下载"></a>7、上传和下载</h4><h4 id="8、搜索框自动补全"><a href="#8、搜索框自动补全" class="headerlink" title="8、搜索框自动补全"></a>8、搜索框自动补全</h4><ul>
<li><strong>ajax异步通信</strong></li>
<li>得到Json字符串（即符合条件的Book集合）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    req.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    resp.setContentType(<span class="string">&quot;text/html; charset=UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">    String name = req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">    List&lt;Book&gt; bookList = <span class="keyword">new</span> BookService().findBookByName(name);</span><br><span class="line"></span><br><span class="line">    Gson gson=<span class="keyword">new</span> Gson();</span><br><span class="line">    <span class="comment">//创建Json字符串</span></span><br><span class="line">    String json = gson.toJson(bookList);</span><br><span class="line">    System.out.println(json);</span><br><span class="line">    resp.getWriter().write(json);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>前端接收Json字符串</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    <span class="comment">//将点击的内容放到搜素框</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">setSearch_onclick</span>(<span class="params">div</span>) </span>&#123;</span><br><span class="line">        $(<span class="string">&quot;#searchName&quot;</span>).val(div.innerText);</span><br><span class="line">        $(<span class="string">&quot;#context1&quot;</span>).css(<span class="string">&quot;display&quot;</span>,<span class="string">&quot;none&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $(<span class="string">&quot;#searchName&quot;</span>).keyup(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> content = $(<span class="built_in">this</span>).val();</span><br><span class="line">        <span class="keyword">if</span> (content === <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">            $(<span class="string">&quot;#context1&quot;</span>).css(<span class="string">&quot;display&quot;</span>, <span class="string">&quot;none&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//由于浏览器的缓存机制所以我们每次传入一个时间</span></span><br><span class="line">        <span class="keyword">var</span> time = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            type: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">            <span class="comment">//新建一个名为SearchNameAjaxServlet的servlet,URL如下</span></span><br><span class="line">            url: <span class="string">&quot;searchNameAjax&quot;</span>,</span><br><span class="line">            data: &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: content,</span><br><span class="line">                <span class="string">&quot;time&quot;</span>: time</span><br><span class="line">            &#125;,<span class="comment">//&quot;info=&quot;+content+&quot;&amp;time=&quot;+time</span></span><br><span class="line">            dataType: <span class="string">&#x27;json&#x27;</span>,</span><br><span class="line">            success: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">                <span class="comment">//拼接html</span></span><br><span class="line">                <span class="comment">//var res = data.split(&quot;,&quot;);</span></span><br><span class="line">                <span class="keyword">var</span> html = <span class="string">&quot;&quot;</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; data.length; i++) &#123;</span><br><span class="line">                    <span class="comment">//每一个div还有鼠标移出、移入点击事件</span></span><br><span class="line">                    html += <span class="string">&quot;&lt;div onmousedown=&#x27;setSearch_onclick(this)&#x27; onmouseout=&#x27;changeBackColor_out(this)&#x27; onmouseover=&#x27;changeBackColor_over(this)&#x27;&gt;&quot;</span></span><br><span class="line">                        + data[i].name + <span class="string">&quot;&lt;/div&gt;&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                $(<span class="string">&quot;#context1&quot;</span>).html(html);</span><br><span class="line">                <span class="comment">//显示为块级元素</span></span><br><span class="line">                $(<span class="string">&quot;#context1&quot;</span>).css(<span class="string">&quot;display&quot;</span>, <span class="string">&quot;block&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//鼠标移到到内容上</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">changeBackColor_over</span>(<span class="params">div</span>) </span>&#123;</span><br><span class="line">        $(div).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;#CCCCCC&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//鼠标离开内容</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">changeBackColor_out</span>(<span class="params">div</span>) </span>&#123;</span><br><span class="line">        $(div).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $(<span class="string">&quot;#searchName&quot;</span>).blur(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        $(<span class="string">&quot;#context1&quot;</span>).css(<span class="string">&quot;display&quot;</span>,<span class="string">&quot;none&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dmyang-only.github.io/2020/11/11/12%E5%B9%B6%E5%8F%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dmYang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DmYoung">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/11/12%E5%B9%B6%E5%8F%91/" class="post-title-link" itemprop="url">并发</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-11 12:33:33" itemprop="dateCreated datePublished" datetime="2020-11-11T12:33:33+08:00">2020-11-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-12-17 13:12:55" itemprop="dateModified" datetime="2020-12-17T13:12:55+08:00">2020-12-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">java基础</span></a>
                </span>
            </span>

          
            <span id="/2020/11/11/12%E5%B9%B6%E5%8F%91/" class="post-meta-item leancloud_visitors" data-flag-title="并发" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>67k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1:01</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="并发"><a href="#并发" class="headerlink" title="并发"></a>并发</h2><blockquote>
<p>多线程能够提高内存的使用率，提高程序的响应程度</p>
<p>JVM是多线程（main(主线程)，GC线程，异常处理线程）</p>
</blockquote>
<p>IO操作不占用CPU,只是我们一般拷贝文件使用的是<code>阻塞IO</code>，但会一直等待IO结束，没能充分利用线程</p>
<ul>
<li>有<code>非阻塞IO</code>和<code>异步IO</code>优化</li>
</ul>
<h3 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h3><h4 id="1、进程与线程"><a href="#1、进程与线程" class="headerlink" title="1、进程与线程"></a>1、进程与线程</h4><p><img src="https://camo.githubusercontent.com/a66819fd82c6adfa69b368edf3c52b1fa9cdc89d/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d332f4a564de8bf90e8a18ce697b6e695b0e68daee58cbae59f9f2e706e67" alt="java运行时内存区域"></p>
<blockquote>
<p>进程process：操作系统分配和调度的基本单位，进程是线程的容器，是程序的实体，拥有独立的内存空间</p>
<p>线程thread：操作系统进行运算调度的最小单位，与其他线程共享内存空间</p>
<p>多个线程共享进程的<strong>堆</strong>和<strong>方法区</strong>资源（<strong>JDK1.8之后使用元空间</strong>），但是每个线程有自己的<strong>程序计数器，虚拟机栈和本地方法栈</strong></p>
<ul>
<li><p>堆是进程中最大的一块内存，主要用于存放新创建的对象 (所有对象都在这里分配内存)</p>
</li>
<li><p>方法区主要用于存放已被加载的类信息、常量、静态变量、即时编译器编译后的代码等数据。 </p>
</li>
</ul>
<p>线程和进程最大的不同在于基本上各个进程都是独立的，而线程则不一定。同一进程中的不同线程极有可能相互影响。线程执行开销小，但不利于资源的管理和保护；进程则相反。</p>
</blockquote>
<h5 id="1-1-进程通信"><a href="#1-1-进程通信" class="headerlink" title="1.1 进程通信"></a>1.1 进程通信</h5><ul>
<li>同一台计算机进程通信称为IPC</li>
<li>不同计算机之间的进程通过网络，遵守共同的协议HTTP</li>
</ul>
<h5 id="1-2-线程通信"><a href="#1-2-线程通信" class="headerlink" title="1.2 线程通信"></a>1.2 线程通信</h5><ul>
<li>由于线程之间共享内存，多个线程可以访问同一个共享变量</li>
<li>线程更轻量，线程的上下文切换成本一般比进程低</li>
</ul>
<h4 id="2、并行与并发"><a href="#2、并行与并发" class="headerlink" title="2、并行与并发"></a>2、并行与并发</h4><blockquote>
<p>并行：多个CPU同时执行不同的任务 parallel</p>
<p>并发：由CPU的任务调度器完成，轮流运行 concurrent</p>
</blockquote>
<blockquote>
<p>异步：更像一个消息传递，一旦开始，<strong>方法调用就会立即返回</strong>，调用者可以继续后续的操作</p>
<p>同步：形容一次方法调用。同步方法调用一旦开始，调用者必须<strong>等到方法调用返回后</strong>，才能继续后续的行为</p>
</blockquote>
<blockquote>
<p>高并发：响应时间，吞吐量，并发用户数</p>
</blockquote>
<h4 id="3、线程调度模型"><a href="#3、线程调度模型" class="headerlink" title="3、线程调度模型"></a>3、线程调度模型</h4><ul>
<li><p>分时调度模型：所有线程<strong>轮流使用</strong>CPU，平均分配每个线程占用CPU的时间片</p>
</li>
<li><p>抢占式调度模型：优先级高的线程使用CPU，优先级相同，则随机选择一个(JVM)</p>
</li>
</ul>
<h4 id="4、线程三个特性"><a href="#4、线程三个特性" class="headerlink" title="4、线程三个特性"></a>4、线程三个特性</h4><h5 id="4-1-原子性"><a href="#4-1-原子性" class="headerlink" title="4.1 原子性"></a>4.1 原子性</h5><blockquote>
<p>原子操作：只有简单的读取、赋值（而且必须是将数字赋值给某个变量，变量之间的相互赋值不是原子操作）才是原子操作</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">10</span>;  <span class="comment">//语句1直接将数值10赋值给a，也就是说线程执行这个语句的会直接将数值10写入到工作内存中。</span></span><br></pre></td></tr></table></figure>

<p><strong>一个操作是不可中断，要么全部执行成功要么全部执行失败</strong></p>
<p>​    即多个线程一起执行的时候，一个操作一旦开始，就不会被其他线程所干扰。</p>
<h5 id="4-2-有序性"><a href="#4-2-有序性" class="headerlink" title="4.2 有序性"></a>4.2 有序性</h5><blockquote>
<p>有序性：是指程序执行的顺序按照代码的先后顺序执行。</p>
</blockquote>
<p><strong>Java内存模型具备一些先天的“有序性”，即不需要通过任何手段就能够得到保证的有序性，这个通常也称为 happens-before 原则。如果两个操作的执行次序无法从happens-before原则推导出来，那么它们就不能保证它们的有序性，虚拟机可以随意地对它们进行重排序</strong></p>
<h5 id="4-3-可见性"><a href="#4-3-可见性" class="headerlink" title="4.3 可见性"></a>4.3 可见性</h5><blockquote>
<p>可见性：当一个线程修改了共享变量后，其他线程能够立即得知这个修改。</p>
</blockquote>
<h3 id="二、Java多线程"><a href="#二、Java多线程" class="headerlink" title="二、Java多线程"></a>二、Java多线程</h3><blockquote>
<p>主线程：在main方法中</p>
<p>子线程：main方法中启动的其他线程（与主线程平等相同）</p>
<p>主线程放在子线程后，否则会优先执行主线程，线程多次在运行、阻塞之间切换</p>
</blockquote>
<h4 id="1、启动创建线程"><a href="#1、启动创建线程" class="headerlink" title="1、启动创建线程"></a>1、启动创建线程</h4><blockquote>
<p>调用start方法方可启动线程，而run方法只是thread的一个普通方法调用，还是在主线程里执行</p>
</blockquote>
<h5 id="1-1-继承Thread"><a href="#1-1-继承Thread" class="headerlink" title="1.1 继承Thread"></a>1.1 继承Thread</h5><p><strong>创建该类的实例，即创建了线程对象</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Music</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">1000</span>;i++) System.out.println(i+<span class="string">&quot;听音乐&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Music m=<span class="keyword">new</span> Music();</span><br><span class="line">m.start();</span><br></pre></td></tr></table></figure>

<h5 id="1-2-实现Runnable-接口"><a href="#1-2-实现Runnable-接口" class="headerlink" title="1.2 实现Runnable 接口"></a>1.2 实现Runnable 接口</h5><blockquote>
<p><strong>作为任务对象</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Thread(Runnable target，name)</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Music1</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">1000</span>;i++) System.out.println(i+<span class="string">&quot;听音乐&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Music1 m1=<span class="keyword">new</span> Music1();</span><br><span class="line">Thread t_music=<span class="keyword">new</span> Thread(m1,<span class="string">&quot;name&quot;</span>);</span><br><span class="line">t_music.start();</span><br></pre></td></tr></table></figure>

<h5 id="1-3-Callable接口"><a href="#1-3-Callable接口" class="headerlink" title="1.3 Callable接口"></a>1.3 Callable接口</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Callable</span>&lt;<span class="title">V</span>&gt;</span></span><br><span class="line"><span class="class">     <span class="title">V</span> <span class="title">call</span>()</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Callable函数式泛型接口，带有返回值</strong></p>
<ul>
<li><p><code>RunnableFuture&lt;V&gt;</code> 接口继承了<code>Runnable</code>接口和 <code>Future&lt;V&gt;</code>接口，</p>
</li>
<li><p>将<code>FutureTask&lt;V&gt;</code> 的一个实例当做是一个Runnable接口的实例</p>
</li>
<li><p><code>FutureTask</code>能够接收<code>Callable</code>类型的参数，<strong>用来处理结果有返回值的情况</strong></p>
</li>
<li><p>传入Thread来启动我们新建的线程</p>
</li>
</ul>
</blockquote>
<img src="https://csn.damyoung.cn/20180730145740512" alt="img" style="zoom: 80%;" />

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">FutureTask&lt;Integer&gt; future=<span class="keyword">new</span> FutureTask&lt;Integer&gt;(<span class="keyword">new</span> Callable() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Thread(future,<span class="string">&quot;这是FutureTask线程&quot;</span>).start();</span><br><span class="line">Integer integer = future.get();</span><br><span class="line">System.out.println(integer);</span><br></pre></td></tr></table></figure>

<h5 id="1-4-匿名创建"><a href="#1-4-匿名创建" class="headerlink" title="1.4 匿名创建"></a>1.4 匿名创建</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Thread()&#123; </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">1000</span>;i++) System.out.println(i+<span class="string">&quot;听音乐&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;.start();</span><br></pre></td></tr></table></figure>

<p>或者，匿名实现runnable接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Thread t2=<span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable()&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Thread.currentThread().setName(<span class="string">&quot;听歌线程&quot;</span>);</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;-----&gt;听歌&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">t2.start();</span><br></pre></td></tr></table></figure>

<p>Lambda简化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Thread t2=<span class="keyword">new</span> Thread(  ()-&gt;&#123;</span><br><span class="line"> 	System.out.println(Thread.currentThread().getName()+<span class="string">&quot;-----&gt;听歌&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="实现接口-VS-继承-Thread"><a href="#实现接口-VS-继承-Thread" class="headerlink" title="实现接口 VS 继承 Thread"></a>实现接口 VS 继承 Thread</h5><p>实现接口会更好一些，因为：</p>
<ul>
<li>Java 不支持多重继承，因此继承了 Thread 类就无法继承其它类，但是可以实现多个接口；</li>
<li>类可能只要求可执行就行，继承整个 Thread 类开销过大。</li>
</ul>
<blockquote>
<p>工具类<code>Executors</code>可以实现<code>Runnable</code>对象和<code>Callable</code>对象之间的相互转换。（<code>Executors.callable（Runnable task）</code>或<code>Executors.callable（Runnable task，Object result）</code>）。</p>
</blockquote>
<h4 id="2、-线程运行原理"><a href="#2、-线程运行原理" class="headerlink" title="2、*线程运行原理"></a>2、*线程运行原理</h4><h5 id="2-1-栈与栈帧"><a href="#2-1-栈与栈帧" class="headerlink" title="2.1 栈与栈帧"></a>2.1 栈与栈帧</h5><blockquote>
<p>JVM中有栈、堆、方法区组成</p>
<p>线程使用栈内存，每个线程启动后，虚拟机为其分配一块栈内存(后进先出)</p>
</blockquote>
<ul>
<li>每一个栈由多个栈帧组成，对应每次方法调用时所占用的内存</li>
<li>每个线程只能有一个活动栈帧，对应正在执行的那个方法</li>
</ul>
<img src="https://csn.damyoung.cn/image-20201001214757147.png" alt="image-20201001214757147" style="zoom: 67%;" />

<h5 id="2-2-线程上下文切换"><a href="#2-2-线程上下文切换" class="headerlink" title="2.2 线程上下文切换"></a>2.2 线程上下文切换</h5><blockquote>
<p>由于一些原因CPU不再执行当前的线程，转而执行另一个线程的代码</p>
</blockquote>
<ul>
<li>线程的CPU时间片用完</li>
<li>垃圾回收</li>
<li>有更高优先级的线程需要运行</li>
<li>主动： 线程自己调用sleep/yield/wait/join/park/synchronized/lock等方法</li>
</ul>
<blockquote>
<p>当Context Switch发生时，需要由<strong>操作系统保存当前线程的状态，并恢复另一个线程的状态</strong></p>
<p>程序计数器，作用是记住下一条jvm指令的执行地址，是线程私有的</p>
</blockquote>
<ul>
<li>状态包括程序计数器、虚拟机栈每个栈帧的信息，如局部变量、操作数栈、返回地址等</li>
<li>频繁的上下文切换会影响性能</li>
</ul>
<h4 id="3、生命周期"><a href="#3、生命周期" class="headerlink" title="3、生命周期"></a>3、生命周期</h4><h5 id="3-1-操作系统层面"><a href="#3-1-操作系统层面" class="headerlink" title="3.1 操作系统层面"></a>3.1 操作系统层面</h5><blockquote>
<p>在操作系统层面上</p>
</blockquote>
<ul>
<li><p>新建new：<code>还未与操作系统线程关联</code></p>
</li>
<li><p>就绪Runnable: start（）<code>关联</code></p>
</li>
<li><p>运行running：由任务调度器分配CPU资源，获取CPU资源，执行run()  —&gt;阻塞、死亡、就绪</p>
</li>
<li><p>阻塞block：失去所占用的资源</p>
<ul>
<li>等待阻塞：wait() </li>
<li>同步阻塞：获取synchronized同步锁失败 </li>
<li>其他阻塞： sleep() 发出I/O请求</li>
</ul>
</li>
<li><p>死亡 dead: 终止</p>
</li>
</ul>
<h5 id="3-2-JavaApi层面"><a href="#3-2-JavaApi层面" class="headerlink" title="3.2** JavaApi层面"></a>3.2** JavaApi层面</h5><blockquote>
<p>Java层面六个状态</p>
</blockquote>
<img src="https://csn.damyoung.cn/image-20201003112044132.png" alt="image-20201003112044132" style="zoom:80%;" />

<ul>
<li><p>new-新建线程对象，还未于操作系统相关联</p>
</li>
<li><p>2-Runnable–&gt;Waiting</p>
<ul>
<li>obj.wait()</li>
<li>obj.notify()/obj.notifyAll()/thread.interrupt()<ul>
<li>竞争锁失败，waiting–&gt;blocked</li>
<li>竞争锁成功，waiting–&gt;runnable</li>
</ul>
</li>
</ul>
</li>
<li><p>3-Runnable–&gt;waiting</p>
<ul>
<li>调用join方法，<strong>当前线程</strong>进入waiting状态</li>
<li>或调用当前线程interrupt(),<strong>当前线程</strong>进入waiting状态</li>
</ul>
</li>
<li><p>4-Runnable–&gt;waiting</p>
<ul>
<li>LockSupport.park</li>
<li>LockSupport.unpark(目标线程)，waiting–&gt;Runnable</li>
</ul>
</li>
<li><p>5-Runnable–&gt;TimeWaiting</p>
<ul>
<li>wait()</li>
<li>等待超时/notify/notifyAll/interrupt<ul>
<li>竞争锁失败，TimeWaiting–&gt;blocked</li>
<li>竞争锁成功 ,  TimeWaiting–&gt;runnable</li>
</ul>
</li>
</ul>
</li>
<li><p>6-Runnable–&gt;TimeWaiting</p>
<ul>
<li>join(long n)</li>
</ul>
</li>
<li><p>7-Runnable–&gt;TimeWaiting</p>
<ul>
<li>sleep(long n)</li>
</ul>
</li>
<li><p>8-Runnable–&gt;TimeWaiting</p>
<ul>
<li>LockSupport.parkNanos(long nanos)、LockSupport.parkUtil(long mills)</li>
</ul>
</li>
<li><p>9-Runnable–&gt;Blocked</p>
<ul>
<li>获得对象锁时竞争失败</li>
<li>Blocked中EntrySet中的线程竞争成功</li>
</ul>
</li>
<li><p>10-Runnable–&gt;Terminated</p>
<ul>
<li>所有代码运行完毕，进入terminated</li>
</ul>
</li>
</ul>
<h4 id="4、Thread方法"><a href="#4、Thread方法" class="headerlink" title="4、Thread方法"></a>4、Thread方法</h4><h5 id="3-1-start与run"><a href="#3-1-start与run" class="headerlink" title="3.1 start与run"></a>3.1 start与run</h5><blockquote>
<ul>
<li>start() 让线程进入就绪状态(runnable)，当CPU时间片分配到CPU资源才会进行运行(running)状态</li>
<li><code>start()</code>会执行线程的相应准备工作，然后自动去执行<code>run()</code>方法的内容，这时真正的多线程工作</li>
<li>直接执行<code>run()</code>方法，会把<code>run</code>方法当成一个<code>main()</code>线程下的普通方法执行，并不会在某个线程中执行它，所以这并不是多线程工作</li>
</ul>
</blockquote>
<blockquote>
<p><strong>直接调用run() 方法并没有启动新的线程，还是由main线程启动!!!!!!!</strong></p>
</blockquote>
<h5 id="3-2-sleep与yield"><a href="#3-2-sleep与yield" class="headerlink" title="3.2 sleep与yield"></a>3.2 sleep与yield</h5><blockquote>
<p><code>Thread.sleep(millisec)</code>方法会休眠当前正在执行的线程，<code>millisec</code>单位为毫秒。</p>
<p>该方法可能会有两个异常：</p>
<ul>
<li><code>IllegalArgumentException</code>:如果参数为负数</li>
<li><code>InterruptedException</code>:如果任何线程中断了当前线程，就会抛出此异常，此时线程的中断状态将被清除。</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>sleep() 放弃CPU时间片，running–&gt;Timed Waiting状态(阻塞状态)</li>
<li>睡眠结束后的线程未必会立刻得到执行，需要等待时间片分配CPU资源</li>
</ul>
<p><code>sleep(long milis)</code></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Thread.sleep(<span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li><p>yield() 让步，会让当前线程从Running进入Runnable就绪状态，然后<strong>调度其它同优先级的线程</strong></p>
</li>
<li><p>在下一次竞争中，若又获得CPU时间片则依旧继续运行</p>
</li>
<li><p>具体实现<strong>依赖于操作系统的任务调度器</strong></p>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Thread.yield()</span><br></pre></td></tr></table></figure>

<p><strong>应用</strong></p>
<blockquote>
<p>在没有利用cpu计算时，不要让while(true)空转浪费cpu，这时可以使用sleep/yield来转权给其他程序</p>
<p><strong>sleep适用于无需锁同步的场景</strong></p>
</blockquote>
<p><strong>与 sleep() 方法的区别</strong>：</p>
<ul>
<li><code>sleep()</code>方法给其他进程运行时不会考虑进程的优先级问题，因此会给低优先级的线程以运行的机会；<code>yield()</code>方法只会给相同优先级或者更高优先级的线程以运行的机会。</li>
<li><code>sleep()</code>方法声明会抛出<code>InterruptedException</code>异常，而<code>yield()</code>方法没有声明任何异常。</li>
<li><code>sleep()</code>方法比<code>yield()</code>方法（跟操作系统CPU调度相关）具有更好的可移植性。</li>
</ul>
<h5 id="3-3-线程优先级"><a href="#3-3-线程优先级" class="headerlink" title="3.3 线程优先级"></a>3.3 线程优先级</h5><blockquote>
<p>setPority(),仅仅只是一个提示，调度器可以忽略它</p>
<p>CPU比较忙，那么优先级高的线程会获得更多的时间片；cpu闲时，优先级几乎没有作用</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">t1.setPriority(t1.MIN_PRIORITY);<span class="comment">//1</span></span><br><span class="line">t1.setPriority(t1.NORM_PRIORITY);<span class="comment">//5</span></span><br><span class="line">t1.setPriority(t1.MAX_PRIORITY);<span class="comment">//10</span></span><br></pre></td></tr></table></figure>

<h5 id="3-4-name"><a href="#3-4-name" class="headerlink" title="3.4 name"></a>3.4 name</h5><blockquote>
<p>set Name() 、get Name()</p>
<p>构造方法    Thread(String name)  / Thread(Runnable target, String name)</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Thread t1=<span class="keyword">new</span> Thread(<span class="string">&quot;music&quot;</span>)</span><br><span class="line"></span><br><span class="line">t1.setName(<span class="string">&quot;music&quot;</span>);</span><br><span class="line"></span><br><span class="line">Thread.currentThread().setName()</span><br></pre></td></tr></table></figure>

<h5 id="3-5-stop-suspend-resume"><a href="#3-5-stop-suspend-resume" class="headerlink" title="3.5 stop/suspend/resume"></a>3.5 stop/suspend/resume</h5><blockquote>
<p>stop停止/suspend暂停/resume恢复是<code>@deprecated</code>过时方法，在操作同步代码块时,会造成死锁</p>
<p>代替的方法 interrupt/park/unpark</p>
</blockquote>
<h4 id="5、-interrupt"><a href="#5、-interrupt" class="headerlink" title="5、*interrupt"></a>5、*interrupt</h4><p><strong>不可打断模式</strong></p>
<blockquote>
<ul>
<li>interrupt并不是马上停止线程，而是给线程<strong>打一个停止标记</strong>，将线程的中断状态设置为true<ul>
<li>stop()方法也可以停止线程，<strong>线程锁住共享资源</strong>，被杀死后其他线程无法获得共享资源，<strong>其他线程永远无法获得资源</strong></li>
<li>stop停止/suspend暂停/resume恢复是<code>@deprecated</code>过时方法，在操作同步代码块时,会造成死锁</li>
</ul>
</li>
<li><strong>当中断sleep/yield时，会出现InterruptException异常</strong></li>
</ul>
</blockquote>
<p><strong>判断中断</strong></p>
<blockquote>
<ul>
<li>static boolean interrupted()：判断当前线程是否中断，清除中断标志。</li>
<li>boolean isInterrupted()：判断线程是否中断，不清除中断标志。</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Thread t1 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="comment">//判断线程是否中断，不清楚中断标志</span></span><br><span class="line">            <span class="keyword">boolean</span> interrupted = Thread.currentThread().isInterrupted();</span><br><span class="line">            <span class="comment">//清除中断标志</span></span><br><span class="line">            <span class="keyword">boolean</span> interrupted1 = Thread.interrupted();</span><br><span class="line">            <span class="keyword">if</span> (interrupted)&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">t1.start();</span><br><span class="line">Thread.sleep(<span class="number">50</span>);</span><br><span class="line"><span class="comment">//中断线程</span></span><br><span class="line">t1.interrupt();</span><br></pre></td></tr></table></figure>



<h4 id="6、守护线程"><a href="#6、守护线程" class="headerlink" title="6、守护线程"></a>6、守护线程</h4><blockquote>
<p><code>setDaemon(boolean on)</code></p>
<p>垃圾回收线程是典型的守护线程</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaemonThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;<span class="comment">//死循环</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;i am alive&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">500</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;finally block&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">DaemonThread daemonThread = <span class="keyword">new</span> DaemonThread();</span><br><span class="line">daemonThread.setDaemon(<span class="keyword">true</span>); <span class="comment">//建立守护线程，守护main方法</span></span><br><span class="line">daemonThread.start();</span><br><span class="line">Thread thread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br></pre></td></tr></table></figure>

<p>线程如果不设置为守护线程，是一个死循环，会一直执行，当我们把它设置为守护线程后，在主线程执行完成后，守护线程也会退出，但是需要注意的是<strong>守护线程在退出的时候并不会执行finnaly块中的代码，所以将释放资源等操作不要放在finnaly块中执行，这种操作是不安全的</strong>。</p>
<h4 id="7、wait-notify"><a href="#7、wait-notify" class="headerlink" title="7、wait/notify"></a>7、wait/notify</h4><blockquote>
<p><strong>必须获得锁状态下才能使用wait/notify</strong></p>
<p>​    wait(long timeout)：将线程放弃同步锁转换为阻塞状态，直到被其他进程进入该同步锁唤醒为止。</p>
<p>​        -带参wait,会在时限结束后直接进入BLOCKING状态</p>
<p>​    notify():<strong>随机唤醒</strong>一个此同步锁上等待的线程</p>
<p>​    notifyAll():唤醒此同步锁上所有等待中的线程。</p>
</blockquote>
<p><strong>存在的问题</strong></p>
<blockquote>
<p>notify会虚假唤醒问题</p>
<ul>
<li>用notifyAll解决</li>
<li>使用while循环解决</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> (<span class="keyword">this</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(flag==<span class="number">1</span>)&#123;</span><br><span class="line">        System.out.print(<span class="string">&quot;春&quot;</span>);</span><br><span class="line">        System.out.print(<span class="string">&quot;眠&quot;</span>);</span><br><span class="line">        System.out.print(<span class="string">&quot;不&quot;</span>);</span><br><span class="line">        System.out.print(<span class="string">&quot;觉&quot;</span>);</span><br><span class="line">        System.out.print(<span class="string">&quot;晓&quot;</span>);</span><br><span class="line">        System.out.print(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">        flag=<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">this</span>.notifyAll();</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.wait();</span><br><span class="line">    &#125;</span><br><span class="line"> <span class="keyword">synchronized</span>(<span class="keyword">this</span>)&#123;</span><br><span class="line">     <span class="keyword">if</span>(flag==<span class="number">2</span>)&#123;</span><br><span class="line">         System.out.print(<span class="string">&quot;砺&quot;</span>);</span><br><span class="line">         System.out.print(<span class="string">&quot;峰&quot;</span>);</span><br><span class="line">         System.out.print(<span class="string">&quot;科&quot;</span>);</span><br><span class="line">         System.out.print(<span class="string">&quot;技&quot;</span>);</span><br><span class="line">         System.out.print(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">         flag=<span class="number">1</span>;</span><br><span class="line">         <span class="keyword">this</span>.notifyAll();</span><br><span class="line">     &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">     	<span class="keyword">this</span>.wait();</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="7-1-wait和sleep区别和共同点"><a href="#7-1-wait和sleep区别和共同点" class="headerlink" title="7.1 wait和sleep区别和共同点"></a>7.1 wait和sleep区别和共同点</h5><ul>
<li><p>俩者都可用于暂停线程的执行</p>
</li>
<li><p>wait()是<strong>Object</strong>实例方法，sleep()是<strong>Thread</strong>的静态方法</p>
</li>
<li><p>wait()方法必须要在同步方法或者同步代码块中<strong>调用</strong>，也就是必须已经获得对象锁，sleep()方法没有这个限制</p>
<ul>
<li>wait()方法会<strong>释放</strong>占有的对象锁，使得该线程<strong>进入等待池waitSet中</strong>，等待下一次获取资源。</li>
<li>而sleep()方法只是会<strong>让出CPU并不会释放掉对象锁</strong></li>
</ul>
</li>
<li><p>sleep()方法在休眠时间达到后如果再次获得CPU时间片就会<strong>继续执行</strong>，而wait()方法必须等待</p>
<ul>
<li>Object.notift/Object.notifyAll通知后，才会离开等待池，并且再次获得CPU时间片才会继续执行</li>
</ul>
</li>
</ul>
<h5 id="7-2-原理"><a href="#7-2-原理" class="headerlink" title="7.2 原理"></a>7.2 原理</h5><blockquote>
<p>实现原理：见3.4monitor</p>
</blockquote>
<h4 id="8、join原理"><a href="#8、join原理" class="headerlink" title="8、join原理"></a>8、join原理</h4><blockquote>
<p><strong>一个线程等待另一个线程的结束</strong>==&gt;保护性暂停==&gt;<strong>线程同步等待问题</strong></p>
<p>插队：当前线程暂停，等待指定的线程执行结束后，当前线程再继续</p>
<p>在一个线程中调用另一个线程的<code>join()</code>方法，会将当前线程挂起，等待另一个线程执行完毕之后再继续往下执行</p>
<p><code>join(long millis)</code></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">t1.join(); <span class="comment">//无参</span></span><br><span class="line">t1.join(<span class="number">1000</span>);<span class="comment">//带参,只等待mills的时间</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    test();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException</span>&#123;</span><br><span class="line">    Thread thread = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        i = <span class="number">10</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    thread.start();</span><br><span class="line">    thread.join(); <span class="comment">//10，无join0</span></span><br><span class="line">    System.out.println(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="三、共享模型-锁"><a href="#三、共享模型-锁" class="headerlink" title="三、共享模型(锁)"></a>三、共享模型(锁)</h3><h4 id="1、前言"><a href="#1、前言" class="headerlink" title="1、前言"></a>1、前言</h4><h5 id="1-1-临界区"><a href="#1-1-临界区" class="headerlink" title="1.1 临界区"></a>1.1 临界区</h5><blockquote>
<p>一段代码存在对<strong>共享资源</strong>的<strong>多线程读写</strong>操作，称这段代码为临界区</p>
</blockquote>
<ul>
<li>多线程本身没有问题，也仅仅只是读操作也没用问题</li>
<li>但在多线程对共享资源进行读写操作时，出现<strong>指令交错</strong>时出现问题</li>
</ul>
<h5 id="1-2-竞态条件"><a href="#1-2-竞态条件" class="headerlink" title="1.2 竞态条件"></a>1.2 竞态条件</h5><p>Race Condiction</p>
<blockquote>
<p>在<strong>多线程</strong>下，<strong>没有依赖关系</strong>的代码，在执行<strong>共享变量读写</strong>操作(至少有一个线程写)时，并不能保证以编写顺序执行，这称为发生了竞态条件</p>
</blockquote>
<h5 id="1-3-线程同步"><a href="#1-3-线程同步" class="headerlink" title="1.3 线程同步"></a>1.3 线程同步</h5><blockquote>
<p><strong>线程同步</strong>：当有一个线程对内存进行操作时，其他线程不可以对内存进行，直至该线程结束</p>
</blockquote>
<h5 id="1-4-线程安全"><a href="#1-4-线程安全" class="headerlink" title="1.4 线程安全"></a>1.4 线程安全</h5><blockquote>
<p><strong>上下文切换</strong>造成<strong>指令交错</strong>引发线程安全问题</p>
</blockquote>
<h4 id="2、阻塞式Synchronized"><a href="#2、阻塞式Synchronized" class="headerlink" title="2、阻塞式Synchronized"></a>2、阻塞式Synchronized</h4><blockquote>
<p>避免临界区的竞态条件发生，即保证了线程同步/线程安全</p>
</blockquote>
<h5 id="2-1-Synchronized原理"><a href="#2-1-Synchronized原理" class="headerlink" title="2.1 Synchronized原理"></a><strong>2.1 Synchronized原理</strong></h5><blockquote>
<ul>
<li>Synchronized俗称对象锁，采用<strong>互斥</strong>的方式让同一个时刻至多<strong>只能有一个线程持有同一把对象锁</strong>，其他线程想再获取时会<strong>被阻塞</strong>。</li>
<li>持有锁的线程安全执行临界区的代码，保证了<strong>临界区代码的原子性</strong>，不用担心上下文切换。</li>
<li>Synchronized<strong>锁的是对象</strong>！！！，加在普通方法上锁的是this这个实例对象，加在静态方法上锁的是该类对象</li>
<li>如果有多个线程，<strong>需要对多个线程都加上同一把对象锁</strong>！！！！不然无互斥现象</li>
</ul>
</blockquote>
<blockquote>
<p><strong>保证有序性，但并不能禁止指令重排序</strong></p>
</blockquote>
<p><strong>语法</strong> </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span>(对象)&#123; <span class="comment">//线程1，线程2(blocked)</span></span><br><span class="line">	临界区</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Synchronized保证了多线程三个特性</strong></p>
<blockquote>
<p><strong>synchronized</strong>能够保证任一时刻只有一个线程执行该代码块(线程同步)，并且在释放锁之前会将对变量的修改刷新到主存当中，那么自然就<strong>不存在原子性和可见性</strong>问题了</p>
</blockquote>
<p><strong>关于Synchronized有序性</strong></p>
<blockquote>
<p>由于Synchronized<strong>保证临界区代码不会发生上下文切换</strong>，当变量完全被Synchronized保护，即使临界区代码发生了重排序也无无影响，故<strong>Synchronized能保证作用范围内有序性(但不能禁止重排序)。</strong></p>
</blockquote>
<h5 id="2-2-同步代码块"><a href="#2-2-同步代码块" class="headerlink" title="2.2 同步代码块"></a>2.2 同步代码块</h5><blockquote>
<p>this/.class/其他对象（d？ Demo d=new Demo()）；</p>
<p>但不能使用匿名内部类</p>
</blockquote>
<ul>
<li><p>初始标志位为1，线程访问时标志位设置<strong>为0</strong>，该线程获得访问代码块的权限；</p>
</li>
<li><p>其他线程访问时发现为0则阻塞；执行完毕时设置为1</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> (Printer.class)&#123;</span><br><span class="line">    System.out.print(<span class="string">&quot;春&quot;</span>);</span><br><span class="line">    System.out.print(<span class="string">&quot;眠&quot;</span>);</span><br><span class="line">    System.out.print(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="2-3-同步方法"><a href="#2-3-同步方法" class="headerlink" title="2.3 同步方法"></a>2.3 同步方法</h5><blockquote>
<p>非静态方法锁：this</p>
<p>静态方法锁：.class</p>
</blockquote>
<blockquote>
<p><strong>普通方法锁住的是实例对象</strong>，静态方法是属于类的，<strong>静态方法锁定的是这个类的所有对象</strong></p>
<p>即不管创建多少个实例，都需要等待锁释放</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> ticket=<span class="number">10</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (Ticker.class) &#123;</span><br><span class="line">            <span class="keyword">if</span> (ticket == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(getName() + <span class="string">&quot;--卖出第&quot;</span> + ticket-- + <span class="string">&quot;号票&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="3、线程安全"><a href="#3、线程安全" class="headerlink" title="3、线程安全"></a>3、线程安全</h4><blockquote>
<p><strong>上下文切换</strong>造成<strong>指令交错</strong>引发线程安全问题</p>
</blockquote>
<h5 id="3-1-成员变量和静态变量"><a href="#3-1-成员变量和静态变量" class="headerlink" title="3.1 成员变量和静态变量"></a>3.1 成员变量和静态变量</h5><ul>
<li>如果没有被共享，则线程安全</li>
<li>如果被共享<ul>
<li>只有读操作，则线程安全</li>
<li>有读写操作，则这段代码是临界区，需要考虑线程安全</li>
</ul>
</li>
</ul>
<h5 id="3-2-局部变量"><a href="#3-2-局部变量" class="headerlink" title="3.2 局部变量"></a>3.2 局部变量</h5><ul>
<li>局部变量是线程安全,没有被共享</li>
<li>局部变量引用的对象则未必<ul>
<li>如果该对象没有逃离方法的作用范围，是线程安全</li>
<li>如果该对象逃离<strong>方法的作用范围</strong>，需要考虑线程安全  （return）</li>
</ul>
</li>
</ul>
<h5 id="3-3-常见线程安全类-不可变类"><a href="#3-3-常见线程安全类-不可变类" class="headerlink" title="3.3 常见线程安全类(不可变类)"></a>3.3 常见线程安全类(不可变类)</h5><p>vector、HashTable、Random、String、Integer、StringBuffer</p>
<blockquote>
<p>多个线程调用它们同一个实例的某个方法时，是线程安全的</p>
</blockquote>
<ul>
<li>它们每个方法是原子的</li>
<li>多个方法的组成不是原子的</li>
</ul>
<blockquote>
<p><strong>不可变类线程安全性</strong>:（String、Integer…）因为其内部的状态不可以改变，因此它们的方法都是线程安全。</p>
</blockquote>
<ul>
<li>String类中replace内部是创建新的String实例，并没有对状态进行改变</li>
</ul>
<h4 id="4、-Monitor-锁"><a href="#4、-Monitor-锁" class="headerlink" title="4、*Monitor(锁)"></a>4、*Monitor(锁)</h4><blockquote>
<p>操作系统提供的Monitor锁</p>
</blockquote>
<h5 id="4-1-java对象头"><a href="#4-1-java对象头" class="headerlink" title="4.1 java对象头"></a>4.1 java对象头</h5><blockquote>
<p>Mark Word：hashcode(hash地址)、bisased_lock偏向锁状态、01表示锁状态</p>
<p>Klass Word：表示对象从属的类</p>
</blockquote>
<img src="https://csn.damyoung.cn/image-20201002235120076.png" alt="image-20201002235120076" style="zoom:80%;" />

<img src="https://csn.damyoung.cn/image-20201002235454295.png" alt="image-20201002235454295" style="zoom:80%;" />

<img src="https://csn.damyoung.cn/image-20201002234814861.png" alt="image-20201002234814861" style="zoom:80%;" />

<ul>
<li>biased_lock：1表示开启偏向锁</li>
</ul>
<h5 id="4-2-Monitor"><a href="#4-2-Monitor" class="headerlink" title="4.2 Monitor"></a>4.2 Monitor</h5><p><strong>Synchronized底层原理</strong></p>
<blockquote>
<p>监视器/管程(操作系统)</p>
<p>WaitSet(等待池)、Owner、EntryList(未获得过锁线程)</p>
</blockquote>
<h5 id="4-3-wait原理"><a href="#4-3-wait原理" class="headerlink" title="4.3 wait原理"></a>4.3 wait原理</h5><img src="https://csn.damyoung.cn/image-20201002175837645.png" alt="image-20201002175837645" style="zoom: 80%;" />

<ul>
<li>Owner线程发现条件不满足，调用wait()，即可进入WaitSet进入WAITING状态</li>
<li>BLOCKED(未获得过锁的线程)与WAITING(调用wait方法)线程<strong>都处于阻塞状态</strong>，<strong>不占用CPU时间片</strong><ul>
<li>BLOCKED线程在Owner线程释放锁时唤醒</li>
<li>Waiting线程在Owner线程调用notify/notifyAll时唤醒，但仍进入EntryList条件变量中重新竞争</li>
</ul>
</li>
</ul>
<h4 id="5、-锁优化"><a href="#5、-锁优化" class="headerlink" title="5、**锁优化"></a>5、**锁优化</h4><blockquote>
<p>JVM层面对对象锁的优化</p>
<p>Synchronized是重量级锁(Monitor)、悲观锁、可重入锁、非公平锁</p>
<p>​    不可打断</p>
</blockquote>
<h5 id="5-1-自旋锁"><a href="#5-1-自旋锁" class="headerlink" title="5.1 自旋锁"></a>5.1 自旋锁</h5><blockquote>
<p>互斥同步进入阻塞状态的开销都很大，应该尽量避免，在许多应用中，共享数据的锁定状态只会持续很短的一段时间</p>
<p>自旋锁的思想是让一个线程在请求一个共享数据的锁时执行忙循环（自旋）一段时间，如果在这段时间内能获得锁，就可以避免进入阻塞状态</p>
<p>自旋锁虽然能避免进入阻塞状态从而减少开销，但是它需要进行忙循环操作占用 CPU 时间，它只适用于共享数据的锁定状态很短的场景。</p>
<p>JDK 1.6 中引入了自适应的自旋锁。自适应意味着自旋的次数不再固定了，而是由前一次在同一个锁上的自旋次数及锁的拥有者的状态来决定。</p>
</blockquote>
<h5 id="5-2-锁消除"><a href="#5-2-锁消除" class="headerlink" title="5.2 锁消除"></a>5.2 锁消除</h5><blockquote>
<p>锁消除是指对于被检测出不可能存在竞争的共享数据的锁进行消除。</p>
<p>锁消除主要是通过<strong>逃逸分析</strong>来支持，如果堆上的共享数据不可能逃逸出去被其它线程访问到，那么就可以把它们当成<strong>私有数据</strong>对待，也就可以将它们的<strong>锁进行消除</strong>。</p>
</blockquote>
<p><code>String</code>是一个不可变的类，字符串拼接代码就隐式加了锁，编译器会对<code>String</code>的拼接自动优化。在JDK1.5之前，会转化为<code>StringBuffer</code>对象的连续<code>append()</code>操作。</p>
<blockquote>
<p>现在使用<code>StringBuilder</code>,线程不安全，效率高</p>
</blockquote>
<p>每个<code>append()</code>方法中都有一个同步块。</p>
<p>虚拟机观察变量<code>sb</code>，很快就会发现它的动态作用域被限制在<code>concatString()</code>方法内部。</p>
<p>也就是说，<code>sb</code>的所有引用永远不会逃逸到<code>concatString()</code>方法之外，其他线程无法访问到它，因此可以进行消除。</p>
<h5 id="5-3-锁粗化"><a href="#5-3-锁粗化" class="headerlink" title="5.3 锁粗化"></a>5.3 锁粗化</h5><blockquote>
<p>如果一系列的连续操作都对同一个对象反复加锁和解锁，频繁的加锁操作就会导致性能损耗。</p>
</blockquote>
<p>上一节的示例代码中连续的<code>append()</code>方法就属于这类情况。如果虚拟机探测到由这样的一串零碎的操作都对同一个对象加锁，将会把加锁的范围扩展（粗化）到整个操作序列的外部。</p>
<p>对于上一节的示例代码就是扩展到第一个<code>append()</code>操作之前直至最后一个<code>append()</code>操作之后，这样只需要加锁一次就可以了。</p>
<h5 id="5-4-轻量级锁"><a href="#5-4-轻量级锁" class="headerlink" title="5.4 轻量级锁"></a>5.4 轻量级锁</h5><blockquote>
<ul>
<li><p>如果一个对象虽然有多线程访问，但多线程访问的时间是错开的(没有竞争)，那么可以轻量级锁优化</p>
</li>
<li><p>对使用者是透明的，语法仍然是Synchronized</p>
</li>
<li><p>但每次发生锁重入时，还是需要进行CAS操作</p>
</li>
</ul>
</blockquote>
<h5 id="5-5-锁膨胀"><a href="#5-5-锁膨胀" class="headerlink" title="5.5 锁膨胀"></a>5.5 锁膨胀</h5><blockquote>
<p>在尝试加轻量级锁时，CAS操作无法成功，这时一种情况就是有其他线程为此对象加上了轻量级锁(有竞争),这时需要进行锁膨胀，将轻量级锁变为重量级锁。</p>
</blockquote>
<h5 id="5-6-偏向锁"><a href="#5-6-偏向锁" class="headerlink" title="5.6 偏向锁"></a>5.6 偏向锁</h5><blockquote>
<p>轻量级锁在没有竞争时，每次重入都需要执行CAS操作</p>
<p>偏向锁优化：只有第一次使用CAS将线程ID设置到对象的Mark Word头，之后发现这个线程ID是自己的就表示没有竞争。</p>
<p>​                        不用重新CAS。以后只要不发生竞争，这个对象就归该线程所有。</p>
</blockquote>
<h6 id="5-6-1-撤销偏向锁"><a href="#5-6-1-撤销偏向锁" class="headerlink" title="5.6.1 撤销偏向锁"></a>5.6.1 撤销偏向锁</h6><ul>
<li>1-调用对象的Id,但偏向锁的对象MarkWord中存储的是线程Id。如果调用hashcode会导致偏向锁被撤销</li>
<li>2-其他线程使用偏向锁对象，会将偏向锁升级为轻量级锁</li>
</ul>
<h6 id="5-6-2-批量重偏向"><a href="#5-6-2-批量重偏向" class="headerlink" title="5.6.2 批量重偏向"></a>5.6.2 批量重偏向</h6><ul>
<li>对象被多个线程访问，但没有竞争，这时偏向了线程T1的对象仍有机会重新偏向T2，重偏向会重置对象的线程Id</li>
<li>当撤销偏向锁阈值超过20次，会在这些对象加锁时重新偏向至加锁线程。</li>
</ul>
<h6 id="5-6-3-批量撤销"><a href="#5-6-3-批量撤销" class="headerlink" title="5.6.3 批量撤销"></a>5.6.3 批量撤销</h6><p>当撤销偏向锁阈值超过40次后，jvm发现不该偏向，于是整个类的所有对象都会变成不可偏向，<strong>新建的对象也是不可偏向。</strong></p>
<h4 id="6、Park-amp-Unpark"><a href="#6、Park-amp-Unpark" class="headerlink" title="6、Park&amp;Unpark"></a>6、Park&amp;Unpark</h4><blockquote>
<p>LockSupport工具类</p>
<ul>
<li><p>LockSupport.park() 暂停当前线程</p>
</li>
<li><p>LockSupport.unpark(暂停线程对象)   恢复某个线程的运行</p>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Thread t=<span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Thread.sleep(<span class="number">2</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    LockSupport.park();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Thread.sleep(<span class="number">2</span>);</span><br><span class="line"><span class="comment">//将线程作为形参</span></span><br><span class="line">LockSupport.unpark(t);</span><br></pre></td></tr></table></figure>

<h5 id="park-vs-wait"><a href="#park-vs-wait" class="headerlink" title="park vs wait"></a>park vs wait</h5><ul>
<li>park/unpark以<strong>线程为单位来！！！</strong>【阻塞】【唤醒】线程，而notify是随机唤醒某个线程，不精确</li>
<li>wait必须配合Object Monitor来使用，而park没有这个限制</li>
<li><strong>park( __counter=0)之前可以先unpark(设置_counter=1), wait之前不能先notify</strong></li>
</ul>
<h4 id="7、-Reentrantlock"><a href="#7、-Reentrantlock" class="headerlink" title="7、**Reentrantlock"></a>7、**Reentrantlock</h4><img src="https://csn.damyoung.cn/image-20201007164306417.png" alt="image-20201007164306417" style="zoom:67%;" />

<blockquote>
<p>是在对象级别的锁。而Synchronized是以关键字形式(直接操作Monitor)</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取锁</span></span><br><span class="line">reentrantLock.lock();</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="comment">//临界区</span></span><br><span class="line">&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">    reentrantLock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="7-1-可重入"><a href="#7-1-可重入" class="headerlink" title="7.1 可重入"></a>7.1 可重入</h5><blockquote>
<p>可重入指同一个线程如果首次获得这把锁，那么它是这把锁的拥有者，因此有权力再次获得该锁。</p>
<p>Synchronized和ReentrantLock都是可重入锁</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Lock lock=<span class="keyword">new</span> ReentrantLock();</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        m1();</span><br><span class="line">        System.out.println(<span class="string">&quot;main&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">        System.out.println(<span class="string">&quot;finally&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">m1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;m1&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">        System.out.println(<span class="string">&quot;m1Finally&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="7-2-可打断"><a href="#7-2-可打断" class="headerlink" title="7.2 可打断"></a>7.2 可打断</h5><blockquote>
<ul>
<li><p>默认为不可打断模式<code>-见2.5interrupt</code></p>
</li>
<li><p>可打断模式调用<code>lock.lockInterruptibly</code>-通过抛出异常实现</p>
</li>
</ul>
<img src="https://csn.damyoung.cn/image-20201007191014931.png" alt="image-20201007191014931" style="zoom:67%;" />

<p>指线程可以被其他线程调用<code>interrupt()</code>打断。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Thread thread = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;thread&quot;</span>);</span><br><span class="line">        <span class="comment">//设置lock为可打断</span></span><br><span class="line">        <span class="comment">//如果没有竞争那么此方法会获取Lock对象锁</span></span><br><span class="line">        <span class="comment">//如果有竞争进入阻塞队列，可以被其他线程用interrupt打断</span></span><br><span class="line">        lock.lockInterruptibly();</span><br><span class="line">    &#125;<span class="keyword">catch</span> (InterruptedException e)&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        System.out.println(<span class="string">&quot;中断异常&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;获得到锁&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">lock.lock();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">//开启thread线程</span></span><br><span class="line">    thread.start();</span><br><span class="line"></span><br><span class="line">    Thread.sleep(<span class="number">1</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;打断thread&quot;</span>);</span><br><span class="line">    <span class="comment">//打断thread线程</span></span><br><span class="line">    thread.interrupt();</span><br><span class="line">&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">    lock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="7-3-锁超时"><a href="#7-3-锁超时" class="headerlink" title="7.3 锁超时"></a>7.3 锁超时</h5><blockquote>
<p>设置时间，使得在阻塞队列中立即失败</p>
<p><code>tryLock</code>的方法就是试一下，如果能得到锁，就返回true，如果当时得不到，马上就返回false，绝不等。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Thread thread=<span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;尝试获得锁&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!lock.tryLock(<span class="number">1</span>, TimeUnit.SECONDS))&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;获取不到锁&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;获得到锁&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">lock.lock();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;主线程&quot;</span>);</span><br><span class="line">    thread.start();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">    lock.unlock();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="7-4-非公平锁"><a href="#7-4-非公平锁" class="headerlink" title="7.4 非公平锁"></a>7.4 非公平锁</h5><blockquote>
<p>公平锁：是指多个线程按照申请锁的顺序来获取锁</p>
<p>非公平锁：是指多个线程获取锁的顺序并不是按照申请锁的顺序，有可能后申请的线程优先获取锁</p>
</blockquote>
<blockquote>
<p>ReetrantLoc通过构造方法的boolean类型来指定公平锁或者非公平锁，<strong>默认是非公平锁</strong>。Synchronized也是非公平锁</p>
</blockquote>
<h5 id="7-5-条件变量condition-await"><a href="#7-5-条件变量condition-await" class="headerlink" title="7.5 条件变量condition/await"></a>7.5 条件变量condition/await</h5><blockquote>
<ul>
<li>Condition类是来实现线程之间的协调关系</li>
<li>每个条件变量对应一个<strong>等待队列</strong>，其实现类是<code>ConditionObject</code>(AQS内部类，继承与Condition)</li>
</ul>
<img src="https://csn.damyoung.cn/image-20201007230023942.png" alt="image-20201007230023942" style="zoom:67%;" />

<p>条件变量：Synchronized的WaitSet，但Synchronized只支持一个</p>
<ul>
<li>ReentrantLock支持多个条件变量<ul>
<li>await前需要获得锁，执行后会释放锁，进入ConditionObject等待</li>
<li>await线程被唤醒(或打断、或超时)，重新竞争lock锁</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//条件变量2个</span></span><br><span class="line">Condition condition1 = lock.newCondition();</span><br><span class="line">Condition condition2 = lock.newCondition();</span><br><span class="line"></span><br><span class="line">lock.lock();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">//进入condition1等待</span></span><br><span class="line">    condition1.await();</span><br><span class="line">    <span class="comment">//唤醒condition1中的线程</span></span><br><span class="line">    condition1.signal();</span><br><span class="line">    condition1.signalAll();</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">    lock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以在<code>Condition</code>上调用<code>await()</code>方法使线程等待，其它线程调用<code>signal()</code>或<code>signalAll()</code>方法唤醒等待的线程。</p>
<p>相比于<code>wait()</code>这种等待方式，<code>await()</code>可以指定等待的条件，因此更加灵活。</p>
</blockquote>
<h5 id="7-6-Synchronized-vs-ReentrantLock"><a href="#7-6-Synchronized-vs-ReentrantLock" class="headerlink" title="7.6 Synchronized vs ReentrantLock"></a>7.6 Synchronized vs ReentrantLock</h5><ul>
<li><strong>两者都是可重入锁</strong></li>
<li><code>synchronized</code>是JVM实现的，<code>ReentrantLock</code>是JDK实现的</li>
<li>新版本的<code>synchronized</code>进行了很多优化，例如自旋锁，<code>synchronized</code>与<code>ReentrantLock</code>大致相同。</li>
<li>当持有锁的线程长期不释放锁的时候，正在等待的线程可以选择放弃等待，改为处理其他事情。 <strong><code>ReentrantLock</code>可中断（通过<code>lock.lockInterruptibly()</code>来实现），而<code>synchronized</code>不行</strong>。</li>
<li><code>synchronized</code>中的锁是非公平的，<code>ReentrantLock</code>默认情况下也是非公平的，但是也可以是公平的（通过<code>ReentrantLock</code>类的<code>ReentrantLock(boolean fair)</code>。</li>
<li>一个<code>ReentrantLock</code>可以同时绑定多个<code>Condition</code>对象（绑定多个条件）,从而可以有选择性的进行线程通知，在调度线程上更加灵活。在使用<code>notify()/notifyAll()</code>方法进行通知时，被通知的线程是由 JVM 选择的，用<code>ReentrantLock</code>类结合<code>Condition</code>实例可以实现“选择性通知”。</li>
</ul>
<blockquote>
<p>除非需要使用<code>ReentrantLock</code>的高级功能，否则优先使用<code>synchronized</code>。这是因为<code>synchronized</code>是 JVM 实现的一种锁机制，JVM 原生地支持它，而<code>ReentrantLock</code>不是所有的 JDK 版本都支持。并且使用<code>synchronized</code>不用担心没有释放锁而导致死锁问题，因为 JVM 会确保锁的释放。</p>
</blockquote>
<h4 id="8、多把锁"><a href="#8、多把锁" class="headerlink" title="8、多把锁"></a>8、多把锁</h4><blockquote>
<p>俩个不相干线程使用同一把锁会影响并发度</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BigRoom</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object studyRoom=<span class="keyword">new</span> Object();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object sleepRoom=<span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sleep</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (sleepRoom)&#123;</span><br><span class="line">            Thread.sleep(<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">study</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (studyRoom)&#123;</span><br><span class="line">            Thread.sleep(<span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="9、线程活跃性"><a href="#9、线程活跃性" class="headerlink" title="9、线程活跃性"></a>9、线程活跃性</h4><h5 id="9-1-死锁"><a href="#9-1-死锁" class="headerlink" title="9.1 死锁"></a>9.1 死锁</h5><blockquote>
<p>俩个或以上的线程在执行过程中，需要获得多把锁，这时容易发生死锁</p>
<p><strong>这种因线程之间争夺资源而互相等待的现象，需要外力推动</strong></p>
<p>解决：多种锁不能嵌套</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//死锁演示</span></span><br><span class="line"><span class="keyword">synchronized</span> (Product.class)&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;卖家有货，等待买家交钱&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        <span class="keyword">synchronized</span> (Money.class)&#123;</span><br><span class="line">    		System.out.println(<span class="string">&quot;卖家获得钱，交出货物&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//解决</span></span><br><span class="line"><span class="keyword">synchronized</span> (Money.class)&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;买家有钱，等待卖家交货&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sleep(<span class="number">1000</span>);    <span class="comment">//睡眠，让出CPU资源</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">synchronized</span> (Product.class)&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;买家获得货物，钱交给卖家&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="定位死锁"><a href="#定位死锁" class="headerlink" title="定位死锁"></a>定位死锁</h6><ul>
<li>jconsole工具</li>
<li>jps定位进程</li>
</ul>
<h5 id="9-2-活锁"><a href="#9-2-活锁" class="headerlink" title="9.2 活锁"></a>9.2 活锁</h5><blockquote>
<p><strong>俩个线程互相改变对方的结束条件，最后谁也无法结束</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keyword">int</span> a=<span class="number">10</span>;</span><br><span class="line"><span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">    <span class="keyword">while</span> (a&gt;<span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">200</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        a--;</span><br><span class="line">        System.out.println(a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).start();</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">   <span class="keyword">while</span> (a&lt;<span class="number">20</span>)&#123;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           Thread.sleep(<span class="number">200</span>);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">       a++;</span><br><span class="line">       System.out.println(a);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;).start();</span><br></pre></td></tr></table></figure>



<h5 id="9-1-饥饿"><a href="#9-1-饥饿" class="headerlink" title="9.1 饥饿"></a>9.1 饥饿</h5><blockquote>
<p>在公平锁中，由于优先级太低，始终无法得到CPU调度执行，也不能结束，<strong>造成“饥饿”现象</strong></p>
</blockquote>
<h3 id="四、内存模型"><a href="#四、内存模型" class="headerlink" title="四、内存模型"></a>四、内存模型</h3><h4 id="1、Java内存模型"><a href="#1、Java内存模型" class="headerlink" title="1、Java内存模型"></a>1、<strong>Java内存模型</strong></h4><h5 id="1-1-概念"><a href="#1-1-概念" class="headerlink" title="1.1 概念"></a>1.1 概念</h5><blockquote>
<p><strong>多线程下Java代码的执行顺序，共享变量的读写！！！</strong></p>
</blockquote>
<blockquote>
<p>JMM即Java Memory Model，从属于JVM，定义了主  存、工作内存抽象概念，底层对应着CPU寄存器、缓存、硬件内存、CPU指令优化等.</p>
<p>JMM试图屏蔽各种硬件和操作系统的内存差异，使得java代码在各种平台都达到一致的内存访问效果</p>
</blockquote>
<blockquote>
<p>共享变量会先放在主存中，每个线程都有属于自己的工作内存，并且会把位于主存中的共享变量拷贝到自己的工作内存</p>
<p>之后的读写操作均使用位于工作内存的变量副本，并在某个时刻将工作内存的变量副本写回到主存中去。</p>
<p>线程只能操作自己工作内存中的变量，不同线程之间的变量值传递需要通过主内存来完成</p>
</blockquote>
<h5 id="1-2-三大特性"><a href="#1-2-三大特性" class="headerlink" title="1.2 三大特性"></a>1.2 三大特性</h5><blockquote>
<ul>
<li>原子性-保证指令不会受到<strong>线程上下文切换</strong>的影响</li>
<li>可见性-保证指令不会受到Cpu<strong>缓存</strong>的影响</li>
<li>有序性-保证指令不会受到CPU<strong>指令并行优化</strong>的影响</li>
</ul>
</blockquote>
<h6 id="1-1-可见性"><a href="#1-1-可见性" class="headerlink" title="1.1 可见性"></a>1.1 可见性</h6><blockquote>
<p><strong>可见性：当一个线程修改了共享变量后，其他线程能够立即得知这个修改。</strong></p>
<ul>
<li><p>当多个线程操作共享变量时，一个CPU中的线程读取主存数据到<strong>CPU缓存</strong>，然后对共享对象做了更改。</p>
</li>
<li><p>但CPU缓存中的更改后的对象还没有flush到主存，此时<strong>线程对共享对象的更改对其它CPU中的线程是不可见的</strong>。 </p>
</li>
<li><p>最终就是每个线程最终都会拷贝共享对象，而且拷贝的对象位于不同的CPU缓存中</p>
</li>
</ul>
</blockquote>
<p><strong>解决</strong></p>
<blockquote>
<ul>
<li>使用<strong>volatile(易变)**关键字，保证变量会</strong>直接从主存读取<strong>，而对变量的</strong>更新也会直接写到主存**(轻量)</li>
<li>使用Synchronized保证临界区代码的原子性，也会在释放锁前将变量直接写入主存中，保证可见性(调用Monitor,重量)</li>
<li><code>final</code>:被<code>final</code>关键字修饰的字段在构造器中一旦初始化完成，并且没有发生<code>this</code>逃逸（其他线程通过<code>this</code>引用访问到初始化一半的对象），那么其他线程就能看见<code>final</code>字段的值。</li>
</ul>
</blockquote>
<h6 id="1-3-原子性"><a href="#1-3-原子性" class="headerlink" title="1.3 原子性"></a>1.3 原子性</h6><blockquote>
<p><strong>原子性：一个操作是不可中断，要么全部执行成功要么全部执行失败</strong></p>
<ul>
<li><p>volatile不能保证原子性，<strong>不能保证指令交错</strong>，仅适合用于一个写线程，多个读线程。</p>
</li>
<li><p>Synchronized保证临界区代码避免发生竞态条件</p>
</li>
</ul>
</blockquote>
<h6 id="1-4-有序性"><a href="#1-4-有序性" class="headerlink" title="1.4 有序性"></a>1.4 有序性</h6><blockquote>
<p><strong>有序性：是指程序执行的顺序按照代码的先后顺序执行。</strong></p>
<p>CPU会对<strong>无依赖关系指令</strong>进行重排序优化</p>
<ul>
<li>volatile可以禁止指令重排序</li>
<li>也可以通过<code>synchronized</code>来保证有序性，它保证每个时刻只有一个线程执行同步代码，相当于是让线程顺序执行同步代码。典型的应用是双重检查锁实现的单例模式。</li>
</ul>
</blockquote>
<h5 id="1-3-内存间的交互操作"><a href="#1-3-内存间的交互操作" class="headerlink" title="1.3 内存间的交互操作"></a>1.3 内存间的交互操作</h5><blockquote>
<p>Java 内存模型定义了 8 个操作来完成主内存和工作内存的交互操作：</p>
</blockquote>
<img src="https://github.com/CyC2018/CS-Notes/raw/master/notes/pics/8b7ebbad-9604-4375-84e3-f412099d170c.png" alt="内存交互操作" style="zoom:80%;" />

<ul>
<li><code>read</code>:把一个变量的值从主内存传输到工作内存中</li>
<li><code>load</code>:在<code>read</code>之后执行，把<code>read</code>得到的值放入工作内存的变量副本中</li>
<li><code>use</code>:把工作内存中一个变量的值传递给执行引擎</li>
<li><code>assign</code>:把一个从执行引擎接收到的值赋给工作内存的变量</li>
<li><code>store</code>:把工作内存的一个变量的值传送到主内存中</li>
<li><code>write</code>:在<code>store</code>之后执行，把<code>store</code>得到的值放入主内存的变量中</li>
<li><code>lock</code>:作用于主内存的变量</li>
<li><code>unlock</code></li>
</ul>
<h5 id="1-4-多线程读写优化"><a href="#1-4-多线程读写优化" class="headerlink" title="1.4 多线程读写优化"></a>1.4 多线程读写优化</h5><blockquote>
<p>如果让线程独占CPU是不合理的，任务调度器会让线程分时使用CPU</p>
</blockquote>
<blockquote>
<p>编译器JIT以及硬件层面会做层层优化，提升性能</p>
<ul>
<li>Complier/JIT优化 </li>
<li>Processor流水线优化</li>
<li>Cache优化</li>
</ul>
</blockquote>
<h6 id="1-1-1-编译器优化"><a href="#1-1-1-编译器优化" class="headerlink" title="1.1.1 编译器优化"></a>1.1.1 编译器优化</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">优化前</span><br><span class="line">	x=<span class="number">1</span></span><br><span class="line">	y=<span class="string">&quot;sss&quot;</span></span><br><span class="line">	x=<span class="number">2</span></span><br><span class="line">优化后</span><br><span class="line">	y=<span class="string">&quot;sss&quot;</span></span><br><span class="line">	x=<span class="number">2</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">优化前</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;max;i++)&#123;</span><br><span class="line">    	z+=a[i]</span><br><span class="line">    &#125;</span><br><span class="line">优化后</span><br><span class="line">	t=z;</span><br><span class="line">	 <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;max;i++)&#123;</span><br><span class="line">    	t+=a[i]</span><br><span class="line">    &#125;</span><br><span class="line">    z=t</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">优化前</span><br><span class="line">	<span class="keyword">if</span>(x&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">		y=<span class="number">1</span>;</span><br><span class="line">		<span class="comment">//--</span></span><br><span class="line">	&#125;</span><br><span class="line">优化后</span><br><span class="line">	y=<span class="number">1</span></span><br><span class="line">	<span class="keyword">if</span>(x&gt;=<span class="number">0</span>)&#123; <span class="comment">//发现一直true,提取出y</span></span><br><span class="line">		<span class="comment">//---</span></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h6 id="1-1-2-流水线优化"><a href="#1-1-2-流水线优化" class="headerlink" title="1.1.2 流水线优化"></a>1.1.2 流水线优化</h6><blockquote>
<p>多线程下会导致指令重排序</p>
<ul>
<li>流水线在CPU的一个时钟周期会执行多个指令不同部分</li>
</ul>
</blockquote>
<p><strong>execute Out of Order</strong>乱序执行 </p>
<ul>
<li>按序执行，一旦遇到指令依赖的情况，流水线就会停滞</li>
<li>乱序执行，就可以跳到下一个非依赖指令并发布它。这样执行单元就可以总是处于工作状态，把时间浪费减到最少</li>
</ul>
<h6 id="1-1-3-缓存优化"><a href="#1-1-3-缓存优化" class="headerlink" title="1.1.3 缓存优化"></a>1.1.3 缓存优化</h6><blockquote>
<p>导致可见性问题，缓存会产生 一致性 问题</p>
</blockquote>
<h4 id="2、JMM规范"><a href="#2、JMM规范" class="headerlink" title="2、JMM规范"></a>2、JMM规范</h4><blockquote>
<p>内存模型就是多线程下对共享变量的一组读写规则</p>
<ul>
<li>代码可能的执行顺序       –有序性</li>
<li>共享变量值是否在线程间同步  –可见性</li>
</ul>
</blockquote>
<h5 id="2-1-Race-Condition"><a href="#2-1-Race-Condition" class="headerlink" title="2.1 Race Condition"></a>2.1 Race Condition</h5><blockquote>
<p>竞态条件    </p>
<p>在<strong>多线程</strong>下，<strong>没有依赖关系</strong>的代码，在执行<strong>共享变量读写</strong>操作(至少有一个线程写)时，并不能保证以编写顺序执行，这称为发生了竞态条件</p>
</blockquote>
<p><strong>竞争是为了更好的性能</strong> </p>
<h5 id="2-2-Synchronization-Order"><a href="#2-2-Synchronization-Order" class="headerlink" title="2.2 Synchronization Order"></a>2.2 Synchronization Order</h5><blockquote>
<p>多线程下，每个线程的执行顺序按编写顺序执行，那么必须使用Synchronization Actions保证</p>
<ul>
<li>lock,unlock,synchronized</li>
<li>volatile方式读写读写变量</li>
<li>VarHandle方式 (jdk9)</li>
</ul>
</blockquote>
<h5 id="2-3-Happens-Before"><a href="#2-3-Happens-Before" class="headerlink" title="2.3 Happens-Before"></a>2.3 Happens-Before</h5><blockquote>
<p>JVM还规定了先行发生原则，让一个操作无需控制就能先于另一个操作完成。</p>
<p><strong>在JMM中，如果一个操作执行的结果需要对另一个操作可见，那么这两个操作之间必须存在happens-before关系。</strong></p>
</blockquote>
<ul>
<li><p>如果一个操作happens-before另一个操作，那么第一个操作的执行结果将对第二个操作可见，而且第一个操作的执行顺序排在第二个操作之前。</p>
</li>
<li><p>两个操作之间存在happens-before关系，并不意味着Java平台的具体实现必须要按照happens-before关系指定的顺序来执行。<strong>如果重排序之后的执行结果，与按happens-before关系来执行的结果一致，那么这种重排序并不非法</strong>（也就是说，JMM允许这种重排序）</p>
</li>
</ul>
<p><strong>具体规则</strong></p>
<ol>
<li><p>单一线程原则</p>
<blockquote>
<p>Single Thread Rule</p>
<p>一个线程内，按照代码顺序，书写在前面的操作先行发生于书写在后面的操作</p>
</blockquote>
</li>
<li><p>管程锁定规则</p>
<blockquote>
<p>Monitor Lock Rule</p>
<p>一个unLock操作先行发生于后面对同一个锁的lock操作。</p>
</blockquote>
</li>
<li><p>volatile变量规则</p>
<blockquote>
<p>Volatile Variable Rule</p>
<p>对一个变量的写操作先行发生于后面对这个变量的读操作。</p>
</blockquote>
</li>
<li><p>传递规则</p>
<blockquote>
<p>Transitivity</p>
<p>如果操作A先行发生于操作B，而操作B又先行发生于操作C，则可以得出操作A先行发生于操作C。</p>
</blockquote>
</li>
<li><p>线程启动规则</p>
<blockquote>
<p>Thread Start Rule</p>
<p>Thread对象的start()方法先行发生于此线程的每个一个动作。</p>
</blockquote>
</li>
<li><p>线程中断规则</p>
<blockquote>
<p>Thread Interruption Rule</p>
<p>对线程interrupt()方法的调用先行发生于被中断线程的代码检测到中断事件的发生。</p>
</blockquote>
</li>
<li><p>线程终结规则</p>
<blockquote>
<p>线程中所有的操作都先行发生于线程的终止检测，我们可以通过Thread.join()方法结束、Thread.isAlive()的返回值手段检测到线程已经终止执行。</p>
</blockquote>
</li>
<li><p>对象终结规则</p>
<blockquote>
<p>Finalizer Rule</p>
<p>一个对象的初始化完成先行发生于他的finalize()方法的开始。</p>
</blockquote>
</li>
</ol>
<p>exp</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MonitorDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">writer</span><span class="params">()</span> </span>&#123;     <span class="comment">// 1</span></span><br><span class="line">        a++;                                <span class="comment">// 2</span></span><br><span class="line">    &#125;                                       <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">reader</span><span class="params">()</span> </span>&#123;    <span class="comment">// 4</span></span><br><span class="line">        <span class="keyword">int</span> i = a;                         <span class="comment">// 5</span></span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>从整体上来看，线程A的执行结果（a=1）对线程B是可见的，实现原理为：释放锁的时候会将值刷新到主内存中，其他线程获取锁时会强制从主内存中获取最新的值。另外也验证了2 happens-before 5，2的执行结果对5是可见的。</p>
</li>
<li><p>从横向来看，这就像线程A通过主内存中的共享变量和线程B进行通信，A 告诉 B 我们俩的共享数据现在为1啦，这种线程间的通信机制正好吻合java的内存模型正好是共享内存的并发模型结构。</p>
</li>
</ul>
<h4 id="3、volatile"><a href="#3、volatile" class="headerlink" title="3、volatile"></a>3、volatile</h4><blockquote>
<p>底层实现原理是<strong>内存屏障</strong>(Memory Barrier)</p>
</blockquote>
<blockquote>
<p><strong>使用场景！！！</strong></p>
<ul>
<li>一个线程修改了某个变量的值，读写操作都同步到主存中，新值对其他线程来说是立即可见的。</li>
<li><strong>禁止进行指令重排序</strong>，保证volatile有序性。</li>
<li>不能保证原子性，仅仅用于仅有一个写操作场景下或运算结果并不依赖于变量的当前值。</li>
</ul>
</blockquote>
<h5 id="3-1-可见性"><a href="#3-1-可见性" class="headerlink" title="3.1 可见性"></a>3.1 可见性</h5><blockquote>
<p>写屏障sfence，<strong>写屏障之前</strong>的所有修改都会同步到主存</p>
<p>读屏障lfence，<strong>读屏障之后</strong>读取都是主存中最新数据</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> isover=<span class="keyword">false</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="comment">//读屏障</span></span><br><span class="line">                <span class="keyword">while</span> (!isOver) &#123;</span><br><span class="line">                    a++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        thread.start();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        isOver = <span class="keyword">true</span>;</span><br><span class="line">        <span class="comment">//写屏障</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="3-2-有序性"><a href="#3-2-有序性" class="headerlink" title="3.2 **有序性"></a>3.2 **有序性</h5><blockquote>
<p>写屏障，不会将写屏障之前的代码排在写屏障之后</p>
<p>读屏障，不会将读屏障之后的代码排在读屏障之前</p>
</blockquote>
<p><strong>注意！！！！</strong></p>
<blockquote>
<ul>
<li><strong>读屏障仅仅是保证之后的读能够读到最新的结果，但不能保证之前的读操作是最新结果</strong> </li>
<li>有序性的保证只是保证**本线程！！的相关代码不被重排序 ** </li>
</ul>
</blockquote>
<p>double-checked blocking 模式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;<span class="comment">//步骤1</span></span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton.class) &#123;<span class="comment">//步骤2</span></span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;<span class="comment">//步骤3</span></span><br><span class="line">                    instance = <span class="keyword">new</span> Singleton();<span class="comment">//步骤4</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>双检锁模式特点</p>
<blockquote>
<ul>
<li>懒惰实例化</li>
<li>首次使用getInstance()，才会使用Synchronized加锁，后续使用无需加锁</li>
<li>第一个if是在同步代码块外，存在线程安全问题，<strong>加入volatile禁止指令重排序</strong></li>
</ul>
</blockquote>
<p>问题</p>
<blockquote>
<p>由于Synchronized保证作用范围内临界区的有序性，并不能禁止指令重排</p>
</blockquote>
<p>因为instance = new Singleton()这条语句实际上包含了<strong>三个操作：</strong></p>
<p>1.分配对象的内存空间；</p>
<p>2.初始化对象    new Singleton()；</p>
<p>3.设置instance指向刚分配的内存地址。 </p>
<blockquote>
<p>步骤2和步骤3可能会被重排序，流程变为1-&gt;3-&gt;2</p>
</blockquote>
<p>如果2和3进行了重排序的话，线程B进行判断if(instance==null)时就会为true，而实际上这个instance并没有初始化成功，将会读取到一个没有初始化完成的对象。</p>
<blockquote>
<p><strong>用volatile修饰</strong>的话就可以禁止2和3操作重排序，从而避免这种情况。<strong>volatile包含禁止指令重排序的语义，其具有有序性</strong>。</p>
</blockquote>
<h5 id="3-3-原子性"><a href="#3-3-原子性" class="headerlink" title="3.3 原子性"></a>3.3 原子性</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keyword">int</span> counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++)</span><br><span class="line">                    counter++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        thread.start();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(counter);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启10个线程，每个线程都自加10000次，如果不出现线程安全的问题最终的结果应该就是：10*10000 = 100000;可是运行多次都是小于100000的结果，问题在于 <strong>volatile并不能保证原子性</strong></p>
<p>counter++这并不是一个原子操作，包含了三个步骤：1.读取变量counter的值；2.对counter加一；3.将新值赋值给变量counter。</p>
<p>如果线程A读取counter到工作内存后，其他线程对这个值已经做了自增操作后，那么线程A的这个值自然而然就是一个过期的值，因此，总结果必然会是小于100000的。</p>
<p>让volatile保证原子性，必须符合以下两条规则：</p>
<ol>
<li><strong>运算结果并不依赖于变量的当前值，或者能够确保只有一个线程修改变量的值；</strong></li>
<li><strong>变量不需要与其他的状态变量共同参与不变约束</strong></li>
</ol>
<h5 id="3-4-volatile-修饰数组和对象"><a href="#3-4-volatile-修饰数组和对象" class="headerlink" title="3.4 volatile 修饰数组和对象"></a>3.4 volatile 修饰数组和对象</h5><p>volatile 修饰对象或数组时，只能保证他们的<strong>引用地址的可见性</strong>，而不能保证其内部元素具有可见性。</p>
<p>但是如果对于同一个数组，用 volatile 修饰后，在一个线程改编数组中的值，在另一个线程中还是可以马上读取到更新的新值，原因是：</p>
<blockquote>
<p>当另一个线程读取 array 时，因为 array 的引用被 volatile 修饰，所以线程对所有变量都会从主内存去获取，当然也就包括数组的内部值（例如 array[0]）。 所以会让人产生误解，以为是volatile修饰的数组保证了其数组的可见性，其实不然。</p>
</blockquote>
<h4 id="4、double-checked-locking"><a href="#4、double-checked-locking" class="headerlink" title="4、double-checked locking"></a>4、double-checked locking</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LazySingleton</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> LazySingleton instance=<span class="keyword">null</span>;    <span class="comment">//保证 instance 在所有线程中同步</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">LazySingleton</span><span class="params">()</span></span>&#123;&#125;    <span class="comment">//private 避免类在外部被实例化</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LazySingleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance==<span class="keyword">null</span>)&#123;</span><br><span class="line">            Synchronized(LazySingleton.class)&#123;</span><br><span class="line">                <span class="comment">//getInstance 方法前加同步</span></span><br><span class="line">                <span class="keyword">if</span>(instance==<span class="keyword">null</span>)&#123;</span><br><span class="line">                    instance=<span class="keyword">new</span> LazySingleton();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>双检锁模式特点</p>
<blockquote>
<ul>
<li>懒惰实例化</li>
<li>首次使用getInstance()，才会使用Synchronized加锁，后续使用无需加锁</li>
<li>第一个if是在同步代码块外，存在线程安全问题，<strong>加入volatile禁止指令重排序</strong></li>
</ul>
</blockquote>
<p>详见3.2</p>
<h4 id="5、synchronized关键字和volatile关键字的区别"><a href="#5、synchronized关键字和volatile关键字的区别" class="headerlink" title="5、synchronized关键字和volatile关键字的区别"></a>5、synchronized关键字和volatile关键字的区别</h4><ul>
<li><code>volatile</code>关键字是线程同步的轻量级实现，所以<code>volatile</code>性能比<code>synchronized</code>性能要好。但是<code>volatile</code>关键字只能用于变量而<code>synchronized</code>可以修饰方法和代码块。实际开发中<code>synchronized</code>比较常见。</li>
<li>多线程使用<code>volatile</code>关键字不会发生阻塞，而<code>synchronized</code>可能会发生阻塞。</li>
<li><code>volatile</code>关键字保证数据的可见性，但是不能保证数据的原子性。<code>synchronized</code>关键字两者都能保证。</li>
<li><code>volatile</code>关键字主要用于解决变量在多个线程之间的可见性，而<code>synchronized</code>关键字解决的是多个线程之间访问资源的同步性。</li>
</ul>
<h3 id="五、共享模型-无锁"><a href="#五、共享模型-无锁" class="headerlink" title="五、共享模型(无锁)"></a>五、共享模型(无锁)</h3><blockquote>
<p>无锁操作是使用**CAS(compare and swap)**又叫做比较交换来鉴别线程是否出现冲突</p>
<p>出现冲突就重试当前操作直到没有冲突为止。</p>
<p><strong>无锁特点：</strong></p>
</blockquote>
<ul>
<li>无锁操作效率高，非阻塞锁但不会进入阻塞状态，减少上下文切换，但会不断自旋cas操作而占用CPU资源</li>
<li>体现了<strong>无锁并发</strong>、<strong>无阻塞并发</strong>，但在竞争激烈时反而会影响效率</li>
</ul>
<h4 id="1、CAS"><a href="#1、CAS" class="headerlink" title="1、CAS"></a>1、CAS</h4><blockquote>
<p><strong>CAS是乐观锁，非阻塞锁</strong> compare and swap</p>
<ul>
<li><p>它认为在线程在共享资源时不会发生冲突，不会发生冲突自然就不会阻塞其他线程的操作，故线程也就不会出现阻塞</p>
</li>
<li><p>为了获取变量的最新值(内存地址V)，保证该变量的可见性，<strong>需要使用volatile修饰</strong></p>
</li>
</ul>
</blockquote>
<blockquote>
<p>synchronized 是悲观锁（阻塞锁），悲观地认为程序中的并发情况严重</p>
</blockquote>
<h5 id="1-1-操作过程"><a href="#1-1-操作过程" class="headerlink" title="1.1 操作过程"></a>1.1 操作过程</h5><p>3个基本操作数：内存地址V(可能被其他线程修改的值)，旧的期望值O(先前获取的值)，要修改的新值N</p>
<p>更新变量时，当变量的期望值与内存地址V当中的实际值相同时，才会将内存地址V对应的值修改为N</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AtomicInteger i = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line">i.compareAndSet(<span class="number">10</span>, <span class="number">3</span>)  <span class="comment">//false，不可修改</span></span><br></pre></td></tr></table></figure>

<h5 id="1-2-CAS的问题"><a href="#1-2-CAS的问题" class="headerlink" title="1.2 CAS的问题"></a>1.2 CAS的问题</h5><h6 id="1-2-1-ABA问题"><a href="#1-2-1-ABA问题" class="headerlink" title="1.2.1 ABA问题"></a>1.2.1 ABA问题</h6><p>CAS会检查旧值有无变化，比如一个旧值A变为了成B，然后再变成A，刚好在做CAS时检查发现旧值并没有变化依然为A，但是实际上的确发生了变化</p>
<p><strong>解决</strong>：添加一个版本号<code>AtomicStampedReference()</code>，原来的变化路径A-&gt;B-&gt;A就变成了1A-&gt;2B-&gt;3C。</p>
<h6 id="1-2-2-自旋时间过长"><a href="#1-2-2-自旋时间过长" class="headerlink" title="1.2.2 自旋时间过长"></a>1.2.2 自旋时间过长</h6><p>CAS是<strong>非阻塞</strong>同步，不会把线程挂起，会自旋进行下一次尝试，自旋时间过长会对性能消耗</p>
<h6 id="1-2-3-只能保证一个共享资源的原子操作"><a href="#1-2-3-只能保证一个共享资源的原子操作" class="headerlink" title="1.2.3 只能保证一个共享资源的原子操作"></a>1.2.3 只能保证一个共享资源的原子操作</h6><p>当对一个共享变量执行操作时CAS能保证其原子性，如果对多个共享变量进行操作,CAS就不能保证其原子性</p>
<p><strong>解决：</strong>用一个对象整合多个共享变量，atomic中提供<code>AtomicReference</code>来保证引用对象之间的原子性</p>
<h4 id="2、原子整数"><a href="#2、原子整数" class="headerlink" title="2、原子整数"></a>2、原子整数</h4><p>java并发包concurrent工具类</p>
<ul>
<li>AtomicBoolean</li>
<li>AtomicInteger</li>
<li>AtomicLong</li>
</ul>
<blockquote>
<p>例如i++操作，不是原子操作  1. 读取i的初始值 2.++  3.终值赋予</p>
<p>在 getAndIncrement()中，是原子操作</p>
<p><strong>保证基本类型操作的原子性</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//构造初始值</span></span><br><span class="line">AtomicInteger i = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//自增并获取++i</span></span><br><span class="line">System.out.println(i.incrementAndGet());</span><br><span class="line"><span class="comment">//i++</span></span><br><span class="line">System.out.println(i.getAndIncrement());</span><br><span class="line">System.out.println(i.get());</span><br><span class="line"></span><br><span class="line"><span class="comment">//先获取再加</span></span><br><span class="line">System.out.println(i.getAndAdd(<span class="number">5</span>));</span><br><span class="line"><span class="comment">//先加</span></span><br><span class="line">System.out.println(i.addAndGet(<span class="number">5</span>));</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//读取到值-&gt;设置的值</span></span><br><span class="line"><span class="comment">//使用Lambda表达式</span></span><br><span class="line">i.updateAndGet(value-&gt;value+<span class="number">10</span>);</span><br></pre></td></tr></table></figure>



<h4 id="3、原子引用"><a href="#3、原子引用" class="headerlink" title="3、原子引用"></a>3、原子引用</h4><ul>
<li>AtomicReference</li>
<li>AtomicMarkableReference  记录有没有被更改过，boolean</li>
<li>AtomicStampedReference </li>
</ul>
<h5 id="3-1-AtomicReference"><a href="#3-1-AtomicReference" class="headerlink" title="3.1 AtomicReference"></a>3.1 AtomicReference</h5><blockquote>
<p>AtomicReference&lt;引用对象&gt; balance=new AtomicReference&lt;&gt;(引用对象参数)</p>
<p><strong>保护对象引用的原子性</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DecimalAccounts</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> AtomicReference&lt;BigDecimal&gt; balance;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DecimalAccounts</span><span class="params">(BigDecimal bigDecimal)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.balance=<span class="keyword">new</span> AtomicReference&lt;&gt;(bigDecimal);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-2-AtomicStampedReference"><a href="#3-2-AtomicStampedReference" class="headerlink" title="3.2 AtomicStampedReference"></a>3.2 AtomicStampedReference</h5><p><strong>添加多个版本号，解决ABA</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> AtomicStampedReference&lt;String&gt; ref=<span class="keyword">new</span> AtomicStampedReference&lt;&gt;(<span class="string">&quot;a&quot;</span>,<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//获取初始值</span></span><br><span class="line">    String reference = ref.getReference();</span><br><span class="line">    <span class="comment">//获取版本号</span></span><br><span class="line">    <span class="keyword">int</span> stamp = ref.getStamp();</span><br><span class="line">    </span><br><span class="line">    ref.compareAndSet(reference,<span class="string">&quot;b&quot;</span>,stamp,stamp+<span class="number">1</span>);</span><br><span class="line">    System.out.println(ref.getReference());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-3-AtomicMarkableReference"><a href="#3-3-AtomicMarkableReference" class="headerlink" title="3.3 AtomicMarkableReference"></a>3.3 AtomicMarkableReference</h5><blockquote>
<p>返回比较成功与否的boolean值。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AtomicMarkableReference ref=<span class="keyword">new</span> AtomicMarkableReference(bag,<span class="keyword">true</span>)</span><br><span class="line"><span class="keyword">boolean</span> success=ref.compareAndSet(bag,<span class="keyword">new</span> bag(),<span class="keyword">true</span>,<span class="keyword">false</span>);</span><br></pre></td></tr></table></figure>



<h4 id="4、原子数组"><a href="#4、原子数组" class="headerlink" title="4、原子数组"></a>4、原子数组</h4><ul>
<li>AtomicIntegerArray</li>
<li>AtomicLongArray</li>
<li>AtomicReferenceArray</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">AtomicIntegerArray atomicIntegerArray = <span class="keyword">new</span> AtomicIntegerArray(<span class="number">10</span>);</span><br><span class="line"><span class="keyword">int</span> length = atomicIntegerArray.length();</span><br><span class="line">atomicIntegerArray.set(<span class="number">1</span>,<span class="number">20</span>);</span><br><span class="line">System.out.println(atomicIntegerArray.get(<span class="number">1</span>));</span><br></pre></td></tr></table></figure>



<h4 id="5、字段更新器"><a href="#5、字段更新器" class="headerlink" title="5、字段更新器"></a>5、字段更新器</h4><ul>
<li>AtomicReferenceFieldUpdater</li>
</ul>
<blockquote>
<p>保证对象成员变量，字段的线程安全性</p>
<p><strong>只能配合volatile修饰的字段</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span></span>&#123;</span><br><span class="line">    <span class="keyword">volatile</span> String name;</span><br><span class="line">&#125;</span><br><span class="line">Student stu=<span class="keyword">new</span> Student();</span><br><span class="line">AtomicReferenceFieldUpdater updater=</span><br><span class="line">   AtomicReferenceFieldUpdater.newUpdater(Student.class,String.class,<span class="string">&quot;name&quot;</span>);</span><br><span class="line"></span><br><span class="line">updater.compareAndSet(stu,<span class="keyword">null</span>,<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">System.out.println(stu);</span><br></pre></td></tr></table></figure>



<h4 id="6、？原子累加器"><a href="#6、？原子累加器" class="headerlink" title="6、？原子累加器"></a>6、？原子累加器</h4><blockquote>
<p>jdk8新增累加类 <code>LongAdder</code>，较与AtomicLong/…性能更好</p>
</blockquote>
<p>听不懂，以后再看</p>
<h3 id="六、不可变对象"><a href="#六、不可变对象" class="headerlink" title="六、不可变对象"></a>六、不可变对象</h3><h4 id="1、不可变设计"><a href="#1、不可变设计" class="headerlink" title="1、不可变设计"></a>1、不可变设计</h4><blockquote>
<p>vector、HashTable、Random、String、Integer、StringBuffer、DateTimeFormatter</p>
<p>变量使用final修饰</p>
</blockquote>
<blockquote>
<p>不可变对象可以保证线程安全</p>
<ul>
<li>它们每个方法是原子的</li>
<li><strong>多个方法的组成不是原子的</strong></li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DateTimeFormatter dateTimeFormatter = DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;<span class="number">10</span> ; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">        TemporalAccessor parse = dateTimeFormatter.parse(<span class="string">&quot;1911-04-03&quot;</span>);</span><br><span class="line">        System.out.println(parse);</span><br><span class="line">    &#125;).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="String"><a href="#String" class="headerlink" title="String"></a>String</h5><blockquote>
<p>当发生修改操作时，<strong>保护性拷贝</strong>，避免<strong>共享产生线程安全问题</strong></p>
</blockquote>
<img src="https://csn.damyoung.cn/image-20201004195902776.png" alt="image-20201004195902776" style="zoom:67%;" />



<h4 id="2、final原理"><a href="#2、final原理" class="headerlink" title="2、final原理"></a>2、final原理</h4><blockquote>
<p> 加入了<strong>写屏障保护</strong>，保证变量值的可见性</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestFinal</span></span>&#123;</span><br><span class="line">    <span class="comment">//1.分配内存空间</span></span><br><span class="line">    <span class="comment">//2.初始化0</span></span><br><span class="line">    <span class="comment">//3.赋值20</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> a=<span class="number">20</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="https://csn.damyoung.cn/image-20201010152712727.png" alt="image-20201010152712727" style="zoom:80%;" />



<h3 id="七、线程池"><a href="#七、线程池" class="headerlink" title="七、线程池"></a>七、线程池</h3><h4 id="1、自定义线程池"><a href="#1、自定义线程池" class="headerlink" title="1、自定义线程池"></a>1、自定义线程池</h4><blockquote>
<p>基于生产消费者模式</p>
<p>Thread Pool  任务的消费者 &gt;&gt;&gt; Blocking Queue阻塞队列 &gt;&gt;&gt; main任务的生产者</p>
</blockquote>
<img src="https://csn.damyoung.cn/image-20201005130109179.png" alt="image-20201005130109179" style="zoom: 67%;" />

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> admin</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestPool</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建线程池对象</span></span><br><span class="line">        ThreadPool threadPool=<span class="keyword">new</span> ThreadPool(<span class="number">1</span>,<span class="number">1000</span>,TimeUnit.MILLISECONDS,<span class="number">1</span>,(queue,task)-&gt;&#123;</span><br><span class="line">            <span class="comment">//1、死等</span></span><br><span class="line"><span class="comment">//            queue.put(task);</span></span><br><span class="line">            <span class="comment">//2.带超时等待</span></span><br><span class="line"><span class="comment">//            queue.offer(task,500,TimeUnit.MILLISECONDS);</span></span><br><span class="line">            <span class="comment">//3.放弃任务执行</span></span><br><span class="line"><span class="comment">//            System.out.println(task);</span></span><br><span class="line">            <span class="comment">//4.让调用自己抛出异常</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;任务执行失败&quot;</span>+task);        </span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;<span class="number">3</span> ; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> j=i;</span><br><span class="line">            threadPool.execute(()-&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(j);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@FunctionalInterface</span> <span class="comment">//拒绝策略</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">RejectPolicy</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">      <span class="function"><span class="keyword">void</span> <span class="title">reject</span><span class="params">(BlockingQueue&lt;T&gt; queue,T task)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadPool</span></span>&#123;</span><br><span class="line">    <span class="comment">//任务队列</span></span><br><span class="line">    <span class="keyword">private</span> BlockingQueue&lt;Runnable&gt; taskQueue;</span><br><span class="line">    <span class="comment">//线程集合</span></span><br><span class="line">    <span class="keyword">private</span> HashSet&lt;Worker&gt; workers=<span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//核心线程数,即线程池大小</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> coreSize;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取超时时间数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> timeOut;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TimeUnit timeUnit;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//拒绝策略</span></span><br><span class="line">    <span class="keyword">private</span> RejectPolicy&lt;Runnable&gt; rejectPolicy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 传入一个任务,并执行任务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable task)</span></span>&#123;</span><br><span class="line">        <span class="comment">//1.当任务数没有超过coreSize时，直接交给worker对象执行</span></span><br><span class="line">        <span class="comment">//2.当任务数超过coreSize时，加入任务队列暂存</span></span><br><span class="line">        <span class="keyword">synchronized</span> (workers)&#123;</span><br><span class="line">            <span class="keyword">if</span> (workers.size()&lt;coreSize)&#123;</span><br><span class="line">                Worker worker= <span class="keyword">new</span> Worker(task);</span><br><span class="line">                </span><br><span class="line">                System.out.println(<span class="string">&quot;新增任务&quot;</span>+worker);</span><br><span class="line">                <span class="comment">//添加到线程集合中</span></span><br><span class="line">                workers.add(worker);</span><br><span class="line">                </span><br><span class="line">                worker.start();</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//1.队列满了就死等</span></span><br><span class="line"><span class="comment">//                taskQueue.put(task);</span></span><br><span class="line">                <span class="comment">//2.带超时等待</span></span><br><span class="line">                <span class="comment">//3.放弃任务执行</span></span><br><span class="line">                <span class="comment">//4.让调用自己抛出异常</span></span><br><span class="line">                <span class="comment">//5.让调用者自己执行</span></span><br><span class="line">                taskQueue.tryPut(rejectPolicy,task);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ThreadPool</span><span class="params">(<span class="keyword">int</span> coreSize, <span class="keyword">long</span> timeOut, TimeUnit timeUnit,<span class="keyword">int</span> capacity,RejectPolicy&lt;Runnable&gt; 							rejectPolicy)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.coreSize = coreSize;</span><br><span class="line">        <span class="keyword">this</span>.timeOut = timeOut;</span><br><span class="line">        <span class="keyword">this</span>.timeUnit = timeUnit;</span><br><span class="line">        <span class="keyword">this</span>.taskQueue=<span class="keyword">new</span> BlockingQueue&lt;&gt;(capacity);</span><br><span class="line">        <span class="keyword">this</span>.rejectPolicy=rejectPolicy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Worker</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Runnable task;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Worker</span><span class="params">(Runnable task)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.task = task;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="comment">//执行任务</span></span><br><span class="line">            <span class="comment">//1.当task不为空，执行任务</span></span><br><span class="line">            <span class="comment">//2.当task执行完毕，在接着从任务队列中获取任务并执行</span></span><br><span class="line"><span class="comment">//            while(task !=null ||(task=taskQueue.take())!=null )&#123;</span></span><br><span class="line">            <span class="comment">//超时限制获取策略</span></span><br><span class="line">            <span class="keyword">while</span>(task !=<span class="keyword">null</span> ||(task=taskQueue.poll(timeOut,timeUnit))!=<span class="keyword">null</span> )&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;正在执行&quot;</span>+task);</span><br><span class="line">                    task.run();</span><br><span class="line">                &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                    task=<span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//当任务队列的任务执行完毕时。从线程集合中移除</span></span><br><span class="line">            <span class="keyword">synchronized</span> (workers)&#123;</span><br><span class="line">                workers.remove(<span class="keyword">this</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 阻塞队列</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BlockingQueue</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//1.任务队列(Deque双向队列)_</span></span><br><span class="line">    <span class="keyword">private</span> Deque&lt;T&gt; queue=<span class="keyword">new</span> ArrayDeque&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.锁，线程安全</span></span><br><span class="line">    <span class="keyword">private</span> ReentrantLock lock=<span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.生产者条件变量</span></span><br><span class="line">    <span class="keyword">private</span> Condition fullWaitSet=lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.消费者条件变量</span></span><br><span class="line">    <span class="keyword">private</span> Condition emptyWaitSet=lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.队列容量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> capcity;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BlockingQueue</span><span class="params">(<span class="keyword">int</span> capcity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.capcity = capcity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 带超时的阻塞获取</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">poll</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span></span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//将timeout转化未纳秒</span></span><br><span class="line">            <span class="keyword">long</span> nanos=unit.toNanos(timeout);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (queue.isEmpty())&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (nanos&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//返回是剩余时间</span></span><br><span class="line">                    nanos = emptyWaitSet.awaitNanos(nanos);</span><br><span class="line">                &#125;<span class="keyword">catch</span> (InterruptedException e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//获取队列第一个元素</span></span><br><span class="line">            T t = queue.removeFirst();</span><br><span class="line">            <span class="comment">//唤醒生产者条件变量</span></span><br><span class="line">            fullWaitSet.signal();</span><br><span class="line">            <span class="keyword">return</span> t;</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 阻塞任务获取</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">take</span><span class="params">()</span></span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (queue.isEmpty())&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    emptyWaitSet.await();</span><br><span class="line">                &#125;<span class="keyword">catch</span> (InterruptedException e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//获取队列第一个元素</span></span><br><span class="line">            T t = queue.removeFirst();</span><br><span class="line">            <span class="comment">//唤醒生产者条件变量</span></span><br><span class="line">            fullWaitSet.signal();</span><br><span class="line">            <span class="keyword">return</span> t;</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 带超时的阻塞添加</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 成功true</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">offer</span><span class="params">(T task,<span class="keyword">long</span> timeout,TimeUnit timeUnit)</span></span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//将timeout转化为纳秒</span></span><br><span class="line">            <span class="keyword">long</span> nanos=timeUnit.toNanos(timeout);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (queue.size()==capcity)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;等待加入任务队列&quot;</span>+task);</span><br><span class="line">                    <span class="keyword">if</span> (nanos&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    nanos = fullWaitSet.awaitNanos(nanos);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;加入任务队列&quot;</span>+task);</span><br><span class="line">            queue.addLast(task);</span><br><span class="line">            <span class="comment">//唤醒消费者条件变量</span></span><br><span class="line">            emptyWaitSet.signal();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 阻塞添加</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(T element)</span></span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (queue.size()==capcity)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;等待加入任务队列&quot;</span>+element);</span><br><span class="line">                    fullWaitSet.await();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;加入任务队列&quot;</span>+element);</span><br><span class="line">            queue.addLast(element);</span><br><span class="line">            <span class="comment">//唤醒消费者条件变量</span></span><br><span class="line">            emptyWaitSet.signal();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取大小</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> queue.size();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tryPut</span><span class="params">(RejectPolicy&lt;T&gt; rejectPolicy,T task)</span></span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//判断队列是否已满</span></span><br><span class="line">            <span class="keyword">if</span> (queue.size()==capcity)&#123;</span><br><span class="line">                rejectPolicy.reject(<span class="keyword">this</span>,task);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;加入任务队列&quot;</span>+task);</span><br><span class="line">                queue.addLast(task);</span><br><span class="line">                <span class="comment">//唤醒消费者条件变量</span></span><br><span class="line">                emptyWaitSet.signal();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="2、ThreadPoolExecutor"><a href="#2、ThreadPoolExecutor" class="headerlink" title="2、ThreadPoolExecutor"></a>2、ThreadPoolExecutor</h4><img src="https://csn.damyoung.cn/image-20201005170916502.png" alt="image-20201005170916502" style="zoom:67%;" />



<blockquote>
<p>线程池的顶级接口是<code>Executor</code>,<strong>管理多个异步任务的执行，而无需程序员显式的管理线程的生命周期</strong>。</p>
<p>线程池的顶级接口是<code>Executor</code>,线程池接口是<code>ExecutorService</code></p>
</blockquote>
<h5 id="2-1-线程池状态"><a href="#2-1-线程池状态" class="headerlink" title="2.1  线程池状态"></a>2.1  线程池状态</h5><blockquote>
<p>使用int(4个字节) 的高3位(有符号位)来表示线程状态，低29位表示线程数量</p>
<p><strong>目的:</strong> 存储在一个原子变量ctl中，目的是将线程池状态与线程个数合二为一，这样就可以使用一次CAS原子操作进行赋值。</p>
</blockquote>
<img src="https://csn.damyoung.cn/image-20201005171216379.png" alt="image-20201005171216379" style="zoom:67%;" />

<h5 id="2-2-构造方法以及创建线程方法"><a href="#2-2-构造方法以及创建线程方法" class="headerlink" title="2.2 构造方法以及创建线程方法"></a>2.2 构造方法以及创建线程方法</h5><h6 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="function"><span class="params">                          TimeUnit unit,</span></span></span><br><span class="line"><span class="function"><span class="params">                          BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class="line"><span class="function"><span class="params">                          ThreadFactory threadFactory,</span></span></span><br><span class="line"><span class="function"><span class="params">                          RejectedExecutionHandler handler)</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>corePoolSize 核心线程数目</li>
<li>maximumPoolSize 最大线程数</li>
<li>keepAliveTime  生存时间-针对救急线程</li>
<li>unit 时间单位-针对救急线程</li>
<li>workQueue 阻塞队列</li>
<li>threadFactory 线程工厂-可以为线程创建时起个好名字</li>
<li>handler 拒绝策略</li>
</ul>
<blockquote>
<p>ThreadPoolExecutor 线程池中存在核心线程和救急线程==&gt;最大线程数</p>
<ul>
<li><p>当**阻塞队列满(配合有界队列)**时，又有新任务，才会动用救急线程，救急线程有生存时间。</p>
</li>
<li><p>当救急线程也满时，才会执行<strong>拒绝策略</strong></p>
<p>jdk:</p>
<ul>
<li>AbortPolicy 抛出RejectExecutionException异常，默认策略</li>
<li>CallerRunsPolicy 让调用者运行任务</li>
<li>DiscardPolicy 放弃本次任务</li>
<li>DiscardOldestPolicy 放弃队列中最早的任务，本任务取而代之</li>
</ul>
</li>
</ul>
</blockquote>
<img src="https://csn.damyoung.cn/image-20201005174351695.png" alt="image-20201005174351695" style="zoom: 67%;" />

<h6 id="Executors"><a href="#Executors" class="headerlink" title="Executors"></a>Executors</h6><blockquote>
<p><strong>通过<code>Executor</code>框架的工具类<code>Executors</code>来实现</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">2</span>, <span class="keyword">new</span> ThreadFactory() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AtomicInteger t=<span class="keyword">new</span> AtomicInteger(<span class="number">1</span>);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Thread <span class="title">newThread</span><span class="params">(Runnable r)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Thread(r,<span class="string">&quot;myPool_t&quot;</span>+t.getAndIncrement());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong><code>Executors</code>返回线程池对象的弊端如下：</strong></p>
<ul>
<li><code>FixedThreadPool</code>和<code>SingleThreadExecutor</code>：允许请求的队列长度为<code>Integer.MAX_VALUE</code>，可能堆积大量的请求，从而导致OOM。</li>
<li><code>CacheThreadPool</code>和<code>ScheduledThreadPool</code>：允许创建的线程数量为<code>Integer.MAX_VALUE</code>，可能会创建大量线程，从而导致OOM</li>
</ul>
<h5 id="2-3-四种线程池"><a href="#2-3-四种线程池" class="headerlink" title="2.3 四种线程池"></a>2.3 四种线程池</h5><h6 id="2-3-newFixedThreadPool"><a href="#2-3-newFixedThreadPool" class="headerlink" title="2.3 newFixedThreadPool"></a>2.3 newFixedThreadPool</h6><blockquote>
<p>固定大小的线程池，适用于<strong>任务量已知，相对耗时</strong>的任务</p>
</blockquote>
<p>特点</p>
<ul>
<li>核心线程数==最大线程数(没有救急线程被创建)，因此也无需超时时间</li>
<li>阻塞队列是无界的，可以放任意数量的任务。</li>
<li>当某个线程执行出现异常而结束，线程池会补充一个新的线程</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">2</span>, <span class="keyword">new</span> ThreadFactory() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AtomicInteger t=<span class="keyword">new</span> AtomicInteger(<span class="number">1</span>);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Thread <span class="title">newThread</span><span class="params">(Runnable r)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Thread(r,<span class="string">&quot;myPool_t&quot;</span>+t.getAndIncrement());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">executorService.execute(()-&gt;&#123;</span><br><span class="line">    System.out.println(Thread.currentThread().getName());</span><br><span class="line">&#125;);</span><br><span class="line">executorService.execute(()-&gt;&#123;</span><br><span class="line">    System.out.println(Thread.currentThread().getName());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h6 id="2-4-newCachedThreadPool"><a href="#2-4-newCachedThreadPool" class="headerlink" title="2.4 newCachedThreadPool"></a>2.4 newCachedThreadPool</h6><blockquote>
<p>核心线程数是0，最大线程数是Integer.MAX_VALUE。</p>
<ul>
<li>全部是救急线程(当线程空闲时，60s后会进行回收)</li>
<li>救急线程可以无限创建</li>
</ul>
<p>队列采用SynchronousQueue，没有容量，没有线程来取是放不进去的</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newCachedThreadPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">0</span>, Integer.MAX_VALUE,</span><br><span class="line">                                  <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">                                  <span class="keyword">new</span> SynchronousQueue&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>适用于<strong>任务数比较密集，每个任务执行时间短</strong></p>
</blockquote>
<h6 id="2-5-newSingleThreadExecutor"><a href="#2-5-newSingleThreadExecutor" class="headerlink" title="2.5 newSingleThreadExecutor"></a>2.5 newSingleThreadExecutor</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newSingleThreadExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> FinalizableDelegatedExecutorService</span><br><span class="line">        (<span class="keyword">new</span> ThreadPoolExecutor(<span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">                                <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>保证所有任务的执行顺序按照任务的提交顺序执行</strong>，线程固定为1，多于1时，会放入<strong>无界队列</strong>排队。</p>
<p>任务执行完毕，这唯一的线程也不会被释放</p>
</blockquote>
<p><strong>区别</strong></p>
<ul>
<li>自己创建一个单线程串行执行，执行失败而终止而没有任何补救措施。而线程池还会创建新线程补救</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService executorService = Executors.newSingleThreadExecutor();</span><br><span class="line">executorService.execute(()-&gt;&#123;</span><br><span class="line">    <span class="keyword">int</span> i=<span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">&#125;);</span><br><span class="line">executorService.execute(()-&gt;&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">executorService.execute(()-&gt;&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>Executors.newSingleThreadExecutor 线程数始终为1，<strong>不能修改</strong><ul>
<li>应用装饰器模式，只对外暴露<code>ExecutorService</code>接口，不能调用<code>ThreadPoolExecutor</code>特有方法</li>
</ul>
</li>
<li>Executors.newFixedThreadPool(1)初始时为1，以后<strong>还可以修改</strong><ul>
<li>对外暴露的是<code>ThreadPoolExecutor</code>对象，强转后调用setCorePoolSize等方法进行修改。</li>
</ul>
</li>
</ul>
<h6 id="2-6-任务调度线程池"><a href="#2-6-任务调度线程池" class="headerlink" title="2.6 任务调度线程池"></a>2.6 任务调度线程池</h6><blockquote>
<p><strong>支持定时以及周期性执行任务的需求</strong></p>
</blockquote>
<p>Timer</p>
<blockquote>
<p>java.util.Timer</p>
<p><strong>实现定时功能</strong>，但由于所有的任务都是由同一个线程调度，因此所有任务都是<strong>串行执行</strong>的</p>
<p>同一个时间只能有一个任务在执行，前一个任务的延迟或异常都会影响到之后的任务。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Timer timer=<span class="keyword">new</span> Timer();</span><br><span class="line">TimerTask timerTask1 = <span class="keyword">new</span> TimerTask() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Timer任务1&quot;</span>);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">TimerTask timerTask2 = <span class="keyword">new</span> TimerTask() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Timer任务2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">timer.schedule(timerTask1,<span class="number">1000</span>);</span><br><span class="line">timer.schedule(timerTask2,<span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<p>newScheduledThreadPool</p>
<p><strong>延时执行</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ScheduledExecutorService scheduledExecutorService = Executors.newScheduledThreadPool(<span class="number">2</span>);</span><br><span class="line">scheduledExecutorService.schedule(()-&gt;&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;task1&quot;</span>);</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">&#125;,<span class="number">1</span>, TimeUnit.MILLISECONDS);</span><br><span class="line">scheduledExecutorService.schedule(()-&gt;&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;task1&quot;</span>);</span><br><span class="line">&#125;,<span class="number">1</span>, TimeUnit.MILLISECONDS);</span><br></pre></td></tr></table></figure>

<p><strong>定时执行</strong></p>
<blockquote>
<p>scheduleAtFixedRate   每间隔1s执行</p>
<p>以下例子每隔2s执行</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">scheduledExecutorService.scheduleAtFixedRate(()-&gt;&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;task1&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Thread.sleep(<span class="number">2</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//延时时间，时间间隔，时间单位</span></span><br><span class="line">&#125;,<span class="number">1</span>,<span class="number">1</span>,TimeUnit.SECONDS);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>scheeduleWithFixedRate 会在上一次任务执行完了之后再间隔1s执行</p>
<p>以下例子每隔3s执行</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">scheduledExecutorService.scheduleWithFixedDelay(()-&gt;&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;task1&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Thread.sleep(<span class="number">2</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,<span class="number">1</span>,<span class="number">1</span>,TimeUnit.SECONDS);</span><br></pre></td></tr></table></figure>



<h5 id="2-4-提交任务"><a href="#2-4-提交任务" class="headerlink" title="2.4 提交任务"></a>2.4 提交任务</h5><h6 id="2-4-1-execute"><a href="#2-4-1-execute" class="headerlink" title="2.4.1 execute"></a>2.4.1 execute</h6><blockquote>
<p>void execute(Runnable command)</p>
</blockquote>
<h6 id="2-4-2-submit"><a href="#2-4-2-submit" class="headerlink" title="2.4.2 submit"></a>2.4.2 submit</h6><blockquote>
<p>Funture&lt;&gt; submit(Callable c)</p>
<p>提交任务task,用<strong>返回值Future获得任务执行结果</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line">Future&lt;String&gt; future = executorService.submit(<span class="keyword">new</span> Callable&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ok&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">System.out.println(future.get());</span><br></pre></td></tr></table></figure>

<h6 id="2-4-3-invokeAll"><a href="#2-4-3-invokeAll" class="headerlink" title="2.4.3 invokeAll"></a>2.4.3 invokeAll</h6><blockquote>
<p>提交tasks所有任务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</span><br></pre></td></tr></table></figure>

<p>带超时时间</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,</span><br><span class="line">                              <span class="keyword">long</span> timeout, TimeUnit unit)</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line">List&lt;Future&lt;String&gt;&gt; futures = executorService.invokeAll(Arrays.asList(</span><br><span class="line">        () -&gt; &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        () -&gt; &#123;</span><br><span class="line">            Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;2&quot;</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        () -&gt; &#123;</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;3&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">));</span><br><span class="line">futures.forEach(future-&gt;&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        System.out.println(future.get());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException | ExecutionException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h6 id="2-4-4-invokeAny"><a href="#2-4-4-invokeAny" class="headerlink" title="2.4.4 invokeAny"></a>2.4.4 invokeAny</h6><blockquote>
<p>提交tasks所有任务，哪个任务先成功执行完毕，返回此任务执行结果，其他任务取消</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;T&gt; <span class="function">T <span class="title">invokeAny</span><span class="params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> InterruptedException, ExecutionException</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;T&gt; <span class="function">T <span class="title">invokeAny</span><span class="params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,</span></span></span><br><span class="line"><span class="function"><span class="params">                <span class="keyword">long</span> timeout, TimeUnit unit)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> InterruptedException, ExecutionException, TimeoutException</span>;</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line">Object invokeAny = executorService.invokeAny(Arrays.asList(</span><br><span class="line">        () -&gt; &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        () -&gt; &#123;</span><br><span class="line">            Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;2&quot;</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        () -&gt; &#123;</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;3&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">));</span><br><span class="line">System.out.println(invokeAny.toString()); <span class="comment">//2</span></span><br></pre></td></tr></table></figure>

<h5 id="2-5-关闭线程池"><a href="#2-5-关闭线程池" class="headerlink" title="2.5 关闭线程池"></a>2.5 关闭线程池</h5><h6 id="2-5-1-shutdown"><a href="#2-5-1-shutdown" class="headerlink" title="2.5.1 shutdown"></a>2.5.1 shutdown</h6><blockquote>
<p>线程池状态变为    SHUTDOWN</p>
<ul>
<li>不会接收新任务</li>
<li>但已提交的任务会执行完</li>
<li>该方法不会阻塞调用线程的执行,仅会打断空闲线程</li>
</ul>
<p>void shutdown()</p>
</blockquote>
<h6 id="2-5-2-shutdownNow"><a href="#2-5-2-shutdownNow" class="headerlink" title="2.5.2 shutdownNow"></a>2.5.2 shutdownNow</h6><blockquote>
<p>线程池状态变为    STOP</p>
<ul>
<li>不会接收新任务</li>
<li>会将队列中的任务返回</li>
<li>并用 interrupt 的方式中断正在执行的任务</li>
</ul>
<p>List<Runnable> shutdownNow()</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line">        Future&lt;String&gt; future = executorService.submit(<span class="keyword">new</span> Callable&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;111&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;finish111&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;ok&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        Future&lt;String&gt; future1 = executorService.submit(<span class="keyword">new</span> Callable&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;222&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;finish222&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;ok&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        Future&lt;String&gt; future2 = executorService.submit(<span class="keyword">new</span> Callable&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;333&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;finish333&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;ok&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        System.out.println(<span class="string">&quot;shutdown&quot;</span>);</span><br><span class="line">        executorService.shutdown();</span><br><span class="line"><span class="comment">//        List&lt;Runnable&gt; runnables = executorService.shutdownNow();</span></span><br><span class="line"><span class="comment">//        System.out.println(runnables);</span></span><br></pre></td></tr></table></figure>



<h5 id="2-6-线程池处理线程异常"><a href="#2-6-线程池处理线程异常" class="headerlink" title="2.6 线程池处理线程异常"></a>2.6 线程池处理线程异常</h5><blockquote>
<ul>
<li>try-catch任务自身处理异常</li>
<li>使用Callable得到返回结果，会将异常信息<strong>封装在future对象中</strong></li>
</ul>
</blockquote>
<h4 id="3、Fork-join-线程池"><a href="#3、Fork-join-线程池" class="headerlink" title="3、Fork/join 线程池"></a>3、Fork/join 线程池</h4><blockquote>
<p>jdk1.7 的线程池实现</p>
<ul>
<li><p>体现分治思想，适用于能够进行<strong>任务拆分的cpu密集运算</strong>，默认创建与cpu核心数大小的线程池</p>
</li>
<li><p>任务拆分：将一个大任务拆分为算法上相同的小任务，直至不能拆分可以直接求解</p>
<p><strong>将每个任务的分解和合并交给不同的线程来完成，进一步提升运算效率</strong></p>
</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    ForkJoinPool pool=<span class="keyword">new</span> ForkJoinPool(<span class="number">4</span>);</span><br><span class="line">    System.out.println(pool.invoke(<span class="keyword">new</span> MyTask(<span class="number">5</span>)));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//继承RecursiveTask&lt;返回值类型&gt; 递归task</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTask</span> <span class="keyword">extends</span> <span class="title">RecursiveTask</span>&lt;<span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> n;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyTask</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.n = n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Integer <span class="title">compute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//终止条件</span></span><br><span class="line">        <span class="keyword">if</span> (n==<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        MyTask t1=<span class="keyword">new</span> MyTask(n-<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//让一个线程执行此任务</span></span><br><span class="line">        <span class="comment">//拆分</span></span><br><span class="line">        t1.fork();</span><br><span class="line">        <span class="comment">//合并</span></span><br><span class="line">        <span class="keyword">int</span> result=n+t1.join();</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="八、J-U-C"><a href="#八、J-U-C" class="headerlink" title="八、J.U.C"></a>八、J.U.C</h3><blockquote>
<p>java.util.concurrent并发包</p>
</blockquote>
<h4 id="1、AQS"><a href="#1、AQS" class="headerlink" title="1、AQS"></a>1、AQS</h4><blockquote>
<p>AbstractQueuedSynchronizer</p>
</blockquote>
<blockquote>
<p><strong>同步器：</strong>用来构建<strong>阻塞式锁和其他同步组件</strong>的基本框架，通过<strong>FIFO等待队列</strong>来完成获取资源线程排队工作</p>
<p>条件变量来实现等待、唤醒机制，支持多个条件变量，类似于Monitor的WaitSet</p>
</blockquote>
<p><strong>特点</strong></p>
<blockquote>
<p><code>AQS</code>使用一个<code>int</code>成员变量来表示同步状态，通过内置的<code>FIFO</code>队列来完成获取资源线程的排队工作。<code>AQS</code>使用<code>CAS</code>对该同步状态进行原子操作实现对其值的修改。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> state;<span class="comment">//共享变量，使用volatile修饰保证线程可见性</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>getState、setState、compareAndSetState这三个方法对同步状态（独占和共享）进行更改</p>
<p>通过<strong>getState,setState以及compareAndSetState</strong>这三个方法对同步状态进行更改</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回同步状态的当前值</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">getState</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br><span class="line"> <span class="comment">// 设置同步状态的值</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">setState</span><span class="params">(<span class="keyword">int</span> newState)</span> </span>&#123; </span><br><span class="line">        state = newState;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//原子地（CAS操作）将同步状态值设置为给定值update（如果当前同步状态的值等于expect（期望值））</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">compareAndSetState</span><span class="params">(<span class="keyword">int</span> expect, <span class="keyword">int</span> update)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> STATE.compareAndSet(<span class="keyword">this</span>, expect, update);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li>同步器提供的模板方法基本上分为3类：<ul>
<li>独占式获取与释放同步状态 ReentrantLock</li>
<li>共享式获取与释放同步状态,多个线程可同时执行 Semaphore CountdownLatch</li>
<li>查询同步队列中的等待线程情况。</li>
</ul>
</li>
</ul>
<h5 id="1-1-方法"><a href="#1-1-方法" class="headerlink" title="1.1 方法"></a>1.1 方法</h5><ul>
<li>tryAcquire(arg)  获取锁</li>
<li>tryRelease(arg) 释放锁</li>
</ul>
<h5 id="1-2-自定义锁"><a href="#1-2-自定义锁" class="headerlink" title="1.2 自定义锁"></a>1.2 自定义锁</h5><img src="http://qiniu.xiaoming.net.cn/AQS独占锁的实现" alt="AQS 独占锁的实现" style="zoom:80%;" />

<p><strong>AQS使用了模板方法模式，自定义同步器时需要重写下面几个AQS提供的模板方法：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">isHeldExclusively()<span class="comment">//该线程是否正在独占资源。只有用到condition才需要去实现它。</span></span><br><span class="line">tryAcquire(<span class="keyword">int</span>)<span class="comment">//独占方式。尝试获取资源，成功则返回true，失败则返回false。</span></span><br><span class="line">tryRelease(<span class="keyword">int</span>)<span class="comment">//独占方式。尝试释放资源，成功则返回true，失败则返回false。</span></span><br><span class="line">tryAcquireShared(<span class="keyword">int</span>)<span class="comment">//共享方式。尝试获取资源。负数表示失败；0表示成功，但没有剩余可用资源；正数表示成功，且有剩余资源。</span></span><br><span class="line">tryReleaseShared(<span class="keyword">int</span>)<span class="comment">//共享方式。尝试释放资源，成功则返回true，失败则返回false。</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestAqs</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyLock myLock=<span class="keyword">new</span> MyLock();</span><br><span class="line">        <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">            myLock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">&quot;lock1&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                myLock.unlock();</span><br><span class="line">                System.out.println(<span class="string">&quot;unlock1&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;T1&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">            myLock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">&quot;lock2&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                myLock.unlock();</span><br><span class="line">                System.out.println(<span class="string">&quot;unlock2&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;T2&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//自定义不可重入锁</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyLock</span> <span class="keyword">implements</span> <span class="title">Lock</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//继承同步器类</span></span><br><span class="line">    <span class="comment">//独占锁</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MySync</span> <span class="keyword">extends</span> <span class="title">AbstractQueuedSynchronizer</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (compareAndSetState(<span class="number">0</span>,<span class="number">1</span>))&#123;</span><br><span class="line">                <span class="comment">//成功，加上了锁，并且设置 owner 为当前线程</span></span><br><span class="line">                setExclusiveOwnerThread(Thread.currentThread());</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">tryRelease</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">            setExclusiveOwnerThread(<span class="keyword">null</span>);</span><br><span class="line">            setState(<span class="number">0</span>); <span class="comment">//state被volatile,写屏障</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span>  <span class="comment">//是否持有独占锁</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">isHeldExclusively</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> getState()==<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Condition <span class="title">newCondition</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ConditionObject();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MySync sync=<span class="keyword">new</span> MySync();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//调用同步器</span></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">//加锁,不成功会进入等待队列等待</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        sync.acquire(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">//加锁可打断</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lockInterruptibly</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        sync.acquireInterruptibly(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>   <span class="comment">//尝试加锁</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sync.tryAcquire(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">//带超时时间的加锁	</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">(<span class="keyword">long</span> time, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sync.tryAcquireNanos(<span class="number">1</span>,unit.toNanos(time));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        sync.release(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">//创建条件变量</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Condition <span class="title">newCondition</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sync.newCondition();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="2、ReentrantLock"><a href="#2、ReentrantLock" class="headerlink" title="2、ReentrantLock"></a>2、ReentrantLock</h4><blockquote>
<p>见 3.7 ReentrantLock 和 十、锁</p>
</blockquote>
<h4 id="3、ReetrantReadWriteLock"><a href="#3、ReetrantReadWriteLock" class="headerlink" title="3、ReetrantReadWriteLock"></a>3、ReetrantReadWriteLock</h4><blockquote>
<p>读写锁，见 10.3 读写锁</p>
</blockquote>
<h5 id="3-1-应用于数据库缓存"><a href="#3-1-应用于数据库缓存" class="headerlink" title="3.1 应用于数据库缓存"></a>3.1 应用于数据库缓存</h5><blockquote>
<ul>
<li>对数据库的读写操作+上读写锁保护</li>
<li>构造HashMap集合，存储缓存。</li>
</ul>
</blockquote>
<p><strong>存在的问题：</strong></p>
<h6 id="1、先更新缓存"><a href="#1、先更新缓存" class="headerlink" title="1、先更新缓存"></a>1、先更新缓存</h6><blockquote>
<p>会出现在缓存拿到的都是旧数据</p>
</blockquote>
<img src="https://csn.damyoung.cn/image-20201008132757774.png" alt="image-20201008132757774" style="zoom:67%;" />

<h6 id="2、先更新数据库"><a href="#2、先更新数据库" class="headerlink" title="2、先更新数据库"></a>2、先更新数据库</h6><img src="https://csn.damyoung.cn/image-20201008132813721.png" alt="image-20201008132813721" style="zoom:67%;" />

<h5 id="3-2-StampedLock"><a href="#3-2-StampedLock" class="headerlink" title="3.2 StampedLock"></a>3.2 StampedLock</h5><blockquote>
<p>进一步优化读性能，在使用时读锁、写锁都必须配合【戳】使用</p>
</blockquote>
<h4 id="4、线程安全集合类"><a href="#4、线程安全集合类" class="headerlink" title="4、线程安全集合类"></a>4、线程安全集合类</h4><blockquote>
<ul>
<li>遗留- vertor(list)、HashTable</li>
<li>修饰-SynchronizedMap、SynchronizedList(使用Collections方法修饰)-内部还是使用Synchronized</li>
<li>JUC<ul>
<li>Blocking类(实现基于锁，并提供用来阻塞的方法来保证线程安全)</li>
<li>CopyOnWrite类(适用于读多写少)、</li>
<li>Concurrent类-使用<strong>CAS优化</strong>,性能较好，但会存在<strong>弱一致性(可能会读取到旧数据)</strong>(遍历时、size)</li>
</ul>
</li>
</ul>
</blockquote>
<h5 id="4-1-ConcurrentHashMap"><a href="#4-1-ConcurrentHashMap" class="headerlink" title="4.1 ConcurrentHashMap"></a>4.1 ConcurrentHashMap</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcurrentHashMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">ConcurrentMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ConcurrentMap</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">Map</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; </span>&#123;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>computeIfAbsent()  如果缺少key,则产生新value，并放入Map</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LongAdder value=<span class="keyword">new</span> ConcurrentHashMap&lt;String,LongAdder&gt;().computeIfAbsent( ,(key)-&gt;<span class="keyword">new</span> LongAdder());</span><br><span class="line">value.increment();</span><br></pre></td></tr></table></figure>



<p><strong>原理</strong></p>
<h6 id="4-1-1-HashMap并发死链"><a href="#4-1-1-HashMap并发死链" class="headerlink" title="4.1.1 HashMap并发死链"></a>4.1.1 HashMap并发死链</h6><blockquote>
<p>在jdk7下的，多线程环境下使用非线程安全的map集合，扩容之后产生的<strong>并发死链</strong>问题</p>
<ul>
<li>hashMap根据哈希算法计算数据存储的桶位置，桶位置相同的形成链表<ul>
<li>jdk7-新加入放在第一个</li>
<li>jdk8-新加入放在最后个</li>
</ul>
</li>
<li>多线程形成并发死链问题，在某个桶链表形成环形链表。</li>
</ul>
</blockquote>
<h5 id="4-2-LinkedBlockingQueue"><a href="#4-2-LinkedBlockingQueue" class="headerlink" title="4.2 LinkedBlockingQueue"></a>4.2 LinkedBlockingQueue</h5><blockquote>
<p>Dummy无值，只是个占位节点</p>
</blockquote>
<h6 id="入队"><a href="#入队" class="headerlink" title="入队"></a>入队</h6><img src="https://csn.damyoung.cn/image-20201008221014801.png" alt="image-20201008221014801" style="zoom:67%;" />

<h6 id="出队"><a href="#出队" class="headerlink" title="出队"></a>出队</h6><h6 id="加锁分析"><a href="#加锁分析" class="headerlink" title="加锁分析"></a>加锁分析</h6><blockquote>
<p><strong>使用Dummy占位符和俩把锁</strong></p>
<ul>
<li>用一把锁：同一时刻，最多只允许有一个线程(生产者和消费者二选一)执行</li>
<li>俩把锁： 同一时刻，可以允许俩个线程同时执行(一个生产者与一个消费者)<ul>
<li>生产者与生产者仍然串行</li>
<li>消费者与消费者仍然串行</li>
</ul>
</li>
</ul>
</blockquote>
<p><strong>线程安全分析</strong></p>
<blockquote>
<p>putLock保证last节点的线程，takeLock保证head节点的线程安全</p>
</blockquote>
<ul>
<li>节点大于2(包括Dummy占位节点)，俩把锁保证入队与出队没有竞争</li>
<li>等于2(一个Dummy节点，一个正常节点)，仍然是俩把锁锁住俩个对象，不会竞争</li>
<li>等于1，take线程会被notEmpty条件阻塞，有竞争，会阻塞。</li>
</ul>
<h5 id="4-3-ArrayBlockingQueue"><a href="#4-3-ArrayBlockingQueue" class="headerlink" title="4.3 ArrayBlockingQueue"></a>4.3 ArrayBlockingQueue</h5><ul>
<li><p>Linked支持有界，Array强制有界</p>
</li>
<li><p>Array需要提前初始化Node数组，入队Node是提前创建好的。</p>
<p>Linked是懒惰的，入队会生成新的Node</p>
</li>
<li><p>Linked俩把锁，Array一把锁。</p>
</li>
</ul>
<h5 id="4-4-ConcurrentLinkedQueue"><a href="#4-4-ConcurrentLinkedQueue" class="headerlink" title="4.4 ConcurrentLinkedQueue"></a>4.4 ConcurrentLinkedQueue</h5><blockquote>
<p>类似LinkedBlockingQueue，<strong>都是使用俩把【锁】,使用的CAS实现，应用于并发要求更多的场景</strong></p>
</blockquote>
<blockquote>
<p>应用于Tomcat的Connector结构。</p>
</blockquote>
<h5 id="4-5-CopyOnWriterArrayList"><a href="#4-5-CopyOnWriterArrayList" class="headerlink" title="4.5 CopyOnWriterArrayList"></a>4.5 CopyOnWriterArrayList</h5><img src="https://csn.damyoung.cn/image-20201008224232404.png" alt="image-20201008224232404" style="zoom:67%;" />

<blockquote>
<p><strong>写入时拷贝</strong>，<strong>增删改即写操作</strong>会将底层数组拷贝一份，更改操作在新数组上执行</p>
<p>这时不影响其他线程的<strong>并发读，读写分离(并发 读写)</strong></p>
<ul>
<li>读写操作，读操作都未加锁</li>
</ul>
</blockquote>
<img src="https://csn.damyoung.cn/image-20201008224318927.png" alt="image-20201008224318927" style="zoom:67%;" />



<h4 id="5、Semaphore"><a href="#5、Semaphore" class="headerlink" title="5、Semaphore"></a>5、Semaphore</h4><blockquote>
<p>信号量，用来限制能<strong>同时访问共享资源</strong>的<strong>线程</strong>上限</p>
<p><strong>ps：</strong>限制线程数，而不是限制资源数(Tomcat LimitLatch)。</p>
</blockquote>
<blockquote>
<p>也是实现AQS同步器</p>
<p>Semaphore 有两种模式，公平模式和非公平模式。</p>
<ul>
<li>公平模式： 调用<code>acquire</code>的顺序就是获取许可证的顺序，遵循<code>FIFO</code>；</li>
<li>非公平模式： 抢占式的。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Semaphore</span><span class="params">(<span class="keyword">int</span> permits)</span> </span>&#123;</span><br><span class="line">    sync = <span class="keyword">new</span> NonfairSync(permits);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Semaphore</span><span class="params">(<span class="keyword">int</span> permits, <span class="keyword">boolean</span> fair)</span> </span>&#123;</span><br><span class="line">    sync = fair ? <span class="keyword">new</span> FairSync(permits) : <span class="keyword">new</span> NonfairSync(permits);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建Semaphore对象(限制线程数,fair?)</span></span><br><span class="line">Semaphore semaphore = <span class="keyword">new</span> Semaphore(<span class="number">3</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;<span class="number">10</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//添加许可，默认一次只用掉一个信号量，也可以参数传多个  </span></span><br><span class="line">            semaphore.acquire();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;running...&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;end&quot;</span>);</span><br><span class="line">            <span class="comment">//释放许可</span></span><br><span class="line">            semaphore.release();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,<span class="string">&quot;&quot;</span>+i).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="6、CountdownLatch"><a href="#6、CountdownLatch" class="headerlink" title="6、CountdownLatch"></a>6、CountdownLatch</h4><blockquote>
<p>用来进行线程同步协作，等待所有线程完成倒计时</p>
<p>其中构造方法用来初始化等待计数值，await()等待计数归零，countDown() 用来让计数–</p>
</blockquote>
<h5 id="6-1-使用"><a href="#6-1-使用" class="headerlink" title="6.1 使用"></a>6.1 使用</h5><blockquote>
<p>内部维护了一个计数器<code>cnt</code>，每次调用<code>countDown()</code>方法会让计数器的值减1，减到0的时候，它表示所有的线程已经完成了任务，然后在闭锁上等待的线程就可以恢复执行任务,那些之前调用<code>await()</code>方法而在等待的线程就会被唤醒。</p>
</blockquote>
<p><strong>不足</strong></p>
<p><code>CountDownLatch</code>是一次性的，计数器的值只能在构造方法中初始化一次，之后没有任何机制再次对其设置值，当<code>CountDownLatch</code>使用完毕后，它不能再次被使用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">CountDownLatch latch=<span class="keyword">new</span> CountDownLatch(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;t1.begin..&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    latch.countDown();</span><br><span class="line">    System.out.println(<span class="string">&quot;t1.end&quot;</span>);</span><br><span class="line">&#125;).start();</span><br><span class="line"><span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;t2.begin..&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    latch.countDown();</span><br><span class="line">    System.out.println(<span class="string">&quot;t2.end&quot;</span>);</span><br><span class="line">&#125;).start();</span><br><span class="line"><span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;t3.begin..&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    latch.countDown();</span><br><span class="line">    System.out.println(<span class="string">&quot;t3.end..&quot;</span>);</span><br><span class="line">&#125;).start();</span><br><span class="line">System.out.println(<span class="string">&quot;waiting..&quot;</span>);</span><br><span class="line">latch.await();</span><br><span class="line">System.out.println(<span class="string">&quot;..end&quot;</span>);</span><br></pre></td></tr></table></figure>

<h5 id="6-2-配合线程池使用"><a href="#6-2-配合线程池使用" class="headerlink" title="6.2 配合线程池使用"></a>6.2 配合线程池使用</h5><blockquote>
<p>等待多个远程调用结束</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService pool = Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line">CountDownLatch latch=<span class="keyword">new</span> CountDownLatch(<span class="number">10</span>);</span><br><span class="line">Random r=<span class="keyword">new</span> Random();</span><br><span class="line">String[] all =<span class="keyword">new</span> String[<span class="number">10</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;<span class="number">10</span> ; j++) &#123;</span><br><span class="line">    <span class="keyword">int</span> k=j;</span><br><span class="line">    pool.execute(()-&gt;&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">100</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(r.nextInt(<span class="number">100</span>));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            all[k]=i+<span class="string">&quot;%&quot;</span>;</span><br><span class="line">            <span class="comment">//在同一行变化。</span></span><br><span class="line">            System.out.print(<span class="string">&quot;\r&quot;</span>+ Arrays.toString(all));</span><br><span class="line">        &#125;</span><br><span class="line">        latch.countDown();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">latch.await();</span><br><span class="line">System.out.println(<span class="string">&quot;游戏开始&quot;</span>);</span><br><span class="line">pool.shutdown();</span><br></pre></td></tr></table></figure>



<h4 id="7、Cyclicbarrier"><a href="#7、Cyclicbarrier" class="headerlink" title="7、Cyclicbarrier"></a>7、Cyclicbarrier</h4><blockquote>
<p>循环栅栏，用来进行线程协作，等待线程满足某个计数。</p>
<ul>
<li>计数可以恢复，无需重新创建对象</li>
<li>存在的问题：<strong>线程数和计数值要一致</strong></li>
</ul>
<p>构造时设置计数个数， await()计数-1</p>
<p><code>CyclicBarrier</code>有两个构造函数，其中<code>parties</code>指示计数器的初始值，<code>barrierAction</code>在所有线程都到达屏障的时候会执行一次。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService pool = Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line">CyclicBarrier barrier=<span class="keyword">new</span> CyclicBarrier(<span class="number">2</span>,()-&gt;&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;task1,task2,finish..&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//若线程数为3</span></span><br><span class="line"><span class="comment">//task1,taks2,task1</span></span><br><span class="line"><span class="comment">//由于task1(1s) task2(2s),会导致是俩次task1减去计数。</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">    pool.submit(()-&gt;&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;t1.begin..&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            <span class="comment">//计数-1</span></span><br><span class="line">            barrier.await();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException | BrokenBarrierException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;t1.end&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    pool.submit(()-&gt;&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;t2.begin..&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">            barrier.await();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException | BrokenBarrierException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;t2.end&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">pool.shutdown();</span><br></pre></td></tr></table></figure>



<h4 id="8、CyclicBarrier和CountDownLatch的区别"><a href="#8、CyclicBarrier和CountDownLatch的区别" class="headerlink" title="8、CyclicBarrier和CountDownLatch的区别"></a>8、CyclicBarrier和CountDownLatch的区别</h4><ul>
<li><p><code>CountDownLatch</code>是计数器，只能使用一次，而<code>CyclicBarrier</code>计数器提供了<code>reset</code>方法，可以多次使用。</p>
</li>
<li><p><code>CountDownLatch</code>的设计思想强调的是一个（多个）线程等待其他线程执行完成后才能执行</p>
<p><code>CyclicBarrier</code>则是强调要多个线程都到达某一个条件，才能一起执行后续步骤。</p>
</li>
</ul>
<h4 id="9、FutureTask"><a href="#9、FutureTask" class="headerlink" title="9、FutureTask"></a>9、FutureTask</h4><p><code>Callable</code>接口它可以有返回值，返回值通过<code>Future</code>进行封装。<code>FutureTask</code>实现了<code>RunnableFuture</code>接口，该接口继承自<code>Runnable</code>和<code>Future</code>接口，这使得<code>FutureTask</code>既可以当做一个任务执行，也可以有返回值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FutureTask</span>&lt;<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">RunnableFuture</span>&lt;<span class="title">V</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">interface</span> <span class="title">RunnableFuture</span>&lt;<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">Runnable</span>, <span class="title">Future</span>&lt;<span class="title">V</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>FutureTask</code>适用于<strong>异步获取执行结果或取消执行任务</strong>的场景。当一个任务需要执行很久时，就可以使用<code>FutureTask</code>进行封装，主线程在完成自己的任务后再回来获取结果。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FutureTaskExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">        FutureTask&lt;Integer&gt; futureTask = <span class="keyword">new</span> FutureTask&lt;Integer&gt;(<span class="keyword">new</span> Callable&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">10</span>);</span><br><span class="line">                    result += i;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        Thread computeThread = <span class="keyword">new</span> Thread(futureTask);</span><br><span class="line">        computeThread.start();</span><br><span class="line"></span><br><span class="line">        Thread otherThread = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;other task is running...&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        otherThread.start();</span><br><span class="line">        System.out.println(futureTask.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="九、多线程设计模式"><a href="#九、多线程设计模式" class="headerlink" title="九、多线程设计模式"></a>九、多线程设计模式</h3><h4 id="1、俩阶段终止模式"><a href="#1、俩阶段终止模式" class="headerlink" title="1、俩阶段终止模式"></a>1、俩阶段终止模式</h4><h5 id="1-1-interrupt"><a href="#1-1-interrupt" class="headerlink" title="1.1 interrupt"></a>1.1 interrupt</h5><ul>
<li>当出现打断标志时，会将中断标志置为true</li>
<li>sleep时被打断，会抛出<code>interruptException</code>,并需要重新设置打断标志，在下次while循环中退出</li>
</ul>
<img src="C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20201008224824308.png" alt="image-20201008224824308" style="zoom:67%;" />

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MonitorInterrupt</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        TwpPhaseTermination twpPhaseTermination = <span class="keyword">new</span> TwpPhaseTermination();</span><br><span class="line">        twpPhaseTermination.start();</span><br><span class="line">        Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;设置中断标志&quot;</span>);</span><br><span class="line">        twpPhaseTermination.stop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TwpPhaseTermination</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Thread monitor;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//启动监控线程</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span></span>&#123;</span><br><span class="line">        monitor=<span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">                <span class="keyword">boolean</span> interrupted = Thread.currentThread().isInterrupted();</span><br><span class="line">                <span class="keyword">if</span> (interrupted)&#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;中断标志为true,中断线程&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//中断标志为false.进入睡眠</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    <span class="comment">//在sleep时被打断会抛出异常</span></span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//重新设置标志,抛出异常时标志会消失，需要重新设置</span></span><br><span class="line">                Thread.currentThread().interrupt();</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        monitor.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//停止监控线程</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span></span>&#123;</span><br><span class="line">        monitor.interrupt();</span><br><span class="line">        System.out.println(<span class="string">&quot;中断线程&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="1-2-volatile"><a href="#1-2-volatile" class="headerlink" title="1.2 volatile"></a>1.2 volatile</h5><blockquote>
<p><strong>利用volatile的可见性进行改进</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TwpPhaseTermination</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Thread monitor;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> stop=<span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//启动监控线程</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span></span>&#123;</span><br><span class="line">        monitor=<span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span> (stop)&#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;标志为true,中断线程&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//中断标志为false.进入睡眠</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    <span class="comment">//在sleep时被打断会抛出异常</span></span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;monitor&quot;</span>);</span><br><span class="line">        monitor.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//停止监控线程</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span></span>&#123;</span><br><span class="line">        stop=<span class="keyword">true</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;中断线程&quot;</span>);</span><br><span class="line">        monitor.interrupt();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="2、同步保护性暂停"><a href="#2、同步保护性暂停" class="headerlink" title="2、同步保护性暂停"></a>2、同步保护性暂停</h4><blockquote>
<p>Guarded Suspension ，<strong>用在一个线程等待另一个线程的结果</strong></p>
<ul>
<li>有<strong>一个结果</strong>从一个线程传递到另一个线程，让他们关联同一个<code>GuardedObject</code></li>
<li>有结果<strong>不断</strong>的从一个线程传递到另一个线程，使用消息队列(生产者消费者)</li>
</ul>
</blockquote>
<img src="https://csn.damyoung.cn/image-20201009210302949.png" alt="image-20201009210302949" style="zoom:67%;" />

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GuardObjectDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        GuardObject g=<span class="keyword">new</span> GuardObject();</span><br><span class="line">        <span class="comment">//等待线程2结果</span></span><br><span class="line">        <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;线程1开始&quot;</span>);</span><br><span class="line">            <span class="comment">//等待结果</span></span><br><span class="line">            System.out.println(g.get());</span><br><span class="line">        &#125;,<span class="string">&quot;线程1&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;线程2开始&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            g.complete(<span class="string">&quot;response&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;线程2执行complete&quot;</span>);</span><br><span class="line">        &#125;,<span class="string">&quot;线程2&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GuardObject</span></span>&#123;</span><br><span class="line">    <span class="comment">//结果</span></span><br><span class="line">    <span class="keyword">private</span> Object response;</span><br><span class="line">    <span class="comment">//获取结果</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>)&#123;</span><br><span class="line">            <span class="comment">//没有结果</span></span><br><span class="line">            <span class="keyword">while</span> (response==<span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">this</span>.wait();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> response;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//产生结果</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">complete</span><span class="params">(Object response)</span></span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>)&#123;</span><br><span class="line">            <span class="keyword">this</span>.response=response;</span><br><span class="line">            <span class="keyword">this</span>.notifyAll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="3、生产者-消费者模式"><a href="#3、生产者-消费者模式" class="headerlink" title="3、生产者/消费者模式"></a>3、生产者/消费者模式</h4><img src="https://csn.damyoung.cn/image-20201003095739174.png" alt="image-20201003095739174" style="zoom:80%;" />

<blockquote>
<ul>
<li>生产者负责产生结果数据，不关心数据该如何处理。消费者专心处理结果数据</li>
<li>消息队列有<strong>容量限制</strong>，满时不会再加入数据，空时不会再消耗数据</li>
<li>JDK各种阻塞队列，采用的就是这种模式</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> admin</span></span><br><span class="line"><span class="comment"> *  生产者消费者模式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConConsumDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MessageQueue messageQueue=<span class="keyword">new</span> MessageQueue(<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">int</span> id=i;</span><br><span class="line">            <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">                messageQueue.put(<span class="keyword">new</span> Message(id,<span class="string">&quot;值&quot;</span>+id));</span><br><span class="line">            &#125;,<span class="string">&quot;生产者&quot;</span>).start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//消费者</span></span><br><span class="line">        <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(messageQueue.take());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 消息队列类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MessageQueue</span></span>&#123;</span><br><span class="line">    <span class="comment">//消息队列集合,实现双向队列</span></span><br><span class="line">    <span class="keyword">private</span> LinkedList&lt;Message&gt; linkedList=<span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">    <span class="comment">//队列容量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> capacity;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MessageQueue</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.capacity = capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取消息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Message <span class="title">take</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//检查队列是否为空</span></span><br><span class="line">        <span class="keyword">synchronized</span> (linkedList)&#123;</span><br><span class="line">            <span class="keyword">while</span> (linkedList.isEmpty())&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    linkedList.wait();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            Message message = linkedList.removeFirst();</span><br><span class="line">            <span class="comment">//唤醒put中wait</span></span><br><span class="line">            linkedList.notifyAll();</span><br><span class="line">            <span class="keyword">return</span> message;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//存入消息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(Message message)</span></span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (linkedList)&#123;</span><br><span class="line">            <span class="comment">//检查队列已经满</span></span><br><span class="line">            <span class="keyword">while</span> (linkedList.size()==capacity)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    linkedList.wait();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            linkedList.addLast(message);</span><br><span class="line">            linkedList.notifyAll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Message</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> Object value;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Message</span><span class="params">(<span class="keyword">int</span> id, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Message&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, value=&quot;</span> + value +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="4、同步之顺序控制"><a href="#4、同步之顺序控制" class="headerlink" title="4、同步之顺序控制"></a>4、同步之顺序控制</h4><h5 id="4-1-wait-notify"><a href="#4-1-wait-notify" class="headerlink" title="4.1 wait/notify"></a>4.1 wait/notify</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> Object lock=<span class="keyword">new</span> Object();</span><br><span class="line"><span class="comment">//表示t2是否运行过</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">boolean</span> t2runned=<span class="keyword">false</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Thread t1=<span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock)&#123;</span><br><span class="line">            <span class="keyword">while</span> (!t2runned)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    lock.wait();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;t1&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,<span class="string">&quot;t1&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Thread t2 = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;t2&quot;</span>);</span><br><span class="line">            t2runned=<span class="keyword">true</span>;</span><br><span class="line">            lock.notifyAll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="string">&quot;t2&quot;</span>);</span><br><span class="line"></span><br><span class="line">    t1.start();</span><br><span class="line">    t2.start();</span><br></pre></td></tr></table></figure>

<h5 id="4-2-park-unpark"><a href="#4-2-park-unpark" class="headerlink" title="4.2 park/unpark"></a>4.2 park/unpark</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Thread t1=<span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">    LockSupport.park();</span><br><span class="line">    System.out.println(<span class="string">&quot;t1&quot;</span>);</span><br><span class="line">&#125;,<span class="string">&quot;t1&quot;</span>);</span><br><span class="line"></span><br><span class="line">Thread t2 = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;t2&quot;</span>);</span><br><span class="line">    LockSupport.unpark(t1);</span><br><span class="line">&#125;, <span class="string">&quot;t2&quot;</span>);</span><br><span class="line"></span><br><span class="line">t1.start();</span><br><span class="line">t2.start();</span><br></pre></td></tr></table></figure>

<h5 id="4-4-await-signal"><a href="#4-4-await-signal" class="headerlink" title="4.4 await/signal"></a>4.4 await/signal</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">ReentrantLock lock=<span class="keyword">new</span> ReentrantLock();</span><br><span class="line">Condition condition = lock.newCondition();</span><br><span class="line">Thread t1=<span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        condition.await();</span><br><span class="line">        System.out.println(<span class="string">&quot;t1&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,<span class="string">&quot;t1&quot;</span>);</span><br><span class="line"></span><br><span class="line">Thread t2 = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;t2&quot;</span>);</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        condition.signal();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="string">&quot;t2&quot;</span>);</span><br><span class="line"></span><br><span class="line">t1.start();</span><br><span class="line">t2.start();</span><br></pre></td></tr></table></figure>



<h4 id="5、交替输出"><a href="#5、交替输出" class="headerlink" title="5、交替输出"></a>5、交替输出</h4><h5 id="wait-notify"><a href="#wait-notify" class="headerlink" title="wait/notify"></a>wait/notify</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WaitNotify</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        WaitNotify waitNotify=<span class="keyword">new</span> WaitNotify(<span class="number">1</span>,<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">            waitNotify.print(<span class="string">&quot;a&quot;</span>,<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">            waitNotify.print(<span class="string">&quot;b&quot;</span>,<span class="number">2</span>,<span class="number">3</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">            waitNotify.print(<span class="string">&quot;c&quot;</span>,<span class="number">3</span>,<span class="number">1</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//打印</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(String str,<span class="keyword">int</span> waitFlag,<span class="keyword">int</span> nextFlag)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;loopNumber; i++) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (<span class="keyword">this</span>)&#123;</span><br><span class="line">                <span class="keyword">while</span> (flag!=waitFlag)&#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">this</span>.wait();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.print(str);</span><br><span class="line">                <span class="comment">//改变等待标记</span></span><br><span class="line">                flag=nextFlag;</span><br><span class="line">                <span class="keyword">this</span>.notifyAll();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//等待标记</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> flag;</span><br><span class="line">    <span class="comment">//循环次数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> loopNumber;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WaitNotify</span><span class="params">(<span class="keyword">int</span> flag, <span class="keyword">int</span> loopNumber)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.flag = flag;</span><br><span class="line">        <span class="keyword">this</span>.loopNumber = loopNumber;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="await-signal"><a href="#await-signal" class="headerlink" title="await/signal"></a>await/signal</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AwaitSignal</span> <span class="keyword">extends</span> <span class="title">ReentrantLock</span> </span>&#123;</span><br><span class="line">    <span class="comment">//循环次数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> loopNumber;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AwaitSignal</span><span class="params">(<span class="keyword">int</span> loopNumber)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.loopNumber = loopNumber;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> str   打印的内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> current   条件变量</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> next  下个条件变量</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(String str,Condition current,Condition next)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;loopNumber; i++) &#123;</span><br><span class="line">            lock();</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                current.await();</span><br><span class="line">                System.out.print(str);</span><br><span class="line">                next.signal();</span><br><span class="line">            &#125;<span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">AwaitSignal awaitSignal=<span class="keyword">new</span> AwaitSignal(<span class="number">5</span>);</span><br><span class="line">Condition a=awaitSignal.newCondition();</span><br><span class="line">Condition b=awaitSignal.newCondition();</span><br><span class="line">Condition c=awaitSignal.newCondition();</span><br><span class="line"><span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">    awaitSignal.print(<span class="string">&quot;a&quot;</span>,a,b);</span><br><span class="line">&#125;).start();</span><br><span class="line"><span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">    awaitSignal.print(<span class="string">&quot;b&quot;</span>,b,c);</span><br><span class="line">&#125;).start();</span><br><span class="line"><span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">    awaitSignal.print(<span class="string">&quot;c&quot;</span>,c,a);</span><br><span class="line">&#125;).start();</span><br><span class="line"></span><br><span class="line"><span class="comment">//由于一开始都进入等待</span></span><br><span class="line">Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">awaitSignal.lock();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;开始&quot;</span>);</span><br><span class="line">    a.signal();</span><br><span class="line">&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">    awaitSignal.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="park-unpark"><a href="#park-unpark" class="headerlink" title="park/unpark"></a>park/unpark</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class ParkUnpark&#123;</span><br><span class="line">    &#x2F;&#x2F;循环次数</span><br><span class="line">    private int loopNumber;</span><br><span class="line"></span><br><span class="line">    public ParkUnpark(int loopNumber) &#123;</span><br><span class="line">        this.loopNumber &#x3D; loopNumber;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void print(String str,Thread next)&#123;</span><br><span class="line">        for (int i &#x3D; 0; i &lt;loopNumber; i++) &#123;</span><br><span class="line">            LockSupport.park();</span><br><span class="line">            System.out.print(str);</span><br><span class="line">            LockSupport.unpark(next);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> Thread t1;</span><br><span class="line"><span class="keyword">static</span> Thread t2;</span><br><span class="line"><span class="keyword">static</span> Thread t3;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    ParkUnpark parkUnpark=<span class="keyword">new</span> ParkUnpark(<span class="number">5</span>);</span><br><span class="line">    t1=<span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">        parkUnpark.print(<span class="string">&quot;a&quot;</span>,t2);</span><br><span class="line">    &#125;);</span><br><span class="line">    t2=<span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">        parkUnpark.print(<span class="string">&quot;b&quot;</span>,t3);</span><br><span class="line">    &#125;);</span><br><span class="line">    t3=<span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">        parkUnpark.print(<span class="string">&quot;c&quot;</span>,t1);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    t1.start();</span><br><span class="line">    t2.start();</span><br><span class="line">    t3.start();</span><br><span class="line">    LockSupport.unpark(t1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="6、犹豫模式"><a href="#6、犹豫模式" class="headerlink" title="6、犹豫模式"></a>6、犹豫模式</h4><blockquote>
<p>balking模式用于在一个线程发现另一个线程或本线程已经做了某一件相同的事，那么本线程无需再做，直接返回</p>
<p>存在读写操作，需要保证原子性，<strong>不能使用volatile(适用于只有一个写操作)</strong></p>
<p>为了提高性能，尽量使得临界区的代码少。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//启动监控线程</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (starting) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        starting = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">      monitor = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (stop) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;标志为true,中断线程&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//中断标志为false.进入睡眠</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    <span class="comment">//在sleep时被打断会抛出异常</span></span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;monitor&quot;</span>);</span><br><span class="line">        monitor.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="7、工作模式"><a href="#7、工作模式" class="headerlink" title="7、工作模式"></a>7、工作模式</h4><blockquote>
<p>让有限的工作线程来轮流异步处理无限多的任务</p>
</blockquote>
<h5 id="7-1-饥饿"><a href="#7-1-饥饿" class="headerlink" title="7.1 饥饿"></a>7.1 饥饿</h5><blockquote>
<p><strong>线程数量不足导致的饥饿，常出现在固定大小的线程池中</strong></p>
<p>不同的任务类型应该使用不同的线程池，这样能够避免饥饿，并能提高效率</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService pool = Executors.newFixedThreadPool(<span class="number">4</span>);</span><br><span class="line">pool.execute(()-&gt;&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;处理点餐&quot;</span>);</span><br><span class="line">    Future&lt;String&gt; f = pool.submit(() -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;做菜&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;cook&quot;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        System.out.println(f.get());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException | ExecutionException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">pool.execute(()-&gt;&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;处理点餐&quot;</span>);</span><br><span class="line">    Future&lt;String&gt; f1=pool.submit(()-&gt;&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;做菜&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;cook&quot;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        System.out.println(f1.get());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException | ExecutionException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>解决</strong></p>
<blockquote>
<p>不同的任务类型使用不同的线程池</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//点餐线程池</span></span><br><span class="line">ExecutorService pool = Executors.newFixedThreadPool(<span class="number">1</span>);</span><br><span class="line"><span class="comment">//cook线程池</span></span><br><span class="line">ExecutorService cookPool= Executors.newFixedThreadPool(<span class="number">1</span>);</span><br><span class="line">pool.execute(()-&gt;&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;处理点餐&quot;</span>);</span><br><span class="line">    Future&lt;String&gt; f = cookPool.submit(() -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;做菜&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;cook&quot;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        System.out.println(f.get());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException | ExecutionException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">pool.execute(()-&gt;&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;处理点餐&quot;</span>);</span><br><span class="line">    Future&lt;String&gt; f1=cookPool.submit(()-&gt;&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;做菜&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;cook&quot;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        System.out.println(f1.get());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException | ExecutionException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="7-2-池大小"><a href="#7-2-池大小" class="headerlink" title="7.2 池大小"></a>7.2 池大小</h5><h6 id="CPU密集运算"><a href="#CPU密集运算" class="headerlink" title="CPU密集运算"></a>CPU密集运算</h6><blockquote>
<p>cpu核数+1实现最优的CPU利用率。</p>
<p>+1是保证当线程故障或暂停时，额外线程能够顶上，保证CPU时钟周期不被浪费。</p>
</blockquote>
<h6 id="IO密集运算"><a href="#IO密集运算" class="headerlink" title="IO密集运算"></a>IO密集运算</h6><h3 id="十、锁"><a href="#十、锁" class="headerlink" title="十、锁"></a>十、锁</h3><blockquote>
<p>用于优化锁，见于3.5 Synchronized优化</p>
</blockquote>
<p>锁一共有4种状态，级别从低到高依次是：<strong>无锁状态、偏向锁状态、轻量级锁状态和重量级锁状态</strong>，这几个状态会随着竞争情况逐渐升级。<strong>锁可以升级但不能降级</strong>，意味着偏向锁升级成轻量级锁后不能降级成偏向锁。这种锁升级却不能降级的策略，目的是为了提高获得锁和释放锁的效率。</p>
<h4 id="（1）公平锁和非公平锁"><a href="#（1）公平锁和非公平锁" class="headerlink" title="（1）公平锁和非公平锁"></a>（1）公平锁和非公平锁</h4><p>公平锁：是指多个线程按照申请锁的顺序来获取锁</p>
<p>非公平锁：是指多个线程获取锁的顺序并不是按照申请锁的顺序，有可能后申请的线程优先获取锁</p>
<p><strong>非公平锁一上来就尝试占用锁，若占用失败，就采用公平锁的方式到末尾排队</strong></p>
<blockquote>
<p><strong>公平锁 VS 非公平锁</strong></p>
</blockquote>
<p>1、公平锁每次获取到的锁为同步队列中的<strong>第一个节点</strong>，<strong>保证请求资源时间上的绝对顺序</strong>，</p>
<p>​    非公平锁有可能刚释放锁的线程下次继续获取该锁，则有可能导致其他线程永远无法获取到锁，<strong>造成“饥饿”现象</strong>。</p>
<img src="https://csn.damyoung.cn/image-20201007191641779.png" alt="image-20201007191641779" style="zoom:67%;" />

<p>​    </p>
<p>2、公平锁为了保证时间上的绝对顺序，需要频繁的<strong>上下文切换</strong>，而非公平锁会降低一定的上下文切换，降低性能开销。</p>
<p>​        因此，ReentrantLock默认选择的是非公平锁，则是为了减少一部分上下文切换，<strong>保证了系统更大的吞吐量</strong>。</p>
<h4 id="（2）递归锁"><a href="#（2）递归锁" class="headerlink" title="（2）递归锁"></a>（2）递归锁</h4><p>递归锁（可重入锁ReentrantLock）</p>
<blockquote>
<ul>
<li><p>表示该锁能够支持一个线程对资源的重复加锁。</p>
</li>
<li><p>该锁的还支持获取锁时的公平和非公平性选择。</p>
</li>
<li><p>如果一个锁不支持可重入，那当一个线程调用它的lock()方法获取锁之后，如果再次调用lock()方法，则该线程将会被自己所阻塞。</p>
</li>
</ul>
</blockquote>
<p>synchronized关键字隐式的支持重进入，比如一个synchronized修饰的递归方法，在方法执行时，执行线程在获取了锁之后仍能连续多次地获得该锁。ReentrantLock虽然没能像synchronized关键字一样支持隐式的重进入，但是在调用lock()方法时，已经获取到锁的线程，能够再次调用lock()方法获取锁而不被阻塞。</p>
<h5 id="可重入性"><a href="#可重入性" class="headerlink" title="可重入性"></a>可重入性</h5><p>重进入是指任意线程在获取到锁之后能够再次获取该锁而不会被锁所阻塞，该特性的实现需要解决以下两个问题。</p>
<ul>
<li><strong>线程再次获取锁</strong>。锁需要去识别获取锁的线程是否为当前占据锁的线程，如果是，则再次成功获取。</li>
<li><strong>锁的最终释放</strong>。线程重复n次获取了锁，随后在第n次释放该锁后，其他线程能够获取到该锁。锁的最终释放要求锁对于获取进行计数自增，计数表示当前锁被重复获取的次数，而锁被释放时，计数自减，当计数等于0时表示锁已经成功释放。</li>
</ul>
<h4 id="（3）读写锁"><a href="#（3）读写锁" class="headerlink" title="（3）读写锁"></a>（3）读写锁</h4><blockquote>
<p>ReentrantReadWriteLock</p>
</blockquote>
<blockquote>
<ul>
<li>读写锁用的<strong>同一个Sync同步器，因此等待队列、state等也是同一个</strong><ul>
<li>写锁占state低16位，读锁占用高16位</li>
</ul>
</li>
</ul>
<img src="https://csn.damyoung.cn/image-20201008134833759.png" alt="image-20201008134833759" style="zoom:67%;" />

<ul>
<li>拥有ReadLock和WriteLock俩个内部类、Syn内部类</li>
</ul>
</blockquote>
<img src="https://csn.damyoung.cn/image-20201011110445480.png" alt="image-20201011110445480" style="zoom:80%;" />

<img src="https://csn.damyoung.cn/image-20201011110514236.png" alt="image-20201011110514236" style="zoom: 80%;" />



<h5 id="3-1-独占锁"><a href="#3-1-独占锁" class="headerlink" title="3.1 独占锁"></a>3.1 独占锁</h5><p>这些锁在同一时刻只允许<strong>一个线程</strong>进行访问</p>
<h5 id="3-2-共享锁"><a href="#3-2-共享锁" class="headerlink" title="3.2 共享锁"></a>3.2 共享锁</h5><p>这些锁在同一时刻可以被多个线程所持有</p>
<h5 id="3-3-读写锁"><a href="#3-3-读写锁" class="headerlink" title="3.3 读写锁"></a>3.3 读写锁</h5><p>ReentrantReadWriteLock其读锁是共享锁(并发)，其写锁是独占锁(互斥)</p>
<blockquote>
<ul>
<li><p>读锁的共享锁可保证<strong>并发读</strong>是非常高效的，但读写、写读、写写的过程是互斥的</p>
</li>
<li><p>读写锁在同一时刻可以允许<strong>多个读线程</strong>访问，但是在<strong>写线程</strong>访问时，所有的读线程和其他写线程均被阻塞。</p>
</li>
<li><p>读写锁维护了一对锁，一个读锁和一个写锁，通过<strong>分离读锁和写锁</strong>，使得<strong>并发性</strong>相比一般的排他锁有了很大提升。</p>
</li>
</ul>
</blockquote>
<p>读写锁主要有以下三个特性：</p>
<ul>
<li><strong>公平性选择</strong>：支持非公平性（默认）和公平性锁获取方式，吞吐量还是非公平优于公平；</li>
<li><strong>重入性</strong>：支持重入<ul>
<li>读锁获取后能再次获取</li>
<li>写锁获取之后能够再次获取写锁，同时也能够获取读锁</li>
<li>但不支持锁升级，即在读锁下再次获取写锁</li>
</ul>
</li>
<li><strong>锁降级</strong>：遵循获取写锁，获取读锁再释放写锁的次序，写锁能够降级成为读锁</li>
<li><strong>读锁不支持条件变量</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> ReentrantReadWriteLock reentrantReadWriteLock=<span class="keyword">new</span> ReentrantReadWriteLock();</span><br><span class="line"><span class="comment">//读锁对象</span></span><br><span class="line"><span class="keyword">private</span> ReentrantReadWriteLock.ReadLock readLock=reentrantReadWriteLock.readLock();</span><br><span class="line"><span class="comment">//写锁对象</span></span><br><span class="line"><span class="keyword">private</span> ReentrantReadWriteLock.WriteLock writeLock=reentrantReadWriteLock.writeLock();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">read</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;获取读锁&quot;</span>);</span><br><span class="line">    readLock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;读取&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        readLock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;获取写锁&quot;</span>);</span><br><span class="line">    writeLock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;写入&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        writeLock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="（4）乐观锁"><a href="#（4）乐观锁" class="headerlink" title="（4）乐观锁"></a>（4）乐观锁</h4><p>CAS是什么</p>
<p>（1）<strong>CAS是乐观锁，非阻塞锁</strong> compare and swap</p>
<p>它认为在线程在共享资源时不会发生冲突，不会发生冲突自然就不会阻塞其他线程的操作，故线程也就不会出现阻塞</p>
<p>无锁操作是使用**CAS(compare and swap)**又叫做比较交换来鉴别线程是否出现冲突，出现冲突就重试当前操作直到没有冲突为止。</p>
<p>（2）synchronized 是悲观锁（阻塞锁），悲观地认为程序中的并发情况严重</p>
<p>2、操作过程</p>
<p>3个基本操作数：内存地址V，旧的期望值O，要修改的新值N</p>
<p>更新变量时，但变量的期望值与内存地址V当中的实际值相同时，才会将内存地址V对应的值修改为N</p>
<p>3、CAS的问题</p>
<p>（1）ABA问题</p>
<p>CAS会检查旧值有无变化，比如一个旧值A变为了成B，然后再变成A，刚好在做CAS时检查发现旧值并没有变化依然为A，但是实际上的确发生了变化</p>
<p><strong>解决</strong>：添加一个版本号，原来的变化路径A-&gt;B-&gt;A就变成了1A-&gt;2B-&gt;3C。</p>
<p>（2）自旋时间过长</p>
<p>CAS是非阻塞同步，不会把线程挂起，会自旋进行下一次尝试，自旋时间过长会对性能消耗</p>
<p>（3）只能保证一个共享的原子操作</p>
<p>当对一个共享变量执行操作时CAS能保证其原子性，如果对多个共享变量进行操作,CAS就不能保证其原子性</p>
<p><strong>解决：</strong>用一个对象整合多个共享变量，atomic中提供AtomicReference来保证引用对象之间的原子性</p>
<h4 id="（5）自旋锁"><a href="#（5）自旋锁" class="headerlink" title="（5）自旋锁"></a>（5）自旋锁</h4><p>轻量级锁失败后，虚拟机为了避免线程真实地在操作系统层面挂起，还会进行一项称为自旋锁的优化手段。这是基于在大多数情况下，线程持有锁的时间都不会太长，如果直接挂起操作系统层面的线程可能会得不偿失，毕竟操作系统实现线程之间的切换时需要从用户态转换到核心态，这个状态之间的转换需要相对比较长的时间，时间成本相对较高，因此自旋锁会假设在不久将来，当前的线程可以获得锁，因此虚拟机会让当前想要获取锁的线程做几个空循环(这也是称为自旋的原因)，一般不会太久，可能是50个循环或100循环，在经过若干次循环后，如果得到锁，就顺利进入临界区。如果还不能获得锁，那就会将线程在操作系统层面挂起，这就是自旋锁的优化方式，这种方式确实也是可以提升效率的。最后没办法也就只能升级为重量级锁了。</p>
<h4 id="（6）轻量级锁"><a href="#（6）轻量级锁" class="headerlink" title="（6）轻量级锁"></a>（6）轻量级锁</h4><p>倘若偏向锁失败，虚拟机并不会立即升级为重量级锁，它还会尝试使用一种称为轻量级锁的优化手段(1.6之后加入的)，此时Mark Word 的结构也变为轻量级锁的结构。轻量级锁能够提升程序性能的依据是“对绝大部分的锁，在整个同步周期内都不存在竞争”，注意这是经验数据。需要了解的是，轻量级锁所适应的场景是线程交替执行同步块的场合，如果存在同一时间访问同一锁的场合，就会导致轻量级锁膨胀为重量级锁。</p>
<p><img src="https://csn.damyoung.cn/1113901-20190703154344750-1101311912.png" alt="img"></p>
<h2 id="二、线程通信"><a href="#二、线程通信" class="headerlink" title="二、线程通信"></a>二、线程通信</h2><h3 id="1、通信与同步"><a href="#1、通信与同步" class="headerlink" title="1、通信与同步"></a>1、通信与同步</h3><p>线程通信指线程之间以何种机制来交换信息，两种 <strong>共享内存</strong>和<strong>消息传递</strong></p>
<p>（1）在<strong>共享内存</strong>的并发模型里，线程之间共享程序的公共状态</p>
<p>​        线程之间通过写-读内存中的公共状态来<strong>隐式</strong>进行通信</p>
<p>​        典型的共享内存通信方式就是通过<strong>共享对象进行通信</strong></p>
<p>（2）在<strong>消息传递</strong>的并发模型里，线程之间没有公共状态，</p>
<p>​        线程之间必须通过明确的发送消息来<strong>显式</strong>进行通信</p>
<p>​        在java中典型的消息传递方式就是wait()和notify()</p>
<p><strong>线程同步</strong>是指程序用于控制不同线程之间操作发生相对顺序的机制。</p>
<p>（1）在共享内存并发模型里，同步是显式进行的。</p>
<p>​        程序员必须显式指定某个方法或某段代码需要在线程之间互斥执行。</p>
<p>（2）在消息传递的并发模型里，由于消息的发送必须在消息的接收之前</p>
<p>​        因此同步是隐式进行的。</p>
<p>java内存模型是<strong>共享内存的并发模型</strong>，线程之间主要通过读-写共享变量来完成隐式通信</p>
<h3 id="2、可见性和竞争"><a href="#2、可见性和竞争" class="headerlink" title="2、可见性和竞争"></a>2、可见性和竞争</h3><p>当对象和变量存储到计算机的各个内存区域时，必然会面临一些问题</p>
<ol>
<li>共享对象对各个线程的可见性</li>
<li>共享对象的竞争现象</li>
</ol>
<h4 id="（2）竞争"><a href="#（2）竞争" class="headerlink" title="（2）竞争"></a>（2）竞争</h4><p>如果多个线程共享一个对象，如果它们同时修改这个共享对象，这就产生了竞争现象。</p>
<p>线程A和线程B共享一个对象obj。假设线程A从主存读取Obj.count变量到自己的CPU缓存，同时，线程B也读取了Obj.count变量到它的CPU缓存，并且这两个线程都对Obj.count做了加1操作。此时，Obj.count加1操作被执行了两次，不过都在不同的CPU缓存中。</p>
<p>要解决竞争现象我们可以使用<strong>synchronized</strong>代码块。synchronized代码块可以保证同一个时刻只能有一个线程进入代码竞争区，synchronized代码块也能保证代码块中所有变量都将会从主存中读，当线程退出代码块时，对所有变量的更新将会flush到主存，不管这些变量是不是volatile类型的。</p>
<h3 id="3、重排序"><a href="#3、重排序" class="headerlink" title="3、重排序"></a>3、重排序</h3><p>指令重排序是指编译器和处理器为了提高性能对指令进行重新排序</p>
<ol>
<li>编译器优化重排序：编译器在不改变单线程程序语义的前提下，可以重新安排语句的执行顺序。</li>
<li>指令级并行的重排序：如果不存在数据依赖性，处理器可以改变语句对应机器指令的执行顺序。</li>
<li>内存系统的重排序：处理器使用缓存和读写缓冲区，这使得加载和存储操作看上去可能是在乱序执行。</li>
</ol>
<p>1属于编译器重排序，而2和3统称为处理器重排序。这些重排序会导致线程安全的问题，JMM确保在不同的编译器和不同的处理器平台之上，通过插入特定类型的<code>Memory Barrier</code>来禁止特定类型的编译器重排序和处理器重排序，为上层提供一致的内存可见性保证。</p>
<p><strong>编译器和处理器不会改变存在数据依赖性关系的两个操作的执行顺序，即不会重排序</strong></p>
<p>数据依赖性是指<strong>如果两个操作访问同一个变量，且这两个操作有一个为写操作，此时这两个操作就存在数据依赖性</strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dmyang-only.github.io/2020/09/11/01Html/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dmYang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DmYoung">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/11/01Html/" class="post-title-link" itemprop="url">html</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-09-11 12:33:33" itemprop="dateCreated datePublished" datetime="2020-09-11T12:33:33+08:00">2020-09-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-12-06 22:43:39" itemprop="dateModified" datetime="2020-12-06T22:43:39+08:00">2020-12-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
            </span>

          
            <span id="/2020/09/11/01Html/" class="post-meta-item leancloud_visitors" data-flag-title="html" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>7.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>7 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>网页</strong>是放在服务器上一个文件，浏览网页时，文件会被下载电脑上，由浏览器解析</p>
<p><strong>网站</strong>就是一个绑定了域名的文件夹，该文件夹中可以包含子文件夹以及各种各样的文件（网页），这些文件都可以通过域名来访问。</p>
<h1 id="html"><a href="#html" class="headerlink" title="html"></a>html</h1><p>（1）有开始标签和结束标签</p>
<p>（2）空标签《br/》==《br》《/br》 </p>
<p>（3）不分大小写</p>
<h2 id="head"><a href="#head" class="headerlink" title="head"></a>head</h2><p>《title》表示文档的标题</p>
<p>《link》配合href属性引用外部CSS文件</p>
<p>《style》内部编写CSS样式    </p>
<p>《script》配合src属性引入外部javaScript文件</p>
<p><strong>src</strong>   表示来源地址，用来引入地址中的内容，浏览器在解析引入文件时，会停止对后续文档的处理，直到 src 的内容加载完毕</p>
<p><strong>href</strong> 表示超文本引用，href 属性中的内容只是与当前页面有关联，然后当前页面对它进行一次引用。</p>
<h2 id="body"><a href="#body" class="headerlink" title="body"></a>body</h2><ul>
<li><p>《p》标签用来表示一个段落，能容纳一段文本；</p>
</li>
<li><p>《a》标签用来表示一个超链接，用鼠标点击后可以跳转到其它网页；</p>
</li>
<li><p>《ul》《ol》标签用来表示一个列表，其中的每个 <li> 都是子标签，用来表示一个列表项。</p>
</li>
</ul>
<h2 id="一、基本标签"><a href="#一、基本标签" class="headerlink" title="一、基本标签"></a>一、基本标签</h2><h3 id="1、文件标签"><a href="#1、文件标签" class="headerlink" title="1、文件标签"></a>1、文件标签</h3><p>body: text,bgcolor 背景颜色,background背景图片</p>
<h3 id="2、排版标签"><a href="#2、排版标签" class="headerlink" title="2、排版标签"></a>2、排版标签</h3><!-- 注释文字 -->

<p>换行&lt; br/&gt;</p>
<p> 文段&lt; p&gt;  段与段之间存在空行</p>
<p>​        属性align对齐方式left/center/right</p>
<p>水平线：&lt; hr/&gt;  width/size/color/align</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		白日依山尽<span class="tag">&lt;<span class="name">br</span>&gt;</span>黄河入海流</span><br><span class="line">		<span class="tag">&lt;<span class="name">hr</span> <span class="attr">width</span>=<span class="string">&quot;500px&quot;</span> <span class="attr">align</span>=<span class="string">&quot;left&quot;</span><span class="attr">color</span>=<span class="string">&quot;blue&quot;</span> <span class="attr">size</span>=<span class="string">&quot;10&quot;</span>/&gt;</span> </span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span>标题<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span> <span class="attr">align</span>=<span class="string">&quot;left&quot;</span>&gt;</span>服务器一般放在专业的机<span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span> <span class="attr">align</span>=<span class="string">&quot;right&quot;</span>&gt;</span>另外，为了让服务器<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- &lt;文字标签&gt; --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">font</span> <span class="attr">size</span>=<span class="string">&quot;4&quot;</span> <span class="attr">color</span>=<span class="string">&quot;seagreen&quot;</span>&gt;</span>哈哈哈<span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">font</span> <span class="attr">size</span>=<span class="string">&quot;5&quot;</span> <span class="attr">color</span>=<span class="string">&quot;red&quot;</span>&gt;</span>哈哈哈<span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">hr</span> &gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 标题自动换行 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">h1</span>&gt;</span>哈哈哈<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">h2</span>&gt;</span>哈哈哈<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">h3</span>&gt;</span>哈哈哈<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">h4</span>&gt;</span>哈哈哈<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3、块标签"><a href="#3、块标签" class="headerlink" title="3、块标签"></a>3、块标签</h3><p>div 块级标签（独占一行或多行）</p>
<p>span 行级标签（同一行，若同一行放不下才换行）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: aquamarine;&quot;</span>&gt;</span></span><br><span class="line">    春眠不觉晓<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: blue;&quot;</span>&gt;</span></span><br><span class="line">    处处闻啼鸟</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;background-color: black;&quot;</span>&gt;</span>span1sssss<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;background-color: blue;&quot;</span>&gt;</span>span2<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4、文字标签"><a href="#4、文字标签" class="headerlink" title="4、文字标签"></a>4、文字标签</h3><h4 id="（1）font"><a href="#（1）font" class="headerlink" title="（1）font"></a>（1）font</h4><p>color/size/face文字类型</p>
<h4 id="（2）标题标签"><a href="#（2）标题标签" class="headerlink" title="（2）标题标签"></a>（2）标题标签</h4><p>h1–h6   随着数字的增大逐渐变小，字体是加粗的，内置字号 默认占据一行</p>
<h3 id="5、列表标签"><a href="#5、列表标签" class="headerlink" title="5、列表标签"></a>5、列表标签</h3><h4 id="（1）无序标签-ul"><a href="#（1）无序标签-ul" class="headerlink" title="（1）无序标签 ul"></a>（1）无序标签 ul</h4><p>type：有三个值，分别为disc、 square和circle</p>
<h4 id="（2）有序标签-ol"><a href="#（2）有序标签-ol" class="headerlink" title="（2）有序标签 ol"></a>（2）有序标签 ol</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 无序列表 unorderlist --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">ul</span> <span class="attr">type</span>=<span class="string">&quot;square&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">li</span>&gt;</span>苹果<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">li</span>&gt;</span>西瓜<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">li</span>&gt;</span>葡萄<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 有序列表 orderlist --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">ol</span> <span class="attr">type</span>=<span class="string">&quot;1&quot;</span> <span class="attr">start</span>=<span class="string">&quot;3&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">li</span>&gt;</span>苹果<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">li</span>&gt;</span>西瓜<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">li</span>&gt;</span>葡萄<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">li</span>&gt;</span>香蕉<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line">				</span><br><span class="line">			<span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="6、图形标签"><a href="#6、图形标签" class="headerlink" title="6、图形标签"></a>6、图形标签</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;image/1.jpg&quot;</span> <span class="attr">width</span>=<span class="string">&quot;6000px&quot;</span> <span class="attr">height</span>=<span class="string">&quot;6000px&quot;</span> <span class="attr">border</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="7、链接标签"><a href="#7、链接标签" class="headerlink" title="7、链接标签"></a>7、链接标签</h3><p>a </p>
<p>href:跳转页面地址</p>
<p>name:名称，锚点</p>
<p>target ：_self(自己)  _blank（新页面，之前的页面还有）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://www.baidu.com&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_self&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">font</span> <span class="attr">size</span>=<span class="string">&quot;500&quot;</span> <span class="attr">color</span>=<span class="string">&quot;blue&quot;</span>&gt;</span>点击跳转到百度<span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;images.html&quot;</span><span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span>&gt;</span>图片1<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#bottom&quot;</span>&gt;</span>到达底部<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#middle&quot;</span>&gt;</span>到达中部<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"> 嘻嘻嘻嘻嘻嘻嘻嘻嘻嘻<span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">name</span>=<span class="string">&quot;top&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="8、表格标签"><a href="#8、表格标签" class="headerlink" title="8、表格标签"></a>8、表格标签</h3><p>tr–th/td</p>
<p>th标签默认居中，td标签默认靠左</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">&quot;1&quot;</span> <span class="attr">width</span>=<span class="string">&quot;50%&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> <span class="attr">bgcolor</span>=<span class="string">&quot;yellow&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">caption</span>&gt;</span>表标题<span class="tag">&lt;/<span class="name">caption</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 行标题th --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>学号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>性别<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">&quot;right&quot;</span>&gt;</span>2-1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">&quot;left&quot;</span>&gt;</span>2-2<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>2-3<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>2-1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>2-2<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 跨行 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">rowspan</span>=<span class="string">&quot;2&quot;</span>&gt;</span>2-3<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 跨列 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span>3-1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="二、表单标签"><a href="#二、表单标签" class="headerlink" title="二、表单标签"></a>二、表单标签</h2><h3 id="form"><a href="#form" class="headerlink" title="form"></a>form</h3><p>name:表单名称、action:提交的路径地址、<strong>method:提交方式（get和post）</strong></p>
<p><strong>form里面嵌套table</strong></p>
<p><strong>get和post的区别</strong></p>
<p>(1)get提交将数据加在地址栏的后面，格式?name=value&amp;name=value；post提交将数据封装在请求体中<br>    ?username=zhangsan&amp;password=123&amp;sex=male&amp;hobby=football&amp;hobby=paiqiu&amp;city=bj#</p>
<p>(2)get提交相对不安全；post提交相对安全</p>
<p>(3)get提交有大小限制，根据浏览器不同而不同；post不限制大小                            </p>
<h3 id="2-1-input"><a href="#2-1-input" class="headerlink" title="2.1 input"></a>2.1 input</h3><p>type属性： text、password、radio、checkbox、file、button、submit、reset(重置按钮)、</p>
<p>​                    image（图片按钮）</p>
<p>​                    hidden  隐藏表单   作用是在<strong>提交数据的时候，服务器需要这个数据，但是不需要用户看到</strong>。</p>
<p><strong>name属性一定要写</strong></p>
<h3 id="2-2-select"><a href="#2-2-select" class="headerlink" title="2.2 select"></a>2.2 select</h3><p><strong>下拉框</strong></p>
<p>name</p>
<p>option可选项： value 表单项中的值、selected 默认被选中</p>
<h3 id="2-3-testArea"><a href="#2-3-testArea" class="headerlink" title="2.3 testArea"></a>2.3 testArea</h3><p><strong>文本域</strong>，cols列数 rows 行数</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- method-&gt;get/post --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;selvet&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">table</span> &gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">td</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> /&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">				</span><br><span class="line">				<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">td</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> /&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">				</span><br><span class="line">				<span class="comment">&lt;!-- 单选框 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">td</span>&gt;</span>性别<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">id</span>=<span class="string">&quot;male&quot;</span> /&gt;</span>男</span><br><span class="line">						<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">id</span>=<span class="string">&quot;female&quot;</span> <span class="attr">checked</span>=<span class="string">&quot;checked&quot;</span> /&gt;</span>女</span><br><span class="line">					<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">				</span><br><span class="line">				<span class="comment">&lt;!-- 复选框 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">						爱好</span><br><span class="line">					<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">					</span><br><span class="line">					<span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hobby&quot;</span> <span class="attr">id</span>=<span class="string">&quot;football&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> <span class="attr">checked</span>=<span class="string">&quot;checked&quot;</span> /&gt;</span>足球</span><br><span class="line">						<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hobby&quot;</span> <span class="attr">id</span>=<span class="string">&quot;basketball&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> /&gt;</span>篮球</span><br><span class="line">						<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hobby&quot;</span> <span class="attr">id</span>=<span class="string">&quot;baseball&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> /&gt;</span>排球</span><br><span class="line">					<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">				</span><br><span class="line">				<span class="comment">&lt;!-- 下拉框 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">						地址</span><br><span class="line">					<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;city&quot;</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;beijing&quot;</span>&gt;</span>北京<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span> =<span class="string">&quot;shanghai&quot;</span> <span class="attr">selected</span>=<span class="string">&quot;selected&quot;</span>&gt;</span>上海<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span> =<span class="string">&quot;guangzhou&quot;</span>&gt;</span>广州<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">					</span><br><span class="line">						<span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;area&quot;</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;cp&quot;</span>&gt;</span>昌平区<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span> =<span class="string">&quot;haidin&quot;</span> <span class="attr">selected</span>=<span class="string">&quot;selected&quot;</span>&gt;</span>海淀区<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">				</span><br><span class="line">				<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">						邮箱</span><br><span class="line">					<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">td</span>&gt;</span>	</span><br><span class="line">						<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;普通输入框&quot;</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">					</span><br><span class="line">				<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">td</span>&gt;</span>上传头像<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;file&quot;</span> /&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">					</span><br><span class="line">				<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">						备注</span><br><span class="line">					<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">textarea</span> <span class="attr">rows</span>=<span class="string">&quot;10&quot;</span> <span class="attr">cols</span>=<span class="string">&quot;30&quot;</span>&gt;</span></span><br><span class="line">							write down your list</span><br><span class="line">						<span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">						</span><br><span class="line">					<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span> /&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;普通按钮&quot;</span> /&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;reset&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;重置&quot;</span> /&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">						</span><br><span class="line">					<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;image&quot;</span> <span class="attr">src</span>=<span class="string">&quot;btn.gif&quot;</span> /&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20190101&quot;</span> /&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">				</span><br><span class="line">			<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="三、html框架"><a href="#三、html框架" class="headerlink" title="三、html框架"></a>三、html框架</h2><p>frameset 属性 rows/cols 划分格式： rows=”120,*”</p>
<p>*表示其他</p>
<p>frame  ：name/src</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">frameset</span> <span class="attr">rows</span>=<span class="string">&quot;120,450,*&quot;</span> <span class="attr">border</span>=<span class="string">&quot;10&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">frame</span> <span class="attr">src</span>=<span class="string">&quot;http://www.baidu.com&quot;</span> &gt;</span><span class="tag">&lt;<span class="name">frame</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">frameset</span> <span class="attr">cols</span>=<span class="string">&quot;120,*&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">frame</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">frame</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span> &gt;</span><span class="tag">&lt;<span class="name">frame</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">frameset</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">frame</span> <span class="attr">src</span>=<span class="string">&quot;http://www.qq.com&quot;</span> &gt;</span>&lt;/frame/&gt;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">frameset</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>iframe</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">h1</span>&gt;</span>内部框架<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;http://www.baidu.com&quot;</span> <span class="attr">width</span>=<span class="string">&quot;300px&quot;</span> <span class="attr">height</span>=<span class="string">&quot;200px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="四、特殊字符"><a href="#四、特殊字符" class="headerlink" title="四、特殊字符"></a>四、特殊字符</h2><p>&amp;nbsp:空格、&amp;qt：大于号 &amp;lt小于号、&amp;copy版权符号 、&amp;reg注册符号</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		首页<span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;gt;</span><span class="symbol">&amp;nbsp;</span>旅游<span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;lt;</span>图书列表</span><br><span class="line">		<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">			<span class="symbol">&amp;copy;</span>copyright 广州<span class="symbol">&amp;reg;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">©copyright 广州®</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dmyang-only.github.io/2020/09/11/02CSS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dmYang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DmYoung">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/11/02CSS/" class="post-title-link" itemprop="url">css</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-09-11 12:33:33" itemprop="dateCreated datePublished" datetime="2020-09-11T12:33:33+08:00">2020-09-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-12-06 22:43:55" itemprop="dateModified" datetime="2020-12-06T22:43:55+08:00">2020-12-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
            </span>

          
            <span id="/2020/09/11/02CSS/" class="post-meta-item leancloud_visitors" data-flag-title="css" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h2><h3 id="1、什么是CSS"><a href="#1、什么是CSS" class="headerlink" title="1、什么是CSS"></a>1、什么是CSS</h3><p><strong>层叠样式表</strong>，cascade style sheet进行样式修饰语言</p>
<p>层叠，不同的CSS样式对同一个html标签进行修饰，冲突的让步优先级高的，不冲突则共同作用</p>
<p>样式表，css属性样式的集合</p>
<h3 id="2、引入CSS"><a href="#2、引入CSS" class="headerlink" title="2、引入CSS"></a>2、引入CSS</h3><h4 id="（1）内嵌样式"><a href="#（1）内嵌样式" class="headerlink" title="（1）内嵌样式"></a>（1）内嵌样式</h4><p>将CSS代码嵌入到HTML标签中</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;color:red;font-size: 100px;&quot;</span>&gt;</span>你好啊 小朋友<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="（2）内部样式"><a href="#（2）内部样式" class="headerlink" title="（2）内部样式"></a>（2）内部样式</h4><p>在head标签中使用style标签进行CSS的引入</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span></span><br><span class="line">		div&#123;</span><br><span class="line">			color: red;</span><br><span class="line">			font-size: 100px;</span><br><span class="line">		&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<h4 id="（3）外部样式"><a href="#（3）外部样式" class="headerlink" title="（3）外部样式"></a>（3）外部样式</h4><p>Link 标签，引用外部CSS文件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">href</span>=<span class="string">&quot;1.css&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3、选择器"><a href="#3、选择器" class="headerlink" title="3、选择器"></a>3、选择器</h3><h4 id="（1）基本选择器"><a href="#（1）基本选择器" class="headerlink" title="（1）基本选择器"></a>（1）基本选择器</h4><p><strong>根据id、类、标签进行选择</strong></p>
<p><strong>优先级</strong>：<strong>选择器的优先级：id&gt;class&gt;元素</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//类选择</span><br><span class="line">.style1&#123;</span><br><span class="line">	background-color: black;</span><br><span class="line">    &#125;</span><br><span class="line">//id选择</span><br><span class="line">    #div3&#123;</span><br><span class="line">    background-color: orange;</span><br><span class="line">    &#125;</span><br><span class="line">//标签选择</span><br><span class="line">    div&#123;</span><br><span class="line">    background-color: saddlebrown;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;style1&quot;</span>&gt;</span>hello css1!!!<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="（2）属性选择器"><a href="#（2）属性选择器" class="headerlink" title="（2）属性选择器"></a>（2）属性选择器</h4><p>格式：基本选择器[属性=‘属性值’]{css属性}</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 属性选择器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;text&quot;</span>]</span>&#123;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">background-color</span>: <span class="selector-id">#FFA500</span>;</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">&quot;&quot;</span> <span class="attr">cellspacing</span>=<span class="string">&quot;&quot;</span> <span class="attr">cellpadding</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    		name:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    		密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> /&gt;</span></span><br><span class="line">    		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="（3）伪元素选择器"><a href="#（3）伪元素选择器" class="headerlink" title="（3）伪元素选择器"></a>（3）伪元素选择器</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 伪元素选择器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span></span><br><span class="line"><span class="css">    <span class="comment">/* 静止状态 */</span></span></span><br><span class="line"><span class="css">    <span class="selector-tag">a</span><span class="selector-pseudo">:link</span>&#123;</span></span><br><span class="line">        color: red;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="comment">/* 悬浮状态 */</span></span></span><br><span class="line"><span class="css">    <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span>&#123;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">color</span><span class="selector-pseudo">:blue</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="comment">/* 触发状态 */</span></span></span><br><span class="line"><span class="css">    <span class="selector-tag">a</span><span class="selector-pseudo">:active</span>&#123;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">color</span><span class="selector-pseudo">:greenyellow</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="comment">/* 完成状态 */</span></span></span><br><span class="line"><span class="css">    <span class="selector-tag">a</span><span class="selector-pseudo">:visited</span>&#123;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">color</span><span class="selector-pseudo">:green</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>点击<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h4 id="（4）层级选择器"><a href="#（4）层级选择器" class="headerlink" title="（4）层级选择器"></a>（4）层级选择器</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 层级（后代）选择器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span></span><br><span class="line"><span class="css">    <span class="selector-id">#div2</span> <span class="selector-class">.dd1</span>&#123;</span></span><br><span class="line">        color: orange;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">		</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dd1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>111<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dd2&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>122<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3、css属性"><a href="#3、css属性" class="headerlink" title="3、css属性"></a>3、css属性</h3><h4 id="（1）文字属性"><a href="#（1）文字属性" class="headerlink" title="（1）文字属性"></a>（1）文字属性</h4><p><strong>font</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">color</span><span class="selector-pseudo">:red</span>;   <span class="comment">/* 字体颜色 */</span></span><br><span class="line"><span class="selector-tag">font-size</span>: <span class="selector-tag">small</span>;  <span class="comment">/* 字体大小 */</span></span><br><span class="line"><span class="selector-tag">font-family</span>: 黑体;  <span class="comment">/* 字体类型 */</span></span><br><span class="line"><span class="selector-tag">font-style</span>: <span class="selector-tag">italic</span>;  <span class="comment">/* 字体风格 */</span>				</span><br><span class="line"><span class="selector-tag">font-weight</span>: 100; <span class="comment">/* 加粗 */</span></span><br><span class="line"><span class="selector-tag">word-spacing</span>: 2<span class="selector-tag">em</span>;  <span class="comment">/* 单词间距 */</span></span><br><span class="line"><span class="selector-tag">letter-spacing</span>: 2<span class="selector-tag">em</span>; <span class="comment">/* 字符间距 */</span></span><br></pre></td></tr></table></figure>

<h4 id="（2）文本属性"><a href="#（2）文本属性" class="headerlink" title="（2）文本属性"></a>（2）文本属性</h4><p><strong>text</strong>-decoration:下划线underline 、none</p>
<p>text-align：水平对齐方式</p>
<p>text-indent:缩进</p>
<p>line-height: 行高</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">			<span class="selector-tag">p</span>&#123;</span><br><span class="line">				<span class="attribute">text-indent</span>: <span class="number">2em</span>;<span class="comment">/* 缩进 */</span></span><br><span class="line">				<span class="attribute">line-height</span>: <span class="number">2.25rem</span>;  <span class="comment">/* 行高 */</span></span><br><span class="line">			&#125;</span><br><span class="line">&lt;/<span class="selector-tag">style</span>&gt;</span><br></pre></td></tr></table></figure>

<h4 id="（3）背景颜色"><a href="#（3）背景颜色" class="headerlink" title="（3）背景颜色"></a>（3）背景颜色</h4><p><strong>background</strong>-color</p>
<p>background-image： url(“图片地址”)</p>
<p>background-<strong>repeat</strong>:平铺方式  repeat:横向纵向平铺，no-repeat,repeat-x,repeat-y</p>
<h4 id="（4）列表属性"><a href="#（4）列表属性" class="headerlink" title="（4）列表属性"></a>（4）列表属性</h4><p>list-style-type：none；</p>
<p>list-style-image url(“图片地址”)</p>
<p>list-style-<strong>position</strong>: outside(默认)，inside</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span></span><br><span class="line">			ul li&#123;</span><br><span class="line"><span class="css">				<span class="comment">/* 无序列表的排序图标 */</span></span></span><br><span class="line">				/* list-style-type: upper-roman;</span><br><span class="line">				list-style-type: none; */</span><br><span class="line"><span class="css">				  <span class="selector-tag">list-style-image</span>: <span class="selector-tag">url</span>(../<span class="selector-tag">MyHtml</span>/<span class="selector-tag">image</span>/2<span class="selector-class">.png</span>);</span></span><br><span class="line">				  list-style-position: inside;</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="（5）尺寸属性"><a href="#（5）尺寸属性" class="headerlink" title="（5）尺寸属性"></a>（5）尺寸属性</h4><p>width,height</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span></span><br><span class="line">			p&#123;</span><br><span class="line">				width: 800px;</span><br><span class="line">				height: 5rem;</span><br><span class="line"><span class="css">				<span class="selector-tag">background-color</span>: <span class="selector-id">#FFA500</span>;</span></span><br><span class="line">				//设置行高和文本高一致，可使得行位于中间</span><br><span class="line">				line-height: 5rem;</span><br><span class="line">				text-align: center;</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="（6）显示属性"><a href="#（6）显示属性" class="headerlink" title="（6）显示属性"></a>（6）显示属性</h4><p><strong>display</strong>: <strong>none</strong>隐藏,<strong>block</strong>(块级显示)，<strong>inline</strong>(行级显示)</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span>&#123;</span><br><span class="line">        <span class="comment">/* 	块级变行级 */</span></span><br><span class="line">        <span class="comment">/* display: inline; */</span></span><br><span class="line">        <span class="attribute">background-color</span>: pink;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">        <span class="attribute">height</span>:<span class="number">200px</span>;</span><br><span class="line">   &#125;	</span><br><span class="line">   <span class="comment">/* 行级变块级 */</span></span><br><span class="line">   <span class="selector-tag">span</span>&#123;</span><br><span class="line">       <span class="attribute">display</span>: block;</span><br><span class="line">       <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">       <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">       <span class="attribute">background-color</span>: pink;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="4、盒子模型"><a href="#4、盒子模型" class="headerlink" title="4、盒子模型"></a>4、盒子模型</h3><h4 id="border边框"><a href="#border边框" class="headerlink" title="border边框"></a>border边框</h4><p>border-width、border-color、border-style、三合一border:10px solid red;</p>
<p>border-top/bottom/left/right</p>
<h4 id="padding内部"><a href="#padding内部" class="headerlink" title="padding内部"></a>padding内部</h4><p>padding:10px 代表上下左右都是10px</p>
<p>padding:1px 2px 3px 4px</p>
<p>padding: 1px 2px;  上下/左右</p>
<p>padding：1px 2px 3px; padding-top;单独设置</p>
<h4 id="margin外部"><a href="#margin外部" class="headerlink" title="margin外部"></a>margin外部</h4><p>代表边框外壁与其他元素之间的距离</p>
<p>margin:10px</p>
<p>同上！</p>
<h3 id="5、浮动"><a href="#5、浮动" class="headerlink" title="5、浮动"></a>5、浮动</h3><h4 id="（1）定位"><a href="#（1）定位" class="headerlink" title="（1）定位"></a>（1）定位</h4><p><strong>position</strong>  相对定位<strong>relative</strong> , 绝对定位<strong>absolute</strong> , 固定定位<strong>fixed</strong></p>
<p>多个祖先的绝对定位采用<strong>就近原则</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*//相对定位参照物:相对于它自已原来的位置,不脱离标准流，原来位置不会被其他元素占领*/</span></span><br><span class="line"><span class="selector-class">.box2</span>&#123;</span><br><span class="line">	<span class="attribute">background-color</span>: skyblue;			</span><br><span class="line">	<span class="attribute">position</span>: relative;</span><br><span class="line"><span class="comment">/*相对与浏览器 </span></span><br><span class="line"><span class="comment">绝对定位若是父亲定位过，则参照物就变成了父亲，而不是浏览器</span></span><br><span class="line"><span class="comment">多级父亲都已被定位过，则就近原则</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">	<span class="attribute">position</span>: absolute;</span><br><span class="line">	<span class="attribute">left</span>: <span class="number">20px</span>;</span><br><span class="line">	<span class="attribute">top</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>fixed固定定位用于链接返回固定位置</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.backtop&#123;</span><br><span class="line">	position: fixed;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;backtop&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>返回<span class="tag">&lt;<span class="name">br</span> /&gt;</span>顶部<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;2.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;2.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;2.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;2.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="（2）消除浮动"><a href="#（2）消除浮动" class="headerlink" title="（2）消除浮动"></a>（2）消除浮动</h4><p>​    clear:both</p>
<h4 id="（3）z-index"><a href="#（3）z-index" class="headerlink" title="（3）z-index"></a>（3）z-index</h4><p>设置顶层或底层,可用于将在一个元素放置于另一元素之后。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box1</span>&#123;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box2</span>&#123;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line"><span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line"><span class="attribute">background</span>: skyblue;</span><br><span class="line"><span class="attribute">position</span>: absolute;</span><br><span class="line"><span class="attribute">top</span>: <span class="number">180px</span>;</span><br><span class="line"><span class="attribute">left</span>: <span class="number">180px</span>;</span><br><span class="line"><span class="attribute">z-index</span>: <span class="number">1</span>;				</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="（4）列表浮动"><a href="#（4）列表浮动" class="headerlink" title="（4）列表浮动"></a>（4）列表浮动</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span></span><br><span class="line">			*&#123;</span><br><span class="line">				margin: 0px;</span><br><span class="line">				padding: 0rem;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line"><span class="css">			<span class="selector-class">.nav</span>&#123;</span></span><br><span class="line">				position: fixed;</span><br><span class="line">				width: 960px;</span><br><span class="line">				height: 50px;</span><br><span class="line">				border: 1px red solid;</span><br><span class="line">				margin: 100px 100px;  //居中</span><br><span class="line">			&#125;</span><br><span class="line"><span class="css">			<span class="selector-class">.nav</span> <span class="selector-tag">ul</span>&#123;</span></span><br><span class="line">				list-style-type: none;</span><br><span class="line">			&#125;</span><br><span class="line"><span class="css">			<span class="selector-class">.nav</span> <span class="selector-tag">ul</span> <span class="selector-tag">li</span>&#123;</span></span><br><span class="line">				float: left;				</span><br><span class="line">				text-align: center;</span><br><span class="line">				height: 50px;</span><br><span class="line">				width: 120px;</span><br><span class="line"><span class="css">				<span class="selector-tag">line-height</span>: 50<span class="selector-tag">px</span>;  <span class="comment">/* 文字垂直居中 */</span></span></span><br><span class="line">				</span><br><span class="line">			&#125;			</span><br><span class="line"><span class="css">			<span class="selector-class">.nav</span> <span class="selector-tag">ul</span> <span class="selector-tag">li</span> <span class="selector-tag">a</span>&#123;</span></span><br><span class="line">				text-decoration: none;</span><br><span class="line">				display: block;</span><br><span class="line">				background-color: purple;</span><br><span class="line"><span class="css">				<span class="selector-tag">color</span><span class="selector-pseudo">:black</span>;			</span></span><br><span class="line">			&#125;</span><br><span class="line"><span class="css">			<span class="selector-class">.nav</span> <span class="selector-tag">ul</span> <span class="selector-tag">li</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span>&#123;</span></span><br><span class="line">				background-color: orange;</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;nav&quot;</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>网站栏目<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>网站栏目<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>网站栏目<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>网站栏目<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>网站栏目<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>网站栏目<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>网站栏目<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>网站栏目<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span>		</span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dmyang-only.github.io/2020/09/11/04jQuery/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dmYang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DmYoung">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/11/04jQuery/" class="post-title-link" itemprop="url">jquery</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-09-11 12:33:33" itemprop="dateCreated datePublished" datetime="2020-09-11T12:33:33+08:00">2020-09-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-12-06 22:44:17" itemprop="dateModified" datetime="2020-12-06T22:44:17+08:00">2020-12-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
            </span>

          
            <span id="/2020/09/11/04jQuery/" class="post-meta-item leancloud_visitors" data-flag-title="jquery" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>14k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>13 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="JQuery"><a href="#JQuery" class="headerlink" title="JQuery"></a>JQuery</h2><p><strong>jQuery对象通过选择器获取</strong></p>
<p>语法：**$(“选择器”)== jQuery(“选择器”)**</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> content=<span class="string">&quot;&lt;p&gt;&lt;span&gt;用户&quot;</span>+count+<span class="string">&quot;:&lt;/span&gt;&quot;</span>+$(<span class="string">&quot;#text&quot;</span>).val()+<span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="一、动画效果"><a href="#一、动画效果" class="headerlink" title="一、动画效果"></a>一、动画效果</h2><p><strong>利用可见性过滤</strong></p>
<h4 id="1、淡入和淡出"><a href="#1、淡入和淡出" class="headerlink" title="1、淡入和淡出"></a>1、淡入和淡出</h4><blockquote>
<p>fadeIn() fadeOut() fadeTo()</p>
</blockquote>
<p>css<strong>设置为不可见</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;ad.jpg&quot; style=&quot;display:none&quot;/&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;input[name=fadein_btn]&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	$(<span class="string">&quot;img&quot;</span>).fadeIn(<span class="number">2000</span>);</span><br><span class="line">&#125;);</span><br><span class="line">$(<span class="string">&quot;input[name=fadeout_btn]&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	$(<span class="string">&quot;img&quot;</span>).fadeOut(<span class="number">2000</span>);</span><br><span class="line">&#125;);	</span><br><span class="line">$(<span class="string">&quot;input[name=fadeinout_btn]&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	$(<span class="string">&quot;img&quot;</span>).fadeToggle(<span class="number">2000</span>);</span><br><span class="line">&#125;);	</span><br><span class="line">$(<span class="string">&quot;input[name=fadeto_btn]&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	$(<span class="string">&quot;img&quot;</span>).fadeTo(<span class="number">2000</span>,<span class="number">0.3</span>); </span><br><span class="line">&#125;);	</span><br></pre></td></tr></table></figure>

<h4 id="2、上拉下拉"><a href="#2、上拉下拉" class="headerlink" title="2、上拉下拉"></a>2、上拉下拉</h4><blockquote>
<p>slideDown() slideUp()</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;txt&quot; style=&quot;display:none&quot;&gt;	</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#btn_down&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		$(<span class="string">&quot;.txt&quot;</span>).slideDown(<span class="number">5000</span>);  <span class="comment">//下拉5秒</span></span><br><span class="line">&#125;);</span><br><span class="line">$(<span class="string">&quot;#btn_up&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		$(<span class="string">&quot;.txt&quot;</span>).slideUp(<span class="number">5000</span>);  <span class="comment">//上拉5秒</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="3、显示和隐藏"><a href="#3、显示和隐藏" class="headerlink" title="3、显示和隐藏"></a>3、显示和隐藏</h4><blockquote>
<p>show()  hide()</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#btn1&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	$(<span class="string">&quot;#pic&quot;</span>).show(<span class="number">2000</span>);</span><br><span class="line">&#125;);</span><br><span class="line">$(<span class="string">&quot;#btn2&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	$(<span class="string">&quot;#pic&quot;</span>).hide(<span class="number">2000</span>);</span><br><span class="line">&#125;);	</span><br><span class="line">$(<span class="string">&quot;#btn3&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	$(<span class="string">&quot;#pic&quot;</span>).toggle(<span class="number">2000</span>); <span class="comment">//显示与隐藏中切换</span></span><br><span class="line">&#125;);							</span><br></pre></td></tr></table></figure>

<h2 id="二、属性操作"><a href="#二、属性操作" class="headerlink" title="二、属性操作"></a>二、属性操作</h2><p><strong>attr、prop</strong></p>
<h4 id="1、attr"><a href="#1、attr" class="headerlink" title="1、attr"></a>1、attr</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#btn1&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//attribute读</span></span><br><span class="line">        <span class="keyword">var</span> title=$(<span class="string">&quot;li:first&quot;</span>).attr(<span class="string">&quot;title&quot;</span>);</span><br><span class="line">        alert(title);</span><br><span class="line">&#125;);</span><br><span class="line">$(<span class="string">&quot;#btn2&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		$(<span class="string">&quot;li:first&quot;</span>).attr(<span class="string">&quot;title&quot;</span>,<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;#btn4&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">var</span> alt=$(<span class="string">&quot;img&quot;</span>).attr(<span class="string">&quot;alt&quot;</span>);</span><br><span class="line">		alert(alt);</span><br><span class="line">&#125;);</span><br><span class="line">$(<span class="string">&quot;#btn5&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		$(<span class="string">&quot;img&quot;</span>).attr(&#123;</span><br><span class="line">			width:<span class="string">&quot;75&quot;</span>,	<span class="comment">//写多个属性</span></span><br><span class="line">			height:<span class="string">&quot;100&quot;</span></span><br><span class="line">		&#125;);		</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="removeAttr"><a href="#removeAttr" class="headerlink" title="removeAttr"></a>removeAttr</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#btn3&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//移除属性</span></span><br><span class="line">    $(<span class="string">&quot;li:first&quot;</span>).removeAttr(<span class="string">&quot;title&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="2、prop"><a href="#2、prop" class="headerlink" title="2、prop"></a>2、prop</h4><p><strong>适用于enable disenable selected checked</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#btn6&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	$(<span class="string">&quot;#ckx&quot;</span>).prop(<span class="string">&quot;checked&quot;</span>,<span class="string">&quot;true&quot;</span>); <span class="comment">//enabled disabled selected checked</span></span><br><span class="line">&#125;);</span><br><span class="line">				</span><br><span class="line">$(<span class="string">&quot;#btn7&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">     <span class="comment">// $(&quot;#ckx&quot;).prop(&quot;checked&quot;,&quot;false&quot;);//不可行</span></span><br><span class="line">      $(<span class="string">&quot;#ckx&quot;</span>).removeAttr(<span class="string">&quot;checked&quot;</span>) <span class="comment">//可行</span></span><br><span class="line">     <span class="comment">// $(&quot;#ckx&quot;)[0].checked=false;	//可行</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="三、事件"><a href="#三、事件" class="headerlink" title="三、事件"></a>三、事件</h2><h4 id="1、change事件"><a href="#1、change事件" class="headerlink" title="1、change事件"></a>1、change事件</h4><p><strong>change</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注册改变事件</span></span><br><span class="line">$(<span class="string">&quot;.info&quot;</span>).change(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// alert(&quot;性别为:&quot;+$(&quot;.info&gt;option:selected&quot;).val());</span></span><br><span class="line">    $(<span class="built_in">this</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;#7FE&quot;</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="2、键盘事件"><a href="#2、键盘事件" class="headerlink" title="2、键盘事件"></a>2、键盘事件</h4><p><strong>keydown、keypress、keyup</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#password&quot;</span>).keydown(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">	$(<span class="string">&quot;#events&quot;</span>).append(<span class="string">&quot;keyup&quot;</span>);</span><br><span class="line">&#125;).keydown(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">	$(<span class="string">&quot;#events&quot;</span>).append(<span class="string">&quot;keydown&quot;</span>);</span><br><span class="line">&#125;).keypress(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">	$(<span class="string">&quot;#events&quot;</span>).append(<span class="string">&quot;keypress&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#userName&quot;</span>).keydown(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(e.keyCode==<span class="number">13</span>)&#123;</span><br><span class="line">        $(<span class="string">&quot;#password&quot;</span>).focus();</span><br><span class="line">        e.preventDefault();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">$(<span class="string">&quot;#password&quot;</span>).keydown(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(e.keyCode==<span class="number">13</span>)&#123;</span><br><span class="line">        $(<span class="string">&quot;#form1&quot;</span>).submit(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> confirm(<span class="string">&quot;你确认提交吗&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="3、焦点事件"><a href="#3、焦点事件" class="headerlink" title="3、焦点事件"></a>3、焦点事件</h4><p><strong>focus</strong>、<strong>blus失去焦点</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获得焦点</span></span><br><span class="line">$(<span class="string">&quot;input&quot;</span>).focus(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"> $(<span class="built_in">this</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br><span class="line">&#125;); </span><br><span class="line"><span class="comment">// 失去焦点</span></span><br><span class="line">$(<span class="string">&quot;input&quot;</span>).blur(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"> $(<span class="built_in">this</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;white&quot;</span>);</span><br><span class="line">&#125;); </span><br></pre></td></tr></table></figure>

<h4 id="4、事件绑定事件"><a href="#4、事件绑定事件" class="headerlink" title="4、事件绑定事件"></a>4、事件绑定事件</h4><p><strong>on绑定、off解绑</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#btn1&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//通过on()方式为div中添加一个元素</span></span><br><span class="line">    $(<span class="string">&quot;#btn&quot;</span>).on(<span class="string">&quot;click&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $(<span class="string">&#x27;&lt;p&gt;这是第一个&lt;/p&gt;&#x27;</span>).appendTo($(<span class="string">&#x27;#dv&#x27;</span>));</span><br><span class="line">        $(<span class="string">&#x27;&lt;p&gt;这是第二个&lt;/p&gt;&#x27;</span>).appendTo($(<span class="string">&#x27;#dv&#x27;</span>));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);	</span><br><span class="line">$(<span class="string">&quot;#btn2&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	$(<span class="string">&quot;#btn&quot;</span>).off(<span class="string">&quot;click&quot;</span>);                                                         </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="5、鼠标事件"><a href="#5、鼠标事件" class="headerlink" title="5、鼠标事件"></a>5、鼠标事件</h4><p><strong>mouseover鼠标移入、mouseout鼠标移出</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;h3 style=<span class="string">&quot;background-color:white;&quot;</span>&gt;</span><br><span class="line">    mouseover事件被触发&lt;span id=<span class="string">&quot;mover&quot;</span>&gt;<span class="number">0</span>&lt;<span class="regexp">/span&gt;次&lt;/</span>br&gt;</span><br><span class="line">	mouseout事件被触发&lt;span id=<span class="string">&quot;mout&quot;</span>&gt;<span class="number">0</span>&lt;/span&gt;次</span><br><span class="line">&lt;/h3&gt;</span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;.dv&quot;</span>).mouseover(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $(<span class="built_in">this</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br><span class="line">    $(<span class="string">&#x27;#mover&#x27;</span>).text(y+=<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line">$(<span class="string">&quot;.dv&quot;</span>).mouseout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $(<span class="built_in">this</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;blue&quot;</span>);</span><br><span class="line">    $(<span class="string">&#x27;#mout&#x27;</span>).text(x+=<span class="number">1</span>);</span><br><span class="line">&#125;);				</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;.dv&quot;</span>).hover(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;	<span class="comment">//光标移入</span></span><br><span class="line">	$(<span class="built_in">this</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;	<span class="comment">//光标移出</span></span><br><span class="line">	$(<span class="built_in">this</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;blue&quot;</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="四、选择器"><a href="#四、选择器" class="headerlink" title="四、选择器"></a>四、选择器</h2><h3 id="1、基本选择器"><a href="#1、基本选择器" class="headerlink" title="1、基本选择器"></a>1、基本选择器</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#byId&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);	<span class="comment">//id选择器</span></span><br><span class="line">$(<span class="string">&quot;.byClass&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);	<span class="comment">//类选择器</span></span><br><span class="line">$(<span class="string">&quot;p&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);	<span class="comment">//标签选择器</span></span><br><span class="line">$(<span class="string">&quot;*&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);  <span class="comment">//通配符选择器</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//只选择有类为byClass或者id为byId的标签对象</span></span><br><span class="line">$(<span class="string">&quot;#byId,.byClass&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="2、层级选择器"><a href="#2、层级选择器" class="headerlink" title="2、层级选择器"></a>2、层级选择器</h3><p><strong>“&gt;直接后代==children()”</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#dv&gt;p&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);<span class="comment">//选择div下的儿子p标签</span></span><br><span class="line"><span class="comment">//children方法</span></span><br><span class="line">$(<span class="string">&quot;#dv&quot;</span>).children(<span class="string">&quot;p&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>全部后代  “空格”、find()</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查找后代的全部p标签</span></span><br><span class="line">$(<span class="string">&quot;#dv p&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br><span class="line"><span class="comment">//find方法</span></span><br><span class="line">$(<span class="string">&quot;#dv&quot;</span>).find(<span class="string">&quot;p&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>后面的第一个   +</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#dv+p&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>); <span class="comment">//dv的第一个p元素</span></span><br><span class="line">$(<span class="string">&quot;#dv&quot;</span>).next(<span class="string">&quot;p&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>后面的所有    ~</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#dv~p&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>); <span class="comment">//dv后的所有p元素</span></span><br><span class="line">$(<span class="string">&quot;#dv&quot;</span>).nextAll()(<span class="string">&quot;p&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>前面元素prev</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#dv&quot;</span>).prev(<span class="string">&quot;p&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br><span class="line">$(<span class="string">&quot;#dv&quot;</span>).prev(<span class="string">&quot;p&quot;</span>).prev(<span class="string">&quot;p&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>); <span class="comment">//连缀</span></span><br><span class="line">$(<span class="string">&quot;#dv&quot;</span>).prevAll(<span class="string">&quot;p&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>siblings==== nextAll+prevAll</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#dv&quot;</span>).siblings(<span class="string">&#x27;p&#x27;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>父级选择</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#p1&quot;</span>).parent().prev().css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br><span class="line">$(<span class="string">&quot;#p1&quot;</span>).parent().parent().parent().next().next().css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="3、属性选择器"><a href="#3、属性选择器" class="headerlink" title="3、属性选择器"></a>3、属性选择器</h3><p><strong>可选择包含有 id属性等等</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//改变含有title属性=cartoonlist的元素的背景颜色</span></span><br><span class="line">$(<span class="string">&quot;[title=cartoonlist]&quot;</span>).css(<span class="string">&quot;color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br><span class="line"><span class="comment">//改变含有title属性的&lt;li&gt;元素的背景颜色</span></span><br><span class="line">$(<span class="string">&quot;li[title]&quot;</span>).css(<span class="string">&quot;color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//改变title属性的值中以h开头的元素的背景颜色</span></span><br><span class="line">$(<span class="string">&quot;[title^=h]&quot;</span>).css(<span class="string">&quot;color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br><span class="line"><span class="comment">//改变title属性的值中以jp结尾的元素的背景颜色</span></span><br><span class="line">$(<span class="string">&quot;[title$=jp]&quot;</span>).css(<span class="string">&quot;color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br><span class="line"><span class="comment">//改变title属性的值中含有s的元素的背景颜色</span></span><br><span class="line">$(<span class="string">&quot;[title*=s]&quot;</span>).css(<span class="string">&quot;color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//改变包含events属性，且title属性的值中含有y的&lt;li&gt;元素的背景颜色 </span></span><br><span class="line">$(<span class="string">&quot;li[title*=y][class=evens]&quot;</span>).css(<span class="string">&quot;color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="4、过滤"><a href="#4、过滤" class="headerlink" title="4、过滤"></a>4、过滤</h3><h4 id="a、基本过滤"><a href="#a、基本过滤" class="headerlink" title="a、基本过滤"></a>a、基本过滤</h4><p><strong>first</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//改变第1个&lt;li&gt;元素的背景颜色</span></span><br><span class="line">$(<span class="string">&quot;li:first&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br><span class="line">$(<span class="string">&quot;li&quot;</span>).first().css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>last</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//改变最后一个&lt;li&gt;元素的背景颜色</span></span><br><span class="line"> $(<span class="string">&quot;li:last&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br><span class="line"> $(<span class="string">&quot;li&quot;</span>).last().css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>not</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//改变class不为three的&lt;li&gt;元素的背景颜色</span></span><br><span class="line">$(<span class="string">&quot;li:not(.three)&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>odd</strong>、<strong>even</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//改变索引值为偶数的&lt;li&gt;元素的背景颜色</span></span><br><span class="line">$(<span class="string">&quot;li:even&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br><span class="line"><span class="comment">//改变索引值为奇数的&lt;li&gt;元素的背景颜色</span></span><br><span class="line">$(<span class="string">&quot;li:odd&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>eq相等、gt大于、lt小于</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//改变索引值等于1的&lt;li&gt;元素的背景颜色</span></span><br><span class="line">$(<span class="string">&quot;li:eq(1)&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br><span class="line"><span class="comment">//改变索引值大于1的&lt;li&gt;元素的背景颜色</span></span><br><span class="line">$(<span class="string">&quot;li:gt(1)&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br><span class="line"><span class="comment">//改变索引值小于1的&lt;li&gt;元素的背景颜色</span></span><br><span class="line">$(<span class="string">&quot;li:lt(1)&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>header</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//改变所有标题元素，例如&lt;h1&gt;,&lt;h2&gt;,&lt;h3&gt;……这些元素的背景颜色</span></span><br><span class="line">$(<span class="string">&quot;:header&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="b、可见性过滤"><a href="#b、可见性过滤" class="headerlink" title="b、可见性过滤"></a>b、可见性过滤</h4><p>CSS: <strong>display:none</strong>  不可见   <strong>display:block</strong>  可见</p>
<p><strong>:visible show()</strong></p>
<p><strong>:hidden  hide()</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;input[name=show]&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// $(&quot;p:hidden&quot;).css(&quot;display&quot;,&quot;block&quot;);</span></span><br><span class="line">    $(<span class="string">&quot;p:hidden&quot;</span>).show();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;input[name=hide]&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// $(&quot;p:visible&quot;).css(&quot;display&quot;,&quot;none&quot;);</span></span><br><span class="line">    $(<span class="string">&quot;p:visible&quot;</span>).hide();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="c、内容过滤"><a href="#c、内容过滤" class="headerlink" title="c、内容过滤"></a>c、内容过滤</h4><p><strong>:contains</strong>    文本内容</p>
<p><strong>:has</strong>          标签</p>
<p><strong>:empty</strong>      空</p>
<p><strong>:parent</strong>      是否为父标签</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;div:contains(&#x27;也&#x27;)&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br><span class="line">$(<span class="string">&quot;div:has(span)&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br><span class="line">$(<span class="string">&quot;div:empty&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br><span class="line"><span class="comment">//:parent判断当前元素是否是父元素</span></span><br><span class="line">$(<span class="string">&quot;div:parent&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="d、表单过滤"><a href="#d、表单过滤" class="headerlink" title="d、表单过滤"></a>d、表单过滤</h4><p><strong>:enable</strong> 可用</p>
<p><strong>:disable</strong> 不可用</p>
<p><strong>:checked</strong> 选中 单选框radio 复选框checkbox</p>
<p><strong>:selected</strong> 选择 下拉列表select option</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;:input&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;orange&quot;</span>);</span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;:text&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;orange&quot;</span>);</span><br><span class="line">$(<span class="string">&quot;:password&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;orange&quot;</span>);</span><br><span class="line">$(<span class="string">&quot;:radio&quot;</span>).hide();</span><br><span class="line">$(<span class="string">&quot;:checkbox&quot;</span>).hide();</span><br><span class="line">$(<span class="string">&quot;:button&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;orange&quot;</span>);</span><br><span class="line">$(<span class="string">&quot;:image&quot;</span>).hide();</span><br><span class="line">$(<span class="string">&quot;:reset&quot;</span>).hide();</span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;input:checked&quot;</span>).hide();</span><br><span class="line">alert($(<span class="string">&quot;option:selected&quot;</span>).val());</span><br></pre></td></tr></table></figure>

<h2 id="五、样式css"><a href="#五、样式css" class="headerlink" title="五、样式css"></a>五、样式css</h2><h3 id="1、样式"><a href="#1、样式" class="headerlink" title="1、样式"></a>1、样式</h3><h4 id="（1）设置样式"><a href="#（1）设置样式" class="headerlink" title="（1）设置样式"></a>（1）设置样式</h4><p>设置多个属性使用<strong>大括号</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;div&quot;</span>).css(<span class="string">&quot;background-color&quot;</span>,<span class="string">&quot;pink&quot;</span>);</span><br><span class="line">$(<span class="string">&quot;div&quot;</span>).css(<span class="string">&quot;width&quot;</span>,<span class="string">&quot;150px&quot;</span>);</span><br><span class="line">$(<span class="string">&quot;div&quot;</span>).css(<span class="string">&quot;height&quot;</span>,<span class="string">&quot;150px&quot;</span>);</span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;div&quot;</span>).css(&#123;<span class="attr">backgroundColor</span>:<span class="string">&quot;pink&quot;</span>,<span class="attr">width</span>:<span class="string">&quot;150px&quot;</span>,<span class="string">&quot;height&quot;</span>:<span class="string">&quot;150px&quot;</span>,</span><br><span class="line"><span class="string">&quot;border-radius&quot;</span>:<span class="string">&quot;5%&quot;</span>&#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="（2）获取样式"><a href="#（2）获取样式" class="headerlink" title="（2）获取样式"></a>（2）获取样式</h4><p>获取多个样式使用<strong>中括号</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取单个属性的值</span></span><br><span class="line"><span class="keyword">var</span> obj=$(<span class="string">&quot;div&quot;</span>).css(<span class="string">&quot;color&quot;</span>);</span><br><span class="line">alert(obj);</span><br><span class="line"><span class="comment">//获取多个属性的值</span></span><br><span class="line"><span class="keyword">var</span> obj=$(<span class="string">&quot;div&quot;</span>).css([<span class="string">&quot;color&quot;</span>,<span class="string">&quot;font-size&quot;</span>,<span class="string">&quot;font-family&quot;</span>]);</span><br><span class="line"><span class="comment">//在控制台查看obj</span></span><br><span class="line"><span class="built_in">console</span>.log(obj)</span><br></pre></td></tr></table></figure>

<h4 id="（3）添加样式"><a href="#（3）添加样式" class="headerlink" title="（3）添加样式"></a>（3）添加样式</h4><p><strong>addClass、removeClass、toggleClass</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;#btn1&#x27;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	$(<span class="string">&#x27;div&#x27;</span>).addClass(<span class="string">&quot;style1&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$(<span class="string">&#x27;#btn3&#x27;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	$(<span class="string">&#x27;div&#x27;</span>).removeClass(<span class="string">&quot;style2&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//切换样式</span></span><br><span class="line">$(<span class="string">&#x27;#btn5&#x27;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	$(<span class="string">&#x27;div&#x27;</span>).toggleClass(<span class="string">&quot;style3&quot;</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="2、html"><a href="#2、html" class="headerlink" title="2、html"></a>2、html</h3><p><strong>.html()和.text()方法不能使用在表单元素上,而.val()只能使用在表单元素上；</strong></p>
<p><strong>.val()方法和.html()相同，如果其应用在元素集合上时，只能读取第一个表单元素的”value”值</strong></p>
<p><strong>但是.text()不一样，如果.text()应用在多个元素上时，将会读取所有选中元素的文本内容；</strong></p>
<p><strong>进行字符串拼接 ps: 利用标签属性（p/span/div/tr/td/li）</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建行  拼接字符串,添加到tbody中</span></span><br><span class="line"><span class="keyword">var</span> newcows=<span class="string">&quot;&lt;tr&gt;&lt;td&gt;&quot;</span>+lesson+<span class="string">&quot;&lt;/td&gt;&lt;td&gt;&quot;</span>+accedemic</span><br><span class="line">			+<span class="string">&quot;&lt;/td&gt;&lt;td&gt;&lt;a href=&#x27;javascrip:;&#x27; class=&#x27;del&#x27;&gt;删除&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> content=<span class="string">&quot;&lt;p&gt;&lt;span&gt;用户&quot;</span>+count+<span class="string">&quot;:&lt;/span&gt;&quot;</span>+$(<span class="string">&quot;#text&quot;</span>).val()+<span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="（1）html方法"><a href="#（1）html方法" class="headerlink" title="（1）html方法"></a>（1）html方法</h4><p>获得html代码，含有标签</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#btn1&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="comment">//读取innerHtml，只适用与DOM对象</span></span><br><span class="line">	<span class="keyword">var</span> content=$(<span class="string">&quot;#d1&quot;</span>).html();</span><br><span class="line">	alert(content);</span><br><span class="line">&#125;)</span><br><span class="line">$(<span class="string">&quot;#btn2&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	$(<span class="string">&quot;#d1&quot;</span>).html(<span class="string">&quot;ssss&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="（2）text方法"><a href="#（2）text方法" class="headerlink" title="（2）text方法"></a>（2）text方法</h4><p>获得文本值，将标签进行过滤</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#btn1&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;	 </span><br><span class="line">	<span class="keyword">var</span> content=$(<span class="string">&quot;.left&quot;</span>).text(); <span class="comment">//读，相当与DOM的innerText</span></span><br><span class="line">	alert(content);</span><br><span class="line">&#125;);</span><br><span class="line">$(<span class="string">&quot;#btn2&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="comment">//写</span></span><br><span class="line">	$(<span class="string">&quot;.left&quot;</span>).text(<span class="string">&quot;ssss&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="（3）val方法"><a href="#（3）val方法" class="headerlink" title="（3）val方法"></a>（3）val方法</h4><p>获得value的值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;.btn1&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="comment">//不带参的方法，读value</span></span><br><span class="line">	alert($(<span class="string">&quot;.txt&quot;</span>).val());</span><br><span class="line">	<span class="comment">// alert($(&quot;.txt&quot;)[0].value);</span></span><br><span class="line">&#125;);</span><br><span class="line">$(<span class="string">&quot;.btn2&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="comment">//带参的方法，写</span></span><br><span class="line">	$(<span class="string">&quot;.txt&quot;</span>).val(<span class="string">&quot;&quot;</span>);<span class="comment">//清空</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="六、元素宽高"><a href="#六、元素宽高" class="headerlink" title="六、元素宽高"></a>六、元素宽高</h2><h4 id="（1）元素的宽和高"><a href="#（1）元素的宽和高" class="headerlink" title="（1）元素的宽和高"></a>（1）元素的宽和高</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">alert(<span class="string">&quot;宽：&quot;</span>+$(<span class="string">&#x27;div&#x27;</span>).width()+<span class="string">&quot;高：&quot;</span>+$(<span class="string">&#x27;div&#x27;</span>).height());</span><br><span class="line"></span><br><span class="line">$(<span class="string">&#x27;div&#x27;</span>).width($(<span class="string">&#x27;div&#x27;</span>).width()+<span class="number">50</span>);</span><br><span class="line">$(<span class="string">&#x27;div&#x27;</span>).height($(<span class="string">&#x27;div&#x27;</span>).width()+<span class="number">50</span>);</span><br></pre></td></tr></table></figure>

<h4 id="（2）元素的位置"><a href="#（2）元素的位置" class="headerlink" title="（2）元素的位置"></a>（2）元素的位置</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alert(<span class="string">&quot;left:&quot;</span>+$(<span class="string">&#x27;div&#x27;</span>).offset().left+<span class="string">&quot;top:&quot;</span>+$(<span class="string">&#x27;div&#x27;</span>).offset().top);</span><br><span class="line">$(<span class="string">&#x27;div&#x27;</span>).offset(&#123;<span class="attr">left</span>:<span class="number">300</span>,<span class="attr">top</span>:<span class="number">300</span>&#125;); </span><br></pre></td></tr></table></figure>

<h4 id="（3）元素内部宽高"><a href="#（3）元素内部宽高" class="headerlink" title="（3）元素内部宽高"></a>（3）元素内部宽高</h4><p><strong>包括内边缘</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">alert($(<span class="string">&#x27;div&#x27;</span>).width());</span><br><span class="line">alert($(<span class="string">&#x27;div&#x27;</span>).height());</span><br><span class="line">alert($(<span class="string">&#x27;div&#x27;</span>).innerHeight());<span class="comment">// 100+10+10</span></span><br><span class="line">alert($(<span class="string">&#x27;div&#x27;</span>).innerWidth());</span><br></pre></td></tr></table></figure>

<h4 id="（4）元素外部宽高"><a href="#（4）元素外部宽高" class="headerlink" title="（4）元素外部宽高"></a>（4）元素外部宽高</h4><p><strong>outerWidth() 包括边框</strong></p>
<p><strong>outerWidth(true) 包括边框和外边缘</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">alert($(<span class="string">&#x27;div&#x27;</span>).outerHeight()); <span class="comment">//100+10+10+5+5</span></span><br><span class="line">alert($(<span class="string">&#x27;div&#x27;</span>).outerWidth());</span><br><span class="line">alert($(<span class="string">&#x27;div&#x27;</span>).outerHeight(<span class="literal">true</span>)); <span class="comment">//100+10+10+5+5+20+20</span></span><br><span class="line">alert($(<span class="string">&#x27;div&#x27;</span>).outerWidth(<span class="literal">true</span>)); </span><br></pre></td></tr></table></figure>

<h4 id="（5）节点操作"><a href="#（5）节点操作" class="headerlink" title="（5）节点操作"></a>（5）节点操作</h4><h5 id="a、内部插入"><a href="#a、内部插入" class="headerlink" title="a、内部插入"></a>a、内部插入</h5><p><strong>append、appendTo</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> $newNode1=$(<span class="string">&quot;&lt;li&gt;爱神&lt;/li&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;ul&quot;</span>).append($newNode1);</span><br><span class="line">$newNode1.appendTo(<span class="string">&quot;ul&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>前置插入prepend</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;ul&quot;</span>).prepend($newNode1);</span><br></pre></td></tr></table></figure>

<h5 id="b、外部插入"><a href="#b、外部插入" class="headerlink" title="b、外部插入"></a>b、外部插入</h5><p><strong>元素之前插入同辈节点</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;ul&quot;</span>).after($newNode1);</span><br><span class="line">$newNode1.insertAfter(<span class="string">&quot;ul&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>元素之后同辈节点</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;ul&quot;</span>).before($newNode1);</span><br><span class="line">$newNode1.insertBefore(<span class="string">&quot;ul&quot;</span>);</span><br></pre></td></tr></table></figure>

<h5 id="c、删除清空"><a href="#c、删除清空" class="headerlink" title="c、删除清空"></a>c、删除清空</h5><p><strong>删除、清空节点</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;ul li:eq(1)&quot;</span>).remove();</span><br><span class="line">$(<span class="string">&quot;ul li:eq(1)&quot;</span>).detach(); <span class="comment">//拆卸</span></span><br><span class="line">$(<span class="string">&quot;ul li:eq(1)&quot;</span>).empty();     </span><br></pre></td></tr></table></figure>

<h5 id="d、替换"><a href="#d、替换" class="headerlink" title="d、替换"></a>d、替换</h5><p><strong>替换节点</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;ul li:eq(1)&quot;</span>).replaceWith($newNode1);</span><br></pre></td></tr></table></figure>

<h5 id="e、复制"><a href="#e、复制" class="headerlink" title="e、复制"></a>e、复制</h5><p><strong>复制节点</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;ul li:eq(1)&quot;</span>).clone().appendTo(<span class="string">&quot;ul&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>输出元素本身html</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert($(<span class="string">&quot;&lt;div&gt;&lt;/div&gt;&quot;</span>).append($(<span class="string">&quot;ul li:eq(1)&quot;</span>).clone()).html());</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn=$(<span class="built_in">this</span>).clone(<span class="literal">true</span>); <span class="comment">//true指复印获得原件的事件</span></span><br><span class="line">$(<span class="string">&quot;body&quot;</span>).append(btn);</span><br></pre></td></tr></table></figure>

<h4 id="（6）素材遍历"><a href="#（6）素材遍历" class="headerlink" title="（6）素材遍历"></a>（6）素材遍历</h4><p><strong>each(function(i,e){</strong></p>
<p><strong>})</strong></p>
<p><strong>i 为元素下标，e为元素本身</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#btn&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	$(<span class="string">&quot;li&quot;</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params">i,e</span>)</span>&#123;</span><br><span class="line">		<span class="comment">// alert(i);</span></span><br><span class="line">		alert($(e).text())</span><br><span class="line">		<span class="comment">// alert($(this).text());</span></span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="（7）is"><a href="#（7）is" class="headerlink" title="（7）is"></a>（7）is</h4><p><strong>得到按钮状态</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> check=$(<span class="built_in">this</span>).is(<span class="string">&quot;:checked&quot;</span>);</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dmyang-only.github.io/2020/09/11/05uni-app/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dmYang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DmYoung">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/11/05uni-app/" class="post-title-link" itemprop="url">uni-app</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-09-11 12:33:33" itemprop="dateCreated datePublished" datetime="2020-09-11T12:33:33+08:00">2020-09-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-12-06 22:44:29" itemprop="dateModified" datetime="2020-12-06T22:44:29+08:00">2020-12-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
            </span>

          
            <span id="/2020/09/11/05uni-app/" class="post-meta-item leancloud_visitors" data-flag-title="uni-app" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h3><blockquote>
<p>结合jsp和ajax的优点，可以进行局部刷新</p>
<p>colorui,graceui</p>
</blockquote>
<h4 id="1、uni-app项目框架"><a href="#1、uni-app项目框架" class="headerlink" title="1、uni-app项目框架"></a>1、uni-app项目框架</h4><h5 id="1-1-pages-json"><a href="#1-1-pages-json" class="headerlink" title="1.1 pages.json"></a>1.1 pages.json</h5><blockquote>
<p>文件对uni-app进行全局配置</p>
<ul>
<li>gobalStyle-设置默认页面的窗口表现</li>
<li>pages-path(设置页面路径,每个新增页面需要增加path),style(设置页面窗口属性)</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&quot;pages&quot;: [ </span><br><span class="line">	&#123;</span><br><span class="line">		<span class="attr">&quot;path&quot;</span>: <span class="string">&quot;pages/index/index&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;style&quot;</span>: &#123;</span><br><span class="line">			<span class="attr">&quot;enablePullDownRefresh&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">			 <span class="attr">&quot;onReachBottomDistance&quot;</span>: <span class="number">300</span></span><br><span class="line">			&#125;</span><br><span class="line">	 &#125;</span><br><span class="line">	 ,&#123;</span><br><span class="line">          &quot;path&quot; : &quot;pages/user/user&quot;</span><br><span class="line">       &#125;</span><br><span class="line">      ,&#123;</span><br><span class="line">           &quot;path&quot; : &quot;pages/index/news-detail/news-detail&quot;,</span><br><span class="line">           &quot;style&quot; : &#123;&#125;</span><br><span class="line">       &#125;</span><br><span class="line"> ],</span><br><span class="line">&quot;globalStyle&quot;: &#123;</span><br><span class="line">		&quot;navigationStyle&quot;:&quot;custom&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="1-2-App-vue"><a href="#1-2-App-vue" class="headerlink" title="1.2 App.vue"></a>1.2 App.vue</h5><blockquote>
<p>调用<strong>应用app生命周期</strong>，配置全局样式</p>
<ul>
<li>onLauch- app加载之后，一般只调用一次<ul>
<li>访问本地缓存是否有用户登录，发送到服务器进行验证，验证通过静默登录</li>
<li>发送请求到服务器检测当前登录版本</li>
</ul>
</li>
<li>onShow- 启动或从后台进入</li>
<li>onHide- 前台进入后台</li>
</ul>
</blockquote>
<h5 id="1-3-main-js"><a href="#1-3-main-js" class="headerlink" title="1.3 main.js"></a>1.3 main.js</h5><blockquote>
<p>是uni-app的入口文件</p>
<ul>
<li>初始化vue实例</li>
<li>定义全局组件，使用需要的插件vuex</li>
</ul>
</blockquote>
<h5 id="1-4-uni-scss"><a href="#1-4-uni-scss" class="headerlink" title="1.4 uni.scss"></a>1.4 uni.scss</h5><blockquote>
<p>整体控制应用的风格</p>
</blockquote>
<h4 id="2、简单使用"><a href="#2、简单使用" class="headerlink" title="2、简单使用"></a>2、简单使用</h4><h5 id="2-1-显示返回数据"><a href="#2-1-显示返回数据" class="headerlink" title="2.1 显示返回数据"></a>2.1 显示返回数据</h5><blockquote>
<p>在模板template-view(div)中显示返回的后端数据 </p>
<p><strong>格式</strong>：{ {data} } 别名mustache   </p>
<p><strong>调用方法</strong>：@tap=”方法名”</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;view class&#x3D;&quot;content&quot;&gt;</span><br><span class="line">		&#123;&#123;(x&gt;y)?true:false&#125;&#125;</span><br><span class="line">		&lt;br&#x2F;&gt;</span><br><span class="line">		x:&#123;&#123;x&#125;&#125; y:&#123;&#123;y&#125;&#125;</span><br><span class="line">	&lt;button @tap&#x3D;&quot;add&quot; type&#x3D;&quot;default&quot;&gt;hello&lt;&#x2F;button&gt;</span><br><span class="line">	&lt;&#x2F;view&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">	export default &#123;</span><br><span class="line">		data() &#123;</span><br><span class="line">			return &#123;</span><br><span class="line">				x:3,</span><br><span class="line">				y:6</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		onLoad() &#123;</span><br><span class="line"></span><br><span class="line">		&#125;, </span><br><span class="line">		methods: &#123;</span><br><span class="line">			hello:function()&#123;</span><br><span class="line">				console.log(&#39;hello&#39;)</span><br><span class="line">			&#125;,</span><br><span class="line">			add:function()&#123;</span><br><span class="line">				this.x+&#x3D;1;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<h5 id="2-2-v-for-in循环"><a href="#2-2-v-for-in循环" class="headerlink" title="2.2 v-for-in循环"></a>2.2 v-for-in循环</h5><blockquote>
<p>格式 v-for=”(item,index)   in 遍历的对象集合” </p>
<ul>
<li>index 即遍历的下标，item 即遍历的对象</li>
<li>对于标签内属性可用  <code>：tap=&quot; &quot;代替 tap=&quot;&#123;&#123;&#125;&#125;&quot;</code></li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;view v-for&#x3D;&quot;(item,index) in articleList&quot; :key&#x3D;&quot;index&quot;&gt;</span><br><span class="line">		 	&#123;&#123;index&#125;&#125; &#123;&#123;item&#125;&#125;</span><br><span class="line">&lt;&#x2F;view&gt;</span><br></pre></td></tr></table></figure>



<h3 id="二、页面"><a href="#二、页面" class="headerlink" title="二、页面"></a>二、页面</h3><h4 id="1、页面生命周期"><a href="#1、页面生命周期" class="headerlink" title="1、页面生命周期"></a>1、页面生命周期</h4><h5 id="1-1-onload"><a href="#1-1-onload" class="headerlink" title="1.1 onload"></a>1.1 onload</h5><blockquote>
<p>页面加载事件</p>
</blockquote>
<blockquote>
<ul>
<li>可处理请求 <code>uni.request(&#123; url:&#39;&#39;, success(result)&#123; &#125;,fail(error)&#123; &#125;,complete()&#123; &#125; &#125;)</code></li>
<li>加载loading <code>uni.showloading(&#123;  &#125;)</code></li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">data() &#123;</span><br><span class="line">	return &#123;</span><br><span class="line">		&#x2F;&#x2F;返回的[&#123;&#125;,&#123;&#125;..]形式数据</span><br><span class="line">		articleList: []</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;,</span><br><span class="line">onLoad() &#123;</span><br><span class="line">	var _vue &#x3D; this;</span><br><span class="line">	uni.showLoading(&#123;</span><br><span class="line">		title: &#39;loading...&#39;</span><br><span class="line">	&#125;);</span><br><span class="line">	</span><br><span class="line">	uni.request(&#123;</span><br><span class="line">		url: &#39;https:&#x2F;&#x2F;unidemo.dcloud.net.cn&#x2F;api&#x2F;news&#39;,</span><br><span class="line">		success(result) &#123;</span><br><span class="line">			console.log(result.data);</span><br><span class="line">			_vue.articleList &#x3D; result.data;</span><br><span class="line">		&#125;,</span><br><span class="line">		fail(error) &#123;</span><br><span class="line">			console.log(error);</span><br><span class="line">		&#125;,</span><br><span class="line">		complete() &#123;</span><br><span class="line">			uni.hideLoading();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>



<h5 id="1-2-onReachBottom"><a href="#1-2-onReachBottom" class="headerlink" title="1.2 onReachBottom"></a>1.2 onReachBottom</h5><blockquote>
<p>页面上拉触底事件</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;注意一下request是一个异步请求，不会阻塞后面浏览器操作的运行，有时候会产生时序问题</span><br><span class="line">	onReachBottom() &#123;</span><br><span class="line">		var temArticleList &#x3D; this.articleList;</span><br><span class="line">		var length &#x3D; temArticleList.length;</span><br><span class="line">		for (var i &#x3D; 0; i &lt; length; i++) &#123;</span><br><span class="line">			this.articleList.push(temArticleList[i]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br></pre></td></tr></table></figure>



<h5 id="1-3-onPullDownRefresh"><a href="#1-3-onPullDownRefresh" class="headerlink" title="1.3 onPullDownRefresh"></a>1.3 onPullDownRefresh</h5><blockquote>
<p>下拉刷新事件</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">onPullDownRefresh() &#123;</span><br><span class="line">		var _vue &#x3D; this;</span><br><span class="line">		uni.showLoading(&#123;</span><br><span class="line">			title: &#39;loading...&#39;</span><br><span class="line">		&#125;);</span><br><span class="line">		uni.request(&#123;</span><br><span class="line">			url: &#39;https:&#x2F;&#x2F;unidemo.dcloud.net.cn&#x2F;api&#x2F;news&#39;,</span><br><span class="line">			success(result) &#123;</span><br><span class="line">				console.log(result.data);</span><br><span class="line">				_vue.articleList &#x3D; result.data;</span><br><span class="line">			&#125;,</span><br><span class="line">			fail(error) &#123;</span><br><span class="line">				console.log(error);</span><br><span class="line">			&#125;,</span><br><span class="line">			complete() &#123;</span><br><span class="line">				uni.hideLoading();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>



<h4 id="2、页面栈"><a href="#2、页面栈" class="headerlink" title="2、页面栈"></a>2、页面栈</h4><h5 id="2-1-navigateTo"><a href="#2-1-navigateTo" class="headerlink" title="2.1 navigateTo"></a>2.1 navigateTo</h5><blockquote>
<p><strong>新页面入栈</strong></p>
</blockquote>
<blockquote>
<p>根据postid进行页面跳转</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;view @tap&#x3D;&quot;navTo&quot; :data-postid&#x3D;&quot;item.post_id&quot; v-for&#x3D;&quot;(item, index) in articleList&quot; :key&#x3D;&quot;index&quot; class&#x3D;&quot;cu-card case&quot; :class&#x3D;&quot;isCard ? &#39;no-card&#39; : &#39;&#39;&quot;&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">	navTo: function(event) &#123;</span><br><span class="line">		var postid &#x3D; event.currentTarget.dataset.postid;</span><br><span class="line">		&#x2F;&#x2F;压栈页面跳转</span><br><span class="line">		uni.navigateTo(&#123;</span><br><span class="line">			url: &#39;news-detail&#x2F;news-detail?postid&#x3D;&#39; + postid</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">	data() &#123;</span><br><span class="line">		return &#123;</span><br><span class="line">			&#x2F;&#x2F;返回的是&#123;&#125;类型数据</span><br><span class="line">			article: &#123;&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;,</span><br><span class="line">	onLoad(data) &#123;</span><br><span class="line">		var _vue &#x3D; this;</span><br><span class="line">		uni.showLoading(&#123;</span><br><span class="line">			title: &#39;loading...&#39;</span><br><span class="line">		&#125;);</span><br><span class="line">		uni.request(&#123;</span><br><span class="line">			url: &#39;https:&#x2F;&#x2F;unidemo.dcloud.net.cn&#x2F;api&#x2F;news&#x2F;36kr&#x2F;&#39; + data.postid,</span><br><span class="line">			&#x2F;&#x2F;获得请求结果</span><br><span class="line">			success(result) &#123;</span><br><span class="line">				console.log(result.data);</span><br><span class="line">				_vue.article &#x3D; result.data;</span><br><span class="line">			&#125;,</span><br><span class="line">			fail(error) &#123;</span><br><span class="line">				console.log(error);</span><br><span class="line">			&#125;,</span><br><span class="line">			complete() &#123;</span><br><span class="line">				uni.hideLoading();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;,</span><br><span class="line">	methods: &#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h5 id="2-2-redirectTo"><a href="#2-2-redirectTo" class="headerlink" title="2.2 redirectTo"></a>2.2 redirectTo</h5><blockquote>
<p><strong>页面重定向：当前页面出栈，新页面入栈</strong></p>
</blockquote>
<h5 id="2-3-switchTap"><a href="#2-3-switchTap" class="headerlink" title="2.3 switchTap"></a>2.3 switchTap</h5><blockquote>
<p><strong>Tab切换：页面全部出栈，只留下新的 Tab 页面</strong></p>
</blockquote>
<h4 id="3、页面Tap"><a href="#3、页面Tap" class="headerlink" title="3、页面Tap"></a>3、页面Tap</h4><blockquote>
<p>pages.json中的添加tabBar属性</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&quot;tabBar&quot;: &#123;</span><br><span class="line">		&quot;list&quot;: [</span><br><span class="line">			&#123;</span><br><span class="line">				&quot;pagePath&quot;: &quot;pages&#x2F;index&#x2F;index&quot;,</span><br><span class="line">				&quot;iconPath&quot;: &quot;static&#x2F;tabbar&#x2F;basics.png&quot;,</span><br><span class="line">				&quot;selectedIconPath&quot;: &quot;static&#x2F;tabbar&#x2F;basics_cur.png&quot;,</span><br><span class="line">				&quot;text&quot;: &quot;首页&quot;</span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				&quot;pagePath&quot;: &quot;pages&#x2F;user&#x2F;user&quot;,</span><br><span class="line">				&quot;iconPath&quot;: &quot;static&#x2F;tabbar&#x2F;about.png&quot;,</span><br><span class="line">				&quot;selectedIconPath&quot;: &quot;static&#x2F;tabbar&#x2F;about_cur.png&quot;,</span><br><span class="line">				&quot;text&quot;: &quot;个人中心&quot;</span><br><span class="line">			&#125;</span><br><span class="line">		]</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dmyang-only.github.io/2020/09/11/03JavaScript/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dmYang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DmYoung">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/11/03JavaScript/" class="post-title-link" itemprop="url">js</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-09-11 12:33:33" itemprop="dateCreated datePublished" datetime="2020-09-11T12:33:33+08:00">2020-09-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-12-17 13:16:00" itemprop="dateModified" datetime="2020-12-17T13:16:00+08:00">2020-12-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
            </span>

          
            <span id="/2020/09/11/03JavaScript/" class="post-meta-item leancloud_visitors" data-flag-title="js" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>16k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>14 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>id唯一，name可以相同</p>
<h2 id="一、Js简介"><a href="#一、Js简介" class="headerlink" title="一、Js简介"></a>一、Js简介</h2><p>ECMAScript 6 （发布于 2015 年）是最新的 <a target="_blank" rel="noopener" href="https://www.w3school.com.cn/js/js_versions.asp">JavaScript 版本</a>。</p>
<ul>
<li><p>js可以内嵌在html中，是<strong>基于对象</strong>和<strong>事件驱动</strong>的脚本语言</p>
</li>
<li><p><strong>特点</strong>：<strong>交互性</strong>、<strong>安全性</strong>(JS不能访问本地磁盘)、<strong>跨平台性</strong>(浏览器中具备js解析器)</p>
</li>
</ul>
<h4 id="1-1-作用"><a href="#1-1-作用" class="headerlink" title="1.1 作用"></a>1.1 作用</h4><p>（1）动态修改html、css 中的代码</p>
<p>（2）动态校验数据</p>
<h4 id="1-2-组成"><a href="#1-2-组成" class="headerlink" title="1.2 组成"></a>1.2 组成</h4><ul>
<li><p>ECMAScript </p>
</li>
<li><p>BOM浏览器对象模型</p>
</li>
<li><p>DOM文档对象模型</p>
</li>
</ul>
<h4 id="1-3-引入"><a href="#1-3-引入" class="headerlink" title="1.3 引入"></a>1.3 引入</h4><h5 id="（1）内嵌"><a href="#（1）内嵌" class="headerlink" title="（1）内嵌"></a>（1）内嵌</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 内嵌 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;input type=&quot;button&quot; onclick=&quot;alert(&#x27;helloWorld&#x27;)&quot; /&gt; --&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="（2）内部脚本"><a href="#（2）内部脚本" class="headerlink" title="（2）内部脚本"></a>（2）内部脚本</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 内部脚本 --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- &lt;script type=&quot;text/javascript&quot;&gt;</span></span><br><span class="line"><span class="comment">			alert(&quot;helloword&quot;)</span></span><br><span class="line"><span class="comment">		&lt;/script&gt; --&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="（3）外部脚本"><a href="#（3）外部脚本" class="headerlink" title="（3）外部脚本"></a>（3）外部脚本</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 外部脚本 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js引入.js&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">//js文件</span><br><span class="line">alert(&#x27;helloWorld&#x27;)</span><br></pre></td></tr></table></figure>

<h2 id="二、基本语法"><a href="#二、基本语法" class="headerlink" title="二、基本语法"></a>二、基本语法</h2><blockquote>
<p>​    <strong>变量：var，const,  let</strong></p>
</blockquote>
<h4 id="2-1-原始数据类型"><a href="#2-1-原始数据类型" class="headerlink" title="2.1 原始数据类型"></a>2.1 原始数据类型</h4><p><strong>number</strong>数字类型</p>
<p><strong>string</strong>字符串类型</p>
<p><strong>boolean</strong>布尔类型</p>
<p><strong>null</strong>空类型（Object类型的一种）</p>
<p><strong>undefined</strong>未定义</p>
<p><strong>NaN</strong>:非数字，Not a Number</p>
<p>注意：number/boolean/string是伪对象</p>
<p><strong>typeof</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> v1=<span class="number">1</span>;</span><br><span class="line">alert(v1);</span><br><span class="line">alert(<span class="keyword">typeof</span> v1);</span><br></pre></td></tr></table></figure>

<h4 id="2-2-类型转换"><a href="#2-2-类型转换" class="headerlink" title="2.2 类型转换"></a>2.2 类型转换</h4><ul>
<li>number/boolean–&gt;string : <strong>toString</strong>()</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a=<span class="number">1</span>;</span><br><span class="line">alert(a);</span><br><span class="line">alert(<span class="keyword">typeof</span> a.toString());</span><br><span class="line"><span class="keyword">var</span> a1=<span class="literal">true</span>;</span><br><span class="line">alert(a1);</span><br><span class="line">alert(<span class="keyword">typeof</span> a1.toString())</span><br></pre></td></tr></table></figure>

<ul>
<li><p>string/boolean—&gt;number: <strong>parseInt</strong>()/ <strong>parseFloat</strong>()  <strong>boolean不能转，</strong></p>
<p>可以将数字字符串转换成number 如果“123a3sd5” 转成123</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a1=<span class="string">&quot;111.11as&quot;</span></span><br><span class="line">alert(a1);</span><br><span class="line">alert(<span class="built_in">parseInt</span>(a1))	<span class="comment">//111</span></span><br><span class="line">alert(<span class="built_in">parseFloat</span>(a1)) <span class="comment">//111.11</span></span><br><span class="line"><span class="keyword">var</span> a1=<span class="string">&quot;as111&quot;</span></span><br><span class="line">alert(a1);</span><br><span class="line">alert(<span class="built_in">parseInt</span>(a1))  <span class="comment">//字母在最前面转化不了</span></span><br><span class="line"><span class="keyword">var</span> b=<span class="literal">true</span>;</span><br><span class="line">alert(<span class="built_in">parseInt</span>(b))		<span class="comment">//转化失败为NaN</span></span><br></pre></td></tr></table></figure>

<h5 id="强制转换"><a href="#强制转换" class="headerlink" title="强制转换"></a>强制转换</h5><p><strong>Boolean</strong>() 强转为布尔</p>
<p>（1）数字强转成布尔  非零就是true   零就是false</p>
<p>（2）字符串强转成布尔  <code>非&quot;&quot;</code> (空字符串)就是true   空字符串<code>&quot;&quot;</code>就是false</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a=<span class="number">123</span>;</span><br><span class="line">a=<span class="number">0</span>;</span><br><span class="line">a=<span class="string">&quot;a&quot;</span>;</span><br><span class="line">a=<span class="string">&quot;&quot;</span>;</span><br><span class="line">alert(<span class="built_in">Boolean</span>(a))</span><br></pre></td></tr></table></figure>

<p><strong>Number</strong>() 强转为数字</p>
<p>（1）布尔转数字 true转成1  false转成0</p>
<p>（2）<strong>含非数字的字符串转数字 不能强转</strong>区别与parseInt()</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">alert(<span class="built_in">Boolean</span>(a))</span><br><span class="line"><span class="keyword">var</span> s=<span class="literal">false</span>;</span><br><span class="line">alert(<span class="built_in">Number</span>(s))</span><br><span class="line"><span class="keyword">var</span> s1=<span class="string">&quot;12aa123&quot;</span>;</span><br><span class="line">alert(<span class="built_in">Number</span>(s1))</span><br><span class="line">alert(<span class="built_in">parseInt</span>(s1));</span><br></pre></td></tr></table></figure>

<h4 id="2-3-引用数据类型"><a href="#2-3-引用数据类型" class="headerlink" title="2.3 引用数据类型"></a>2.3 引用数据类型</h4><p>js:  var obj=new Object()  /    var num=new Number()</p>
<h4 id="2-4-运算符"><a href="#2-4-运算符" class="headerlink" title="2.4 运算符"></a>2.4 运算符</h4><h5 id="（1）算术运算符"><a href="#（1）算术运算符" class="headerlink" title="（1）算术运算符"></a>（1）算术运算符</h5><p>+: 遇到字符串变成连接</p>
<p>-：先把字符串转成数字然后进行运算</p>
<p>/: 先把字符串转成数字然后进行运算(有小数点)</p>
<h5 id="（2）比较运算符"><a href="#（2）比较运算符" class="headerlink" title="（2）比较运算符"></a>（2）比较运算符</h5><p>===:全等：类型与值都要相等<br>==只判断值相等</p>
<h5 id="（3）void运算符"><a href="#（3）void运算符" class="headerlink" title="（3）void运算符"></a>（3）void运算符</h5><p>设置void运算符则点击后不会刷新网页</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- //void运算 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>没有void<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span>&gt;</span>有void<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="（4）类型运算符"><a href="#（4）类型运算符" class="headerlink" title="（4）类型运算符"></a>（4）类型运算符</h5><p>typeof 返回该数据类型</p>
<p>instanceof判断数据类型，是否某种类型</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alert(typeof obj);//object</span><br><span class="line">alert(obj instanceof Object);//true</span><br></pre></td></tr></table></figure>

<h4 id="2-5-逻辑语句"><a href="#2-5-逻辑语句" class="headerlink" title="2.5 逻辑语句"></a>2.5 逻辑语句</h4><p>if-else、switch (无while)</p>
<h5 id="（1）for"><a href="#（1）for" class="headerlink" title="（1）for"></a>（1）for</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">	alert(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="（2）for-in"><a href="#（2）for-in" class="headerlink" title="（2）for-in"></a>（2）for-in</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int arr&#x3D;[1,3,5,&quot;ss&quot;];</span><br><span class="line">for(index in arr)&#123;</span><br><span class="line">	alert(arr[index]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三、内建对象"><a href="#三、内建对象" class="headerlink" title="三、内建对象"></a>三、内建对象</h2><h4 id="1、Number"><a href="#1、Number" class="headerlink" title="1、Number"></a>1、Number</h4><p>var m=new Number(value);   var m1=Number(value)</p>
<p>m.toString() ; </p>
<p>valueof()</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a=<span class="string">&quot;123&quot;</span>;</span><br><span class="line">alert(a.valueOf())</span><br></pre></td></tr></table></figure>

<h4 id="2、Boolean"><a href="#2、Boolean" class="headerlink" title="2、Boolean"></a>2、Boolean</h4><p>var b=new Boolean(value)  var b=Boolean(value)</p>
<p>toString()  valueof()</p>
<h4 id="3、String"><a href="#3、String" class="headerlink" title="3、String"></a>3、String</h4><p>var s=new String(value)   var s=String(value)</p>
<p>length  charAt()   charCodeAt()  indexOf()   lastIndexOf()    split()   substr()  substring()  toUpperCase()</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str=<span class="keyword">new</span> <span class="built_in">String</span>(<span class="string">&quot;a-b-ss-FS&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> arr=str.split(<span class="string">&quot;-&quot;</span>);</span><br><span class="line">alert(str.length); <span class="comment">//9</span></span><br><span class="line">alert(str.charAt(<span class="number">4</span>));<span class="comment">//s</span></span><br><span class="line">alert(str.charCodeAt(<span class="number">4</span>));<span class="comment">//115</span></span><br><span class="line">alert(str.indexOf(<span class="string">&quot;s&quot;</span>)); <span class="comment">//4</span></span><br><span class="line">alert(str.toUpperCase())</span><br><span class="line">alert(str.toLowerCase())</span><br></pre></td></tr></table></figure>

<h4 id="4、Array"><a href="#4、Array" class="headerlink" title="4、Array"></a>4、Array</h4><p>var arr=new Array()  var arr=new Array(size)指定长度</p>
<p>var arr=[]  空数组   var arr=[1,2,5];</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">alert(arr.join(&quot;-&quot;))</span><br><span class="line">alert(arr.pop())  &#x2F;&#x2F;返回去除的最后一个元素</span><br><span class="line">alert(arr.push(5)) &#x2F;&#x2F;进入，返回长度</span><br><span class="line">alert(arr.reverse())</span><br><span class="line">alert(arr.sort())</span><br></pre></td></tr></table></figure>

<h4 id="5、Date"><a href="#5、Date" class="headerlink" title="5、Date"></a>5、Date</h4><p>var d=new Date()  var d=new Date(currentTime毫秒数)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">alert(date);</span><br><span class="line">alert(date.toString());</span><br><span class="line">alert(date.toLocaleString());</span><br><span class="line">alert(<span class="string">&quot;year:&quot;</span>+date.getFullYear());<span class="comment">//</span></span><br><span class="line">alert(<span class="string">&quot;month:&quot;</span>+(date.getMonth()+<span class="number">1</span>));<span class="comment">//</span></span><br><span class="line">alert(<span class="string">&quot;date:&quot;</span>+date.getDate());<span class="comment">//</span></span><br><span class="line">alert(<span class="string">&quot;day:&quot;</span>+date.getDay());<span class="comment">//</span></span><br><span class="line"><span class="keyword">var</span> time1 = date.getTime();</span><br><span class="line">alert(time1);</span><br><span class="line"><span class="keyword">var</span> time2 = <span class="number">1</span>*<span class="number">24</span>*<span class="number">60</span>*<span class="number">60</span>*<span class="number">1000</span>;</span><br><span class="line">alert(<span class="keyword">new</span> <span class="built_in">Date</span>(time1+time2).toLocaleString());</span><br></pre></td></tr></table></figure>

<h4 id="6、Math"><a href="#6、Math" class="headerlink" title="6、Math"></a>6、Math</h4><p>无构造，直接使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x=<span class="string">&quot;-198&quot;</span>;</span><br><span class="line">alert(<span class="built_in">Math</span>.abs(x))</span><br><span class="line"><span class="keyword">var</span> m=<span class="number">12.23</span>;</span><br><span class="line">alert(<span class="built_in">Math</span>.ceil(m));</span><br><span class="line">alert(<span class="built_in">Math</span>.floor(m));</span><br><span class="line">alert(<span class="built_in">Math</span>.round(m));</span><br><span class="line"><span class="keyword">var</span> x=<span class="number">1</span>; <span class="keyword">var</span> y=<span class="number">2</span>;</span><br><span class="line">alert(<span class="built_in">Math</span>.pow(x,y));</span><br><span class="line">alert(<span class="built_in">Math</span>.random())</span><br></pre></td></tr></table></figure>

<h4 id="7、RegExp"><a href="#7、RegExp" class="headerlink" title="7、RegExp"></a>7、RegExp</h4><blockquote>
<p><strong>reg.test(str)：返回<code>true/false</code></strong></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">		<span class="keyword">var</span> email=<span class="string">&quot;haohao_827@163.com&quot;</span></span><br><span class="line">		<span class="keyword">var</span> reg=<span class="regexp">/^[A-z]+[A-z0-9_-]*\@[A-z0-9]+\.[A-z]+$/</span>;</span><br><span class="line">		alert(reg.test(email))</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="四、js的函数"><a href="#四、js的函数" class="headerlink" title="四、js的函数"></a>四、js的函数</h2><h4 id="4-1-普通方式"><a href="#4-1-普通方式" class="headerlink" title="4.1 普通方式"></a>4.1 普通方式</h4><h5 id="（1）无参"><a href="#（1）无参" class="headerlink" title="（1）无参"></a>（1）无参</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">method</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	alert(<span class="string">&quot;111&quot;</span>);</span><br><span class="line">	alert(<span class="string">&quot;222&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">method();</span><br></pre></td></tr></table></figure>

<h5 id="（2）带参"><a href="#（2）带参" class="headerlink" title="（2）带参"></a>（2）带参</h5><blockquote>
<p><strong>实参和形参个数可以不同</strong></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">a,b,c</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> sum=a+b+c;</span><br><span class="line">        <span class="comment">//arguments是一个数组，封装所有实参</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="built_in">arguments</span>.length;i++)&#123;</span><br><span class="line">        	alert(<span class="built_in">arguments</span>[i]);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">fn(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="string">&quot;ss&quot;</span>);</span><br></pre></td></tr></table></figure>

<h5 id="（3）带有返回值"><a href="#（3）带有返回值" class="headerlink" title="（3）带有返回值"></a>（3）带有返回值</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">method4</span>(<span class="params">a,b</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// alert(&quot;aaa&quot;);</span></span><br><span class="line">    <span class="keyword">return</span> a+b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> sum=method4(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">alert(sum);</span><br></pre></td></tr></table></figure>

<h4 id="4-2-匿名函数"><a href="#4-2-匿名函数" class="headerlink" title="4.2 匿名函数"></a>4.2 匿名函数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> method2=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	alert(<span class="string">&quot;yyy&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line">method2();</span><br></pre></td></tr></table></figure>

<h4 id="4-3-参数"><a href="#4-3-参数" class="headerlink" title="4.3 参数"></a>4.3 参数</h4><p>a.形参和实参没有var修饰</p>
<p>b.个数不一定相同</p>
<p>c.arguments对象，封装传递进来的实参</p>
<p>d.return后面的代码不再执行</p>
<h4 id="4-4-js的全局函数"><a href="#4-4-js的全局函数" class="headerlink" title="4.4 js的全局函数"></a>4.4 js的全局函数</h4><p>强制转换：Number() 、String() 、Boolean()</p>
<p>转为数字：parseInt() 、parseFloat()</p>
<h2 id="五、事件"><a href="#五、事件" class="headerlink" title="五、事件"></a>五、事件</h2><h4 id="1、点击事件"><a href="#1、点击事件" class="headerlink" title="1、点击事件"></a>1、点击事件</h4><blockquote>
<p>onclick</p>
</blockquote>
<h5 id="绑定方式"><a href="#绑定方式" class="headerlink" title="绑定方式"></a>绑定方式</h5><p>（1）事件和响应内嵌在html标签中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">&quot;button&quot;</span> id=<span class="string">&quot;btn1&quot;</span> value=<span class="string">&quot;btn&quot;</span> onclick=<span class="string">&quot;alert(&#x27;but&#x27;)&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<p>（2）事件内嵌在html标签中，而响应行为用函数进行封装</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;input id=<span class="string">&quot;btn2&quot;</span> type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;button2&quot;</span> onclick=<span class="string">&quot;fn()&quot;</span> /&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	alert(<span class="string">&quot;button2&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（3）事件和响应完全分离</p>
<blockquote>
<p>document.getElementById(“id??”)</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;input id=<span class="string">&quot;btn&quot;</span> type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;button1&quot;</span> /&gt;</span><br><span class="line"><span class="keyword">var</span> btn=<span class="built_in">document</span>.getElementById(<span class="string">&quot;btn&quot;</span>);</span><br><span class="line">btn.onclick=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	alert(<span class="string">&quot;button1&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（4）this对当前id引用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;input id=<span class="string">&quot;btn1&quot;</span> name=<span class="string">&quot;mybtn1&quot;</span> type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;button1&quot;</span> onclick=<span class="string">&quot;fn(this)&quot;</span>/&gt;</span><br><span class="line">		&lt;br /&gt;</span><br><span class="line">&lt;input id=<span class="string">&quot;btn2&quot;</span> name=<span class="string">&quot;mybtn2&quot;</span> type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;button2&quot;</span> onclick=<span class="string">&quot;fn(this)&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">	alert(obj.value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2、onchange"><a href="#2、onchange" class="headerlink" title="2、onchange"></a>2、onchange</h4><p>域内容被改变的事件</p>
<p><strong>实现二级联动</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;city&quot;</span>&gt;</span><br><span class="line">    &lt;option value=<span class="string">&quot;bj&quot;</span>&gt;北京&lt;/option&gt;</span><br><span class="line">    &lt;option value=<span class="string">&quot;tj&quot;</span>&gt;天津&lt;/option&gt;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line">&lt;select id=<span class="string">&quot;area&quot;</span>&gt;</span><br><span class="line">    &lt;option&gt;海淀&lt;/option&gt;</span><br><span class="line">    &lt;option&gt;朝阳&lt;/option&gt;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> select=<span class="built_in">document</span>.getElementById(<span class="string">&quot;city&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> area=<span class="built_in">document</span>.getElementById(<span class="string">&quot;area&quot;</span>);</span><br><span class="line">select.onchange=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> optionVal=select.value;</span><br><span class="line">    <span class="keyword">switch</span>(optionVal)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;bj&#x27;</span>:</span><br><span class="line">        area.innerHTML=<span class="string">&quot;&lt;option&gt;海淀&lt;/option&gt;&lt;option&gt;朝阳&lt;/option&gt;&lt;option&gt;东城&lt;/option&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;tj&#x27;</span>:</span><br><span class="line">        area.innerHTML=<span class="string">&quot;&lt;option&gt;南开&lt;/option&gt;&lt;option&gt;西青&lt;/option&gt;&lt;option&gt;河东&lt;/option&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3、焦点事件"><a href="#3、焦点事件" class="headerlink" title="3、焦点事件"></a>3、焦点事件</h4><blockquote>
<p>onfocus:获得焦点的事件</p>
<p>onblur:失去焦点的事件</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;label <span class="keyword">for</span>=<span class="string">&quot;txt&quot;</span>&gt;name&lt;/label&gt;</span><br><span class="line">	&lt;input type=<span class="string">&quot;text&quot;</span> id=<span class="string">&quot;txt&quot;</span>/&gt;</span><br><span class="line">	&lt;span id=<span class="string">&quot;info&quot;</span>&gt;&lt;/span&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> txt=<span class="built_in">document</span>.getElementById(<span class="string">&quot;txt&quot;</span>);</span><br><span class="line">txt.onfocus=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//友好提示</span></span><br><span class="line">    <span class="keyword">var</span> span=<span class="built_in">document</span>.getElementById(<span class="string">&quot;info&quot;</span>);</span><br><span class="line">    span.innerHTML=<span class="string">&quot;&lt;font color=&#x27;green&#x27;&gt;用户名格式最小8位&lt;/font&gt;&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line">		</span><br><span class="line">txt.onblur=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> span=<span class="built_in">document</span>.getElementById(<span class="string">&quot;info&quot;</span>);</span><br><span class="line">    span.innerHTML=<span class="string">&quot;对不起,格式不正确&quot;</span>;</span><br><span class="line">    span.style.color=<span class="string">&quot;red&quot;</span>;			</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="4、鼠标事件"><a href="#4、鼠标事件" class="headerlink" title="4、鼠标事件"></a>4、鼠标事件</h4><blockquote>
<p>onmouseover:鼠标悬浮事件</p>
<p>onmouseout:鼠标离开事件</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> div=<span class="built_in">document</span>.getElementById(<span class="string">&quot;btn1&quot;</span>);</span><br><span class="line">	<span class="comment">// 移入</span></span><br><span class="line">	div.onmouseover=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		div.style.backgroundColor=<span class="string">&quot;red&quot;</span>;</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="comment">//移出鼠标</span></span><br><span class="line">	div.onmouseout=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		div.style.backgroundColor=<span class="string">&quot;gray&quot;</span>;</span><br><span class="line">	&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="5、加载事件"><a href="#5、加载事件" class="headerlink" title="5、加载事件"></a>5、加载事件</h4><blockquote>
<p>加载完毕的事件</p>
<p>等到页面加载完毕再执行onload事件所指向的函数</p>
<p>window.onload=function()}{</p>
<p>​    }</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> span=<span class="built_in">document</span>.getElementById(<span class="string">&quot;sp1&quot;</span>);</span><br><span class="line">	span.innerHTML=<span class="string">&quot;&lt;h1&gt;helloWorld&lt;/h1&gt;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6、提交事件"><a href="#6、提交事件" class="headerlink" title="6、提交事件"></a>6、提交事件</h4><blockquote>
<p>window.confirm(“xxx”)</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">&quot; &quot;</span> method=<span class="string">&quot;post&quot;</span> onsubmit=<span class="string">&quot;return isDelete()&quot;</span>&gt;</span><br><span class="line">	姓名：小明</span><br><span class="line">	&lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;删除&quot;</span>/&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">111100</span>&lt;a href=<span class="string">&quot;delete.jsp&quot;</span> onclick=<span class="string">&quot;return confirm(&#x27;删除吗&#x27;)&quot;</span>&gt;删除&lt;/a&gt;</span><br><span class="line"><span class="number">222222</span>&lt;a href=<span class="string">&quot;delete.jsp&quot;</span> onclick=<span class="string">&quot;isDelete()&quot;</span>&gt;删除&lt;/a&gt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isDelete</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">var</span> isDelete=<span class="built_in">window</span>.confirm(<span class="string">&quot;你确定删除吗&quot;</span>)</span><br><span class="line">   <span class="keyword">if</span>(isDelete)&#123;</span><br><span class="line">        <span class="comment">// return true;</span></span><br><span class="line">     &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//阻止默认提交</span></span><br><span class="line">       	event.preventDefault();</span><br><span class="line">        <span class="comment">// return false;</span></span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="六、bom"><a href="#六、bom" class="headerlink" title="六、bom"></a>六、bom</h2><p>bom（浏览器对象模型）</p>
<p><img src="https://csn.damyoung.cn/image-20200901164941262.png" alt="image-20200901164941262"></p>
<h4 id="1、window对象"><a href="#1、window对象" class="headerlink" title="1、window对象"></a>1、window对象</h4><h5 id="（1）弹框"><a href="#（1）弹框" class="headerlink" title="（1）弹框"></a>（1）弹框</h5><p>提示框：alert(<strong>“提示信息”</strong>)</p>
<p>确认框：confirm(“确认信息”)  返回true或false</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> res=<span class="built_in">window</span>.confirm(<span class="string">&quot;你确认删除吗&quot;</span>);</span><br><span class="line">alert(res);</span><br></pre></td></tr></table></figure>

<p>输入框：prompt(“输入信息”)  返回值(返回输入的文本)，取消返回null</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> con=<span class="built_in">window</span>.prompt(<span class="string">&quot;请输入密码？&quot;</span>);</span><br><span class="line">alert(con);</span><br></pre></td></tr></table></figure>

<h5 id="（2）open方法"><a href="#（2）open方法" class="headerlink" title="（2）open方法"></a>（2）open方法</h5><p>window.open(‘page.html’, ‘newwindow’, ‘height=100, width=400, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no’) </p>
<p>window.open 弹出新窗口的命令；<br>‘page.html’ 弹出窗口的文件名；?　　<br>‘newwindow’ 弹出窗口的名字（不是文件名），非必须，可用空’’代替；?<br>height=100 窗口高度；?<br>width=400 窗口宽度；?<br>top=0 窗口距离屏幕上方的象素值；?    </p>
<p>left=0 窗口距离屏幕左侧的象素值；?<br>toolbar=no 是否显示工具栏，yes为显示；?<br>menubar，scrollbars 表示菜单栏和滚动栏。?<br>resizable=no 是否允许改变窗口大小，yes为允许；?<br>location=no 是否显示地址栏，yes为允许；?<br>status=no 是否显示状态栏内的信息（通常是文件已经打开），yes为允许</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;打开窗口&quot;</span> onclick=<span class="string">&quot;winopen()&quot;</span> /&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;关闭窗口&quot;</span> onclick=<span class="string">&quot;winclose()&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">winopen</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	win=<span class="built_in">window</span>.open(<span class="string">&quot;http://www.baidu.com&quot;</span>);</span><br><span class="line"><span class="comment">//win=window.open(&quot;http://www.baidu.com&quot;,&quot;newwindow&quot;,&quot;width=400px,height=400&quot;)	</span></span><br><span class="line">&#125;</span><br><span class="line">		</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">winclose</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    win.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">选择季节</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;season&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;winopen2()&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">function winopen2()&#123;</span><br><span class="line">	win=window.open(&quot;season.html&quot;,&quot;&quot;,&quot;width=500,height=300,top=200,left=200&quot;); </span><br><span class="line">&#125;</span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;season&quot;</span> <span class="attr">value</span>=<span class="string">&quot;春天&quot;</span> <span class="attr">checked</span>=<span class="string">&quot;checked&quot;</span> /&gt;</span>春天<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;season&quot;</span> <span class="attr">value</span>=<span class="string">&quot;夏天&quot;</span>/&gt;</span>夏天<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;season&quot;</span> <span class="attr">value</span>=<span class="string">&quot;秋天&quot;</span>/&gt;</span>秋天<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;season&quot;</span> <span class="attr">value</span>=<span class="string">&quot;冬天&quot;</span>/&gt;</span>冬天<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;btn&quot;</span>  <span class="attr">value</span>=<span class="string">&quot;选择&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;fn()&quot;</span>/&gt;</span>	</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">		<span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="keyword">var</span> myseason;</span></span><br><span class="line"><span class="javascript">			<span class="comment">//name--&gt;select,checked--&gt;value</span></span></span><br><span class="line"><span class="javascript">			<span class="keyword">var</span> selectseason=<span class="built_in">document</span>.getElementsByName(<span class="string">&quot;season&quot;</span>);</span></span><br><span class="line"><span class="javascript">			<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;selectseason.length;i++)&#123;</span></span><br><span class="line"><span class="javascript">				<span class="keyword">if</span>(selectseason[i].checked==<span class="literal">true</span>)&#123;</span></span><br><span class="line">					myseason=selectseason[i].value;</span><br><span class="line"><span class="javascript">					<span class="keyword">break</span>;</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"><span class="javascript">            <span class="comment">//opener指打开它的父窗口，window</span></span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.opener.document.getElementById(<span class="string">&quot;season&quot;</span>).value=myseason;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.close();</span></span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2、location"><a href="#2、location" class="headerlink" title="2、location"></a>2、location</h4><blockquote>
<p>​        <strong>location.href=”url地址”;</strong></p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">value</span>=<span class="string">&quot;跳转&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://www.baidu.com&quot;</span>&gt;</span>百度<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> btn=<span class="built_in">document</span>.getElementById(<span class="string">&quot;btn&quot;</span>);</span></span><br><span class="line"><span class="javascript">	btn.onclick=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">		location.href=<span class="string">&quot;http://www.baidu.com&quot;</span>;</span></span><br><span class="line">	&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="3、定时器"><a href="#3、定时器" class="headerlink" title="3、定时器"></a>3、定时器</h4><blockquote>
<p>settimeout 设置延时时间</p>
<p>​    clearInterval(timer) 清除时间间隔</p>
<p>setInterval 设置时间间隔</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">&quot;button&quot;</span>value=<span class="string">&quot;俩秒后弹出提示&quot;</span> onclick=<span class="string">&quot;fn1()&quot;</span> /&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;button&quot;</span>value=<span class="string">&quot;每俩秒弹出提示&quot;</span> onclick=<span class="string">&quot;fn2()&quot;</span> /&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;button&quot;</span>value=<span class="string">&quot;每俩秒弹出提示2&quot;</span> onclick=<span class="string">&quot;fn()&quot;</span> /&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;button&quot;</span>value=<span class="string">&quot;清除&quot;</span> onclick=<span class="string">&quot;fn3()&quot;</span> /&gt;</span><br><span class="line"><span class="keyword">var</span> timer;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="built_in">window</span>.setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">			alert(<span class="string">&quot;helloworld&quot;</span>)</span><br><span class="line">		&#125;,<span class="number">2000</span>);</span><br><span class="line">&#125;</span><br><span class="line">		</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		alert(<span class="string">&quot;helloworld&quot;</span>);</span><br><span class="line">		timer=<span class="built_in">window</span>.setTimeout(fn2,<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line">		</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		timer=<span class="built_in">window</span>.setInterval(</span><br><span class="line">		<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">			alert(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">		&#125;,<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn3</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">clearInterval</span>(timer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4、history"><a href="#4、history" class="headerlink" title="4、history"></a>4、history</h4><blockquote>
<p>back forward</p>
<p>go(-1)  go(1)</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上一页&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;history.back()&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;下一页&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;history.forward()()&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上一页&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;history.go(-1)&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;下一页&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;history.go(1)&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="5、move"><a href="#5、move" class="headerlink" title="5、move"></a>5、move</h4><blockquote>
<p>移动：moveTo 绝对  moveBy 相对</p>
<p>改变大小：resizeTo绝对  resizeBy相对</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;移动&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;move()&quot;</span> /&gt;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;改变大小（绝对值）&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;change1()&quot;</span> /&gt;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;改变大小（相对值）&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;change2()&quot;</span> /&gt;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">			<span class="function"><span class="keyword">function</span> <span class="title">move</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">				<span class="built_in">window</span>.moveBy(<span class="number">200</span>,<span class="number">400</span>);</span></span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line"><span class="javascript">			<span class="function"><span class="keyword">function</span> <span class="title">change1</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">				<span class="built_in">window</span>.resizeTo(<span class="number">400</span>,<span class="number">200</span>);</span></span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line"><span class="javascript">			<span class="function"><span class="keyword">function</span> <span class="title">change2</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">				<span class="built_in">window</span>.resizeBy(<span class="number">100</span>,<span class="number">100</span>);</span></span><br><span class="line">			&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6、广告漂浮"><a href="#6、广告漂浮" class="headerlink" title="6、广告漂浮"></a>6、广告漂浮</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">move</span>(<span class="params"></span>)</span>&#123;								         </span><br><span class="line">        <span class="built_in">document</span>.getElementById(<span class="string">&quot;layer1&quot;</span>).style.left=<span class="built_in">Math</span>.random()*<span class="number">1166</span>+<span class="string">&quot;px&quot;</span>;</span><br><span class="line">		<span class="built_in">document</span>.getElementById(<span class="string">&quot;layer1&quot;</span>).style.top=<span class="built_in">Math</span>.random()*<span class="number">500</span>+<span class="string">&quot;px&quot;</span>;</span><br><span class="line">		<span class="built_in">setTimeout</span>(move,<span class="number">1000</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;body onload=<span class="string">&quot;move();&quot;</span>&gt;</span><br><span class="line">	&lt;div id=<span class="string">&quot;layer1&quot;</span> style=<span class="string">&quot;position:absolute;&quot;</span>&gt;</span><br><span class="line">		&lt;a href=<span class="string">&quot;http://&quot;</span>&gt;</span><br><span class="line">		    &lt;img src=<span class="string">&quot;mm.jpg&quot;</span> width=<span class="string">&quot;200&quot;</span> height=<span class="string">&quot;200&quot;</span> border=<span class="string">&quot;0&quot;</span>&gt;</span><br><span class="line">		&lt;/a&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">	&lt;h2&gt;随机漂浮的广告&lt;/h2&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>

<h2 id="七、Dom"><a href="#七、Dom" class="headerlink" title="七、Dom"></a>七、Dom</h2><p>dom文档对象模型</p>
<h4 id="1、Element"><a href="#1、Element" class="headerlink" title="1、Element"></a>1、Element</h4><blockquote>
<p>getElementById</p>
<p>getElementByNames</p>
<p>getElementByTagName</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> txt=<span class="built_in">document</span>.getElementById(<span class="string">&quot;tid&quot;</span>);</span><br><span class="line">	alert(txt.value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;tname&quot;</span> value=<span class="string">&quot;砺锋IT精英培训_1&quot;</span> id=<span class="string">&quot;tid_1&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;tname&quot;</span> value=<span class="string">&quot;砺锋IT精英培训_2&quot;</span> id=<span class="string">&quot;tid_2&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;tname&quot;</span> value=<span class="string">&quot;砺锋IT精英培训_3&quot;</span> id=<span class="string">&quot;tid_3&quot;</span>&gt;&lt;br&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> inputNodes=<span class="built_in">document</span>.getElementsByName(<span class="string">&quot;tname&quot;</span>);</span><br><span class="line">alert(inputNodes.length);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;inputNodes.length;i++)&#123;</span><br><span class="line">   <span class="keyword">var</span> inputNode=inputNodes[i];</span><br><span class="line">   alert(inputNode.value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var inputNodes=document.getElementsByTagName(&quot;input&quot;);</span><br><span class="line">			alert(inputNodes.length);</span><br><span class="line">			for(var i=0;i&lt;inputNodes.length;i++)&#123;</span><br><span class="line">				var inputNode=inputNodes[i];</span><br><span class="line">				alert(inputNode.value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2、innerHtml"><a href="#2、innerHtml" class="headerlink" title="2、innerHtml"></a>2、innerHtml</h4><blockquote>
<p>innerHTML</p>
<p>innerText</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;subject&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">h3</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span><span class="attr">value</span>=<span class="string">&quot;获取HTML&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;fn1()&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span><span class="attr">value</span>=<span class="string">&quot;替换HTML&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;fn2()&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span><span class="attr">value</span>=<span class="string">&quot;获取TEXT&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;fn3()&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//获取</span></span></span><br><span class="line"><span class="javascript">		<span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="keyword">var</span> div=<span class="built_in">document</span>.getElementById(<span class="string">&quot;subject&quot;</span>);</span></span><br><span class="line">			alert(div.innerHTML);</span><br><span class="line">		&#125;</span><br><span class="line"><span class="javascript">		<span class="comment">//替换</span></span></span><br><span class="line"><span class="javascript">		<span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="keyword">var</span> div=<span class="built_in">document</span>.getElementById(<span class="string">&quot;subject&quot;</span>);</span></span><br><span class="line"><span class="handlebars"><span class="xml">			div.innerHTML=&quot;<span class="tag">&lt;<span class="name">h1</span>&gt;</span>JQUERY<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>&quot;;</span></span></span><br><span class="line">		&#125;</span><br><span class="line"><span class="javascript">		<span class="comment">//获取text（javaScript）</span></span></span><br><span class="line"><span class="javascript">		<span class="function"><span class="keyword">function</span> <span class="title">fn3</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="keyword">var</span> div=<span class="built_in">document</span>.getElementById(<span class="string">&quot;subject&quot;</span>);</span></span><br><span class="line">			alert(div.innerText);</span><br><span class="line">		&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="3、全选和全不选"><a href="#3、全选和全不选" class="headerlink" title="3、全选和全不选"></a>3、全选和全不选</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;td&gt;<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;all&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">value</span>=<span class="string">&quot;全选&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;check();&quot;</span> /&gt;</span></span>全选&lt;/td&gt;</span><br><span class="line"></span><br><span class="line">&lt;td&gt;<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;product&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;checkAll();&quot;</span>/&gt;</span></span>&lt;/td&gt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>)</span>&#123;	</span><br><span class="line">	<span class="keyword">var</span> all=<span class="built_in">document</span>.getElementById(<span class="string">&quot;all&quot;</span>);</span><br><span class="line">	<span class="keyword">var</span> flag=all.checked;</span><br><span class="line">	<span class="keyword">var</span> products=<span class="built_in">document</span>.getElementsByName(<span class="string">&quot;product&quot;</span>);</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;products.length;i++)&#123;</span><br><span class="line">             products[i].checked=flag;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">                                            </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkAll</span>(<span class="params"></span>)</span>&#123;			</span><br><span class="line">     <span class="keyword">var</span> products=<span class="built_in">document</span>.getElementsByName(<span class="string">&quot;product&quot;</span>);</span><br><span class="line">     <span class="keyword">var</span> all=<span class="built_in">document</span>.getElementById(<span class="string">&quot;all&quot;</span>);</span><br><span class="line">     <span class="keyword">var</span> flag=<span class="literal">true</span>;</span><br><span class="line">	 <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;products.length;i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(products[i].checked==<span class="literal">false</span>)&#123;</span><br><span class="line">			flag=<span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	all.checked=flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://dmyang-only.github.io/2020/08/11/05%E5%B8%B8%E8%A7%81%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dmYang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DmYoung">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/11/05%E5%B8%B8%E8%A7%81%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="post-title-link" itemprop="url">设计模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-08-11 12:33:33" itemprop="dateCreated datePublished" datetime="2020-08-11T12:33:33+08:00">2020-08-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-12-17 13:17:24" itemprop="dateModified" datetime="2020-12-17T13:17:24+08:00">2020-12-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">设计模式</span></a>
                </span>
            </span>

          
            <span id="/2020/08/11/05%E5%B8%B8%E8%A7%81%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="post-meta-item leancloud_visitors" data-flag-title="设计模式" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>12k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>11 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一、创建型模式"><a href="#一、创建型模式" class="headerlink" title="一、创建型模式"></a>一、创建型模式</h2><h3 id="1、单例模式"><a href="#1、单例模式" class="headerlink" title="1、单例模式"></a><strong>1</strong>、单例模式</h3><p>Singleton</p>
<blockquote>
<p>一个类只有一个实例，且该类能自行创建这个实例的一种模式</p>
</blockquote>
<p><strong>特点</strong></p>
<blockquote>
<ul>
<li>私有的构造方法，外部不能直接创建该类的实例</li>
</ul>
</blockquote>
<p><strong>应用</strong></p>
<blockquote>
<ul>
<li>某类只要求生成一个对象，对象需要被共享的场合</li>
<li>当某类需要频繁实例化，而创建的对象又频繁被销毁的时候</li>
</ul>
<p>​    如多线程的线程池、tomcat连接池等</p>
</blockquote>
<h4 id="1-1-懒汉式"><a href="#1-1-懒汉式" class="headerlink" title="1.1 懒汉式"></a>1.1 懒汉式</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Lhan</span></span>&#123;</span><br><span class="line">    <span class="comment">//私有的构造方法</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Lhan</span><span class="params">()</span></span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Lhan instance=<span class="keyword">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Lhan <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//balking模式</span></span><br><span class="line">        <span class="keyword">if</span>(instance!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        &#125;</span><br><span class="line">        instance=<span class="keyword">new</span> Lhan();</span><br><span class="line">        returen instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>多次调用都会调用Synchronized锁，性能较低。</li>
</ul>
<h4 id="1-2-饿汉式"><a href="#1-2-饿汉式" class="headerlink" title="1.2 饿汉式"></a>1.2 饿汉式</h4><blockquote>
<p>实例在初始化的时候已经创建，<strong>JVM在加载类的时候是单线程的，由于实例被static修饰</strong>，故没有线程安全的问题</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Ehan</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">    <span class="comment">//私有的构造方法</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Ehan</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Lhan instance=<span class="keyword">new</span> Ehan();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Ehan <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        returen instance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//防止反序列化破坏单例</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">readResolve</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>final–防止子类继承覆盖，破坏单例</li>
<li>构造方法私有，防止创建新的实例，但不能防止反射创建新的实例</li>
<li>static修饰在加载类时创建，JVM在加载类的时候是单线程，可以保证是线程安全的。</li>
<li><strong>方法封装提供一些懒惰的初始化，提供泛型的支持</strong></li>
</ul>
<h4 id="1-3-双检锁式"><a href="#1-3-双检锁式" class="headerlink" title="1.3 双检锁式"></a>1.3 双检锁式</h4><blockquote>
<p>特点是在synchronized关键字内外都加了一层 if 条件判断</p>
<p>既保证了线程安全，又比直接上锁提高了执行效率，还节省了内存空间</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span></span>&#123;</span><br><span class="line">    <span class="comment">//私有的构造方法</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Lhan</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Singleton instance=<span class="keyword">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance==<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(Singleton.class)&#123;</span><br><span class="line">                <span class="comment">//防止并发下，单例对象不会被重复创建。</span></span><br><span class="line">                <span class="keyword">if</span>(instance==<span class="keyword">null</span>)&#123;</span><br><span class="line">                    <span class="comment">//当t1到达这里，未实例化null</span></span><br><span class="line">                    instance=<span class="keyword">new</span> Singleton();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>双重if，防止并发条件下，单例对象不会被重复创建。</li>
</ul>
<h4 id="1-4-静态内部类"><a href="#1-4-静态内部类" class="headerlink" title="1.4 静态内部类"></a>1.4 静态内部类</h4><blockquote>
<p>实例化设置为静态内部类的一个静态属性。</p>
<p>只适用于静态域的情况，双检锁方式可在实例域需要延迟初始化时使用。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonHolder</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton INSTANCE=<span class="keyword">new</span> Singleton();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>第一次使用时，才会触发类加载操作的，故属于懒汉式</p>
</li>
<li><p>类加载时JVM是单线程的，无线程安全问题。</p>
</li>
</ul>
<h4 id="1-5-枚举单例"><a href="#1-5-枚举单例" class="headerlink" title="1.5 枚举单例"></a>1.5 枚举单例</h4><blockquote>
<p>可为饿汉式的改进</p>
<p>自动支持序列化机制，绝对防止多次实例化。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Singleton</span></span>&#123;</span><br><span class="line">    <span class="comment">//实例化</span></span><br><span class="line">    INSTANCE;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">get</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;枚举单例&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Singleton instance = Singleton.INSTANCE;</span><br><span class="line">    instance.get();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>枚举实例是静态的，创建时线程安全</li>
<li>不能被反射破坏单例</li>
<li>枚举类默认实现序列化接口，不会被反序列破坏单例</li>
<li>属于饿汉式单例</li>
</ul>
<h3 id="2、原型模式"><a href="#2、原型模式" class="headerlink" title="2、原型模式"></a>2、原型模式</h3><blockquote>
<p>Prototype</p>
<p><strong>用一个已经创建的实例作为原型，通过拷贝这些原型创建新的对象</strong></p>
<p>Object类clone()方法提供了浅克隆，实现Cloneable接口实现浅克隆</p>
</blockquote>
<p><strong>应用</strong></p>
<ul>
<li>对象的创建过程比较麻烦，但复制比较简单</li>
<li>对象之间相同或相似，仅有个别属性不同</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">implements</span> <span class="title">Cloneable</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Object <span class="title">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">        Dog dog=<span class="keyword">new</span> Dog();</span><br><span class="line">        dog.id=<span class="keyword">this</span>.id;</span><br><span class="line">        dog.name=<span class="keyword">this</span>.name;</span><br><span class="line">        <span class="keyword">return</span> dog;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Dog dog=<span class="keyword">new</span> Dog();</span><br><span class="line"><span class="comment">//需要强转</span></span><br><span class="line">Dog clone = (Dog) dog.clone();</span><br><span class="line">System.out.println(dog);</span><br><span class="line">System.out.println(clone);</span><br></pre></td></tr></table></figure>

<p><strong>改进</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> score;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Student <span class="title">copy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Student std = <span class="keyword">new</span> Student();</span><br><span class="line">        std.id = <span class="keyword">this</span>.id;</span><br><span class="line">        std.name = <span class="keyword">this</span>.name;</span><br><span class="line">        std.score = <span class="keyword">this</span>.score;</span><br><span class="line">        <span class="keyword">return</span> std;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3、工厂模式"><a href="#3、工厂模式" class="headerlink" title="3、工厂模式"></a>3、工厂模式</h3><h4 id="3-1-简单工厂模式"><a href="#3-1-简单工厂模式" class="headerlink" title="3.1 简单工厂模式"></a>3.1 简单工厂模式</h4><blockquote>
<ul>
<li>将全部创建逻辑集中到了一个工厂类中；</li>
<li>它所能创建的类只能是事先考虑到的，如果需要添加新的类，则就需要改变工厂类了，而增加、删除某个子类对象的创建都需要打开简单工厂类来进行修改违背了开闭原则。</li>
<li>又称为<strong>静态工厂模式</strong></li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">interface</span> <span class="title">Oberation</span></span>&#123;</span><br><span class="line"> 	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getResult</span><span class="params">(<span class="keyword">double</span> numberA,<span class="keyword">double</span> numberB)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//具体实现类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Add</span> <span class="keyword">implements</span> <span class="title">Operation</span></span>&#123;</span><br><span class="line">    <span class="comment">// 加法计算</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getResult</span><span class="params">(<span class="keyword">double</span> numberA, <span class="keyword">double</span> numberB)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> numberA + numberB;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sub</span> <span class="keyword">implements</span> <span class="title">Operation</span></span>&#123;</span><br><span class="line">    <span class="comment">// 减法计算</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getResult</span><span class="params">(<span class="keyword">double</span> numberA, <span class="keyword">double</span> numberB)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> numberA-numberB;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//定义简单工厂类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleFatory</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 简单工厂，根据字符串创建相应的对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Operation <span class="title">createOperation</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        Operation operationObj = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">switch</span> (name) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;+&quot;</span>:</span><br><span class="line">                operationObj = <span class="keyword">new</span> Add();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;-&quot;</span>:</span><br><span class="line">                operationObj = <span class="keyword">new</span> Sub();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">     	&#125;</span><br><span class="line">     	<span class="keyword">return</span> operationObj;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Opera</span></span>&#123;</span><br><span class="line">    Operation op=SimpleFatort.createOperation(<span class="string">&quot;+&quot;</span>);</span><br><span class="line">    op.getResult(<span class="number">3</span>,<span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="3-2-工厂方法模式"><a href="#3-2-工厂方法模式" class="headerlink" title="3.2 工厂方法模式"></a>3.2 工厂方法模式</h4><blockquote>
<ul>
<li>用户只需要知道具体工厂的名称就可得到所要的产品，无须知道产品的具体创建过程；</li>
<li>在系统增加新的产品时只需要添加具体产品类和对应的具体工厂类，无须对原工厂进行任何修改，满足开闭原则</li>
</ul>
</blockquote>
<blockquote>
<ol>
<li>抽象工厂（Abstract Factory）：提供了创建产品的接口，调用者通过它访问具体工厂的工厂方法 newProduct() 来创建产品。</li>
<li>具体工厂（ConcreteFactory）：主要是实现抽象工厂中的抽象方法，完成具体产品的创建。</li>
<li>抽象产品（Product）：定义了产品的规范，描述了产品的主要特性和功能。</li>
<li>具体产品（ConcreteProduct）：实现了抽象产品角色所定义的接口，由具体工厂来创建，它同具体工厂之间一一对应。</li>
</ol>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//工厂抽象接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Operation <span class="title">createOperation</span><span class="params">()</span> </span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//产品抽象接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Operation</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getResult</span><span class="params">(<span class="keyword">double</span> numberA,<span class="keyword">double</span> numberB)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加法类工厂</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AddFactory</span> <span class="keyword">implements</span> <span class="title">Factory</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Operation <span class="title">createOperation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;加法运算&quot;</span>);</span><br><span class="line">        <span class="comment">//加法对象</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Add();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 减法类工厂</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SubFactory</span> <span class="keyword">implements</span> <span class="title">Factory</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Operation <span class="title">createOperation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;减法运算&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Sub();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Add</span> <span class="keyword">implements</span> <span class="title">Operation</span></span>&#123;</span><br><span class="line">    <span class="comment">// 加法计算</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getResult</span><span class="params">(<span class="keyword">double</span> numberA, <span class="keyword">double</span> numberB)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> numberA + numberB;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sub</span> <span class="keyword">implements</span> <span class="title">Operation</span></span>&#123;</span><br><span class="line">    <span class="comment">// 减法计算</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getResult</span><span class="params">(<span class="keyword">double</span> numberA, <span class="keyword">double</span> numberB)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> numberA-numberB;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 使用反射机制实例化工厂对象，因为字符串是可以通过变量改变的</span></span><br><span class="line">        Factory addFactory = (Factory) Class.forName(<span class="string">&quot;org.zero01.factory.AddFactory&quot;</span>).newInstance();</span><br><span class="line">        Factory subFactory=(Factory) Class.forName(<span class="string">&quot;org.zero01.factory.SubFactory&quot;</span>).newInstance();</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 通过工厂对象创建相应的实例对象</span></span><br><span class="line">        Operation add = addFactory.createOperation();</span><br><span class="line">        Operation sub = subFactory.createOperation();</span><br><span class="line"> </span><br><span class="line">        System.out.println(add.getResult(<span class="number">1</span>, <span class="number">1</span>));</span><br><span class="line">        System.out.println(sub.getResult(<span class="number">1</span>, <span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>应用</strong></p>
<blockquote>
<ul>
<li>客户只知道创建产品的工厂名，而不知道具体的产品名。如 TCL 电视工厂、海信电视工厂等。</li>
<li>创建对象的任务由多个具体子工厂中的某一个完成，而抽象工厂只提供创建产品的接口。</li>
<li>客户不关心创建产品的细节，只关心产品的品牌。</li>
</ul>
</blockquote>
<h4 id="3-3-抽象工厂模式"><a href="#3-3-抽象工厂模式" class="headerlink" title="3.3 抽象工厂模式"></a>3.3 抽象工厂模式</h4><blockquote>
<p>抽象工厂模式将考虑多等级产品的生产，将同一个具体工厂所生产的位于不同等级的一组产品称为一个产品族</p>
<p><strong>应用</strong></p>
<ul>
<li>系统中有多个产品族，每个具体工厂创建同一族但属于不同等级结构的产品。</li>
<li>系统一次只可能消费其中某一族产品，即同族的产品一起使用。</li>
</ul>
<p><strong>优点</strong></p>
<ul>
<li>可以在类的内部对产品族中相关联的多等级产品共同管理，而不必专门引入多个新的类来进行管理。</li>
<li>当增加一个<strong>新的产品族</strong>时不需要修改原代码，满足开闭原则。</li>
<li>但当产品族中需要增加一个<strong>新种类的产品</strong>时，则所有的工厂类都需要进行修改，不满足开闭原则。</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Horse</span> <span class="keyword">implements</span> <span class="title">Aniaml</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Plant</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fruitage</span> <span class="keyword">implements</span> <span class="title">Plant</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//抽象工厂</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Farm</span></span>&#123;</span><br><span class="line">    <span class="comment">//Animal产品</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Animal <span class="title">newAnimal</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//Plant产品</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Plant <span class="title">newPlant</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//具体工厂</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SGfarm</span> <span class="keyword">implements</span> <span class="title">Farm</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Animal <span class="title">newAnimal</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Cattle();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Plant <span class="title">newPlant</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Vegetables();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="二、结构型模式"><a href="#二、结构型模式" class="headerlink" title="二、结构型模式"></a>二、结构型模式</h2><h3 id="1、享元模式"><a href="#1、享元模式" class="headerlink" title="1、享元模式"></a>1、享元模式</h3><blockquote>
<p><strong>重用数量有限的同一类对象</strong></p>
</blockquote>
<h4 id="1-1-体现"><a href="#1-1-体现" class="headerlink" title="1.1 体现"></a>1.1 体现</h4><p><strong>包装类</strong></p>
<p>Long.valueOf(long l) 避免重复数量的重复创建。-128~127</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title">valueOf</span><span class="params">(<span class="keyword">long</span> l)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> offset = <span class="number">128</span>;</span><br><span class="line">    <span class="keyword">if</span> (l &gt;= -<span class="number">128</span> &amp;&amp; l &lt;= <span class="number">127</span>) &#123; <span class="comment">// will cache</span></span><br><span class="line">        <span class="keyword">return</span> LongCache.cache[(<span class="keyword">int</span>)l + offset];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Long(l);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-2-自定义线程池"><a href="#1-2-自定义线程池" class="headerlink" title="1.2 自定义线程池"></a>1.2 自定义线程池</h4><blockquote>
<p>一次请求到达后，从连接池获取连接，使用完毕再还回连接池。</p>
<p>节约了连接的创建和关闭时间，也实现了<strong>连接的复用</strong>，不至于让庞大的连接数压垮数据库</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Pool pool=<span class="keyword">new</span> Pool(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">            Connection connection=pool.borrow();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="keyword">new</span> Random().nextInt(<span class="number">1000</span>));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            pool.free(connection);</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pool</span></span>&#123;</span><br><span class="line">    <span class="comment">//1.连接池大小</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> poolSize;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.连接对象 数组</span></span><br><span class="line">    <span class="keyword">private</span> Connection[] connections;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.连接状态数组 0表示空闲 1表示繁忙</span></span><br><span class="line">    <span class="keyword">private</span> AtomicIntegerArray state;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Pool</span><span class="params">(<span class="keyword">int</span> poolSize)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.poolSize = poolSize;</span><br><span class="line">        <span class="keyword">this</span>.connections = <span class="keyword">new</span> Connection[poolSize];</span><br><span class="line">        <span class="keyword">this</span>.state = <span class="keyword">new</span> AtomicIntegerArray(<span class="keyword">new</span> <span class="keyword">int</span>[poolSize]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;poolSize ; i++) &#123;</span><br><span class="line">            connections[i]=<span class="keyword">new</span> MockConnection();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//借连接</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Connection <span class="title">borrow</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;poolSize; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (state.get(i)==<span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="comment">//CAS</span></span><br><span class="line">                    <span class="keyword">if</span> (state.compareAndSet(i,<span class="number">0</span>,<span class="number">1</span>))&#123;</span><br><span class="line">                        <span class="keyword">return</span> connections[i];</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//如果没有空闲连接，当前线程进入等待！！！</span></span><br><span class="line">            <span class="keyword">synchronized</span> (<span class="keyword">this</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">this</span>.wait();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//归还连接</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">free</span><span class="params">(Connection connection)</span></span>&#123;</span><br><span class="line">        <span class="comment">//判断归还的连接对象是否为连接池的连接！！！</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;poolSize; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (connections[i]==connection) &#123;</span><br><span class="line">                state.set(i,<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">synchronized</span> (<span class="keyword">this</span>)&#123;</span><br><span class="line">                    <span class="comment">//唤醒wait线程</span></span><br><span class="line">                    <span class="keyword">this</span>.notifyAll();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MockConnection</span> <span class="keyword">implements</span> <span class="title">Connection</span></span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2、适配器模式"><a href="#2、适配器模式" class="headerlink" title="2、适配器模式"></a>2、适配器模式</h3><blockquote>
<p>Adapter</p>
<p><strong>将一个类的接口转换成另一个接口，使得原本接口不兼容而不能工作的类可以工作</strong></p>
<p><code>InputStreamReader</code>、<code>Array.asList(T[])</code></p>
</blockquote>
<h5 id="2-1-自定义适配器"><a href="#2-1-自定义适配器" class="headerlink" title="2.1 自定义适配器"></a>2.1 <strong>自定义适配器</strong></h5><blockquote>
<p>由于new Thread(Runnable runnable)，不能接收Callable接口，可以使用适配器。</p>
</blockquote>
<p><strong>适配器构建</strong></p>
<ul>
<li>实现目标接口Runnable</li>
<li>内部进行接口转化，Callable</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span> <span class="keyword">implements</span> <span class="title">Callable</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            System.out.println(sum+=i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RunnableAdapter</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Callable callable;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RunnableAdapter</span><span class="params">(Callable callable)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.callable=callable;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            callable.call();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Task task=<span class="keyword">new</span> Task();</span><br><span class="line">    Thread thread=<span class="keyword">new</span> Thread(<span class="keyword">new</span> RunnableAdapter(task));</span><br><span class="line">    thread.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="2-2-API使用"><a href="#2-2-API使用" class="headerlink" title="2.2 API使用"></a>2.2 API使用</h5><blockquote>
<p>string[] ==&gt; Set的构造方法需要一个集合</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">    map = <span class="keyword">new</span> HashMap&lt;&gt;(Math.max((<span class="keyword">int</span>) (c.size()/<span class="number">.75f</span>) + <span class="number">1</span>, <span class="number">16</span>));</span><br><span class="line">    addAll(c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String[] strings=&#123;<span class="string">&quot;ag&quot;</span>,<span class="string">&quot;sa&quot;</span>,<span class="string">&quot;sfd&quot;</span>&#125;;</span><br><span class="line">HashSet&lt;String&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;(Arrays.asList(strings));</span><br></pre></td></tr></table></figure>



<blockquote>
<p>InputStream==Reader</p>
<ul>
<li>要求使用字符流，而只提供字节流</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">InputStream inputStream=<span class="keyword">new</span> FileInputStream(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">Reader reader=<span class="keyword">new</span> InputStreamReader(inputStream);</span><br></pre></td></tr></table></figure>



<h3 id="3、代理模式"><a href="#3、代理模式" class="headerlink" title="3、代理模式"></a>3、代理模式</h3><blockquote>
<p>Proxy</p>
<p><strong>为其他对象提供一种代理以控制对这个对象的访问</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> AProxy implements A&#123;</span><br><span class="line">	<span class="keyword">private</span> A a;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">AProxy</span><span class="params">(A a)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.a=a;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">a</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (getCurrentUser().isRoot()) &#123;</span><br><span class="line">        	<span class="keyword">this</span>.a.a();</span><br><span class="line">   		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        	<span class="keyword">throw</span> <span class="keyword">new</span> SecurityException(<span class="string">&quot;Forbidden&quot;</span>);</span><br><span class="line">    	&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>优点</strong></p>
<ul>
<li>在客户端与目标对象之间起到一个中介作用和保护目标对象的作用</li>
<li>扩展目标对象的功能</li>
<li>将客户端与目标对象分离，在一定程度上降低了系统的耦合度，增加程序的可扩展性</li>
</ul>
<p><strong>代理类型</strong></p>
<p>远程代理：把对接口的方法访问转换成远程调用，返回结果</p>
<p>虚代理：先让调用者先持有一个代理对象，真正的对象尚未创建。</p>
<p>保护代理：用代理对象控制对原始对象的访问，用于鉴权</p>
<p>​    </p>
<h3 id="4、装饰器模式"><a href="#4、装饰器模式" class="headerlink" title="4、装饰器模式"></a>4、装饰器模式</h3><blockquote>
<p>decorator</p>
<p><strong>动态的给对象添加一些额外的职责</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">             ┌───────────┐</span><br><span class="line">             │ Component │</span><br><span class="line">             └───────────┘</span><br><span class="line">                   ▲</span><br><span class="line">      ┌────────────┼─────────────────┐</span><br><span class="line">      │            │                 │</span><br><span class="line">┌───────────┐┌───────────┐     ┌───────────┐</span><br><span class="line">│ComponentA ││ComponentB │...  │ Decorator │</span><br><span class="line">└───────────┘└───────────┘     └───────────┘</span><br><span class="line">                                     ▲</span><br><span class="line">                              ┌──────┴──────┐</span><br><span class="line">                              │             │</span><br><span class="line">                        ┌───────────┐ ┌───────────┐</span><br><span class="line">                        │DecoratorA │ │DecoratorB │...</span><br><span class="line">                        └───────────┘ └───────────┘</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>把核心功能和附加功能给分开了</strong></p>
<p>核心功能指<code>FileInputStream</code>这些真正读数据的源头，附加功能指加缓冲、压缩、解密这些功能。</p>
<p>新增核心功能，就增加Component的子类，例如<code>ByteInputStream</code>。</p>
<p>增加附加功能，就增加Decorator的子类，例如<code>CipherInputStream</code>。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建原始的数据源:</span></span><br><span class="line">InputStream fis = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;test.gz&quot;</span>);</span><br><span class="line"><span class="comment">// 增加缓冲功能:</span></span><br><span class="line">InputStream bis = <span class="keyword">new</span> BufferedInputStream(fis);</span><br><span class="line"><span class="comment">// 增加解压缩功能:</span></span><br><span class="line">InputStream gis = <span class="keyword">new</span> GZIPInputStream(bis);</span><br></pre></td></tr></table></figure>



<h2 id="三、行为型模式"><a href="#三、行为型模式" class="headerlink" title="三、行为型模式"></a>三、行为型模式</h2><h3 id="1、责任链模式"><a href="#1、责任链模式" class="headerlink" title="1、责任链模式"></a>1、责任链模式</h3><blockquote>
<p>chain of Responsibility</p>
<p>使多个对象都有机会处理请求，将这些对象连成一条链，并沿着这条链传递请求，直到有一个对象处理它为止，避免请求的发送者与接收者之间的耦合关系。</p>
</blockquote>
<blockquote>
<p>当每个Handler都做一些工作，处理request,通常这些责任链被称为拦截器、过滤器</p>
<ul>
<li>记录日志；</li>
<li>检查权限；</li>
<li>准备相关资源；</li>
<li>…</li>
</ul>
</blockquote>
<p><strong>Servlet中filter</strong></p>
<blockquote>
<p>不但允许每个<code>Filter</code>都有机会处理请求，还允许每个<code>Filter</code>决定是否将请求“放行”给下一个<code>Filter</code>：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuditFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest req, ServletResponse resp, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        log(req);</span><br><span class="line">        <span class="keyword">if</span> (check(req)) &#123;</span><br><span class="line">            <span class="comment">// 放行:</span></span><br><span class="line">            chain.doFilter(req, resp);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 拒绝:</span></span><br><span class="line">            sendError(resp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2、模板模式"><a href="#2、模板模式" class="headerlink" title="2、模板模式"></a>2、模板模式</h3><blockquote>
<p>template method</p>
<p><strong>定义一个操作中的算法的骨架，而将一些步骤延迟到子类</strong></p>
<p><strong>使得子类可以不改变算法结构而重定义算法中的某些特定步骤</strong></p>
<ul>
<li>父类定义骨架，子类实现某些细节</li>
<li>为了防止子类重写父类的骨架方法，可以在父类中对骨架方法使用<code>final</code>。</li>
<li>对于需要子类实现的抽象方法，一般声明为<code>protected</code>，使得这些方法对外部客户端不可见。</li>
</ul>
</blockquote>
<p><strong>应用数据库缓存</strong></p>
<blockquote>
<p>定义一个算法骨架,而将一些步骤延迟到子类(lookupCache/putIntoCache)</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractSetting</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">getSetting</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        String value = lookupCache(key);</span><br><span class="line">        <span class="keyword">if</span> (value == <span class="keyword">null</span>) &#123;</span><br><span class="line">            value = readFromDatabase(key);</span><br><span class="line">            putIntoCache(key, value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> String <span class="title">lookupCache</span><span class="params">(String key)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">putIntoCache</span><span class="params">(String key, String value)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>假设我们希望用一个<code>Map</code>做缓存，那么可以写一个<code>LocalSetting</code>：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LocalSetting</span> <span class="keyword">extends</span> <span class="title">AbstractSetting</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; cache = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> String <span class="title">lookupCache</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cache.get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">putIntoCache</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line">        cache.put(key, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果我们要使用Redis做缓存，那么可以再写一个<code>RedisSetting</code>：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisSetting</span> <span class="keyword">extends</span> <span class="title">AbstractSetting</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> RedisClient client = RedisClient.create(<span class="string">&quot;redis://localhost:6379&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> String <span class="title">lookupCache</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (StatefulRedisConnection&lt;String, String&gt; connection = client.connect()) &#123;</span><br><span class="line">            RedisCommands&lt;String, String&gt; commands = connection.sync();</span><br><span class="line">            <span class="keyword">return</span> commands.get(key);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">putIntoCache</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (StatefulRedisConnection&lt;String, String&gt; connection = client.connect()) &#123;</span><br><span class="line">            RedisCommands&lt;String, String&gt; commands = connection.sync();</span><br><span class="line">            commands.set(key, value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">dmYang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">42</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">dmYang</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">397k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">6:01</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        






<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              Counter('post', '/classes/Counter', { title, url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.error('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"ILChxMKtMF9QxnXpVTEUYylP-9Nh9j0Va","app_key":"cgsT0BJR6ER5caEl0mwuFGPP","server_url":null,"security":false};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


      </div>
    </footer>
  </div>

  
  <script src="/xxb/anime.min.js"></script>
  <script src="/xxb/velocity/velocity.min.js"></script>
  <script src="/xxb/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>;
    <script>
      // 背景图片
      $("body").backstretch("https://csn.damyoung.cn/image-20201218100852830.png");
    </script>

    <!-- 页面点击小红心 -->
    <script type="text/javascript" src="/js/love.js"></script>
</body>
</html>
